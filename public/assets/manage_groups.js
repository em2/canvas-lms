I18n.scoped("groups",function(h){window.contextGroups={autoLoadGroupThreshold:15,loadMembersForGroup:function(a){var b=$("#manage_group_urls .list_users_url").attr("href"),c=a.getTemplateData({textValues:["group_id"]}).group_id;b=$.replaceTags(b,"id",c);a.find(".load_members_link").hide();a.find(".loading_members").show();$.ajaxJSON(b,"GET",null,function(d){a.find(".student").remove();for(var f=$(".user_template"),g=0;g<d.length;g++){var e=d[g],j=f.clone();j.removeClass("user_template");j.addClass("user_id_"+
e.user_id);j.fillTemplateData({data:e});contextGroups.insertIntoGroup(j,a);a.find(".user_count_hidden").text("0");$(window).triggerHandler("resize");contextGroups.updateCategoryCounts(a.parents(".group_category"))}a.find(".loading_members").hide()})},loadUnassignedMembersPage:function(a,b){if(!(b<0&&a.data("page_loaded"))){b=Math.abs(b);if(b==0)b=a.data("page_loaded")||1;var c=a.closest(".group_category").data("category_id"),d=$("#manage_group_urls .list_unassigned_users_url").attr("href");d+="?category_id="+
c+"&page="+b;a.find(".load_members_link").hide();a.find(".loading_members").text(h.t("status.loading","Loading..."));a.find(".loading_members").show();$.ajaxJSON(d,"GET",null,function(f){a.data("page_loaded",b);a.find(".user_count").text(h.t("category.student","student",{count:f.total_entries}));a.find(".user_count_hidden").text(f.total_entries-f.users.length);a.find(".group_user_count").show();a.find(".student").remove();for(var g=$(".user_template"),e=f.users,j=0;j<e.length;j++){var i=e[j],l=g.clone();
l.removeClass("user_template");l.addClass("user_id_"+i.user_id);l.fillTemplateData({data:i});contextGroups.insertIntoGroup(l,a)}a.find(".loading_members").html(f.pagination_html);a.find(".unassigned_members_pagination a").click(function(k){k.preventDefault();match=/page=(\d+)/.exec($(this).attr("href"));if(match.length>=1){k=match[1];contextGroups.loadUnassignedMembersPage($(this).closest(".group_blank").first(),k)}});$(window).triggerHandler("resize")})}},moveToGroup:function(a,b){if(a.parents(".group")[0]!=
b[0]){var c=b.getTemplateData({textValues:["group_id"]}).group_id,d=a.getTemplateData({textValues:["user_id"]}).user_id,f=a.parents(".group"),g=$("#manage_group_urls .add_user_url").attr("href");method="POST";if(!c||c.length==0){g=$("#manage_group_urls .remove_user_url").attr("href");method="DELETE";c=f.getTemplateData({textValues:["group_id"]}).group_id}g=$.replaceTags(g,"id",c);c={user_id:d};a.remove();var e=a;contextGroups.insertIntoGroup(a,b);$category=b.parents(".group_category");if($category.hasClass("student_organized")&&
!b.hasClass("group_blank")){var j=a.clone();e=e.add(j);contextGroups.insertIntoGroup(j,f)}a=e;a.addClass("event_pending");contextGroups.updateCategoryCounts(b.parents(".group_category"));$.ajaxJSON(g,method,c,function(i){var l=b.parents(".group_category").data("category_id");$(".student.user_"+d).each(function(){var m=$(this).find(".category_"+l+"_group_id");if(!m||m.length==0){m=$(document.createElement("span"));m.addClass("category_"+l+"_group_id");$(this).find(".data").append(m)}m.text(i.group_membership.group_id||
"")});a.removeClass("event_pending");contextGroups.updateCategoryCounts(b.parents(".group_category"));var k=$(f);k=k.add(b);contextGroups.updateCategoryHeterogeneity(b.parents(".group_category"),k);k=b.parents(".group_category").find(".group_blank");var n=k.find(".student_list .student").length,o=parseInt(k.find(".user_count_hidden").text());n<=5&&o>0&&contextGroups.loadUnassignedMembersPage(k,0)},function(i){a.remove();a=a.first();contextGroups.insertIntoGroup(a,f);a.removeClass("event_pending");
contextGroups.updateCategoryCounts($category);i=i.errors&&i.errors.user_id?i.errors.user_id[0].message:h.t("errors.unknown","An unexpected error occurred.");$.flashError(i)})}},insertIntoGroup:function(a,b){var c=null,d=a.getTemplateData({textValues:["name","user_id"]}),f=d.name;if(!(b.find(".student_list .user_id_"+d.user_id).length>0)){b.find(".student.user_"+d.user_id).remove();b.find(".student_list .student").each(function(){if($(this).getTemplateData({textValues:["name"]}).name>f){c=$(this);
return false}});c?c.before(a):b.find(".student_list").append(a);a.draggable({helper:function(){var g=$(this).clone().css("cursor","pointer");g.addClass("dragging");g.width($(this).width());$(this).parents(".group_category").append(g);return g}})}},updateCategoryCounts:function(a){a.find(".group").each(function(){var c=$(this).find(".student_list .student").length+parseInt($(this).find(".user_count_hidden").text());$(this).find(".user_count").text(h.t("category.student","student",{count:c}))});var b=
a.find(".group:not(.group_blank)").length;a.find(".group_count").text(h.t("group","Group",{count:b}));a.find(".group").each(function(){$(this).find(".expand_collapse_links").showIf($(this).find(".student_list li").length>0)})},updateCategoryHeterogeneity:function(a,b){var c=false;b.each(function(){var d=null;$(this).hasClass("group_blank")||$(this).find(".student_list .student .section_id").each(function(){other_section_id=$(this).text();if(d===null||d==="")d=other_section_id;else if(other_section_id!==
""&&d!==other_section_id)c=true})});a.find(".heterogenous").text(c?"true":"false")},populateCategory:function(a){a=$(a);a.find(".group").each(function(){var b=parseInt($(this).find(".user_count_hidden").text());b<contextGroups.autoLoadGroupThreshold&&b>0&&contextGroups.loadMembersForGroup($(this))});a.length&&contextGroups.loadUnassignedMembersPage(a.find(".group_blank"),-1)},updateCategory:function(a,b){a.find(".category_name").text(b.name);$(a.data("tab_link")).text(b.name);$("#sidebar_category_"+
b.id+" .category").text(b.name);a.find(".self_signup").text(b.self_signup||"");a.find(".self_signup_text").showIf(b.self_signup);a.find(".restricted_self_signup_text").showIf(b.self_signup==="restricted");a.find(".assign_students_link").showIf(b.self_signup!=="restricted")},addGroupToSidebar:function(a){if(!($("#sidebar_group_"+a.id).length>0)){var b=$("#sidebar_category_"+a.group_category_id);if(b.length==0){b=$("#sidebar_category_blank").clone(true);b.find("ul").empty();b.fillTemplateData({data:a,
id:"sidebar_category_"+a.group_category_id});$(".sidebar_category:last").after(b.show())}var c=$("#sidebar_group_blank").clone(true);c.fillTemplateData({data:a,hrefValues:["id"],id:"sidebar_group_"+a.id});b.find("ul").append(c.show());$("#category_header").show()}},droppable_options:{accept:".student",hoverClass:"hover",tolerance:"pointer",drop:function(a,b){$(".group_category > .student").remove();contextGroups.moveToGroup($(b.draggable),$(this))}}};$(document).ready(function(){$("li.student").live("mousedown",
function(a){a.preventDefault();return false});$("#group_tabs").tabs();$("#group_tabs").bind("tabsselect",function(a,b){contextGroups.populateCategory(b.panel)});$(".group").filter(function(){return $(this).parents("#category_template").length==0}).droppable(contextGroups.droppable_options);$(".add_group_link").click(function(a){a.preventDefault();a=$(this).parents(".group_category");var b=$("#category_template").find(".group_blank").clone(true);b.removeAttr("id");b.find(".student_list").empty();b.removeClass("group_blank");
b.find(".load-more").hide();b.find(".name").text(h.t("group_name","Group Name"));a.find(".clearer").before(b.show());b.find(".edit_group_link").click()});$("#edit_group_form").formSubmit({object_name:"group",processData:function(a){a["group[group_category_id]"]=$(this).parents(".group_category").data("category_id");return a},beforeSubmit:function(a){var b=$(this).parents(".group");$(this).remove();b.removeClass("editing");b.loadingImage();b.fillTemplateData({data:a,avoid:".student_list"});return b},
success:function(a,b){var c=a.group||a.course_assigned_group;b.loadingImage("remove");b.droppable(contextGroups.droppable_options);b.find(".name.blank_name").hide().end().find(".group_name").show();b.find(".group_user_count").show();c.group_id=c.id;b.fillTemplateData({id:"group_"+c.id,data:c,avoid:".student_list",hrefValues:["id"]});contextGroups.addGroupToSidebar(c);contextGroups.updateCategoryCounts(b.parents(".group_category"))}});$(".edit_group_link").click(function(a){a.preventDefault();a=$(this).parents(".group");
var b=a.getTemplateData({textValues:["name","max_membership"]}),c=$("#edit_group_form").clone(true);c.fillFormData(b,{object_name:"group"});a.addClass("editing");a.prepend(c.show());c.find(":input:visible:first").focus().select();a.attr("id")?c.attr("method","PUT").attr("action",a.find(".edit_group_link").attr("href")):c.attr("method","POST").attr("action",$("#manage_group_urls .add_group_url").attr("href"));a.length>0&&a.parents(".group_category").scrollTo(a)});$("#edit_group_form .cancel_button").click(function(){var a=
$(this).parents(".group");$(this).parents(".group").removeClass("editing");$(this).parents("form").remove();a.attr("id")||a.remove()});$("#edit_category_form").formSubmit({object_name:"category",property_validations:{name:function(a){if($(this).parents(".group_category").find(".category_name:first").text().toLowerCase()!=a.toLowerCase()){var b=false;$("#category_list .category").each(function(){if($(this).text().toLowerCase()==a.toLowerCase()){b=true;return false}});if(b)return h.t("errors.category_in_use",
'"%{category_name}" is already in use',{category_name:a})}}},beforeSubmit:function(){var a=$(this).parents(".group_category"),b=$("#group_tabs").tabs("option","selected");b=$($("#category_list .category")[b]).find("a");a.data("tab_link",b);$(this).find("button").attr("disabled",true);$(this).find(".submit_button").text(h.t("status.updating","Updating..."));$(this).loadingImage();return a},success:function(a,b){contextGroups.updateCategory(b,a.group_category);$(this).loadingImage("remove");$(this).remove();
b.removeClass("editing")},error:function(a){$(this).loadingImage("remove");$(this).find("button").attr("disabled",false);$(this).find(".submit_button").text(h.t("errors.update_failed","Update Failed, Try Again"));$(this).formErrors(a)}});$(".edit_category_link").click(function(a){a.preventDefault();a=$(this).parents(".group_category");var b=$("#edit_category_form").clone(true),c=a.getTemplateData({textValues:["category_name","self_signup","heterogenous"]}),d={name:c.category_name,enable_self_signup:c.self_signup!==
null&&c.self_signup!=="",restrict_self_signup:c.self_signup=="restricted"};b.fillFormData(d,{object_name:"category"});b.find("#category_restrict_self_signup").prop("disabled",!d.enable_self_signup||c.heterogenous=="true");a.addClass("editing");a.prepend(b.show());b.find(":input:visible:first").focus().select();b.attr("method","PUT").attr("action",a.find(".edit_category_link").attr("href"));a.scrollTo(b.find(":input:visible:first"))});$("#edit_category_form .cancel_button").click(function(){$(this).parents(".group_category").removeClass("editing");
$(this).parents("form").remove()});$(".delete_category_link").click(function(a){a.preventDefault();var b=$("#group_tabs").tabs("option","selected");if(b==-1)b=$("#category_list li").index($("#category_list li.ui-tabs-selected"));a=$(this).parents(".group_category");var c=$.replaceTags($(this).attr("href"),"category_id",a.data("category_id"));a.confirmDelete({url:c,message:h.t("confirm.remove_category","Are you sure you want to remove this set of groups?"),success:function(){categories_remaining=$("#category_list li").length;
$("#group_tabs").tabs("remove",b);$("#group_tabs").showIf(categories_remaining>0);var d=$(this).data("category_id");if(categories_remaining>0){if(b>categories_remaining)b=categories_remaining;$("#group_tabs").tabs("select",b)}$("#sidebar_category_"+d).slideUp(function(){$(this).remove()});$("#no_groups_message").showIf(categories_remaining==0)}})});$(".add_category_link").click(function(a){a.preventDefault();addGroupCategory(function(b){$("#group_tabs").show();$("#no_groups_message").hide();var c=
$("#category_template").clone(true).removeAttr("id"),d=$("#category_template").find(".group_blank");c.find(".group").droppable(contextGroups.droppable_options);var f=b[0].group_category;b=b[1];for(var g in b){var e=b[g].group||b[g].course_assigned_group;e.group_id=e.id;$group=d.clone(true).removeClass("group_blank");$group.attr("id","group_"+e.id);if(!e.users||e.users.length==0)$group.find(".load-more").hide();$group.droppable(contextGroups.droppable_options);e.user_count=e.users.length;e.user_count_hidden=
e.users.length;$group.fillTemplateData({id:"group_"+e.id,data:e,avoid:".student_list",hrefValues:["id"]});c.find(".clearer").before($group);contextGroups.addGroupToSidebar(e);if(e.users)for(var j in e.users){var i=e.users[j].user,l=$(document.createElement("span")).addClass("category_"+f.id+"_group_id");l.text(e.id);$(".student.user_"+i.id).find(".data").append(l)}$group.find(".name.blank_name").hide().end().find(".group_name").show();$group.find(".group_user_count").show()}c.fillTemplateData({data:{category_id:f.id,
category_name:f.name,self_signup:f.self_signup},hrefValues:["category_id"]});c.attr("id","category_"+f.id);c.data("category_id",f.id);c.find(".self_signup_text").showIf(f.self_signup);c.find(".restricted_self_signup_text").showIf(f.self_signup=="restricted");c.find(".assign_students_link").showIf(f.self_signup!=="restricted");d=$("#group_tabs").tabs("length");if($("li.category").last().hasClass("student_organized"))d-=1;$("#group_tabs").append(c);$("#group_tabs").tabs("add","#category_"+f.id,f.name,
d);$("#group_tabs").tabs("select",d);contextGroups.populateCategory(c);contextGroups.updateCategoryCounts(c);$(window).triggerHandler("resize")})});$("#add_category_form").formSubmit({property_validations:{"category[name]":function(a){var b=false;$("#category_list .category").each(function(){if($(this).text().toLowerCase()==a.toLowerCase()){b=true;return false}});if(b)return h.t("errors.category_in_use",'"%{category_name}" is already in use',{category_name:a})}},beforeSubmit:function(a){$(this).loadingImage();
$(this).data("category_name",a["category[name]"]);$(this).find("button").attr("disabled",true);$(this).find(".submit_button").text(h.t("status.creating_groups","Creating Category..."))},success:function(a){$(this).loadingImage("remove");var b=$(this).data("callbacks")||[],c;for(c in b){var d=b[c];d&&$.isFunction(d)&&d.call(this,a)}$(this).data("callbacks",[]);$(this).find("button").attr("disabled",false);$(this).find(".submit_button").text(h.t("button.create_category","Create Category"));$(this).dialog("close")},
error:function(a){$(this).loadingImage("remove");$(this).find("button").attr("disabled",false);$(this).find(".submit_button").text(h.t("errors.creating_category_failed","Category Creation Failed, Try Again"));$(this).formErrors(a)}});$("#add_category_form .cancel_button").click(function(){$("#add_category_form").dialog("close")});$("#add_category_form #category_enable_self_signup").change(function(){var a=$(this).prop("checked");$("#add_category_form #category_restrict_self_signup").prop("disabled",
!a);$("#add_category_form #group_structure_standard_subcontainer").showIf(!a);$("#add_category_form #group_structure_self_signup_subcontainer").showIf(a);a||$("#add_category_form #category_restrict_self_signup").prop("checked",false)});$("#edit_category_form #category_enable_self_signup").change(function(){var a=$(this).prop("checked"),b=$(this).parents(".group_category").find(".heterogenous").text()=="true";a=!a||b;$("#edit_category_form #category_restrict_self_signup").prop("disabled",a);a&&$("#edit_category_form #category_restrict_self_signup").prop("checked",
false)});$(".load_members_link").click(function(a){a.preventDefault();contextGroups.loadMembersForGroup($(this).parents(".group"))});$(".delete_group_link").click(function(a){a.preventDefault();$(this).parents(".group").confirmDelete({message:h.t("confirm.delete_group","Are you sure you want to delete this group?"),url:$(this).attr("href"),success:function(){var b=$(this).parents(".group_category").find(".group_blank"),c=$(this).getTemplateData({textValues:["group_id"]}).group_id;$("#sidebar_group_"+
c).slideUp(function(){$(this).remove()});$(this).slideUp(function(){var d=$(this).parents(".group_category");d.hasClass("student_organized")||$(this).find(".student").each(function(){contextGroups.insertIntoGroup($(this),b)});$(this).remove();contextGroups.updateCategoryCounts(d)})}})});$(".assign_students_link").click(function(a){a.preventDefault();if(confirm(h.t("confirm.assign_students","This will randomly assign all unassigned students as evenly as possible among the existing student groups"))){var b=
$(this).parents(".group_category"),c=b.find(".group_blank");c.find(".assign_students_link").hide();c.find(".loading_members").text(h.t("status.assigning_students","Assigning Students..."));c.find(".loading_members").show();a=$("#manage_group_urls .assign_unassigned_users_url").attr("href");a=$.replaceTags(a,"category_id",b.data("category_id"));$.ajaxJSON(a,"POST",null,function(d){if(d.length){for(var f=$(".user_template"),g=0;g<d.length;g++)for(var e=d[g],j=b.find("#group_"+e.id),i=0;i<e.new_members.length;i++){var l=
e.new_members[i],k="user_id_"+l.user_id;b.find("."+k).remove();var n=f.clone();n.removeClass("user_template");n.addClass(k);n.fillTemplateData({data:l});contextGroups.insertIntoGroup(n,j)}contextGroups.updateCategoryCounts(b);c.find(".assign_students_link").show();c.find(".loading_members").hide();$(window).triggerHandler("resize");$.flashMessage(h.t("notices.students_assigned","Students assigned to groups."))}else{c.find(".assign_students_link").show();c.find(".loading_members").hide();$(window).triggerHandler("resize");
$.flashError(h.t("notices.no_students_assigned","Nothing to do."))}},function(){c.find(".assign_students_link").show();c.find(".loading_members").hide();$(window).triggerHandler("resize")})}});$(".self_signup_help_link").click(function(a){a.preventDefault();$("#self_signup_help_dialog").dialog("close").dialog({autoOpen:false,title:h.t("titles.self_signup_help","Self Sign-Up Groups"),width:400}).dialog("open")});contextGroups.populateCategory($("#group_tabs .group_category:first"));$(window).resize(function(){if($(".group_category:visible:first").length!=
0){var a=$(".group_category:visible:first").offset().top,b=$(window).height();$(".group_category").height(b-a-40);var c=$(".group_category:visible:first"),d=c.offset().top;c=c.find(".left_side").offset().top;$(".group_category").find(".right_side,.left_side").height(b-a-40-(c-d)+10)}}).triggerHandler("resize");$(".group_category .group").find(".expand_group_link").click(function(a){a.preventDefault();$(this).hide().parents(".group").find(".student_list").slideDown().end().find(".load-more").slideDown().end().find(".collapse_group_link").show()}).end().find(".collapse_group_link").click(function(a){a.preventDefault();
$(this).hide().parents(".group").find(".student_list").slideUp().end().find(".load-more").slideUp().end().find(".expand_group_link").show()});$(".group_category").find(".expand_groups_link").click(function(a){a.preventDefault();$(this).parents(".group_category").find(".expand_group_link").click()});$(".group_category").find(".collapse_groups_link").click(function(a){a.preventDefault();$(this).parents(".group_category").find(".collapse_group_link").click()});$(".group").hover(function(){$(this).addClass("group-hover")},
function(){$(this).removeClass("group-hover")});$(".group_category").each(function(){contextGroups.updateCategoryCounts($(this))});$("#tabs_loading_wrapper").show()})});
$.extend(true,I18n=I18n||{},{translations:{es:{groups:{group_name:"Nombre del Grupo",button:{create_category:"Crear Categor\u00eda"},group:{one:"1 Grupo",other:"%{count} Grupos"},category:{student:{one:"1 estudiante",other:"%{count} estudiantes"}},confirm:{delete_group:"\u00bfSeguro que quiere borrar este grupo?",remove_category:"\u00bfSeguro que quiere remover esta serie de grupos?",assign_students:"Esto asignar\u00e1 todos los estudiantes sin asignar aleatoriamente entre los grupos de estudiantes existentes"},
errors:{update_failed:"Fall\u00f3 la Actualizaci\u00f3n, Intente de Nuevo",creating_category_failed:"Fall\u00f3 la Creaci\u00f3n de la Categor\u00eda, Intente de Nuevo",category_in_use:'"%{category_name}" ya est\u00e1 en uso',unknown:"Ocurri\u00f3 un error inesperado."},titles:{self_signup_help:"Grupos con Auto-Inscripci\u00f3n"},status:{loading:"Cargando...",creating_groups:"Creando la Categor\u00eda...",updating:"Actualizando..."}}}}});
