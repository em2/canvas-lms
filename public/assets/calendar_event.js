var wikiSidebar;
I18n.scoped("calendar_events",function(k){jQuery(function(b){function j(a){i.show();e.hide().find("textarea").editorBox("destroy");if(wikiSidebar){wikiSidebar.hide();b("#sidebar_content").show()}if(a&&e.hasClass("new_event"))window.location.href=b(".calendar_url").attr("href")}var i=b("#full_calendar_event"),e=b("#edit_calendar_event_form"),d=b("#full_calendar_event_holder");wikiSidebar&&wikiSidebar.init();b(".date_field").date_field();b(".time_field").time_field();b(".delete_event_link").click(function(a){a.preventDefault();b("#full_calendar_event_holder").confirmDelete({message:"Are you sure you want to delete this event?",
url:b(this).attr("href"),success:function(){b(this).fadeOut("slow");window.location.href=b(".calendar_url").attr("href")}})});b(".switch_full_calendar_event_view").click(function(){b("#calendar_event_description").editorBox("toggle");return false});b(".edit_calendar_event_link").click(function(){i.hide();var a=i.getTemplateData({textValues:["start_at_date_string","start_at_time_string","end_at_time_string","title","all_day","all_day_date"]});if(a.description==k.t("no_content","No Content"))a.description=
"";a.start_date=a.start_at_date_string;a.start_date=b("#full_calendar_event .start_at_date_string").attr("title");a.start_time=a.start_at_time_string;a.end_time=a.end_at_time_string;if(a.all_day=="true"){if(a.all_day_date)a.start_date=a.all_day_date;a.start_time="";a.end_time=""}e.fillFormData(a,{object_name:"calendar_event"}).show().find("textarea").editorBox();if(wikiSidebar){wikiSidebar.attachToEditor(e.find("textarea:first"));wikiSidebar.show();b("#sidebar_content").hide()}return false});e.find(".cancel_button").click(function(){j(true);
return false});e.formSubmit({object_name:"calendar_event",processData:function(a){a["calendar_event[start_at]"]=b.datetime.process(a.start_date+" "+a.start_time);a["calendar_event[end_at]"]=b.datetime.process(a.start_date+" "+a.end_time);a["calendar_event[description]"]=b(this).find("textarea").editorBox("get_code");d.fillTemplateData({data:a,except:["description"]});return a},beforeSubmit:function(){j();d.loadingImage()},success:function(a){var c=a.calendar_event;a=b.parseFromISO(c.start_at);var g=
b.parseFromISO(c.end_at),f=Date.parse(c.all_day_date);c.start_at_date_string=a.date_formatted;c.start_at_time_string=a.time_formatted;c.end_at_time_string=g.time_formatted;c.all_day_date=f||"";d.find(".from_string,.to_string,.end_at_time_string").showIf(c.end_at&&c.end_at!=c.start_at);d.find(".at_string").showIf(!c.end_at||c.end_at==c.start_at);d.find(".not_all_day").showIf(!c.all_day);d.loadingImage("remove").fillTemplateData({data:c,htmlValues:["description"]});d.find(".start_at_date_string").attr("title",
c.start_at_date_string);b(this).find("textarea").editorBox("set_code",c.description);g=a=null;if(c.start_at){g=c.start_at.substring(0,4);a=c.start_at.substring(5,7)}f=b(".base_calendar_url").attr("href").split(/#/);c=f[1];f=f[0];var h={};try{h=b.parseJSON(c)||{}}catch(l){h={}}if(a&&g){h.month=a;h.year=g}b(".calendar_url").attr("href",f+"#"+b.encodeToHex(JSON.stringify(h)));if(d.hasClass("editing"))window.location.href=b(".calendar_url").attr("href")},error:function(a){d.loadingImage("remove");b(".edit_calendar_event_link:first").click();
e.formErrors(a)}});setTimeout(function(){d.hasClass("editing")&&b(".edit_calendar_event_link:first").click()},500);b(document).fragmentChange(function(a,c){c=="#edit"&&b(".edit_calendar_event_link:first").click()});b.scrollSidebar()})});$.extend(true,I18n=I18n||{},{translations:{es:{calendar_events:{no_content:"Sin Contenido"}}}});
