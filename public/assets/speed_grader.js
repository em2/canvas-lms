(function(g){g.fn.extend({elastic:function(a){var d=g.extend({},a),i=["paddingTop","paddingRight","paddingBottom","paddingLeft","borderLeftWidth","borderLeftStyle","borderRightWidth","borderRightStyle","fontSize","lineHeight","fontFamily","width","fontWeight"];return this.each(function(){function m(u,y){var K=Math.floor(parseInt(u,10));l.height()!=K&&l.css({height:K+"px",overflow:y})}function n(){var u=l.val().replace(/&/g,"&amp;").replace(/  /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),
y=q.html().replace(/<br>/ig,"<br />");if(u+"&nbsp;"!=y){q[0].innerHTML=u+"&nbsp;";q.width(l.width());u=q.height();if(Math.abs(u+w-l.height())>3){u+=w;if(u>=o)m(o,"auto");else u<=r?m(r,"hidden"):m(u,"hidden");g.isFunction(d.callback)&&d.callback()}}}if(this.type!="textarea")return false;var l=g(this),q=g("<div />").css({position:"absolute",display:"none","word-wrap":"break-word"}).prependTo(l.parent()),w=parseInt(l.css("line-height"),10)||parseInt(l.css("font-size"),"10"),r=parseInt(l.css("height"),
10)||w*3,o=parseInt(l.css("max-height"),10)||Number.MAX_VALUE;if(o<0)o=Number.MAX_VALUE;g.each(i,function(u,y){q.css(y,l.css(y))});l.css({overflow:"hidden"}).bind("keyup change cut paste",n).bind("input paste",function(){setTimeout(n,250)});n()})}})})(jQuery);
(function(g){g.widget("ui.selectmenu",{_init:function(){var a=this,d=this.options,i=Math.round(Math.random()*1E3);this.ids=[this.element.attr("id")+"_button_"+i,this.element.attr("id")+"_menu_"+i];this._safemouseup=true;this.newelement=g('<a class="'+this.widgetBaseClass+' ui-widget ui-state-default ui-corner-all" id="'+this.ids[0]+'" role="button" href="#" aria-haspopup="true" aria-owns="'+this.ids[1]+'"></a>').insertAfter(this.element);(i=this.element.attr("tabindex"))&&this.newelement.attr("tabindex",
i);this.newelement.data("selectelement",this.element);this.selectmenuIcon=g('<span class="'+this.widgetBaseClass+'-icon ui-icon"></span>').prependTo(this.newelement).addClass(d.style=="popup"?"ui-icon-triangle-2-n-s":"ui-icon-triangle-1-s");g("label[for="+this.element.attr("id")+"]").attr("for",this.ids[0]).bind("click",function(){a.newelement.focus();return false});this.newelement.bind("mousedown",function(r){a._toggle(r);if(d.style=="popup"){a._safemouseup=false;setTimeout(function(){a._safemouseup=
true},300)}return false}).bind("click",function(){return false}).keydown(function(r){var o=true;switch(r.keyCode){case g.ui.keyCode.ENTER:o=true;break;case g.ui.keyCode.SPACE:o=false;a._toggle(r);break;case g.ui.keyCode.UP:case g.ui.keyCode.LEFT:o=false;a._moveSelection(-1);break;case g.ui.keyCode.DOWN:case g.ui.keyCode.RIGHT:o=false;a._moveSelection(1);break;case g.ui.keyCode.TAB:o=true;break;default:o=false;a._typeAhead(r.keyCode,"mouseup")}return o}).bind("mouseover focus",function(){g(this).addClass(a.widgetBaseClass+
"-focus ui-state-hover ui-state-active")}).bind("focus",function(){g(this).addClass("ui-state-active")}).bind("blur",function(){g(this).removeClass("ui-state-active")}).bind("mouseout blur",function(){g(this).removeClass(a.widgetBaseClass+"-focus ui-state-hover")});g(document).mousedown(function(r){a.close(r)});this.element.click(function(){this._refreshValue()}).focus(function(){this.newelement.focus()});this.list=g('<ul class="'+a.widgetBaseClass+"-menu ui-widget ui-widget-content"+(d.style=="dropdown"?
" ui-corner-bottom":" ui-corner-all")+'" aria-hidden="true" role="listbox" aria-labelledby="'+this.ids[0]+'" id="'+this.ids[1]+'"></ul>').appendTo("body");var m=[];this.element.find("option").each(function(){m.push({value:g(this).attr("value"),text:a._formatText(jQuery(this).text()),selected:g(this).attr("selected"),classes:g(this).attr("class"),parentOptGroup:g(this).parent("optgroup").attr("label")})});var n=a.options.style=="popup"?" ui-state-active":"",l;for(l in m){i=g('<li role="presentation"><a href="#" tabindex="-1" role="option" aria-selected="false">'+
m[l].text+"</a></li>").data("index",l).addClass(m[l].classes).data("optionClasses",m[l].classes||"").mouseup(function(r){if(a._safemouseup){var o=g(this).data("index")!=a._selectedIndex();a.value(g(this).data("index"));a.select(r);o&&a.change(r);a.close(r,true)}return false}).click(function(){return false}).bind("mouseover focus",function(){a._selectedOptionLi().addClass(n);a._focusedOptionLi().removeClass(a.widgetBaseClass+"-item-focus ui-state-hover");g(this).removeClass("ui-state-active").addClass(a.widgetBaseClass+
"-item-focus ui-state-hover")}).bind("mouseout blur",function(){this==a._selectedOptionLi()&&g(this).addClass(n);g(this).removeClass(a.widgetBaseClass+"-item-focus ui-state-hover")});if(m[l].parentOptGroup){var q=a.widgetBaseClass+"-group-"+m[l].parentOptGroup;this.list.find("li."+q).size()?this.list.find("li."+q+":last ul").append(i):g('<li role="presentation" class="'+a.widgetBaseClass+"-group "+q+'"><span class="'+a.widgetBaseClass+'-group-label">'+m[l].parentOptGroup+"</span><ul></ul></li>").appendTo(this.list).find("ul").append(i)}else i.appendTo(this.list);
this.list.bind("mousedown mouseup",function(){return false});if(d.icons)for(var w in d.icons)if(i.is(d.icons[w].find)){i.data("optionClasses",m[l].classes+" "+a.widgetBaseClass+"-hasIcon").addClass(a.widgetBaseClass+"-hasIcon");q=d.icons[w].icon||"";i.find("a:eq(0)").prepend('<span class="'+a.widgetBaseClass+"-item-icon ui-icon "+q+'"></span>')}}this.list.find("li:last").addClass("ui-corner-bottom");d.style=="popup"&&this.list.find("li:first").addClass("ui-corner-top");if(d.transferClasses){l=this.element.attr("class")||
"";this.newelement.add(this.list).addClass(l)}l=this.element.width();this.newelement.width(d.width?d.width:l);d.style=="dropdown"?this.list.width(d.menuWidth?d.menuWidth:d.width?d.width:l):this.list.width(d.menuWidth?d.menuWidth:d.width?d.width-d.handleWidth:l-d.handleWidth);d.maxHeight&&d.maxHeight<this.list.height()&&this.list.height(d.maxHeight);this._optionLis=this.list.find("li:not(."+a.widgetBaseClass+"-group)");this.list.keydown(function(r){var o=true;switch(r.keyCode){case g.ui.keyCode.UP:case g.ui.keyCode.LEFT:o=
false;a._moveFocus(-1);break;case g.ui.keyCode.DOWN:case g.ui.keyCode.RIGHT:o=false;a._moveFocus(1);break;case g.ui.keyCode.HOME:o=false;a._moveFocus(":first");break;case g.ui.keyCode.PAGE_UP:o=false;a._scrollPage("up");break;case g.ui.keyCode.PAGE_DOWN:o=false;a._scrollPage("down");break;case g.ui.keyCode.END:o=false;a._moveFocus(":last");break;case g.ui.keyCode.ENTER:case g.ui.keyCode.SPACE:o=false;a.close(r,true);g(r.target).parents("li:eq(0)").trigger("mouseup");break;case g.ui.keyCode.TAB:o=
true;a.close(r,true);break;case g.ui.keyCode.ESCAPE:o=false;a.close(r,true);break;default:o=false;a._typeAhead(r.keyCode,"focus")}return o});if(d.style=="dropdown"){this.newelement.addClass(a.widgetBaseClass+"-dropdown");this.list.addClass(a.widgetBaseClass+"-menu-dropdown")}else{this.newelement.addClass(a.widgetBaseClass+"-popup");this.list.addClass(a.widgetBaseClass+"-menu-popup")}this.newelement.prepend('<span class="'+a.widgetBaseClass+'-status">'+m[this._selectedIndex()].text+"</span>");this.element.hide();
this.element.attr("disabled")===true&&this.disable();this.value(this._selectedIndex())},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled");g("label[for="+this.newelement.attr("id")+"]").attr("for",this.element.attr("id")).unbind("click");this.newelement.remove();this.list.remove();this.element.show()},_typeAhead:function(a,d){var i=this;if(!i._prevChar)i._prevChar=["",0];var m=String.fromCharCode(a);
c=m.toLowerCase();var n=false;this.list.find("li a").each(function(l){if(!n){var q=g(this).text();if(q.indexOf(m)===0||q.indexOf(c)===0)if(i._prevChar[0]==m){if(i._prevChar[1]<l){n=true;g(this).trigger(d);i._prevChar[1]=l}}else{n=true;g(this).trigger(d);i._prevChar[1]=l}}});this._prevChar[0]=m},_uiHash:function(){return{value:this.value()}},open:function(a){this._refreshPosition();this._closeOthers(a);this.newelement.addClass("ui-state-active");this.list.appendTo("body").addClass(this.widgetBaseClass+
"-open").attr("aria-hidden",false).find("li:not(."+this.widgetBaseClass+"-group):eq("+this._selectedIndex()+") a").focus();this.options.style=="dropdown"&&this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top");this._refreshPosition();this._trigger("open",a,this._uiHash())},close:function(a,d){if(this.newelement.is(".ui-state-active")){this.newelement.removeClass("ui-state-active");this.list.attr("aria-hidden",true).removeClass(this.widgetBaseClass+"-open");this.options.style=="dropdown"&&
this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all");d&&this.newelement.focus();this._trigger("close",a,this._uiHash())}},change:function(a){this.element.trigger("change");this._trigger("change",a,this._uiHash())},select:function(a){this._trigger("select",a,this._uiHash())},_closeOthers:function(a){g("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){g(this).data("selectelement").selectmenu("close",a)});g("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},
_toggle:function(a,d){this.list.is("."+this.widgetBaseClass+"-open")?this.close(a,d):this.open(a)},_formatText:function(a){return this.options.format?this.options.format(a):a},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},_moveSelection:function(a){return this._optionLis.eq(parseInt(this._selectedOptionLi().data("index"),
10)+a).trigger("mouseup")},_moveFocus:function(a){a=isNaN(a)?parseInt(this._optionLis.filter(a).data("index"),10):parseInt(this._focusedOptionLi().data("index"),10)+a;if(a<0)a=0;if(a>this._optionLis.size()-1)a=this._optionLis.size()-1;var d=this.widgetBaseClass+"-item-"+Math.round(Math.random()*1E3);this._focusedOptionLi().find("a:eq(0)").attr("id","").blur();this._optionLis.eq(a).find("a:eq(0)").attr("id",d).focus();this.list.attr("aria-activedescendant",d)},_scrollPage:function(a){var d=Math.floor(this.list.outerHeight()/
this.list.find("li:first").outerHeight());this._moveFocus(a=="up"?-d:d)},_setData:function(a,d){this.options[a]=d;if(a=="disabled")this.element.add(this.newelement).add(this.list)[d?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",d)},value:function(a){if(arguments.length){this.element[0].selectedIndex=a;this._refreshValue();this._refreshPosition()}return this.element[0].selectedIndex},_refreshValue:function(){var a=this.options.style==
"popup"?" ui-state-active":"",d=this.widgetBaseClass+"-item-"+Math.round(Math.random()*1E3);this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+a).find("a").attr("aria-selected","false").attr("id","");this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+a).find("a").attr("aria-selected","true").attr("id",d);a=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"";var i=this._selectedOptionLi().data("optionClasses")?
this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(a).data("optionClasses",i).addClass(i).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html());this.list.attr("aria-activedescendant",d)},_refreshPosition:function(){this.list.css("left",this.newelement.offset().left);var a=this.newelement.offset().top,d=this.list[0].scrollTop;this.list.find("li:lt("+this._selectedIndex()+")").each(function(){d-=g(this).outerHeight()});a+=this.newelement.is("."+
this.widgetBaseClass+"-popup")?d:this.newelement.height();this.list.css("top",a)}});g.extend(g.ui.selectmenu,{getter:"value",version:"@VERSION",eventPrefix:"selectmenu",defaults:{transferClasses:true,style:"popup",width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null}})})(jQuery);
(function(g){var a=0;g.getScrollbarWidth=function(){if(!a)if(g.browser.msie){var d=g('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1E3,left:-1E3}).appendTo("body"),i=g('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1E3,left:-1E3}).appendTo("body");a=d.width()-i.width();d.add(i).remove()}else{d=g("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1E3,left:-1E3}).prependTo("body").append("<div />").find("div").css({width:"100%",
height:200});a=100-d.width();d.parent().remove()}return a}})(jQuery);(function(g){g.fn.shake=function(a,d){if("ondevicemotion"in window){var i=g.extend({threshold:18,interval:2},d),m=0,n={};g(window).bind("devicemotion",function(l){n=l.originalEvent.accelerationIncludingGravity});setInterval(function(){if(Math.abs(n.x)>i.threshold||Math.abs(n.y)>i.threshold||Math.abs(n.z)>i.threshold){var l=new Date/1E3;if(m+i.interval<l){m=l;a(n)}}},100)}return this}})(jQuery);var rubricAssessment;
I18n.scoped("rubric_assessment",function(g){rubricAssessment={init:function(){var a=$("#rubric_criterion_comments_dialog");$(".rubric").delegate(".rating","click",function(){$(this).parents(".criterion").find(".criterion_points").val($(this).find(".points").text()).change()}).delegate(".long_description_link","click",function(d){d.preventDefault();if(!$(this).parents(".rubric").hasClass("editing")){d=$(this).parents(".criterion").getTemplateData({textValues:["long_description","description"]});var i=
$(this).parents(".criterion").hasClass("learning_outcome_criterion");$("#rubric_long_description_dialog").fillTemplateData({data:d,htmlValues:i?["long_description"]:[]}).find(".editing").hide().end().find(".displaying").show().end().dialog("close").dialog({autoOpen:false,title:g.t("titles.criterion_long_description","Criterion Long Description"),width:400}).dialog("open")}}).delegate(".criterion .saved_custom_rating","change",function(){if($(this).parents(".rubric").hasClass("assessing")){var d=$(this).val();
d&&d.length>0&&$(this).parents(".custom_ratings_entry").find(".custom_rating_field").val(unescape(d))}}).delegate(".criterion_comments","click",function(d){d.preventDefault();d.preventDefault();d=$(this).parents(".criterion");var i=d.getTemplateData({textValues:["custom_rating"]}).custom_rating,m=$(this).closest(".displaying").parents(".criterion").length===0;i={criterion_comments:i,criterion_description:d.find(".description:first").text()};a.data("current_rating",d);a.fillTemplateData({data:i});
a.fillFormData(i);a.find(".editing").showIf(m);a.find(".displaying").showIf(!m);a.dialog("close").dialog({autoOpen:false,title:g.t("titles.additional_comments","Additional Comments"),width:400}).dialog("open")}).find(".criterion_points").bind("keypress change blur",function(d){d=$(d.target);if(d.parents(".rubric").hasClass("assessing")){var i=parseFloat(d.val(),10);if(isNaN(i))i=null;var m=d.parents(".criterion");m.find(".rating.selected").removeClass("selected");if(i||i===0){m.find(".criterion_description").addClass("completed");
m.find(".rating").each(function(){parseFloat($(this).find(".points").text(),10)==i&&$(this).addClass("selected")})}else m.find(".criterion_description").removeClass("completed");var n=0;d.parents(".rubric").find(".criterion:visible:not(.ignore_criterion_for_scoring) .criterion_points").each(function(){var l=parseFloat($(this).val(),10);if(isNaN(l))l=0;n+=l});d.parents(".rubric").find(".rubric_total").text(n)}});$(".rubric_summary").delegate(".rating_comments_dialog_link","click",function(d){d.preventDefault();
d=$(this).parents(".criterion");var i={criterion_comments:d.getTemplateData({textValues:["rating_custom"]}).rating_custom,criterion_description:d.find(".criterion_description:first").text()};a.data("current_rating",d);a.fillTemplateData({data:i});a.fillFormData(i);a.find(".editing").hide();a.find(".displaying").show();a.dialog("close").dialog({autoOpen:false,title:g.t("titles.additional_comments","Additional Comments"),width:400}).dialog("open")});a.find(".save_button").click(function(){var d=a.find("textarea.criterion_comments").val(),
i=a.data("current_rating");if(i){i.find(".custom_rating").text(d);i.find(".criterion_comments").toggleClass("empty",!d)}a.dialog("close")});a.find(".cancel_button").click(function(){a.dialog("close")});setInterval(rubricAssessment.sizeRatings,2500)},sizeRatings:function(){if($(".rubric .criterion:visible").length){var a=$.windowScrollTop();$(".rubric .criterion:visible").each(function(){var d=$(this),i=d.find(".ratings:visible");if(i.length){var m=i.find(".rating .container").css("height","");d=Math.max(i.height(),
d.find(".criterion_description .container").height());m.css("height",d-10+"px")}});$("html,body").scrollTop(a)}},assessmentData:function(a){a=rubricAssessment.findRubric(a);var d={};d["rubric_assessment[user_id]"]=rubricAssessment.assessment_user_id||a.find(".user_id").text();d["rubric_assessment[assessment_type]"]=rubricAssessment.assessment_type||a.find(".assessment_type").text();a.find(".criterion:not(.blank)").each(function(){var i="rubric_assessment["+$(this).attr("id")+"]";d[i+"[points]"]=$(this).find(".criterion_points").val();
if($(this).find(".rating.selected")){d[i+"[description]"]=$(this).find(".rating.selected .description").text();d[i+"[comments]"]=$(this).find(".custom_rating").text()}if($(this).find(".custom_rating_field:visible").length>0){d[i+"[comments]"]=$(this).find(".custom_rating_field:visible").val();d[i+"[save_comment]"]=$(this).find(".save_custom_rating").attr("checked")?"1":"0"}});return d},findRubric:function(a){if(!a.hasClass("rubric")){$new_rubric=a.closest(".rubric");if($new_rubric.length===0)$new_rubric=
a.find(".rubric:first");a=$new_rubric}return a},updateRubricAssociation:function(a,d){var i=d.summary_data;if(i&&i.saved_comments)for(var m in i.saved_comments){var n=i.saved_comments[m],l=a.find("#criterion_"+m).find(".saved_custom_rating_holder").hide(),q=l.find(".saved_custom_rating");q.find(".comment").remove();q.empty().append('<option value="">'+g.t("options.select","[ Select ]")+"</option>");for(var w in n)if(n[w]){q.append('<option value="'+escape(n[w])+'">'+$.truncateText(n[w],50)+"</option>");
l.show()}}},populateRubric:function(a,d){a=rubricAssessment.findRubric(a);a.attr("id").substring(7);a.find(".user_id").text(rubricAssessment.assessment_user_id||d.user_id).end().find(".assessment_type").text(rubricAssessment.assessment_type||d.assessment_type);a.find(".criterion_description").removeClass("completed").removeClass("original_completed").end().find(".rating").removeClass("selected").removeClass("original_selected").end().find(".custom_rating_field").val("").end().find(".custom_rating_comments").text("").end().find(".criterion_points").val("").change().end().find(".criterion_rating_points").text("").end().find(".custom_rating").text("").end().find(".save_custom_rating").attr("checked",
false);a.find(".criterion_comments").addClass("empty");if(d){var i=0,m;for(m in d.data){var n=d.data[m],l=n.comments_enabled?n.comments:n.description,q=a.find("#criterion_"+n.criterion_id);n.id||q.find(".rating").each(function(){if(parseFloat($(this).find(".points").text(),10)==n.points)n.id=$(this).find(".rating_id").text()});q.find(".criterion_description").addClass("original_completed").end().find("#rating_"+n.id).addClass("original_selected").addClass("selected").end().find(".custom_rating_field").val(l).end().find(".custom_rating_comments").text(l).end().find(".criterion_points").val(n.points).change().end().find(".criterion_rating_points_holder").showIf(n.points||
n.points===0).end().find(".criterion_rating_points").text(n.points).end().find(".custom_rating").text(l).end().find(".criterion_comments").toggleClass("empty",!l).end().find(".save_custom_rating").attr("checked",false);if(n.points)i+=n.points}a.find(".rubric_total").text(i)}},populateRubricSummary:function(a,d){a.find(".criterion_points").text("").end().find(".rating_custom").text("");if(d){var i=0,m;for(m in d.data){var n=d.data[m];a.find("#criterion_"+n.criterion_id).find(".rating").hide().end().find(".rating.description").showIf(!a.hasClass("free_form")).text(n.description).end().find(".rating_"+
n.id).show().end().find(".criterion_points").text(n.points);if(n.comments_enabled&&n.comments){var l=$.truncateText(n.comments,50);a.find("#criterion_"+n.criterion_id).find(".rating_custom").show().text(l)}if(n.points)i+=n.points}a.show().find(".rubric_total").text(i);a.closest(".edit").show()}else a.hide()}}});$(function(){rubricAssessment.init()});var jsonData,visibleRubricAssessments,anonymousAssignment=false;
I18n.scoped("gradebook",function(g){(function(a,d,i,m){function n(){jsonData.studentsWithSubmissions=jsonData.context.students;a.each(jsonData.studentsWithSubmissions,function(e,h){this.section_ids=a.map(a.grep(jsonData.context.enrollments,function(k){return k.user_id===h.id}),function(k){return k.course_section_id});this.submission=a.grep(jsonData.submissions,function(k){return k.user_id===h.id})[0];this.rubric_assessments=a.grep(visibleRubricAssessments,function(k){return k.user_id===h.id})});if(I=
Number(a.store.userGet("grading_show_only_section"+jsonData.context_id))){var b=a.grep(jsonData.studentsWithSubmissions,function(e){return a.inArray(I,e.section_ids)!=-1});if(b.length)jsonData.studentsWithSubmissions=b;else{alert(g.t("alerts.no_students_in_section","Could not find any students in that section, falling back to showing all sections."));a.store.userRemove("grading_show_only_section"+jsonData.context_id);window.location.reload()}}var f;if(a.store.userGet("eg_hide_student_names")=="true")f=
true;if(f)jsonData.studentsWithSubmissions.sort(function(e,h){return(e&&e.submission&&e.submission.id||Number.MAX_VALUE)-(h&&h.submission&&h.submission.id||Number.MAX_VALUE)});else if(a.store.userGet("eg_sort_by")=="submitted_at")jsonData.studentsWithSubmissions.sort(function(e,h){return(e&&e.submission&&e.submission.submitted_at&&a.parseFromISO(e.submission.submitted_at).timestamp||Number.MAX_VALUE)-(h&&h.submission&&h.submission.submitted_at&&a.parseFromISO(h.submission.submitted_at).timestamp||
Number.MAX_VALUE)});else a.store.userGet("eg_sort_by")=="submission_status"&&jsonData.studentsWithSubmissions.sort(function(e,h){var k={not_graded:1,resubmitted:2,not_submitted:3,graded:4},p=l(e.submission),s=l(h.submission);return k[p]-k[s]})}function l(b){return b&&b.workflow_state!="unsubmitted"&&(b.submitted_at||typeof b.grade!="undefined")?typeof b.grade=="undefined"||b.grade===null||b.workflow_state=="pending_review"?"not_graded":b.grade_matches_current_submission?"graded":"resubmitted":"not_submitted"}
function q(b){var f=l(b.submission),e=f.replace("_"," ");if(f==="resubmitted")e=g.t("graded_then_resubmitted","graded, then resubmitted (%{when})",{when:a.parseFromISO(b.submission.submitted_at).datetime_formatted});return{raw:f,formatted:e}}function w(){var b;if(a.store.userGet("eg_hide_student_names")=="true"||anonymousAssignment)b=true;a("#hide_student_names").attr("checked",b);var f=a.map(jsonData.studentsWithSubmissions,function(k,p){var s=a.htmlEscape(k.name),t=q(k);if(b)s=g.t("nth_student",
"Student %{n}",{n:p+1});return'<option value="'+k.id+'" class="'+t.raw+'">'+s+" ---- "+t.formatted+"</option>"}).join("");x=a("<select id='students_selectmenu'>"+f+"</select>").appendTo("#combo_box_container").selectmenu({style:"dropdown",format:function(k){k=k.split(" ---- ");return'<span class="ui-selectmenu-item-header">'+a.htmlEscape(k[0])+'</span><span class="ui-selectmenu-item-footer">'+k[1]+"</span>"},icons:[{find:".graded"},{find:".not_graded"},{find:".not_submitted"},{find:".resubmitted"}]}).change(function(){j.handleStudentChanged()});
if(jsonData.context.active_course_sections.length&&jsonData.context.active_course_sections.length>1){var e=x.data("selectmenu").list,h=a("#section-menu");h.find("ul").append(a.map(jsonData.context.active_course_sections,function(k){return'<li><a data-section-id="'+k.id+'" href="#">'+k.name+"</a></li>"}).join(""));h.insertBefore(e).bind("mouseenter mouseleave",function(k){a(this).toggleClass("ui-selectmenu-item-selected ui-selectmenu-item-focus ui-state-hover",k.type=="mouseenter").find("ul").toggle(k.type==
"mouseenter")}).find("ul").hide().menu().delegate("a","click mousedown",function(){a.store[a(this).data("section-id")=="all"?"userRemove":"userSet"]("grading_show_only_section"+jsonData.context_id,a(this).data("section-id"));window.location.reload()});if(I){f=a.map(jsonData.context.active_course_sections,function(k){if(k.id==I)return k.name}).join(", ");a("#section_currently_showing").text(f);h.find("ul li a").removeClass("selected").filter("[data-section-id="+I+"]").addClass("selected")}x.selectmenu("option",
"open",function(){e.find("li:first").css("margin-top",e.find("li").height()+"px");h.show().css({left:e.css("left"),top:e.css("top"),width:e.width()-(e.hasScrollbar()&&a.getScrollbarWidth()),"z-index":Number(e.css("z-index"))+1})}).selectmenu("option","close",function(){h.hide()})}}function r(){a("#add_a_comment textarea").elastic({callback:j.resizeFullHeight});a(".media_comment_link").click(function(b){b.preventDefault();a("#media_media_recording").show().find(".media_recording").mediaComment("create",
"any",function(f,e){a("#media_media_recording").data("comment_id",f).data("comment_type",e);j.handleCommentFormSubmit()},function(){j.revertFromFormSubmit()},true);j.resizeFullHeight()});a("#media_recorder_container a").live("click",o);(function(){var b=document.createElement("input");return("onwebkitspeechchange"in b||"speech"in b)&&!navigator.appVersion.match(/Chrome\/10/)})()&&a(".speech_recognition_link").click(function(){a('<input style="font-size: 30px;" speech x-webkit-speech />').dialog({title:g.t("titles.click_to_record",
"Click the mic to record your comments"),open:function(){a(this).width(100)}}).bind("webkitspeechchange",function(){F.val(a(this).val());a(this).dialog("close").remove()});return false}).closest("li").show()}function o(){a("#media_media_recording").hide().removeData("comment_id").removeData("comment_type");j.resizeFullHeight()}function u(b){if(!b||b.assessor_id===m.assessor_id||m.assessment_type=="grading"&&b.assessment_type=="grading")return true;return false}function y(){return a.grep(j.currentStudent.rubric_assessments,
function(b){return b.id==C.val()})[0]}function K(){a("#rubric_summary_container .button-container").appendTo("#rubric_assessments_list_and_edit_button_holder").find(".edit").text(g.t("edit_view_rubric","View Rubric"));a(".toggle_full_rubric, .hide_rubric_link").click(function(b){b.preventDefault();j.toggleFullRubric()});C.change(function(){var b=y();m.populateRubricSummary(a("#rubric_summary_holder .rubric_summary"),b,u(b));j.resizeFullHeight()});L.draggable({axis:"x",cursor:"crosshair",scroll:false,
containment:"#left_side",snap:"#full_width_container",appendTo:"#full_width_container",start:function(){L.draggable("option","minWidth",G.width())},helper:function(){return L.clone().addClass("clone")},drag:function(b,f){var e=f.offset,h=H.width();D.width(h-e.left);L.css("left","0");j.resizeFullHeight()},stop:function(b){b.stopImmediatePropagation()}});a(".save_rubric_button").click(function(){var b=a(this).parents("#rubric_holder").find(".rubric"),f=m.assessmentData(b),e=a(".update_rubric_assessment_url").attr("href");
j.toggleFullRubric();a(".rubric_summary").loadingImage();a.ajaxJSON(e,"POST",f,function(h){var k=false;if(h&&h.rubric_association){m.updateRubricAssociation(b,h.rubric_association);delete h.rubric_association}for(var p in j.currentStudent.rubric_assessments)if(h.id===j.currentStudent.rubric_assessments[p].id){a.extend(true,j.currentStudent.rubric_assessments[p],h);k=true}k||j.currentStudent.rubric_assessments.push(h);j.setOrUpdateSubmission(h.artifact);a.each(h.related_group_submissions_and_assessments,
function(s,t){j.setOrUpdateSubmission(h.artifact).rubric_assessments=a.map(t.rubric_assessments,function(z){return z.rubric_assessment})});a(".rubric_summary").loadingImage("remove");j.showGrade();j.showDiscussion();j.showRubric();j.updateStatsInHeader()})})}function ka(){H.keycodes({keyCodes:"j k p n c r g",ignore:"input, textarea, embed, object"},function(b){b.preventDefault();b.stopPropagation();if(b.keyString=="j"||b.keyString=="p")j.prev();else if(b.keyString=="k"||b.keyString=="n")j.next();
else if(b.keyString=="f"||b.keyString=="c")F.focus();else if(b.keyString=="g")M.focus();else b.keyString=="r"&&j.toggleFullRubric()});a(window).shake(a.proxy(j.next,j))}function la(){var b=H.height(),f,e=G.offset().top;f=Math.max(ma,b)-e;e=a.grep([{element:S,data:{newHeight:0}},{element:na,data:{newHeight:0}},{element:A,data:{newHeight:0}}],function(z){return z&&z.element.is(":visible")});D.css({maxHeight:f-50,overflow:"auto"});a.each(e,function(){this.data.autoHeight=this.element.height("auto").height();
this.element.height(0)});var h=f-oa.height("auto").height()-B.outerHeight();pa.height(f);if((f=h)>0)for(;f>0;){h=true;var k=1E7,p=null;a.each(e,function(){if(this.data.newHeight<k&&this.data.newHeight<this.data.autoHeight){p=this;k=this.data.newHeight}});if(p){p.data.newHeight=k+1;f-=1;h=false}if(h)break}else for(var s,t;f<0;){h=true;s=0;t=null;a.each(e,function(){if(this.data.newHeight>30>s&&this.data.newHeight>=this.data.autoHeight){t=this;s=this.data.newHeight}});if(t){t.data.newHeight=s-1;f+=
1;h=false}if(h)break}a.each(e,function(){this.element.height(this.data.newHeight)});f>0&&A.height(b-Math.floor(A.offset().top)-B.outerHeight());!d.browser.ff&&A.height()>100&&A.scrollTop(1E6)}a.ajaxJSON(window.location.pathname+".json"+window.location.search,"GET",{},function(b){window.jsonData=b;a(j.jsonReady)});var H=a(window);a("body");var N=a("#full_width_container"),T=a("#left_side"),O=a("#resize_overlay"),G=a("#right_side"),U=a("#width_resizer");i=a("#gradebook_header");var qa=a("#assignment_url").attr("href"),
pa=a(".full_height"),oa=a("#rightside_inner"),A=a("#comments"),ra=a("#comment_blank").removeAttr("id").detach(),sa=a("#comment_attachment_blank").removeAttr("id").detach();a("#comment_media_blank").removeAttr("id").detach();var B=a("#add_a_comment"),V=B.find("button"),F=B.find("textarea");a("#group_comment_wrapper");var Z=a("#comment_attachment_input_blank").detach(),aa=1,ta=a("#add_attachment"),ma=500,ua=a("#submissions_container"),P=a("#iframe_holder"),va=a("#x_of_x_students span"),wa=a("#x_of_x_graded span:first"),
xa=a("#average_score"),ya=a("#this_student_does_not_have_a_submission").hide(),C=a("#rubric_assessments_select"),na=a("#rubric_summary_container");a("#rubric_holder");var W=a("#grade_container"),M=W.find("input, select"),ba=W.find(".score"),ca=a("#average_score_wrapper"),da=a("#submission_details"),ea=a("#single_submission"),za=a("#single_submission_submitted_at"),fa=a("#multiple_submissions"),Aa=a("#submission_late_notice"),Ba=a("#submission_not_newest_notice"),Ca=a("#submission_files_container"),
S=a("#submission_files_list"),ga=a("#submission_file_hidden").removeAttr("id").detach(),J=a("#submission_to_view"),Da=a("#assignment_submission_url"),D=a("#rubric_full"),L=a("#rubric_full_resizer_handle");a("#mute_link");var x=null,ha=/^(image|html|code)$/,X=null,Q={},I,ia,Y;Y={getParam:function(b){var f=RegExp(b+"=([^&]+)");b=window.location.pathname.match(RegExp(b+"/([^/]+)"))||window.location.search.match(f);if(!b)return false;return b[1]}};ia={elements:{mute:{icon:a("#mute_link .ui-icon"),label:a("#mute_link .label"),
link:a("#mute_link"),modal:a("#mute_dialog")},nav:i.find(".prev, .next"),spinner:new Spinner({length:2,radius:3,trail:25,width:1}),settings:{form:a("#settings_form"),link:a("#settings_link")}},courseId:Y.getParam("courses"),assignmentId:Y.getParam("assignment_id"),init:function(){this.muted=this.elements.mute.link.data("muted");this.addEvents();this.createModals();this.addSpinner();return this},addEvents:function(){this.elements.nav.click(a.proxy(this.toAssignment,this));this.elements.mute.link.click(a.proxy(this.onMuteClick,
this));this.elements.settings.form.submit(a.proxy(this.submitForm,this));this.elements.settings.link.click(a.proxy(this.showSettingsModal,this))},addSpinner:function(){this.elements.mute.link.append(this.elements.spinner.el)},createModals:function(){var b=g.t("cancel_button","Cancel"),f=g.t("mute_assignment","Mute Assignment"),e={};e={};e[f]=a.proxy(function(){this.toggleMute();this.elements.mute.modal.dialog("close")},this);e[b]=a.proxy(function(){this.elements.mute.modal.dialog("close")},this);
this.elements.settings.form.dialog({autoOpen:false,modal:true,resizable:false,width:400});this.elements.settings.form.find(".submit_button").removeAttr("disabled");this.elements.mute.modal.dialog({autoOpen:false,buttons:e,modal:true,resizable:false,title:this.elements.mute.modal.data("title"),width:400})},toAssignment:function(b){b.preventDefault();j[b.target.getAttribute("class")]()},submitForm:function(b){a.store.userSet("eg_sort_by",a("#eg_sort_by").val());a.store.userSet("eg_hide_student_names",
a("#hide_student_names").prop("checked").toString());a(b.target).find(".submit_button").attr("disabled",true).text(g.t("buttons.saving_settings","Saving Settings..."));window.location.reload();return false},showSettingsModal:function(){this.elements.settings.form.dialog("close").dialog({modal:true,resizeable:false,width:400}).dialog("open")},onMuteClick:function(b){b.preventDefault();this.muted?this.toggleMute():this.elements.mute.modal.dialog("open")},muteUrl:function(){return"/courses/"+this.courseId+
"/assignments/"+this.assignmentId+"/mute"},spinMute:function(){this.elements.spinner.spin();a(this.elements.spinner.el).css({left:9,top:6}).appendTo(this.elements.mute.link)},toggleMute:function(){var b=(this.muted=!this.muted)?g.t("unmute_assignment","Unmute Assignment"):g.t("mute_assignment","Mute Assignment");action=this.muted?"mute":"unmute";actions={mute:function(){this.elements.mute.icon.css("visibility","hidden");this.spinMute();a.ajaxJSON(this.muteUrl(),"put",{status:true},a.proxy(function(){this.elements.spinner.stop();
this.elements.mute.label.html(b);this.elements.mute.icon.removeClass("ui-icon-volume-off").addClass("ui-icon-volume-on").css("visibility","visible")},this))},unmute:function(){this.elements.mute.icon.css("visibility","hidden");this.spinMute();a.ajaxJSON(this.muteUrl(),"put",{status:false},a.proxy(function(){this.elements.spinner.stop();this.elements.mute.label.html(b);this.elements.mute.icon.removeClass("ui-icon-volume-on").addClass("ui-icon-volume-off").css("visibility","visible")},this))}};actions[action].apply(this)}};
a.extend(d,{refreshGrades:function(){var b=unescape(Da.attr("href")).replace("{{submission_id}}",j.currentStudent.submission.user_id)+".json";a.getJSON(b,function(f){j.currentStudent.submission=f.submission;j.showGrade()})},refreshQuizSubmissionSnapshot:function(b){Q[b.user_id+"_"+b.version_number]=b;if(b.last_question_touched)d.lastQuestionTouched=b.last_question_touched},clearQuizSubmissionSnapshot:function(b){Q[b.user_id+"_"+b.version_number]=null},getQuizSubmissionSnapshot:function(b,f){return Q[b+
"_"+f]}});window.onbeforeunload=function(){window.opener&&window.opener.updateGrades&&a.isFunction(window.opener.updateGrades)&&window.opener.updateGrades();var b=a.map(Q,function(f){return f&&a.map(jsonData.context.students,function(e){return f==e&&e.name})[0]});if(hasPendingQuizSubmissions=function(){var f=false;if(b.length)for(var e=0,h=b.length;e<h;e++)if(b[e]!==false)f=true;return f}())return g.t("confirms.unsaved_changes","The following students have unsaved changes to their quiz submissions: \n\n %{users}\nContinue anyway?",
{users:b.join("\n ")})};var j={options:{},publicVariable:[],scribdDoc:null,currentStudent:null,domReady:function(){function b(){N.addClass("full_width");T.css("width","");G.css("width","")}H.bind("resize orientationchange",j.resizeFullHeight).resize();a(document).mouseup(function(){O.hide()});O.click(function(){a(this).hide()});U.mousedown(function(){O.show()}).draggable({axis:"x",cursor:"crosshair",scroll:false,containment:"#full_width_container",snap:"#full_width_container",appendTo:"#full_width_container",
helper:function(){return U.clone().addClass("clone")},snapTolerance:200,drag:function(f,e){var h=e.offset,k=H.width();T.width(h.left/k*100+"%");G.width(100-h.left/k*100+"%");U.css("left","0");k-h.left<a(this).draggable("option","snapTolerance")?b():N.removeClass("full_width");if(h.left<a(this).draggable("option","snapTolerance")){T.width("0%");G.width("100%")}j.resizeFullHeight()},stop:function(f){f.stopImmediatePropagation();O.hide()}}).click(function(f){f.preventDefault();if(N.hasClass("full_width"))N.removeClass("full_width");
else{b();a(this).addClass("highlight",100,function(){a(this).removeClass("highlight",4E3)})}});M.change(j.handleGradeSubmit);J.change(function(){if(typeof j.currentStudent.submission=="undefined")j.currentStudent.submission={};j.currentStudent.submission.currentSelectedIndex=parseInt(a(this).val(),10);j.handleSubmissionSelectionChange()});K();r();j.initComments();ia.init();ka();H.bind("hashchange",j.handleFragmentChange);a("#eg_sort_by").val(a.store.userGet("eg_sort_by"));a("#submit_same_score").click(function(f){j.handleGradeSubmit();
f.preventDefault()})},jsonReady:function(){n();if(jsonData.studentsWithSubmissions.length){a("#speed_grader_loading").hide();a("#gradebook_header, #full_width_container").show();w();j.handleFragmentChange()}else{alert(g.t("alerts.no_active_students","Sorry, there are either no active students in the course or none are gradable by you."));window.history.back()}},skipRelativeToCurrentIndex:function(b){b=(this.currentIndex()+b+jsonData.studentsWithSubmissions.length)%jsonData.studentsWithSubmissions.length;
this.goToStudent(jsonData.studentsWithSubmissions[b].id)},next:function(){this.skipRelativeToCurrentIndex(1)},prev:function(){this.skipRelativeToCurrentIndex(-1)},resizeFullHeight:function(){X&&clearTimeout(X);X=setTimeout(la,0)},toggleFullRubric:function(b){if(!jsonData.rubric_association)return false;if(D.filter(":visible").length||b==="close"){a("#grading").height("auto").children().show();D.fadeOut();this.resizeFullHeight()}else{D.fadeIn();a("#grading").children().hide();this.refreshFullRubric()}},
refreshFullRubric:function(){if(jsonData.rubric_association)if(D.filter(":visible").length){m.populateRubric(D.find(".rubric"),y());a("#grading").height(D.height());this.resizeFullHeight()}},handleFragmentChange:function(){var b;try{b=JSON.parse(decodeURIComponent(document.location.hash.substr(1)))}catch(f){}b||(b={});if(typeof b.student_id!="number"||!a.grep(jsonData.studentsWithSubmissions,function(k){return b.student_id==k.id}).length){b.student_id=jsonData.studentsWithSubmissions[0].id;for(var e=
0,h=jsonData.studentsWithSubmissions.length;e<h;e++)if(typeof jsonData.studentsWithSubmissions[e].submission!=="undefined"&&jsonData.studentsWithSubmissions[e].submission.workflow_state!=="graded"){b.student_id=jsonData.studentsWithSubmissions[e].id;break}}j.goToStudent(b.student_id)},goToStudent:function(b){var f=a.grep(jsonData.studentsWithSubmissions,function(h){return h.id===b})[0],e=x.find("option").index(x.find('option[value="'+f.id+'"]'));if(!(e>=0))throw"student not found";x.selectmenu("value",
e);if(!this.currentStudent||this.currentStudent.id!=f.id)x.change()},currentIndex:function(){return a.inArray(this.currentStudent,jsonData.studentsWithSubmissions)},handleStudentChanged:function(){var b=parseInt(x.val(),10);this.currentStudent=a.grep(jsonData.studentsWithSubmissions,function(f){return f.id===b})[0];document.location.hash="#"+encodeURIComponent(JSON.stringify({student_id:this.currentStudent.id}));this.showGrade();this.showDiscussion();this.showRubric();this.updateStatsInHeader();this.showSubmissionDetails();
this.refreshFullRubric()},handleSubmissionSelectionChange:function(){try{var b=J.filter(":visible").val(),f=Number(b)||this.currentStudent&&this.currentStudent.submission&&this.currentStudent.submission.currentSelectedIndex||0,e=this.currentStudent&&this.currentStudent.submission&&this.currentStudent.submission.submission_history&&this.currentStudent.submission.submission_history[f]&&this.currentStudent.submission.submission_history[f].submission||{},h=jsonData.due_at&&a.parseFromISO(jsonData.due_at),
k=e.submitted_at&&a.parseFromISO(e.submitted_at);e.graded_at&&a.parseFromISO(e.graded_at);var p=[],s=[];za.html(k&&k.datetime_formatted);var t=e.turnitin_data&&e.turnitin_data["submission_"+e.id];b="#";if(t)b=a.replaceTags(a.replaceTags(a("#assignment_submission_turnitin_url").attr("href"),"user_id",e.user_id),"asset_string","submission_"+e.id);W.find(".turnitin_similarity_score").css("display",t&&t.similarity_score!=null?"":"none").attr("href",b).attr("class","turnitin_similarity_score "+(t&&t.state||
"no")+"_score").find(".similarity_score").text(t&&t.similarity_score||"--");S.empty();a.each(e.versioned_attachments||[],function(Fa,Ea){var v=Ea.attachment;v.scribd_doc&&v.scribd_doc.created&&p.push(v);ha.test(v.mime_class)&&s.push(v);var E=e.turnitin_data&&e.turnitin_data["attachment_"+v.id],ja="#";if(E)ja=a.replaceTags(a.replaceTags(a("#assignment_submission_turnitin_url").attr("href"),"user_id",e.user_id),"asset_string","attachment_"+v.id);ga.clone(true).fillTemplateData({data:{submissionId:e.user_id,
attachmentId:v.id,display_name:v.display_name,similarity_score:E&&E.similarity_score},hrefValues:["submissionId","attachmentId"]}).appendTo(S).find("a.display_name").addClass(v.mime_class).data("attachment",v).click(function(R){R.preventDefault();j.loadAttachmentInline(a(this).data("attachment"))}).end().find("a.turnitin_similarity_score").attr("href",ja).attr("class","turnitin_similarity_score "+(E&&E.state||"no")+"_score").attr("target","_blank").css("display",E&&E.similarity_score!=null?"":"none").end().find("a.submission-file-download").bind("dragstart",
function(R){R.originalEvent.dataTransfer&&R.originalEvent.dataTransfer.setData("DownloadURL",v.content_type+":"+v.filename+":"+this.href)}).end().show()});Ca.showIf(e.versioned_attachments&&e.versioned_attachments.length);this.loadAttachmentInline(p[0]||s[0]);Ba.showIf(J.filter(":visible").find(":selected").nextAll().length);this.resizeFullHeight();Aa.showIf(h&&k&&k.minute_timestamp>h.minute_timestamp)}catch(z){d.log_error({message:"SG_submissions_"+(z.message||z.description||""),line:z.lineNumber||
""});throw z;}},refreshSubmissionsToView:function(){var b=jsonData.due_at&&a.parseFromISO(jsonData.due_at);if(this.currentStudent&&this.currentStudent.submission&&this.currentStudent.submission.submission_history&&this.currentStudent.submission.submission_history.length>1){var f="",e=this.currentStudent.submission.submission_history[this.currentStudent.submission.submission_history.length-1].submission;a.each(this.currentStudent.submission.submission_history,function(h,k){k=k.submission;var p=k.submitted_at&&
a.parseFromISO(k.submitted_at),s=b&&p&&p.timestamp>b.timestamp;f+="<option "+(s?"class='late'":"")+" value='"+h+"' "+(k==e?"selected='selected'":"")+">"+(p?p.datetime_formatted:g.t("no_submission_time","no submission time"))+(s?" "+g.t("loud_late","LATE"):"")+(k.grade&&k.grade_matches_current_submission?" ("+g.t("grade","grade: %{grade}",{grade:k.grade})+")":"")+"</option>"});J.html(f);fa.show();ea.hide()}else{fa.hide();ea.show()}},showSubmissionDetails:function(){if(this.currentStudent.submission&&
this.currentStudent.submission.submitted_at){this.refreshSubmissionsToView();da.show();this.handleSubmissionSelectionChange()}else{this.loadAttachmentInline();da.hide()}this.resizeFullHeight()},updateStatsInHeader:function(){va.html(j.currentIndex()+1);var b=a.grep(jsonData.studentsWithSubmissions,function(h){return h.submission&&h.submission.workflow_state==="graded"});b=a.map(b,function(h){return h.submission.score});if(b.length){ca.show();var f=function(h){for(var k=0,p=0,s=h.length;p<s;p++)k+=
h[p];return k/h.length},e=jsonData.points_possible?[" / ",jsonData.points_possible," (",Math.round(100*(f(b)/jsonData.points_possible)),"%)"].join(""):"";xa.html(""+(function(h,k){k=Math.abs(parseInt(k,10))||0;var p=Math.pow(10,k);return Math.round(h*p)/p}(f(b),2)+e))}else ca.hide();wa.html(b.length)},loadAttachmentInline:function(b){ua.children().hide();if(!this.currentStudent.submission||!this.currentStudent.submission.submission_type)ya.show();else{P.empty();var f=b&&b.scribd_doc&&b.scribd_doc.created&&
b.workflow_state!="errored"&&b.scribd_doc.attributes.doc_id;if(b&&(f||a.isPreviewable(b.content_type,"google"))){var e={height:"100%",mimeType:b.content_type,attachment_id:b.id,submission_id:this.currentStudent.submission.id,ready:function(){j.resizeFullHeight()}};if(f)e=a.extend(e,{scribd_doc_id:b.scribd_doc.attributes.doc_id,scribd_access_key:b.scribd_doc.attributes.access_key});P.show().loadDocPreview(e)}else if(b&&ha.test(b.mime_class)){b=unescape(ga.find(".display_name").attr("href")).replace("{{submissionId}}",
this.currentStudent.submission.user_id).replace("{{attachmentId}}",b.id);P.html('<iframe src="'+b+'" frameborder="0" id="speedgrader_iframe"></iframe>').show()}else P.html('<iframe id="speedgrader_iframe" src="/courses/'+jsonData.context_id+"/assignments/"+this.currentStudent.submission.assignment_id+"/submissions/"+this.currentStudent.submission.user_id+"?preview=true"+(this.currentStudent.submission&&!isNaN(this.currentStudent.submission.currentSelectedIndex)?"&version="+this.currentStudent.submission.currentSelectedIndex:
"")+'" frameborder="0"></iframe>').show()}},showRubric:function(){if(jsonData.rubric_association){m.assessment_user_id=this.currentStudent.id;var b=a.grep(j.currentStudent.rubric_assessments,function(h){return h.assessor_id===m.assessor_id}),f=a.grep(j.currentStudent.rubric_assessments,function(h){return h.assessment_type=="grading"});C.find("option").remove();a.each(this.currentStudent.rubric_assessments,function(){C.append('<option value="'+this.id+'">'+this.assessor_name+"</option>")});if(!b.length||
m.assessment_type=="grading"&&!f.length)C.append('<option value="new">'+g.t("new_assessment","[New Assessment]")+"</option>");var e=null;if(f.length)e=f[0].id;if(b.length)e=b[0].id;e&&C.val(e);a("#rubric_assessments_list").showIf(C.find("option").length>1);C.change()}},showDiscussion:function(){A.html("");this.currentStudent.submission&&this.currentStudent.submission.submission_comments&&a.each(this.currentStudent.submission.submission_comments,function(b,f){if(f.submission_comment)f=f.submission_comment;
f.posted_at=a.parseFromISO(f.created_at).datetime_formatted;var e=ra.clone(true).fillTemplateData({data:f});e.find("span.comment").html(a.htmlEscape(f.comment).replace(/\n/g,"<br />"));var h=m.assessment_type==="grading"||m.assessor_id===f.author_id;e.find(".delete_comment_link").click(function(){a(this).parents(".comment").confirmDelete({url:"/submission_comments/"+f.id,message:g.t("confirms.delete_comment","Are you sure you want to delete this comment?"),success:function(){a(this).slideUp(function(){a(this).remove()})}})}).showIf(h);
f.media_comment_type&&f.media_comment_id&&e.find(".play_comment_link").show();a.each(f.cached_attachments||f.attachments,function(){var k=this.attachment||this;k.comment_id=f.id;k.submitter_id=j.currentStudent.id;e.find(".comment_attachments").append(sa.clone(true).fillTemplateData({data:k,hrefValues:["comment_id","id","submitter_id"]}).show().find("a").addClass(k.mime_class))});A.append(e.show());A.find(".play_comment_link").mediaCommentThumbnail("normal")});A.scrollTop(9999999)},revertFromFormSubmit:function(){j.showDiscussion();
j.resizeFullHeight();F.val("");setTimeout(function(){F.trigger("keyup")},0);B.find(":input").attr("disabled",false);V.text(g.t("buttons.submit_comment","Submit Comment"))},handleCommentFormSubmit:function(){function b(h){a.each(h,function(){j.setOrUpdateSubmission(this.submission)});j.revertFromFormSubmit()}if(!a.trim(F.val()).length&&!a("#media_media_recording").data("comment_id")&&!B.find("input[type='file']:visible").length)return false;var f=qa+"/submissions/"+j.currentStudent.id,e={"submission[assignment_id]":jsonData.id,
"submission[user_id]":j.currentStudent.id,"submission[group_comment]":a("#submission_group_comment").attr("checked")?"1":"0","submission[comment]":F.val()};a("#media_media_recording").data("comment_id")&&a.extend(e,{"submission[media_comment_type]":a("#media_media_recording").data("comment_type"),"submission[media_comment_id]":a("#media_media_recording").data("comment_id")});B.find("input[type='file']:visible").length?a.ajaxJSONFiles(f+".text","PUT",e,B.find("input[type='file']:visible"),b):a.ajaxJSON(f,
"PUT",e,b);a("#comment_attachments").empty();B.find(":input").attr("disabled",true);V.text(g.t("buttons.submitting","Submitting..."));o()},setOrUpdateSubmission:function(b){var f=a.grep(jsonData.studentsWithSubmissions,function(e){return e.id===b.user_id})[0];f.submission=f.submission||{};if(typeof b.submission_history==="undefined")b.submission_history=[{submission:a.extend(true,{},b)}];a.extend(true,f.submission,b);return f},handleGradeSubmit:function(){var b=a(".update_submission_grade_url").attr("href"),
f=a(".update_submission_grade_url").attr("title"),e={"submission[assignment_id]":jsonData.id,"submission[user_id]":j.currentStudent.id,"submission[grade]":M.val()};a.ajaxJSON(b,f,e,function(h){a.each(h,function(){j.setOrUpdateSubmission(this.submission)});j.refreshSubmissionsToView();J.change();j.showGrade()})},showGrade:function(){M.val(typeof j.currentStudent.submission!="undefined"&&j.currentStudent.submission.grade!==null?j.currentStudent.submission.grade:"").attr("disabled",typeof j.currentStudent.submission!=
"undefined"&&j.currentStudent.submission.submission_type==="online_quiz");a("#submit_same_score").hide();if(typeof j.currentStudent.submission!="undefined"&&j.currentStudent.submission.score!==null){ba.text(j.currentStudent.submission.score);j.currentStudent.submission.grade_matches_current_submission||a("#submit_same_score").show()}else ba.text("");j.updateStatsInHeader();a.each(jsonData.studentsWithSubmissions,function(b){var f=x.data("selectmenu").list.find("li:eq("+b+")");b=q(this);if(this==j.currentStudent)f=
f.add(x.data("selectmenu").newelement);f.removeClass("not_graded not_submitted graded resubmitted").addClass(b.raw).find(".ui-selectmenu-item-footer").text(b.formatted);a.each("not_graded not_submitted graded resubmitted".split(" "),function(){f.data("optionClasses",f.data("optionClasses").replace(this,""))})})},initComments:function(){V.click(function(b){b.preventDefault();j.handleCommentFormSubmit()});ta.click(function(b){b.preventDefault();b=Z.clone(true);b.find("input").attr("name","attachments["+
aa+"][uploaded_data]");aa++;a("#comment_attachments").append(b.show());j.resizeFullHeight()});Z.find("a").click(function(b){b.preventDefault();a(this).parents(".comment_attachment_input").remove();j.resizeFullHeight()});G.delegate(".play_comment_link","click",function(){var b=a(this).parents(".comment").getTemplateData({textValues:["media_comment_id"]}).media_comment_id;b&&a(this).parents(".comment").find(".media_comment_content").show().mediaComment("show",b,"audio");return false})}};a(j.domReady)})(jQuery,
INST,scribd,rubricAssessment)});
$.extend(true,I18n=I18n||{},{translations:{es:{gradebook:{mute_assignment:"Obviar Tarea",buttons:{saving_settings:"Guardar Configuraciones...",submit_comment:"Enviar Comentario",submitting:"Enviando..."},confirms:{unsaved_changes:"Los siguientes estudiantes tienen cambios no guardados en los env\u00edos de sus evaluaciones: \n%{users}\n\u00bfContinuar?",delete_comment:"\u00bfSeguro que quiere borrar este comentario?"},cancel_button:"Cancelar",grade:"grado: %{grade}",alerts:{no_students_in_section:"No se pudieron encontrar estudiantes en esa secci\u00f3n, regresando para mostrar todas las secciones.",
no_active_students:"Perd\u00f3n, no hay estudiantes activos en este curso o no pueden ser calificados por usted."},new_assessment:"[Tarea Nueva]",no_submission_time:"ningun tiempo de env\u00edo",graded_then_resubmitted:"calificado, luego reenviado (%{when})",titles:{click_to_record:"Haga click en el micr\u00f3fono para grabar sus comentarios"},unmute_assignment:"Activar Tarea",edit_view_rubric:"Ver R\u00fabrica",loud_late:"TARDE",nth_student:"Estudiante %{n}"},rubric_assessment:{titles:{additional_comments:"Comentarios Adicionales",
criterion_long_description:"Descripci\u00f3n Detallada de los Criterios"},options:{select:"[ Seleccionar ]"}}},em2:{gradebook:{confirms:{unsaved_changes:"The following students have unsaved changes to their assessment submissions: \n%{users}\nContinue anyway?"}}}}});
