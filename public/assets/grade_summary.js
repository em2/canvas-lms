var grading_scheme;
I18n.scoped("gradebook",function(o){function r(b,e){if(e.length!==0){var d=e.getTemplateData({textValues:["assignment_group_id","rules","group_weight"]});d=$.extend(d,e.getFormData());var a=b[d.assignment_group_id]||{};if(!a.group_weight)a.group_weight=parseFloat(d.group_weight)/100;a.scores=a.scores||[];a.full_points=a.full_points||[];a.count=a.count||0;a.submissions=a.submissions||[];a.sorted_submissions=a.sorted_submissions||[];if(isNaN(a.score_total))a.score_total=null;if(isNaN(a.full_total))a.full_total=null;
if(a.score_total!==null||a.full_total!==null){a.calculated_score=a.score_total/a.full_total;if(isNaN(a.calculated_score)||!isFinite(a.calculated_score))a.calculated_score=0}else{a.score_total=0;a.full_total=0}if(!a.rules){d.rules=d.rules||"";var c={drop_highest:0,drop_lowest:0,never_drop:[]},g=d.rules.split("\n"),f;for(f in g){var i=g[f].split(":"),k=null;if(i.length>1)k=parseInt(i[1],10);if(k&&!isNaN(k)&&isFinite(k))if(i[0]=="drop_lowest")c.drop_lowest=k;else if(i[0]=="drop_highest")c.drop_highest=
k;else i[0]=="never_drop"&&c.never_drop.push(k)}a.rules=c}return b[d.assignment_group_id]=a}}function n(){var b=$("#only_consider_graded_assignments").attr("checked"),e=$("#grades_summary .student_assignment"),d={};$(".group_total").each(function(){r(d,$(this))});e.removeClass("dropped");e.each(function(){var h=$(this);if(!h.hasClass("hard_coded")){h=h.getTemplateData({textValues:["assignment_group_id","score","points_possible","assignment_id"]});if((!h.score||isNaN(parseFloat(h.score)))&&b)$(this).addClass("dropped");
else{var j=d[h.assignment_group_id];j||(j=r(d,$("#submission_group-"+h.assignment_group_id)));if(j){var l=parseFloat(h.score);if(!l||isNaN(l)||!isFinite(l))l=0;var q=parseFloat(h.points_possible);if(!q||isNaN(q))q=0;var s=l/q;if(isNaN(s)||!isFinite(s))s=0;h.calculated_score=l;h.calculated_possible=q;h.calculated_percent=s;j.submissions.push(h);d[h.assignment_group_id]=j}}}});for(var a in d){e=d[a];e.sorted_submissions=e.submissions.sort(function(h,j){var l=[h.calculated_percent],q=[j.calculated_percent];
if(l>q)return 1;if(l==q)return 0;return-1});for(var c=0,g=0,f=0;f<e.sorted_submissions.length;f++)e.sorted_submissions[f].calculated_drop=false;for(f=0;f<e.sorted_submissions.length;f++){submission=e.sorted_submissions[f];if(!submission.calculated_drop&&c<e.rules.drop_lowest&&submission.calculated_possible>0&&$.inArray(submission.assignment_id,e.rules.never_drop)==-1){c++;submission.calculated_drop=true}e.sorted_submissions[f]=submission}for(f=e.sorted_submissions.length-1;f>=0;f--){submission=e.sorted_submissions[f];
if(!submission.calculated_drop&&g<e.rules.drop_highest&&submission.calculated_possible>0&&$.inArray(submission.assignment_id,e.rules.never_drop)==-1){g++;submission.calculated_drop=true}e.sorted_submissions[f]=submission}for(f=0;f<e.sorted_submissions.length;f++){submission=e.sorted_submissions[f];if(submission.calculated_drop){$("#submission_"+submission.assignment_id).addClass("dropped");c++}else{$("#submission_"+submission.assignment_id).removeClass("dropped");e.scores.push(submission.calculated_score);
e.full_points.push(submission.calculated_possible);e.count++;e.score_total+=submission.calculated_score;e.full_total+=submission.calculated_possible}}d[a]=e}var i=0;var k=a=0,p=0,m=0;$.each(d,function(h,j){r(d,$("#submission_group-"+h));var l=Math.round(j.calculated_score*1E3)/10;$("#submission_group-"+h).find(".grade").text(l).end().find(".score_teaser").text(j.score_total+" / "+j.full_total);l=j.calculated_score*j.group_weight;if(isNaN(l)||!isFinite(l))l=0;if(b&&j.count>0)p+=j.group_weight;i+=l;
m+=j.score_total;k+=j.full_total});a=parseFloat($("#total_groups_weight").text());if(isNaN(a)||!isFinite(a)||a===0){a=Math.round(1E3*m/k)/10;$(".student_assignment.final_grade .score_teaser").text(m+" / "+k)}else{a=parseFloat($("#total_groups_weight").text())/100;if(isNaN(a)||!isFinite(a)||a===0)a=1;if(b&&p<1)i=(a<1?a:1)*i/p;a=Math.round(i*1E3)/10;$(".student_assignment.final_grade .score_teaser").text(o.t("percent","Percent"))}if(isNaN(a)||!isFinite(a))a=0;$(".student_assignment.final_grade").find(".grade").text(a);
grading_scheme&&$(".final_letter_grade .grade").text(INST.GradeCalculator.letter_grade(grading_scheme,a));$(".revert_all_scores").showIf($("#grades_summary .revert_score_link").length>0);(new Date).getTime()}$(document).ready(function(){n();$(".revert_all_scores_link").click(function(b){b.preventDefault();$("#grades_summary .revert_score_link").each(function(){$(this).trigger("click",true)});$("#.show_guess_grades.exists").show();n()});$("tr.student_assignment").mouseover(function(){$(this).hasClass("dropped")?
$(this).attr("title",o.t("titles.dropped_assignment_no_total","This assignment will not be considered in the total calculation")):$(this).attr("title","")});$(".toggle_comments_link").click(function(b){b.preventDefault();$(this).parents("tr.student_assignment").next("tr.comments").toggle()});$(".toggle_rubric_assessments_link").click(function(b){b.preventDefault();$(this).parents("tr.student_assignment").next("tr.comments").next("tr.rubric_assessments").toggle()});$(".student_assignment.editable .assignment_score").click(function(b){if(!($("#grades_summary.editable").length===
0||$(this).find("#grade_entry").length>0||$(b.target).closest(".revert_score_link").length>0)){$(this).find(".grade").data("originalValue")||$(this).find(".grade").data("originalValue",$(this).find(".grade").html());$(this).find(".grade").empty().append($("#grade_entry"));$(this).find(".score_value").hide();b=$(this).parents(".student_assignment").find(".score").text();$("#grade_entry").val(b).show().focus().select()}});$("#grade_entry").keydown(function(b){if(b.keyCode==13)$(this).blur();else if(b.keyCode==
27){b=$(this).parents(".student_assignment").addClass("dont_update").find(".original_score").text();$(this).val(b||"").blur()}});$("#grades_summary .student_assignment").bind("score_change",function(b,e){var d=$(this),a=parseFloat(d.find(".original_score").text());if(isNaN(a))a=null;var c=d.find("#grade_entry").val()||$(this).find(".score").text();c=parseFloat(c);if(isNaN(c))c=null;if(!c&&c!==0)c=a;var g=a!=c;if(c==parseInt(c,10))c+=".0";d.find(".score").text(c);if(d.hasClass("dont_update")){e=false;
d.removeClass("dont_update")}if(e){g||(c=null);var f=d.getTemplateData({textValues:["assignment_id"]}).assignment_id;f=$.replaceTags($(".update_submission_url").attr("href"),"assignment_id",f);$.ajaxJSON(f,"PUT",{"submission[student_entered_score]":c},function(i){i={student_entered_score:i.submission.student_entered_score};d.fillTemplateData({data:i})},function(){});g||(c=a)}$("#grade_entry").hide().appendTo($("body"));if(g)d.find(".assignment_score").attr("title","").find(".score_teaser").text(o.t("titles.hypothetical_score",
"This is a What-If score")).end().find(".score_holder").append($("#revert_score_template").clone(true).attr("id","").show()).find(".grade").addClass("changed");else{a=d.data("muted")?o.t("student_mute_notification","Instructor is working on grades"):o.t("click_to_change","Click to test a different score");d.find(".assignment_score").attr("title",o.t("click_to_change","Click to test a different score")).find(".score_teaser").text(a).end().find(".grade").removeClass("changed");d.find(".revert_score_link").remove()}if(c===
0)c="0.0";d.find(".grade").html(c||d.find(".grade").data("originalValue"));n()});$("#grade_entry").blur(function(){var b=$(this).parents(".student_assignment");b.find(".score").text($(this).val());b.triggerHandler("score_change",true)});$("#grades_summary").delegate(".revert_score_link","click",function(b,e){b.preventDefault();b.stopPropagation();var d=$(this).parents(".student_assignment"),a=d.find(".original_score").text(),c=d.data("muted")?o.t("student_mute_notification","Instructor is working on grades"):
o.t("click_to_change","Click to test a different score");d.find(".score").text(a);d.data("muted")?d.find(".grade").html('<img alt="Muted" class="muted_icon" src="/images/sound_mute.png?1318436336">'):d.find(".grade").text(a||"-");d.find(".assignment_score").attr("title",o.t("click_to_change","Click to test a different score")).find(".score_teaser").text(c).end().find(".grade").removeClass("changed");d.find(".revert_score_link").remove();d.find(".score_value").text(a);e||n()});$("#grades_summary:not(.editable) .assignment_score").css("cursor",
"default");$("#grades_summary tr").hover(function(){$(this).find("td.title .context").addClass("context_hover")},function(){$(this).find("td.title .context").removeClass("context_hover")});$(".show_guess_grades_link").click(function(){$("#grades_summary .student_entered_score").each(function(){var b=parseFloat($(this).text(),10);if(!isNaN(b)&&(b||b===0)){var e=$(this).parents(".student_assignment");e.find(".score").text(b);e.find(".score_value").hide();e.triggerHandler("score_change",false)}});$(".show_guess_grades").hide()});
$("#grades_summary .student_entered_score").each(function(){var b=parseFloat($(this).text(),10);!isNaN(b)&&b&&$(".show_guess_grades").show().addClass("exists")});$(".comments .play_comment_link").mediaCommentThumbnail("normal");$(".play_comment_link").live("click",function(b){b.preventDefault();b=$(this).parents(".comment_media");var e=b.getTemplateData({textValues:["media_comment_id"]}).media_comment_id;if(e){b.children(":not(.media_comment_content)").remove();b.find(".media_comment_content").mediaComment("show_inline",
e,"any")}});$("#only_consider_graded_assignments").change(function(){n()}).triggerHandler("change");$("#show_all_details_link").click(function(b){b.preventDefault();$("tr.comments").show();$("tr.rubric_assessments").show()});$.scrollSidebar()})});
(function(){var o,r=function(n,b){return function(){return n.apply(b,arguments)}};o=function(){function n(){}n.calculate=function(b,e,d){var a;a={};a.group_sums=$.map(e,r(function(c){return{group:c,current:this.create_group_sum(c,b,true),"final":this.create_group_sum(c,b,false)}},this));a.current=this.calculate_total(a.group_sums,true,d);a["final"]=this.calculate_total(a.group_sums,false,d);return a};n.create_group_sum=function(b,e,d){var a,c,g,f,i,k,p,m,h;f={submissions:[],score:0,possible:0,submission_count:0};
p=b.assignments;i=0;for(k=p.length;i<k;i++){a=p[i];c={score:0,possible:0,percent:0,drop:false,submitted:false};g=$.detect(e,function(){return this.assignment_id===a.id});if(g==null)g={score:null};g.assignment_group_id=b.id;if(g.points_possible==null)g.points_possible=a.points_possible;c.submission=g;f.submissions.push(c);if(!(d&&(g.score==null||g.score===""))){c.score=this.parse(g.score);c.possible=this.parse(a.points_possible);c.percent=this.parse(c.score/c.possible);c.submitted=g.score!=null&&g.score!==
"";if(c.submitted)f.submission_count+=1}}f.submissions.sort(function(j,l){return j.percent-l.percent});d=$.extend({drop_lowest:0,drop_highest:0,never_drop:[]},b.rules);b=0;m=["low","high"];g=0;for(k=m.length;g<k;g++){e=m[g];h=f.submissions;i=0;for(p=h.length;i<p;i++){c=h[i];if(!c.drop&&d["drop_"+e+"est"]>0&&$.inArray(c.assignment_id,d.never_drop)===-1&&c.possible>0&&c.submitted){c.drop=true;if((c=c.submission)!=null)c.drop=true;d["drop_"+e+"est"]-=1;b+=1}}}if(b>0&&b===f.submission_count){f.submissions[f.submissions.length-
1].drop=false;if((c=f.submissions[f.submissions.length-1].submission)!=null)c.drop=false;b-=1}f.submission_count-=b;d=f.submissions;b=0;for(e=d.length;b<e;b++){c=d[b];c.drop||(f.score+=c.score)}d=f.submissions;e=0;for(b=d.length;e<b;e++){c=d[e];c.drop||(f.possible+=c.possible)}return f};n.calculate_total=function(b,e,d){var a,c,g,f,i,k,p;c=e?"current":"final";if(d==="percent"){k=i=d=g=0;for(p=b.length;k<p;k++){a=b[k];if(a.group.group_weight>0){if(a[c].submission_count>0){f=a[c].score/a[c].possible;
g+=a.group.group_weight*f;d+=a.group.group_weight}i+=a.group.group_weight}}if(e&&d<100)g=g*(i<100?i:100)/d;return{score:g,possible:100}}else return{score:this.sum(function(){var m,h,j;j=[];m=0;for(h=b.length;m<h;m++){a=b[m];j.push(a[c].score)}return j}()),possible:this.sum(function(){var m,h,j;j=[];m=0;for(h=b.length;m<h;m++){a=b[m];j.push(a[c].possible)}return j}())}};n.sum=function(b){var e,d,a,c;a=e=0;for(c=b.length;a<c;a++){d=b[a];e+=d}return e};n.parse=function(b){return(b=parseFloat(b))&&isFinite(b)?
b:0};n.letter_grade=function(b,e){if(e<0)e=0;return $.grep(b,function(d,a){return e>=d[1]*100||a===b.length-1})[0][0]};return n}();window.INST.GradeCalculator=o}).call(this);
$.extend(true,I18n=I18n||{},{translations:{es:{gradebook:{student_mute_notification:"El instructor est\u00e1 trabajando en las calificaciones",titles:{hypothetical_score:'Esta es una calificaci\u00f3n "que pasa si"',dropped_assignment_no_total:"Esta tarea no ser\u00e1 considerada en el c\u00e1lculo total"},click_to_change:"Haga click para probar una calificaci\u00f3n diferente",percent:"Porcentaje"}}}});
