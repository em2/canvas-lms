var timing;
I18n.scoped("quizzes.timing",function(d){timing={initialTime:new Date,initTimes:function(){if(timing.timesReady)return timing.clientServerDiff;var j=Date.parse($(".now").text())||timing.initialTime||new Date,b=timing.initialTime||new Date;timing.clientServerDiff=j.getTime()-b.getTime();timing.timesReady=true},setReferenceDate:function(j,b){timing.timesReady||timing.initTimes();var g={};g.referenceDate=Date.parse(b);g.isDeadline=true;$(".time_header").text(d.beforeLabel("time_remaining","Time Remaining"));
if(!g.referenceDate){g.isDeadline=false;$(".time_header").text(d.beforeLabel("time_elapsed","Time Elapsed"));g.referenceDate=Date.parse(j)}g.clientServerDiff=timing.clientServerDiff;return g}}});
require(["i18n"],function(d){d=d.scoped("quizzes.take_quiz");var j=null,b=function(){var g=0,l=$(".started_at"),a=$(".end_at"),e=l.text(),f=a.text(),p=f&&new Date(f),q=$(".countdown_seconds"),r=$(".time_running,.time_remaining"),m=$("#last_saved_indicator");return{referenceDate:null,countDown:null,isDeadline:true,fiveMinuteDeadline:false,oneMinuteDeadline:false,submitting:false,dialogged:false,contentBoxCounter:0,lastSubmissionUpdate:new Date,currentlyBackingUp:false,started_at:l,end_at:a,time_limit:parseInt($(".time_limit").text(),
10)||null,updateSubmission:function(h){if(!(b.submitting&&!h))if(!(new Date-b.lastSubmissionUpdate<1E3))if(!b.currentlyBackingUp){b.currentlyBackingUp=true;b.lastSubmissionUpdate=new Date;var c=$("#submit_quiz_form").getFormData();$(".question_holder .question.marked").each(function(){c[$(this).attr("id")+"_marked"]="1"});m.text(d.t("saving","Saving..."));$.ajaxJSON($(".backup_quiz_submission_url").attr("href"),"PUT",c,function(i){m.text(d.t("saved_at","Saved at %{t}",{t:$.friendlyDatetime(new Date)}));
b.currentlyBackingUp=false;h&&setTimeout(function(){b.updateSubmission(true)},3E4);if(i&&i.end_at){b.end_at.text(i.end_at);b.referenceDate=null;i.end_at>b.end_at.text()&&$.flashMessage(d.t("notices.extra_time","You have been given extra time on this attempt"))}},function(){var i=$("#identity .user_id").text()||"none";b.currentlyBackingUp=false;$.ajaxJSON(location.protocol+"//"+location.host+"/simple_response.json?user_id="+i+"&rnd="+Math.round(Math.random()*9999999),"GET",{},function(){},function(){ajaxErrorFlash(d.t("errors.connection_lost",
"Connection to %{host} was lost.  Please make sure you're connected to the Internet before continuing.",{host:location.host}),request)},{skipDefaultError:true});h&&setTimeout(function(){b.updateSubmission(true)},3E4)},{timeout:5E3})}},updateTime:function(){var h=new Date,c=b.time_limit?f:null;g=(g+1)%120;if(g==0&&!c&&!b.twelveHourDeadline){b.referenceDate=null;if(!b.time_limit&&p-h<432E5)c=f}b.referenceDate||$.extend(b,timing.setReferenceDate(e,c,h));if(b.countDown){c=b.countDown.getTime()-h.getTime()-
b.clientServerDiff;if(c<=0)c=0;q.text((new Date(c)).getUTCSeconds());if(c<=0&&!b.submitting){b.submitting=true;$("#submit_quiz_form").submit()}}c=b.referenceDate.getTime()-h.getTime()-b.clientServerDiff;if(b.isDeadline){if(c<1E3)c=0;if(c<1E3&&!b.dialogged){b.dialogged=true;b.countDown=new Date(h.getTime()+1E4);$("#times_up_dialog").show().dialog({title:d.t("titles.times_up","Time's Up!"),width:"auto",height:"auto",modal:true,overlay:{backgroundColor:"#000",opacity:0.7},close:function(){if(!b.submitting){b.submitting=
true;$("#submit_quiz_form").submit()}}})}else if(c>3E4&&c<6E4&&!b.oneMinuteDeadline){b.oneMinuteDeadline=true;$.flashMessage(d.t("notices.one_minute_left","One Minute Left"))}else if(c>25E4&&c<3E5&&!b.fiveMinuteDeadline){b.fiveMinuteDeadline=true;$.flashMessage(d.t("notices.five_minutes_left","Five Minutes Left"))}else if(c>18E5&&c<177E4&&!b.thirtyMinuteDeadline){b.thirtyMinuteDeadline=true;$.flashMessage(d.t("notices.thirty_minutes_left","Thirty Minutes Left"))}else if(c>432E5&&c<4317E4&&!b.twelveHourDeadline){b.twelveHourDeadline=
true;$.flashMessage(d.t("notices.twelve_hours_left","Twelve Hours Left"))}}b.updateTimeString(c)},updateTimeString:function(h){var c=new Date(Math.abs(h));h=c.getUTCFullYear()-1970;var i=c.getUTCMonth(),n=c.getUTCDate()-1,o=c.getUTCHours(),s=c.getUTCMinutes();c=c.getUTCSeconds();var k=[];h&&k.push(d.t("years_count","Year",{count:h}));i&&k.push(d.t("months_count","Month",{count:i}));n&&k.push(d.t("days_count","Day",{count:n}));o&&k.push(d.t("hours_count","Hour",{count:o}));k.push(d.t("minutes_count",
"Minute",{count:s}));k.push(d.t("seconds_count","Second",{count:c}));r.text(k.join(", "))}}}();$(document).mousedown(function(g){j=$(g.target).parents(".answer")[0]}).keydown(function(){j=null});$(function(){$("select").bind("mousewheel",false);$.scrollSidebar();if($("#preview_mode_link").length==0){window.onbeforeunload=function(){b.updateSubmission();if(!b.submitting&&!b.alreadyAcceptedNavigatingAway)return d.t("confirms.unfinished_quiz","You're about to leave the quiz unfinished.  Continue anyway?")};
$(document).delegate("a","click",function(a){if(!($(this).closest(".ui-dialog,.mceToolbar").length>0))if(!a.isDefaultPrevented()){var e=$(this).attr("href")||"",f=location.href;if(f.indexOf("#"))f=f.substring(0,f.indexOf("#"));if(!(e.indexOf("#")==0||e.indexOf(f+"#")==0))if(confirm(d.t("confirms.navigate_away","You're about to navigate away from this page.  Continue anyway?")))b.alreadyAcceptedNavigatingAway=true;else a.preventDefault()}})}var g=$("#questions");$("#question_list").delegate(".jump_to_question_link",
"click",function(a){a.preventDefault();a=$($(this).attr("href"));$("html,body").scrollTo(a.parent());a.find(":input:first").focus().select()}).find(".list_question").bind({mouseenter:function(){var a=$(this),e=a.data(),f=d.t("titles.not_answered","Haven't Answered yet");if(a.hasClass("marked"))f=d.t("titles.come_back_later","You marked this question to come back to later");else if(a.hasClass("answered"))f=d.t("titles.answered","Answered");a.attr("title",f);e.relatedQuestion||(e.relatedQuestion=$("#"+
a.attr("id").substring(5)));e.relatedQuestion.addClass("related")},mouseleave:function(){var a=$(this).data("relatedQuestion");a&&a.removeClass("related")}});g.find(".group_top,.answer_select").bind({mouseenter:function(){$(this).addClass("hover")},mouseleave:function(){$(this).removeClass("hover")}});g.find(".question").bind({mouseenter:function(){var a=$(this),e=a.find($(document.activeElement)).filter("select");e.length&&e.unbind("blur.unhoverQuestion");a.hasClass("hover")||a.addClass("hover")},
mouseleave:function(){var a=$(this),e=a.find($(document.activeElement)).filter("select");if(e.length)e.one("blur.unhoverQuestion",function(){$(this).closest(".question").trigger("mouseleave")});else a.removeClass("hover")}});g.delegate(":checkbox,:radio,label","change mouseup",function(){var a=$(this).parents(".answer");if(j==a[0]){a.find(":checkbox,:radio").blur();b.updateSubmission()}}).delegate(":text,textarea","change blur",function(a,e){e!==false&&b.updateSubmission()}).delegate(".numerical_question_input",
{keypress:function(a){var e=String.fromCharCode(a.charCode||a.keyCode);if(a.charCode==0||e=="-"||e=="."||e=="0"||parseInt(e,10))$(this).triggerHandler("focus");else{$(this).errorBox(d.t("errors.only_numerical_values","only numerical values are accepted"));a.preventDefault();a.stopPropagation()}},"change blur":function(){var a=parseFloat($(this).val());a=isNaN(a)?"":a.toFixed(4);$(this).val(a)}}).delegate(".flag_question","click",function(){var a=$(this).parents(".question");a.toggleClass("marked");
$("#list_"+a.attr("id")).toggleClass("marked")}).delegate(".question_input","change",function(){var a=$(this),e=$(this)[0].tagName.toUpperCase(),f="";if(e=="TEXTAREA")f=a.editorBox("get_code");else if(e=="TEXTAREA"||e=="SELECT"||a.attr("type")=="text")f=a.val();else a.parents(".question").find(".question_input").each(function(){if($(this).attr("checked")||$(this).attr("selected"))f=true});$("#list_"+a.parents(".question").attr("id"))[f?"addClass":"removeClass"]("answered")}).find(".question_input").change();
setInterval(function(){$("textarea.question_input").each(function(){$(this).triggerHandler("change",false)})},2500);$(".hide_time_link").click(function(a){a.preventDefault();if($(".time_running").css("visibility")!="hidden"){$(".time_running").css("visibility","hidden");$(this).text(d.t("show_time_link","Show"))}else{$(".time_running").css("visibility","visible");$(this).text(d.t("hide_time_link","Hide"))}});setTimeout(function(){$("#question_list .list_question").each(function(){var a=$(this);a.find(".jump_to_question_link").text()==
"Spacer"&&a.remove()})},1E3);$("#submit_quiz_form").submit(function(a){$(".question_holder textarea.question_input").each(function(){$(this).change()});if((unanswered=$("#question_list .list_question:not(.answered)").length)&&!b.submitting)if(!confirm(d.t("confirms.unanswered_questions",{one:"You have 1 unanswered question. Submit anyway?",other:"You have %{count} unanswered questions. Submit anyway?"},{count:unanswered}))){a.preventDefault();a.stopPropagation();return false}b.updateSubmission(true);
b.submitting=true});$(".submit_quiz_button").click(function(a){b.updateSubmission(true);a.preventDefault();$("#times_up_dialog").dialog("close")});$("#finish_later_button").click(function(){b.updateSubmission(true)});setTimeout(function(){$(".question_holder textarea.question_input").each(function(){$(this).attr("id","question_input_"+b.contentBoxCounter++);$(this).editorBox()})},2E3);setInterval(b.updateTime,400);var l=$("#identity .user_id").text()||"none";setInterval(function(){$.ajaxJSON(location.protocol+
"//"+location.host+"/simple_response.json?user_id="+l+"&rnd="+Math.round(Math.random()*9999999),"GET",{},function(){},function(){ajaxErrorFlash(d.t("errors.connection_lost","Connection to %{host} was lost.  Please make sure you're connected to the Internet before continuing.",{host:location.host}),request)},{skipDefaultError:true})},3E4);setTimeout(function(){b.updateSubmission(true)},15E3)})});
$.extend(true,I18n=I18n||{},{translations:{es:{quizzes:{timing:{labels:{time_remaining:"Tiempo Restante",time_elapsed:"Tiempo Transcurrido"}},take_quiz:{confirms:{unanswered_questions:{one:"Tiene 1 pregunta sin contestar (vea la barra a la derecha para los detalles). \u00bfDesea enviar?",other:"Tiene %{count} preguntas sin contestar (vea la barra a la derecha para los detalles). \u00bfDesea enviar?"},navigate_away:"Est\u00e1 a punto de navegar hacia otra p\u00e1gina. \u00bfDesea Continuar?",unfinished_quiz:"Est\u00e1 a punto de dejar la evaluaci\u00f3n incompleta. \u00bfDesea Continuar?"},
hours_count:{one:"1 Hora",other:"%{count} Horas"},seconds_count:{one:"1 Segundo",other:"%{count} Segundos"},errors:{connection_lost:"Se perdi\u00f3 la conexi\u00f3n a %{host} . Aseg\u00farese que est\u00e1 conectado al internet antes de continuar.",only_numerical_values:"S\u00f3lo se aceptan valores num\u00e9ricos"},months_count:{one:"1 Mes",other:"%{count} Meses"},titles:{answered:"Contestado",not_answered:"A\u00fan no ha Contestado",come_back_later:"Marc\u00f3 esta pregunta para regresar a ella",
times_up:"\u00a1Se acab\u00f3 el tiempo!"},minutes_count:{one:"1 Minuto",other:"%{count} Minutos"},years_count:{one:"1 A\u00f1o",other:"%{count} A\u00f1os"},hide_time_link:"Esconder",notices:{five_minutes_left:"Cinco Minutos Restantes",twelve_hours_left:"Doce Horas Restantes",thirty_minutes_left:"Treinta Minutos Restantes",one_minute_left:"Un Minuto Restante",extra_time:"Ha recibido tiempo extra en este intento"},days_count:{one:"1 D\u00eda",other:"%{count} D\u00edas"},show_time_link:"Mostrar"}}},
em2:{quizzes:{take_quiz:{confirms:{unfinished_quiz:"You're about to leave the assessment unfinished.  Continue anyway?"}}}}}});
