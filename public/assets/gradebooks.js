var grading_scheme,readOnlyGradebook,gradebook;
I18n.scoped("gradebook",function(m){function v(c){var a=c.data("object_id");if(!a){a=c.find(".table_entry,.student_header,.assignment_header").attr("id");a=a.replace(/^outer_/,"")}c.data("object_id",a);c=object_data[a];for(var j=a.split(/[_-]/),h=[];j.length>0&&isNaN(parseInt(j[0],10));)h.push(j.shift());j=h.join("_");if(c){a=c[j]||c.audit_student||c.user;if(!a)for(var t in c)a=c[t];a[j+"_id"]=a.id;c=a}else{h=a.split("_");c={};if(h[0]=="submission"){c.user_id=h[1];c.assignment_id=h[2]}object_data[a]=
{};object_data[a][h[0]]=c}if(j=="submission"){t=object_data["assignment_"+c.assignment_id];t=t.assignment;c.assignment_group_id=t.assignment_group_id;c.points_possible=t.points_possible}return c}function J(c,a){var j=S.getFormData(),h=$("#submission_"+c.student_id+"_"+c.assignment_id);h.parent();h.loadingImage({image_size:"small"});n({user_id:c.student_id,assignment_id:c.assignment_id,grade:c.grade});if(c.id&&c.id!=="")j["submission[id]"]=c.id;if(c.comment)j["submission[comment]"]=c.comment;j["submission[group_comment]"]=
c.group_comment?"1":"0";j["submission[assignment_id]"]=c.assignment_id;j["submission[user_id]"]=c.student_id;j["submission[grade]"]=c.grade;var t=function(y){for(var q in y){var o=y[q].submission;n(o);K(o.user_id)}y.length>1&&alert(m.t("alerts.students_updated",{one:"1 Student Updated",other:"%{count} Students Updated"},{count:y.length}));h.loadingImage("remove")},B=function(){h.loadingImage("remove")};a&&F.find(".comment_attachments input[type='file']").length?$.ajaxJSONFiles(S.attr("action")+".text",
"POST",j,F.find(".comment_attachments input[type='file']"),t,B):$.ajaxJSON(S.attr("action"),"POST",j,t,B)}function n(c){if(c){var a=null;if(!datagrid.initialized){var j=datagrid.cells[gradebook.studentIndexes[c.user_id]+","+gradebook.assignmentIndexes[c.assignment_id]];a=j&&j.find("#submission_"+c.student_id+"_"+c.assignment_id);if(!a||!a.length){gradebook.queuedSubmissions=gradebook.queuedSubmissions||[];gradebook.queuedSubmissions.push(c);return}}object_data["submission_"+c.user_id+"_"+c.assignment_id]=
{submission:c};j=(j=object_data["assignment_"+c.assignment_id])&&j.assignment;c.student_id=c.user_id;a=a||$("#submission_"+c.student_id+"_"+c.assignment_id);a.css("visibility","");var h=c&&$.parseFromISO(c.submitted_at).minute_timestamp,t=j&&$.parseFromISO(j.due_at).minute_timestamp;a.parent().toggleClass("late",!!(j&&c&&j.due_at&&c.submission_type&&c.submitted_at&&h>t));if(c.grade!==""&&c.grade==0)c.grade="0";h=a.find(".score");var B=a.find(".pending_review");t=a.find(".turnitin");var y=a.find(".grade");
h.showIf(c.score);a.fillTemplateData({data:c});if(c.submission_type!="online_quiz"||c.workflow_state!="pending_review")B.remove();else if(!B.length){y.after($("#gradebook_urls .pending_review").clone());B.addClass("showable").showIf(!a.find(".grading_value:visible").length)}a=null;if(c.turnitin_data){if(c.attachments&&c.submission_type=="online_upload")for(var q in c.attachments){B=c.attachments[q].attachment;if(B=c.turnitin_data&&c.turnitin_data["attachment_"+B.id]){a=a||{};a.items=B.items||[];a.items.push(B)}}else if(c.submission_type==
"online_text_entry")if(B=c.turnitin_data&&c.turnitin_data["submission_"+c.id]){a=a||{};a.items=B.items||[];a.items.push(B)}if(a){B={failure:4,problem:3,warning:2,acceptable:1};var o=0;for(q=0;q<a.items.length;q++)o+=B[a.items[q].state];a.state={"0":"none","1":"acceptable","2":"warning","3":"problem","4":"failure"}[Math.floor(o/a.items.length)]||"no"}}if(a){if(!t.length){q=$("#gradebook_urls .turnitin").clone();q.attr("src",q.attr("src").replace("turnitin_no_score","turnitin_"+a.state+"_score"));y.after(q);
t.addClass("showable").show()}}else t.remove();h.showIf(j&&j.grading_type=="letter_grade");$("#outer_assignment_"+c.assignment_id).find(".grading_type").text()=="pass_fail"&&c.grade&&c.grade!=" - "&&y.empty().append($("#submission_entry_"+c.grade+"_image").clone());if(c.grade==null||c.grade==="")y.empty().append(s(c))}}function s(c){c=$("#submission_"+c.submission_type+"_image").clone().attr("id","");if(c.length===0)c=" - ";return c}function z(c,a){var j=object_data["assignment_"+a.assignment_id].assignment,
h=$("#outer_student_"+a.user_id+" .display_name").text(),t=$("#outer_assignment_"+a.assignment_id+" .display_name").text(),B=m.t("submission_information","Submission Information"),y=c.find(".grade"),q=c.find(".score"),o=$.trim(y.text()),b=$("#student_grading_"+a.assignment_id).clone(),f=a.comment||"";f=a.points_possible;var i=$(document.createElement("div")),g=$(document.createElement("div")),e=$("#gradebook_urls .view_online_submission_url").attr("href");if(h&&t)B=t+": "+h;if(y.find("img").length>
0)o=y.find("img").attr("alt");if(q.length>0)o=q.text();if(o=="_"||o=="-")o="";if(b[0].tagName=="SELECT")b.val(a.grade);else o!=""&&b.val(o);e=$.replaceTags(e,"assignment_id",a.assignment_id);e=$.replaceTags(e,"user_id",a.user_id);re=RegExp('("|%22)'+a.user_id+'("|%22)');e=e.replace(re,a.user_id);i.append($("#submission_view_image").clone(true).removeAttr("id"));i.append($(" <a href='"+e+"'>"+m.t("links.submission_details","Submission Details")+"</a>"));g.css({textAlign:"center",fontWeight:"bold",
fontSize:"1.2em",marginTop:5});if(a.submission_type&&a.submission_type!="online_quiz")if(a.submission_type=="online_url"){g.append($("#submission_"+a.submission_type+"_image").clone().removeAttr("id"));e=a.url;g.append(" <a href='"+e+"' target='_new'>"+m.t("links.go_to_submission","Go To Submission URL")+"</a>")}else if(a.submission_type=="online_upload"){e=$("#gradebook_urls .view_online_upload_url").attr("href");e=$.replaceTags(e,"assignment_id",a.assignment_id);e=$.replaceTags(e,"user_id",a.user_id);
if(a.attachments)for(var l in a.attachments){h=a.attachments[l].attachment;t=$.replaceTags(e,"attachment_id",h.id);if(y=a.turnitin_data&&a.turnitin_data["attachment_"+h.id]){q=$.replaceTags($.replaceTags($.replaceTags($(".turnitin_report_url").attr("href"),"user_id",a.user_id),"asset_string","attachment_"+h.id),"assignment_id",a.assignment_id);var k=$("<a/>");k.attr("href",q).addClass("turnitin_similarity_score").addClass((y&&y.state||"no")+"_score");k.attr("title",m.t("titles.turnitin_score","Turnitin similarity score -- more information"));
k.attr("target","_blank");k.text((y.similarity_score||"--")+"%");g.append(k)}g.append($("#submission_"+a.submission_type+"_image").clone().removeAttr("id"));g.append(" <a href='"+t+"'>"+$.htmlEscape(m.t("links.download_attachment","Download %{attachment}",{attachment:h.display_name}))+"</a><br/>")}}else{if(a.submission_type=="online_text_entry"){if(y=a.turnitin_data&&a.turnitin_data["submission_"+a.id]){q=$.replaceTags($.replaceTags($.replaceTags($(".turnitin_report_url").attr("href"),"user_id",a.user_id),
"asset_string","submission_"+a.id),"assignment_id",a.assignment_id);k=$("<a/>");k.attr("href",q).addClass("turnitin_similarity_score").addClass((y&&y.state||"no")+"_score");k.attr("title",m.t("titles.turnitin_score","Turnitin similarity score -- more information"));k.attr("target","_blank");k.text(y.similarity_score+"%");g.append(k)}g.append($("#submission_"+a.submission_type+"_image").clone().removeAttr("id"));e=$("#gradebook_urls .view_online_text_entry_url").attr("href");e=$.replaceTags(e,"assignment_id",
a.assignment_id);e=$.replaceTags(e,"user_id",a.user_id);g.append(" <a href='"+e+"' target='_new'>"+m.t("links.view_submission","View Submission")+"</a>")}}else if(a.quiz_submission){e=$("#gradebook_urls .view_quiz_url").attr("href");e=$.replaceTags(e,"quiz_id",a.quiz_submission.quiz_id);e=$.replaceTags(e,"user_id",a.user_id);if(a.workflow_state=="pending_review"){g.append($("#submission_pending_review_image").clone().removeAttr("id"));g.append(" <a href='"+e+"' target='_new'>"+m.t("links.finish_scoring",
"Finish Scoring this Quiz")+"</a>")}else{g.append($("#submission_quiz_image").clone().removeAttr("id"));g.append(" <a href='"+e+"' target='_new'>"+m.t("links.view_quiz","View this Quiz")+"</a>")}}else if(a.submission_type=="online_text_entry"){e=$("#gradebook_urls .view_online_text_entry_url").attr("href");e=$.replaceTags(e,"assignment_id",a.assignment_id);e=$.replaceTags(e,"user_id",a.user_id);if(y=a.turnitin_data&&a.turnitin_data["submission_"+a.id]){q=$.replaceTags($.replaceTags($.replaceTags($(".turnitin_report_url").attr("href"),
"user_id",a.user_id),"asset_string","submission_"+a.id),"assignment_id",a.assignment_id);k=$("<a/>");k.attr("href",q).addClass("turnitin_similarity_score").addClass((y&&y.state||"no")+"_score");k.attr("title",m.t("titles.turnitin_score","Turnitin similarity score -- more information"));k.attr("target","_blank");k.text(y.similarity_score+"%");g.append(k)}g.append($("#submission_"+a.submission_type+"_image").clone().removeAttr("id"));g.append(" <a href='"+e+"' target='_new'>"+m.t("links.view_submission",
"View Submission")+"</a>")}F.find(".no_comments").hide().end().find(".add_comment_link").hide().end().find(".points_possible").text(f||"").end().find(".out_of").showIf(f||f==="0").end().find(".grade_entry").empty().append(b.show()).end().find("textarea.comment_text").show().val("").end().find(".submission_details").empty().append(i).append(g).show().end().find(".submission_comments").empty().end().find(".comment_attachments").empty().end().find(".save_buttons,.add_comment").showIf(!readOnlyGradebook).end().find(".group_comment").showIf(j&&
j.group_category).find(":checkbox").attr("checked",true).end().end();if(readOnlyGradebook)F.find(".grade_entry").text(o||"-");a.student_id=a.user_id;a.id=a.id||"";j=j.due_at&&a.submitted_at&&Date.parse(j.due_at)<Date.parse(a.submitted_at);F.find(".submitted_at_box").showIf(a.submitted_at).toggleClass("late_submission",!!j);a.submitted_at_string=$.parseFromISO(a.submitted_at).datetime_formatted;F.fillTemplateData({data:a,except:["created_at","submission_comments","submission_comment","comment","attachments",
"attachment"]});for(l in a.submission_comments){f=a.submission_comments[l].submission_comment;j=$("#submission_comment_blank").clone(true).removeAttr("id");f.posted_at=$.parseFromISO(f.created_at).datetime_formatted;j.fillTemplateData({data:f,except:["attachments"]});if(f.attachments)for(var u in f.attachments){h=f.attachments[u].attachment;o=$("#submission_comment_attachment_blank").clone().removeAttr("id").show();h.assignment_id=a.assignment_id;h.user_id=a.user_id;h.comment_id=f.id;o.fillTemplateData({data:h,
hrefValues:["assignment_id","user_id","id","comment_id"]});j.find(".attachments").append(o)}F.find(".submission_comments").append(j.show())}F.show().dialog("close").dialog({width:500,height:"auto",title:B,open:function(){F.find(".grading_value").focus().select();$("#gradebook").data("disable_highlight",true)},close:function(){$("#gradebook").data("disable_highlight",false)},autoOpen:false}).dialog("open").dialog("option","title",B)}function w(c){var a=v(c);if(a&&a.submission_comments)z(c,a);else{$("#loading_submission_details_dialog").dialog("close").dialog({autoOpen:false,
title:m.t("titles.loading","Loading...")}).dialog("open");var j=$("#loading_submission_details_dialog .submission_details_url").attr("href");j=$.replaceTags($.replaceTags(j,"user_id",a.user_id),"assignment_id",a.assignment_id);$.ajaxJSON(j,"GET",{},function(h){$("#loading_submission_details_dialog").dialog("close");h.submission.submission_comments=h.submission.submission_comments||[];object_data["submission_"+a.user_id+"_"+a.assignment_id]=h;a=v(c);z(c,a)},function(){})}}function r(){gradebook.updateAllStudentGrades=
function(c){gradebook.finalGradesReady=false;if(c)for(var a in object_data)if(object_data[a].submission){c=object_data[a].submission;T[c.user_id]=T[c.user_id]||[];T[c.user_id].push(c)}$(".outer_student_name").each(function(){var j=v($(this));W.push(j.id)})};setInterval(function(){if(W.length>0){var c=W.shift();if(T[c]){for(var a in T[c])n(T[c][a]);T[c]=null}K(c)}else gradebook.finalGradesReady=true},100);gradebook.updateAllStudentGrades();$("html,body").scrollTop(0);$(".outer_assignment_name").each(function(){var c=
$(this),a=v(c),j={title:a.title,id:a.assignment_id,date_sortable:a.due_at,group_id:a.assignment_group_id,special_sort:"a"};j.id=j.id||c.find(".student_header").attr("id").substring(17);if(c.hasClass("final_grade")){j.special_sort="z";j.group_id="z"}else if(c.hasClass("group_total")){a=$("#groups_data .group").index($("#group_"+a.assignment_group_id));j.special_sort="y_"+a}c.data("assignment_object",j)})}function C(c){var a=0,j=$("#class_weighting_policy").attr("checked");$("#groups_data").find(".group").each(function(){var h=
$(this).find(".group_weight").val();h=parseFloat(h);if(isNaN(h))h=0;if(c){var t=$(this).getTemplateData({textValues:["assignment_group_id"]}).assignment_group_id,B=h+"%",y=" of grade";if(!j)y=B="";$("#outer_assignment_group-"+t+",#assignment_group-"+t).find(".points_possible").text(B).end().find(".before_points_possible").text("").end().find(".after_points_possible").text(y)}a+=h});$("#groups_data").find(".total_weight").text(a);c&&gradebook.updateAllStudentGrades&&gradebook.updateAllStudentGrades()}
function D(c,a){if(a)if(!(a&&a.length===0)){var j=a.getTemplateData({textValues:["assignment_group_id","rules"]});j=$.extend(j,a.getFormData());var h=c[j.assignment_group_id]||{};if(!h.group_weight)h.group_weight=parseFloat(j.group_weight)/100;h.scores=h.scores||[];h.full_points=h.full_points||[];h.count=h.count||0;h.submissions=h.submissions||[];h.scored_submissions=h.scored_submissions||[];h.sorted_submissions=h.sorted_submissions||[];if(h.score_total!==null||h.full_total!==null){h.calculated_score=
h.score_total/h.full_total;if(isNaN(h.calculated_score)||!isFinite(h.calculated_score))h.calculated_score=0}h.score_total=h.score_total||0;h.full_total=h.full_total||0;if(!h.rules){j.rules=j.rules||"";var t={drop_highest:0,drop_lowest:0,never_drop:[]},B=j.rules.split("\n"),y;for(y in B){var q=B[y].split(":"),o=null;if(q.length>1)o=parseInt(q[1],10);if(o&&!isNaN(o)&&isFinite(o))if(q[0]=="drop_lowest")t.drop_lowest=o;else if(q[0]=="drop_highest")t.drop_highest=o;else q[0]=="never_drop"&&t.never_drop.push(o)}h.rules=
t}return c[j.assignment_group_id]=h}}function K(c){var a=$(".table_entry.student_"+c);if(a.length!==0){var j={};$("#groups_data .group").each(function(){D(j,$(this))});a.each(function(){if(!$(this).find(".grade").hasClass("hard_coded")){var e=v($(this).parent()),l=j[e.assignment_group_id];l||(l=D($("#group_"+e.assignment_group_id)));if(l)if(!(V&&(e.grade==null||e.grade===""))){var k=parseFloat(e.score);if(!k||isNaN(k)||!isFinite(k))k=0;var u=parseFloat(e.points_possible);if(!u||isNaN(u))u=0;var x=
k/u;if(isNaN(x)||!isFinite(x))x=0;e.calculated_score=k;e.calculated_possible=u;e.calculated_percent=x;l.submissions.push(e);if(e.score||e.score===0)l.scored_submissions.push(e);j[e.assignment_group_id]=l}}});for(var h in j){a=j[h];a.sorted_submissions=a.submissions.sort(function(e,l){var k=[e.calculated_percent,(object_data["assignment_"+e.assignment_id]||{}).due_at],u=[l.calculated_percent,(object_data["assignment_"+l.assignment_id]||{}).due_at];if(k>u)return 1;if(k==u)return 0;return-1});for(var t=
0,B=0,y=a.scored_submissions.length,q=0;q<a.sorted_submissions.length;q++)a.sorted_submissions[q].calculated_drop=false;for(q=0;q<a.sorted_submissions.length;q++){var o=a.sorted_submissions[q];if(!o.calculated_drop&&t<a.rules.drop_lowest&&t+B+1<y&&o.calculated_possible>0&&$.inArray(o.assignment_id,a.rules.never_drop)==-1){t++;o.calculated_drop=true}a.sorted_submissions[q]=o}for(q=a.sorted_submissions.length-1;q>=0;q--){o=a.sorted_submissions[q];if(!o.calculated_drop&&B<a.rules.drop_highest&&t+B+1<
y&&o.calculated_possible>0&&$.inArray(o.assignment_id,a.rules.never_drop)==-1){B++;o.calculated_drop=true}a.sorted_submissions[q]=o}for(q=0;q<a.sorted_submissions.length;q++){o=a.sorted_submissions[q];if(o.calculated_drop)$("#submission_"+o.user_id+"_"+o.assignment_id).parent().addClass("dropped");else{$("#submission_"+o.user_id+"_"+o.assignment_id).parent().removeClass("dropped");a.scores.push(o.calculated_score);a.full_points.push(o.calculated_possible);a.count++;a.score_total+=o.calculated_score;
a.full_total+=o.calculated_possible}}j[h]=a}var b=0;var f=h=0,i=0,g=0;$.each(j,function(e,l){D(j,$("#group_"+e));var k=Math.round(l.calculated_score*1E3)/10;$("#submission_"+c+"_group-"+e).css("visibility","").attr("data-tip","pts: "+l.score_total+" / "+l.full_total).find(".grade").text(k).end().find(".score").hide().end().find(".pct").text(" %").show();k=l.calculated_score*l.group_weight;if(isNaN(k)||!isFinite(k))k=0;if(V&&l.count>0)i+=l.group_weight;b+=k;g+=l.score_total;f+=l.full_total});h=parseFloat($("#groups_data .total_weight").text());
if(!$("#class_weighting_policy").attr("checked")||isNaN(h)||!isFinite(h)||h===0)h=Math.round(1E3*g/f)/10;else{h=parseFloat($("#groups_data .total_weight").text())/100;if(isNaN(h)||!isFinite(h)||h===0)h=1;if(V&&i<1)b=(h<1?h:1)*b/i;h=Math.round(b*1E3)/10}if(isNaN(h)||!isFinite(h))h=0;a="";if(grading_scheme)a=INST.GradeCalculator.letter_grade(grading_scheme,h);$("#submission_"+c+"_final-grade").css("visibility","").attr("data-tip",gradebook.pointCalculations?"pts: "+g+" / "+f:"").find(".grade").text(h).end().find(".score").hide().end().find(".letter_grade").showIf(grading_scheme).text(a).end().find(".pct").text(" %").show()}}
function L(c){var a=window.location.protocol+"//"+window.location.host+window.location.pathname+"?updated="+lastGradebookUpdate;$("#datagrid_topleft").gradebookLoading();$.ajaxJSON(a,"GET",{},function(j){c&&setTimeout(function(){L(true)},12E4);$("#datagrid_topleft").gradebookLoading("remove");var h=lastGradebookUpdate;for(idx in j){var t=j[idx].submission;t.student_id=t.user_id;if(t.updated_at.substring(0,19)>lastGradebookUpdate){n(t);if(t.updated_at>h)h=t.updated_at.substring(0,19)}}lastGradebookUpdate=
h},function(){c&&setTimeout(function(){L(true)},24E4);$("#datagrid_topleft").gradebookLoading("remove")})}var I=$("#loading_gradebook_progressbar"),E=$("#default_grade_form"),M=$("#assignment_details_dialog"),F=$("#submission_information"),S=$("#update_submission_form");$("#publish_to_sis_form");var R=$("#curve_grade_dialog");$("#message_students_dialog");var Z=$("#information_link"),O=$("#total_tooltip").appendTo("body");$("#content").offset();var aa=$("#gradebook_full_content").data("context_code"),
V=true,X={},ca=$(".outer_student_name .course_section"),ba=$("#current_context_code").text().split("_")[1],Y=$.store.userGet("grading_show_only_section"+ba);ca.each(function(){X[$(this).data("course_section_id")]=$(this).attr("title")});if(Y){var da=false,ea=0;$.each(id_maps,function(c){c.match("row_")&&delete id_maps[c]});ca.add(".gradebook_table .course_section").each(function(){if($(this).data("course_section_id")!=Y)$(this).closest("tr").remove();else{var c=$(this).closest(".student_header").attr("id");
if(c){++ea;id_maps["row_"+ea]=Number(c.replace("student_",""))}da=true}});if(!da){alert(m.t("alerts.no_students_in_section","Could not find any students in that section, falling back to showing all sections."));$.store.userRemove("grading_show_only_section"+ba);window.location.reload()}}gradebook={hoverCount:-1,fileIndex:1,assignmentIndexes:{},studentIndexes:{},showInfoLink:function(c){if(!datagrid.currentFocus){var a=c.find(".table_entry");if(c.hasClass("group_total")||c.hasClass("final_grade")){Z.hide();
if(a.attr("data-tip")){c=c.offset();O.show().find(".text").text(a.attr("data-tip"));a=O.outerHeight();O.css({left:c.left-2,top:c.top-a-3})}else O.hide()}else if(!a.length||a.find(".new_message,.pending_review,.turnitin").filter(":visible").length||c.hasClass("group_total")||c.hasClass("final_grade")){Z.hide();O.hide()}else{O.hide();Z.appendTo(a).show()}}},hideInfoLink:function(){O.hide();Z.hide();gradebook.hoverCount=-1},populate:function(){gradebook.updateAllStudentGrades&&gradebook.updateAllStudentGrades()},
makeAccessible:function(){var c=$("#datagrid_data .content"),a=$("#datagrid_left .display_name");c.attr("role","grid").prepend(function(){var j=$("#datagrid_top .assignment_title").map(function(){return"<div role='columnheader' id='th_"+$(this).parents(".assignment_header").attr("id")+"' tabindex='-1'>"+$(this).html()+"</div>"}).get().join("");return"<div class='hidden-readable' role='row'><div role='columnheader' tabindex='-1'>"+m.t("student_name","Student Name")+"</div>"+j+"</div>"}).find(".row").attr("role",
"row").prepend(function(j){return"<div id='th_"+a.eq(j).parents(".student_header").attr("id")+"' tabindex='-1' class='ui-helper-hidden-accessible' role='rowheader'>"+a.eq(j).html()+"</div>"});c.find(".data_cell").attr({role:"gridcell",tabindex:-1,"aria-labelledby":function(){var j=$(this).find(".table_entry").attr("id").split("_");return"th_assignment_"+j[2]+" th_student_"+j[1]}})}};$(document).ready(function(){gradebook.pointCalculations=!$("#class_weighting_policy").attr("checked");var c=function(){$("#gradebook_full_content").hide();
setTimeout(function(){$("#gradebook_table").bind("entry_over",function(b,f){if(f.trueEvent){gradebook.showInfoLink(f.cell);var i=function(e,l){var k=f.cell.offset();O.show().find(".text").html(e);var u=O.outerHeight();O.css({left:k.left-(l?15:2),top:k.top-u-3})};if(f.cell.hasClass("late"))i(m.t("tooltips.submitted_late","This submission was submitted late"));else if(f.cell.hasClass("dropped"))i(m.t("tooltips.submission_dropped","This submission is dropped for grading purposes"));else if(datagrid.columns[f.cell.column].hidden){var g=
v(datagrid.cells["0,"+f.cell.column]).title;i($.htmlEscape(g)+"<br/><span style='font-size: 0.9em;'>"+m.t("click_to_expand","Click to expand")+"</span>",true)}}else b&&b.originalEvent&&b.originalEvent.type&&!b.originalEvent.type.match(/mouse/)&&f.cell.find(".grade").focus().css("outline",0)}).bind("entry_out",function(){gradebook.hideInfoLink()}).bind("entry_click",function(b,f){var i=f.cell;b.originalEvent&&$(b.originalEvent.target).closest(".display_name,.assignment_title").length==0&&b.originalEvent.preventDefault();
if(!(i.hasClass("column_header")||i.hasClass("row_header")||i.find(".grade").hasClass("hard_coded"))){f.cell.data("from_click",true);datagrid.focus(i.row,i.column);f.cell.data("from_click",false)}}).bind("entry_focus",function(b,f){if(readOnlyGradebook){datagrid.blur();return false}var i=f.cell.find(".table_entry"),g=i.find(".grade"),e=true,l=$.trim(g.text());gradebook.hideInfoLink();if(i.find(".grade img.submission_icon").length>0&&f.cell.data("from_click")){w(f.cell);datagrid.blur()}else{if(g.hasClass("hard_coded"))e=
false;if(e){if(g.find("img.graded_icon").length)l=g.find("img.graded_icon").attr("alt").toLowerCase();else if(i.find(".score").length>0&&!(l&&l.match(/.+%/)))l=$.trim(i.find(".score").text());l=$.trim(l);if(l=="-")l="";var k=v(f.cell);if(e){e=f.cell.width();var u=f.cell.height();k=$("#student_grading_"+k.assignment_id).clone(true);var x=k.children().andSelf().filter(".grading_value");g.hide().after(k);k.css("display","block");if(x.attr("type")=="text"){e-=8;u-=8}else{e-=2;u-=2}k.width(e).height(u).css("margin",
1);x.height(u);if(x[0].tagName!="SELECT"||l!=="")x.val(l);k.show();x.focus().select()}i.find(".new_message,.pending_review").hide()}}}).bind("entry_blur",function(b,f){var i=f.cell.find(".table_entry");i.find(".new_message,.pending_review.showable,.grade").show();i.find(".grading_box").remove();f.cell.triggerHandler("mouseover");setTimeout(function(){gradebook.showInfoLink(f.cell)},50)});setTimeout(a,50)},1E3)},a=function(){$(".delete_comment_attachment_link").click(function(b){b.preventDefault();
$(this).parents(".comment_attachment").slideUp(function(){$(this).remove()})});$(".attach_comment_file_link").click(function(b){b.preventDefault();b=$(this).parents(".add_comment").find(".comment_attachment:last").clone(true);b.find("input").attr("name","attachments["+gradebook.fileIndex++ +"][uploaded_data]");$(this).parents(".add_comment").find(".comment_attachments").append(b);b.slideDown()});$(".grading_value").keycodes("esc return tab",function(b){b.preventDefault();b.stopPropagation();if(b.keyString==
"return"||b.keyString=="tab"){$(this).triggerHandler("blur",true);b.keyString=="return"?datagrid.moveDown():datagrid.moveRight()}else if(b.keyString=="esc"){b=$(this).parents("[role='gridcell']");datagrid.blur();b.focus()}});$(".grading_value").blur(function(b,f){if($(this).parents(".table_entry").parents("div.cell").length>0){var i=$(this);if(i.parents(".grading_box").length)i=i.parents(".grading_box");var g=i,e=g;i=e.parents(".table_entry");g.hasClass("grading_value")||(e=g.find(".grading_value"));
var l=g=e.val(),k=$.trim(i.find(".grade").text());if(i.find(".grade img").length>0)k=i.find(".grade img").attr("alt").toLowerCase();if(k=="-")k="";if(e.hasClass("pass_fail"))if(g=="pass"||g=="fail")g=$("#submission_entry_"+g+"_image").clone().attr("id","");e={};S.getFormData();var u=v(i.parent());e.id=u.id||"";e.assignment_id=u.assignment_id;e.student_id=u.user_id;e.grade=l;if(l!=k||l&&f)J(e);if(!g||g==""){e.submission_type=u.submission_type||"";g=s(e)}i.find(".grade").show().empty().append(g);datagrid.blur()}});
E.formSubmit({beforeSubmit:function(){E.loadingImage().find(".cancel_button").attr("disabled",true)},processData:function(b){var f=0;$(".table_entry.assignment_"+b.assignment_id+":visible").each(function(){var i=$(this);i=v(i.parent());var g="submissions[submission_"+f+"]";if(!i.score&&i.score!==0||b.overwrite_existing_grades){b[g+"[assignment_id]"]=b.assignment_id;b[g+"[user_id]"]=i.user_id;b[g+"[grade]"]=b.default_grade;f++}});if(f===0){alert(m.t("alerts.none_to_update","None to Update"));return false}return b},
success:function(b){E.loadingImage("remove");for(var f in b){var i=b[f].submission;n(i);W.push(i.user_id)}alert(m.t("alerts.scores_updated",{one:"1 Student score updated",other:"%{count} Student scores updated"},{count:b.length}));E.find(".cancel_button").attr("disabled",false);E.dialog("close")}}).find(".cancel_button").click(function(){E.dialog("close")});$("#gradebook_full_content,.datagrid").delegate(".assignment_dropdown","click",function(){var b=$(this),f=b.parent(),i=b.parents(".assignment_name").find(".grade_assignment_link").attr("href"),
g=b.parents(".assignment_name"),e=$(this).parents(".cell"),l={},k=v(g);b=function(d,p,A){l['<span class="ui-icon ui-icon-'+d+'">&nbsp;</span> '+p]=A};if(!g.hasClass("group_total")&&!g.hasClass("final_grade")){object_data.submissions&&b("info",m.t("assignment_details","Assignment Details"),function(){var d=v(g),p=$(".student_assignment .assignment_"+d.assignment_id);d.url=g.find(".assignment_link").attr("href");d.cnt=0;d.score_total=0;p.each(function(){var G=$(this);G=v(G.parent());if(G.score!==null&&
G.score!==undefined&&G.score!==""){d.cnt++;d.score_total+=G.score;if(d.max==null||G.score>d.max)d.max=G.score;if(d.min==null||G.score<d.min)d.min=G.score}});d.max=d.max||0;d.min=d.min||0;d.average=Math.round(d.score_total*10/d.cnt)/10;if(isNaN(d.average)||!isFinite(d.average))d.average=m.t("#not_applicable","N/A");var A=p=0;M.find(".distribution").showIf(d.average&&d.points_possible).find(".none_left").width(A=200*(d.min/d.points_possible)).css("left",(p+=A)-A).end().find(".some_left").width(A=200*
((d.average-d.min)/d.points_possible)).css("left",(p+=A)-A).end().find(".some_right").width(A=200*((d.max-d.average)/d.points_possible)).css("left",(p+=A)-A-2).end().find(".none_right").width(A=200*((d.points_possible-d.max)/d.points_possible)).css("left",(p+=A)-A);M.fillTemplateData({data:d}).dialog("close").dialog({autoOpen:false,title:m.beforeLabel("details","Details")+" "+d.title}).dialog("open").find(".assignment_link").attr("href",d.url)});b("newwin",m.t("speed_grader","SpeedGrader"),function(){window.location.href=
i});var u={elements:{assignments:{},modal:$("#mute_dialog"),rows:$("#datagrid_top .row, #datagrid_data .row")},init:function(){this.label=(this.isMuted=f.data("muted"))?m.t("unmute_assignment","Unmute Assignment"):m.t("mute_assignment","Mute Assignment")},onClick:function(){this.url=f.attr("href")+"/mute";this.isMuted?this.updateStatus():this.showDialog()},showDialog:function(){var d=m.t("cancel_button","Cancel"),p=m.t("mute_assignment","Mute Assignment"),A={};A[p]=$.proxy(function(){this.updateStatus();
this.elements.modal.dialog("close")},this);A[d]=$.proxy(function(){this.elements.modal.dialog("close")},this);this.elements.modal.dialog({autoOpen:false,buttons:A,modal:true,resizable:false,title:this.elements.modal.data("title"),width:400});this.elements.modal.dialog("open")},updateStatus:function(){$.ajaxJSON(this.url,"put",{status:!this.isMuted},$.proxy(this.onUpdate,this))},onUpdate:function(d){d="assignment_"+d.assignment.id;f.data("muted",!this.isMuted);if(typeof this.elements.assignments[d]===
"undefined"){this.elements.assignments[d]={};this.elements.assignments[d].assignment=$("#"+d);this.elements.assignments[d].cell=this.elements.assignments[d].assignment.parent();this.elements.assignments[d].index=this.elements.assignments[d].cell.data("column");this.elements.assignments[d].column=$(".content div[data-column="+this.elements.assignments[d].index+"]")}d=this.elements.assignments[d];this.isMuted?this.unmuteAssignment(d):this.muteAssignment(d)},muteAssignment:function(d){var p=$("<a />",
{"class":"mute_icon",title:m.t("teacher_muted_title","Assignment is muted")}).append($("<img />",{src:"/images/sound_mute.png",alt:""}));d.assignment.find("a.assignment_link.assignment_title").after(p);d.column.width(d.column.width()+20);this.elements.rows.width(this.elements.rows.width()+20)},unmuteAssignment:function(d){d.assignment.find(".mute_icon").remove();d.column.width(d.column.width()-20);this.elements.rows.width(this.elements.rows.width()-20)}};u.init();b("volume-on",u.label,$.proxy(u.onClick,
u));if(object_data.submissions){if(!readOnlyGradebook){b("mail-closed",m.t("message_students_who","Message Students Who..."),function(){var d=v(g),p=d.title,A=$("#datagrid_data .assignment_"+d.id),G={};$("#datagrid_left .student_header").each(function(){var H={};H.id=$(this).attr("id").substring(8);H.name=$(this).find(".display_name").text();G[H.id]=H});A.each(function(){var H=v($(this).parent());if(G[H.user_id]){G[H.user_id].score=H.score;G[H.user_id].submitted_at=H.submitted_at;G[H.user_id].graded_at=
H.graded_at}});A=[];for(var N in G)A.push(G[N]);window.messageStudents({options:[{text:m.t("students_who.havent_submitted_yet","Haven't submitted yet")},{text:m.t("students_who.scored_less_than","Scored less than"),cutoff:true},{text:m.t("students_who.scored_more_than","Scored more than"),cutoff:true}],title:p,points_possible:d.points_possible,students:A,callback:function(H,Q,U){U=$.grep(U,function(P){P=P.user_data;if(H==m.t("not_submitted_yet","Haven't submitted yet"))return!P.submitted_at;else if(H==
m.t("scored_less_than","Scored less than"))return P.score!=null&&P.score!==""&&Q!=null&&P.score<Q;else if(H==m.t("scored_more_than","Scored more than"))return P.score!=null&&P.score!==""&&Q!=null&&P.score>Q});return $.map(U,function(P){return P.user_data.id})}})});b("check",m.t("set_default_grade","Set Default Grade"),function(){var d=v(g),p=d.title;E.find(".assignment_title").text(p).end();E.find(".assignment_id").val(d.assignment_id);E.find(".out_of").showIf(d.points_possible||d.points_possible===
"0");E.find(".points_possible").text(d.points_possible);var A=$.replaceTags(E.find(".default_grade_url").attr("href"),"id",d.id);A=S.attr("action");E.attr("action",A).attr("method","POST");d=$box=$("#student_grading_"+d.id).clone();$box.hasClass("grading_value")||(d=$box.find(".grading_value"));d.attr("name","default_grade").show();E.find(".grading_box_holder").empty().append($box);E.dialog("close").dialog({autoOpen:false,width:350,height:"auto",open:function(){E.find(".grading_box").focus()}}).dialog("open").dialog("option",
"title",m.t("default_grade_for_course","Default Grade for %{assignment}",{assignment:p}))});k.grading_type!="pass_fail"&&k.points_possible&&b("check",m.t("curve_grades","Curve Grades"),function(){var d=v(g),p=d.title;R.find(".assignment_title").text(p).end().find(".assignment_id").val(d.assignment_id).end().find(".out_of").showIf(d.points_possible||d.points_possible==="0").end().find("#middle_score").val(parseInt((d.points_possible||0)*0.6,10)).end().find(".points_possible").text(d.points_possible).end().dialog("close").dialog({autoOpen:false,
width:350,height:"auto",open:function(){gradebook.curve()}}).dialog("open").dialog("option","title",m.t("curve_grade_for_course","Curve Grade for %{assignment}",{assignment:p}))})}var x=v(g);x.submission_types&&x.submission_types.match(/(online_upload|online_text_entry|online_url)/)&&b("disk",m.t("download_submissions","Download Submissions"),function(){var d=$(".download_assignment_submissions_url").attr("href");d=$.replaceTags(d,"assignment_id",x.assignment_id);try{object_data["assignment_"+x.assignment_id].assignment.submissions_downloads=
(x.submissions_downloads||0)+1}catch(p){}INST.downloadSubmissions(d)});x.submissions_downloads&&x.submissions_downloads>0&&!readOnlyGradebook&&b("arrowthickstop-1-n",m.t("reupload_submissions","Re-Upload Submissions"),function(){var d=$("#re_upload_submissions_form").find(".re_upload_submissions_url").attr("href");d=$.replaceTags(d,"assignment_id",x.assignment_id);$("#re_upload_submissions_form").attr("action",d);$("#re_upload_submissions_form").dialog("close").dialog({autoOpen:false,title:m.t("reupload_submission_files",
"Re-Upload Submission Files"),width:350}).dialog("open")})}}b("carat-1-w",m.t("hide_column","Hide Column"),function(){datagrid.toggleColumn(datagrid.position(e).column)});if(g.hasClass("group_total")){k=g.find(".assignment_title").text();b("carat-1-w",$.htmlEscape(m.t("hide_all_things","Hide All %{things}",{things:k})),function(){var d=v(g).assignment_group_id;$(".outer_assignment_name").each(function(){var p=v($(this)),A=p.assignment_group_id;if(d&&(d=="group-"+A||d==A)){p=datagrid.position($("#assignment_"+
p.id).parents(".cell")).column;datagrid.toggleColumn(p,false,{skipSizeGrid:true});datagrid.sizeGrid()}})})}$(this).dropdownList({options:l});return false});$("#re_upload_submissions_form").submit(function(){var b=$(this).getFormData();if(b.submissions_zip){if(!b.submissions_zip.match(/\.zip$/)){$(this).formErrors({submissions_zip:m.t("errors.upload_as_zip","Please upload files as a .zip")});return false}}else return false});$(document).keycodes("return h i r 1 2 3 4 5 6 7 8 9 0",function(b){if(!(datagrid.currentFocus||
!datagrid.currentHover))if(!($(b.target).closest(".ui-dialog").length>0)){var f=datagrid.currentHover;if(b.keyString=="return")f.hasClass("student_assignment")&&datagrid.focus(f.row,f.column);else if(b.keyString=="h")datagrid.toggleColumn(f.column);else if(b.keyString=="i"){b.preventDefault();f.hasClass("student_assignment")&&w(f)}else if(b.keyString=="r")L(false);else f.hasClass("student_assignment")&&datagrid.focus(f.row,f.column)}});$("#datagrid_data").delegate("#information_link, .new_message, .pending_review, .turnitin",
"click",function(){w($(this).parents(".student_assignment"));return false});F.find(".add_comment_link").click(function(){$(this).parent().find(".comment_text").css("display","block").focus().select();return false});F.find(".cancel_button").click(function(){F.dialog("close")});F.find(".update_button").click(function(){var b=F.getTemplateData({textValues:["id","student_id","assignment_id"]});b.comment=F.find("textarea.comment_text").val();b.grade=F.find(".grading_value").val();b.group_comment=F.find("#group_comment_checkbox").attr("checked");
J(b,true);F.dialog("close")});$(".refresh_grades_link").click(function(){L(false);return false});setTimeout(function(){L(true)},12E4);$("#hide_students_option").change(function(){var b=$(this).attr("checked");$(".student_name").find(".display_name").showIf(!b).end().find(".hidden_name").showIf(b)}).change();$("#groups_data").find(".group_weight").change(function(){var b=$(this).parents(".group"),f=b.find(".assignment_group_url").attr("href"),i=b.getFormData(),g={};g["assignment_group[group_weight]"]=
i.group_weight;$.ajaxJSON(f,"PUT",g,function(e){b.find(".group_weight").val(e.assignment_group.group_weight);C(true)});C()}).end().find(".cancel_button").click(function(){$("#groups_data").dialog("close")}).end().find("#class_weighting_policy").change(function(){var b=$(".weighting_policy_url").attr("href"),f={},i=$(this).attr("checked"),g=$(this);f["course[group_weighting_scheme]"]=i?"percent":"equal";$.ajaxJSON(b,"PUT",f,function(e){g.attr("checked",e.course.group_weighting_scheme=="percent");gradebook.pointCalculations=
!$("#class_weighting_policy").attr("checked");C(true)})});setTimeout(r,500)},j=navigator.appName,h=parseFloat(navigator.appVersion),t=navigator.productSub||"20070000",B=$("#student_names .outer_student_name").length;if(isNaN(h))h=null;var y=function(){$("#no_students_message, #gradebook_table, .datagrid").addClass("hidden-readable");var b=function(i,g){if(g.length>1)g=g.substring(1);g=g.replace(/\//g,"_");if(g.indexOf("student")==0||g.indexOf("assignment")==0||g.indexOf("submission")==0){var e=$("#"+
g),l=datagrid.position(e.parent());datagrid.scrollTo(l.row,l.column);e.parent().trigger("mouseover")}},f=$("#gradebook_entry_template").html();datagrid.init($("#gradebook_table"),{templateCellHTML:function(i,g){var e=id_maps["row_"+i],l=id_maps["hard_coded_"+g]?"hard_coded":"";return f.replace(/ASSIGNMENT_ID/g,id_maps["column_"+g]).replace(/USER_ID/g,e).replace(/HARD_CODED_CLASS/g,l)},scroll:function(){O.hide()},onReady:function(){function i(){var x=$(".mute_icon:visible"),d=$("#datagrid_data .row, #datagrid_top .row");
x.each(function(p,A){index=$(A).parents(".column_header").data("column");$column=$(".content div[data-column= "+index+"]");$column.width($column.width()+20)});d.width(d.width()+x.length*20)}function g(x){var d=k.shift();if(d){datagrid.toggleColumn(datagrid.position($(d)).column,false,{callback:false,skipSizeGrid:true});x>5?setTimeout(function(){g(0)},500):g(x+1)}else{datagrid.sizeGrid();i()}}function e(){for(var x=0;x<u;x++){var d=gradebook.queuedSubmissions&&gradebook.queuedSubmissions.shift();d&&
n(d)}gradebook.queuedSubmissions&&gradebook.queuedSubmissions.length?setTimeout(e,1):gradebook.makeAccessible()}$(".table_entry.hard_coded .pct").text("%");object_data=object_data||{};object_data.grid=true;$(document).fragmentChange(b);$(document).fragmentChange();var l=$.grep(($.store.userGet("hidden_columns_"+aa)||"").split(/,/),function(x){return x}),k=[];l.length&&$("#"+l.join(",#")).parent().each(function(){k.push(this)});$.store.userGet("show_attendance_"+aa)!="true"&&$(".cell.assignment_name.attendance").each(function(){k.push(this)});
setTimeout(function(){g(0)},50);var u=INST.browser.ie?25:100;setTimeout(e,1)},tick:function(){I.progressbar("option","value",I.progressbar("option","value")+25/B)},toggle:function(i,g){var e=datagrid.cells["0,"+i].children(".assignment_header").attr("id"),l=$.grep(($.store.userGet("hidden_columns_"+aa)||"").split(/,/),function(k){return k&&(!g||k!=e)});g||l.push(e);l=$.uniq(l);$.store.userSet("hidden_columns_"+aa,l.join(","))}})};j&&h&&(j.match(t<"20080000")||j.match(/Internet Explorer/)&&h<5)?setTimeout(y,
50):y();var q=function(){if(object_data&&object_data.grid&&object_data.assignments&&object_data.students&&!q.initialized){q.initialized=true;$("#gradebook_table, .datagrid, #no_students_message").removeClass("hidden-readable");$("#loading_gradebook_message").hide();$(window).triggerHandler("resize");setTimeout(c,500)}if(object_data&&object_data.grid&&object_data.assignments&&object_data.students&&object_data.submissions){$(".student_assignment .table_entry").css("visibility","");I.progressbar("option",
"value",I.progressbar("option","value")+50);$("#sort_rows_dialog .grade_sorts").show();$(window).triggerHandler("resize");setTimeout(gradebook.populate,1)}else setTimeout(q,1)};setTimeout(q,1);j=function(){function b(){var k=I.progressbar("option","value")||15;if(k<85){k=Math.min(k+1,85);I.progressbar("option","value",k)}}function f(k,u,x){$.ajaxJSON(k,"GET",{},function(d){i++;object_data=object_data||{};if(u=="assignments"){I.progressbar("option","value",I.progressbar("option","value")+10);for(var p in d){gradebook.assignmentIndexes[d[p].assignment.id]=
p+1;object_data["assignment_"+d[p].assignment.id]=d[p]}object_data.assignments=true}else if(u=="students"){I.progressbar("option","value",I.progressbar("option","value")+10);for(p in d){gradebook.studentIndexes[d[p].user.id]=p+1;object_data["student_"+d[p].user.id]=d[p]}object_data.students=true}else{b();var A=[];for(p in d){object_data["submission_"+d[p].submission.user_id+"_"+d[p].submission.assignment_id]=d[p];n(d[p].submission);A.push(d[p].submission.user_id)}object_data.student_submissions_count=
object_data.student_submissions_count||0;object_data.student_submissions_count+=x||1;A=$.uniq(A);for(p in A)$(".table_entry.student_"+A[p]).css("visibility","");if(object_data.student_submissions_count>=(object_data.students_count||1))object_data.submissions=true}},function(){f.errors=f.errors||0;f.errors++;f.errors>10?$("#loading_gradebook_status").text(m.t("errors.failed_to_load","Gradebook failed to load, please try refreshing the page")):setTimeout(function(){f(k)},50)})}var i=0;I.progressbar("option",
"value",I.progressbar("option","value")+5);setInterval(function(){i<3&&b()},250);var g=location.href.split("#")[0];g+=location.href.match(/\?/)?"&":"?";f(g+"init=1&assignments=1","assignments");f(g+"init=1&students=1","students");object_data=object_data||{};object_data.students_count=$("#student_names .outer_student_name").length;var e=Math.round(200/($("#assignment_names .outer_assignment_name").length||1)),l=[];setTimeout(function(){if($("#student_names .outer_student_name .assignment_header").length===
0)object_data.submissions=true;else{$("#student_names .outer_student_name .assignment_header").each(function(){var k=($(this).attr("id")||"").substring(14);k&&l.push(k);if(l.length>e){f(g+"init=1&submissions=1&user_ids="+l.join(","),"student_submissions",l.length);l=[]}});l.length>0&&f(g+"init=1&submissions=1&user_ids="+l.join(","),"student_submissions",l.length)}},1)};if(!object_data||!object_data.pre_initialized)j();else{for(var o in object_data)object_data[o].submission&&n(object_data[o].submission);
object_data.assignments=true;object_data.students=true;object_data.submissions=true}setTimeout(function(){gradebook.curve=function(){var b=0,f={},i=R.getFormData(),g=v($("#assignment_"+i.assignment_id).parent()).points_possible,e=[],l=0,k=parseInt($("#middle_score").val(),10);$(".table_entry.assignment_"+i.assignment_id).each(function(){var U=v($(this).parent());if(U.score||i.assign_blanks)f[U.user_id]=U.score||0});k/=g;if(!isNaN(k)){for(b in f){var u=f[b];if(u>g)u=g;if(u<0)u=0;e[parseInt(u,10)]=
e[parseInt(u,10)]||[];e[parseInt(u,10)].push([b,u||0]);l++}var x=[0.0060,0.012,0.028,0.04,0.068,0.106,0.159,0.227,0.309,0.401,0.5,0.599,0.691,0.773,0.841,0.894,0.933,0.96,0.977,0.988,1];k=(1-k)/Math.floor(x.length/2);var d=[],p=[];for(b=0;b<x.length;b++){p.push(1-k*b);d.push(Math.round((1-k*b)*g))}var A=0;k={};var G=0;$("#results_list").empty();$("#results_values").empty();p=[];for(b=e.length-1;b>=0;b--){var N=e[b]||[];u=Math.round(d[G]);for(var H in N){var Q=N[H];k[Q[0]]=u;if(Q[1]==0)k[Q[0]]=0;finalScore=
k[Q[0]];p[finalScore]=p[finalScore]||[];p[finalScore].push(Q[0])}for(A+=N.length;A>x[G]*l;)G++}e=0;for(b=p.length-1;b>=0;b--){l=(p[b]||[]).length;if(l>e)e=l}H=0;for(b=p.length-1;b>=0;b--){N=p[b];l=x=0;if(N||H>g/10){if(N){x=N.length/e;l=N.length}N=b===0?"#ee8":"#cdf";$("#results_list").prepend("<td style='padding: 1px;'><div title='"+l+" student"+(l==1?"":"s")+" will get "+b+" points' style='border: 1px solid #888; background-color: "+N+"; width: 15px; height: "+100*x+"px; margin-top: "+100*(1-x)+
"px;'>&nbsp;</div></td>");$("#results_values").prepend("<td style='text-align: center;'>"+b+"</td>");H=0}else H++}$("#results_list").prepend("<td><div style='height: 100px; position: relative; width: 30px; font-size: 0.8em;'><img src='/images/number_of_students.png' alt='# of students'/><div style='position: absolute; top: 0; right: 3px;'>"+e+"</div><div style='position: absolute; bottom: 0; right: 3px;'>0</div></div></td>");$("#results_values").prepend("<td>&nbsp;</td>");return k}};$("#middle_score").bind("blur change keyup focus",
function(){gradebook.curve()});$("#assign_blanks").change(function(){gradebook.curve()});M.find(".close_button").click(function(){M.dialog("close")});R.formSubmit({processData:function(b){var f=0;curves=gradebook.curve();for(var i in curves){var g="submissions[submission_"+i+"]";b[g+"[assignment_id]"]=b.assignment_id;b[g+"[user_id]"]=i;b[g+"[grade]"]=curves[i];f++}if(f===0){R.errorBox(m.t("errors.none_to_update","None to Update"));return false}return b},beforeSubmit:function(){R.loadingImage().find(".cancel_button").attr("disabled",
true)},success:function(b){R.loadingImage("remove");for(var f in b){var i=b[f].submission;n(i);W.push(i.user_id)}alert(m.t("alerts.scores_updated",{one:"1 Student score updated",other:"%{count} Student scores updated"},{count:b.length}));R.find(".cancel_button").attr("disabled",false).dialog("close")},error:function(){R.loadingImage("remove")}}).find(".cancel_button").click(function(){R.dialog("close")})},1500);$("#gradebook_options").live("click",function(b){b.preventDefault();b.stopPropagation();
var f={};b=function(e,l,k){f['<span class="ui-icon ui-icon-'+e+'" /> '+l]=k};b("carat-2-e-w",m.t("sort_columns_by","Sort Columns By..."),function(){$(".sort_gradebook").each(function(){$(this).attr("disabled",false).text($(this).attr("title"))});$("#sort_columns_dialog").dialog("close").dialog({autoOpen:false,width:400,height:300}).dialog("open")});b("carat-2-n-s",m.t("sort_rows_by","Sort Rows By..."),function(){$(".sort_gradebook").each(function(){$(this).attr("disabled",false).text($(this).attr("title"))});
$("#sort_rows_dialog").dialog("close").dialog({autoOpen:false,width:400,height:300}).dialog("open")});b("pencil",m.t("set_group_weights","Set Group Weights"),function(){$("#groups_data").dialog("close").dialog({title:m.t("titles.assignment_groups","Assignment Groups"),autoOpen:false}).dialog("open").show()});b("clock",m.t("view_grading_history","View Grading History"),function(){window.location.href=$(".gradebook_history_url").attr("href")});b("disk",m.t("download_scores","Download Scores (%{format})",
{format:".csv"}),function(){window.location.href=$(".gradebook_csv_url").attr("href")});b("clock",m.t("upload_scores","Upload Scores (from %{format})",{format:".csv"}),function(){var e={bgiframe:true,autoOpen:false,modal:true,width:410,resizable:false,buttons:{}};e.buttons[m.t("buttons.upload_data","Upload Data")]=function(){$(this).submit()};$("#upload_modal").dialog(e).dialog("open")});var i=$("#hide_students_option").attr("checked");b("person",i?m.t("show_student_name","Show Student Names"):m.t("hide_student_name",
"Hide Student Names"),function(){$("#hide_students_option").attr("checked",!i).change()});b("check",V?m.t("include_ungraded","Include Ungraded Assignments"):m.t("ignore_ungraded","Ignore Ungraded Assignments"),function(){V=!V;gradebook.updateAllStudentGrades()});if($.size(X)>1){var g=Y?m.t("showing_section","Showing Section: %{section}",{section:X[Y]}):m.t("showing_all_sections","Showing All Sections");b("search",g,function(){var e={modal:true,resizable:false,buttons:{}};e.buttons[m.t("buttons.change_section",
"Change Section")]=function(){var k=$("#section_to_show_dialog select").val();$.store[k=="all"?"userRemove":"userSet"]("grading_show_only_section"+ba,k);window.location.reload()};e=$("#section_to_show_dialog").dialog(e).find("select");e.find("[value != all]").remove();for(var l in X)e.append('<option value="'+l+'" '+(Y==l?"selected":"")+" >"+X[l]+"</option>")})}sisPublishEnabled&&b("gear",'<a href="details#tab-grade-publishing">'+m.t("publish_to_sis","Publish grades to SIS")+"</a>",function(){});
$(this).dropdownList({options:f})});$(".sort_gradebook").click(function(b){b.preventDefault();var f=$(this);if(f.hasClass("by_grade")&&!gradebook.finalGradesReady){f.attr("disabled",true).text(m.t("computing_grades","Computing Grades..."));setTimeout(function(){f.filter(":visible").length>0&&f.click()},1E3)}else{f.attr("disabled",false);f.text(f.attr("title"));f.hasClass("sort_rows")?sortStudentRows(function(i){return f.hasClass("by_secondary_identifier")?[i.secondary_identifier,i.display_name,i.course_section]:
f.hasClass("by_section")?[i.course_section,i.display_name,i.secondary_identifier]:f.hasClass("by_grade_desc")?[-i.grade,i.display_name,i.secondary_identifier,i.course_section]:f.hasClass("by_grade_asc")?[i.grade,i.display_name,i.secondary_identifier,i.course_section]:[i.display_name,i.secondary_identifier,i.course_section]}):sortAssignmentColumns(function(i){var g=[i.special_sort,i.date_sortable||"1050-12-12T99:99",i.title];if(f.hasClass("by_group"))g.unshift(parseInt(i.groupData[i.group_id||i.id.toString().substring(6)],
10));return g});$("#sort_rows_dialog").dialog("close");$("#sort_columns_dialog").dialog("close")}});$("#content").delegate(".mute_icon","click.mute",function(b){b=$(b.currentTarget).siblings("a.assignment_link.assignment_title");var f=m.t("cancel_button","Cancel"),i=m.t("unmute_button","Unmute Assignment"),g={},e=$("#unmute_dialog"),l=$("#datagrid_data .row, #datagrid_top .row"),k=b.attr("href")+"/mute";g[i]=function(){e.dialog("close");$.ajaxJSON(k,"put",{status:false},function(u){u=$("#"+("assignment_"+
u.assignment.id));var x=u.parent().data("column");x=$(".content div[data-column="+x+"]");u.find("a.assignment_link.assignment_options").data("muted",false);u.find(".mute_icon").remove();x.width(x.width()-20);l.width(l.width()-20)})};g[f]=function(){e.dialog("close")};e.dialog({buttons:g,modal:true,resizable:false,title:e.data("title"),width:400})})});var W=[];gradebook.finalGradesReady=true;var T={};window.sortStudentRows=function(c){var a=[];$(".outer_student_name").each(function(){var o=$(this).getTemplateData({textValues:["display_name",
"secondary_identifier","course_section"]});o.display_name=(o.display_name||"zzzzzzz").toLowerCase();o.secondary_identifier=(o.secondary_identifier||"zzzzzzz").toLowerCase();o.course_section=(o.course_section||"zzzzzzz").toLowerCase();o.id=$(this).find(".assignment_header").attr("id").substring(14);o.grade=parseFloat($(".student_"+o.id+".assignment_final-grade .grade").text())||0;a.push(o)});var j=[],h;for(h in a){var t=a[h],B=c(t);B.student=t;j.push(B)}j=j.sort(function(o,b){for(var f in o){var i=
o[f],g=b[f];if(i<g)return-1;if(i>g)return 1}return 0});a=[];for(h in j)a.push(j[h].student);var y=[0],q=["--"];$.each(a,function(o,b){var f=$("#student_"+b.id).parents(".cell");y.push(datagrid.position(f).row);q.push(f.find(".display_name").text())});datagrid.reorderRows(y)};window.reverseRows=function(){for(var c=[0],a=datagrid.rows.length-1;a>0;a--)c.push(a);datagrid.reorderRows(c)};window.sortAssignmentColumns=function(c){var a=$(".outer_assignment_name"),j=[],h={};$("#groups_data .group").each(function(b){var f=
$(this).find(".assignment_group_id").text();h[f]=b});a.each(function(){var b=$(this).data("assignment_object");b.groupData=h;j.push(b)});a=[];for(var t in j){var B=j[t],y=c(B);y.assignment=B;a.push(y)}a=a.sort();j=[];for(t in a)j.push(a[t].assignment);var q=[0],o=["--"];$.each(j,function(b,f){var i=$("#assignment_"+f.id).parents(".cell");q.push(datagrid.position(i).column);o.push(i.find(".assignment_title").text())});datagrid.reorderColumns(q)};$(document).ready(function(){$(document).bind("update_student_grades",
function(c,a){K(a)})});$.fn.gradebookLoading=function(c){this.find(".refresh_grades_link").find(".static").showIf(c).end().find(".animated").showIf(!c)}});
I18n.scoped("message_students",function(m){var v=$("#message_students_dialog"),J={};window.messageStudents=function(n){J=n;v.find(".message_types").empty();for(var s in n.options){var z=$("<option/>"),w=n.options[s];z.val(s).text(w.text);v.find(".message_types").append(z)}z=n.title;w=v.find("ul li.blank:first");var r=v.find("ul"),C={};v.find("ul li:not(.blank)").remove();for(s in n.students){var D=w.clone(true).removeClass("blank");D.find(".name").text(n.students[s].name);D.find(".score").text(n.students[s].score);
D.data("id",n.students[s].id);D.user_data=n.students[s];r.append(D.show());C[n.students[s].id]=D}r.show();v.data("students_hash",C);v.find(".asset_title").text(z);v.find(".out_of").showIf(n.points_possible!=null);v.find(".send_button").text(m.t("send_message","Send Message"));v.find(".points_possible").text(n.points_possible);v.find("textarea").val("");v.find("select")[0].selectedIndex=0;v.find("select").change();v.dialog("close").dialog({width:600,modal:true}).dialog("open").dialog("option","title",
m.t("message_student","Message Students for %{course_name}",{course_name:z}))};$(document).ready(function(){v.find(".cutoff_score").bind("change blur keyup",function(){v.find("select").change()});v.find(".cancel_button").click(function(){v.dialog("close")});$("#message_assignment_recipients").formSubmit({processData:function(n){var s=[];$(this).find(".student:visible").each(function(){s.push($(this).data("id"))});if(s.length==0)return false;n.recipients=s.join(",");return n},beforeSubmit:function(){$(this).find("button").attr("disabled",
true).filter(".send_button").text(m.t("buttons.sending_message","Sending Message..."))},success:function(){$(this).find(".send_button").text("Message Sent!");var n=$(this);setTimeout(function(){n.find("button").attr("disabled",false).filter(".send_button").text(m.t("buttons.send_message","Send Message"));$("#message_students_dialog").dialog("close")},2E3)},error:function(){$(this).find("button").attr("disabled",false).filter(".send_button").text(m.t("buttons.send_message_failed","Sending Message Failed, please try again"))}});
v.find("select").change(function(){var n=parseInt($(this).val(),10)||0,s=J.options[n],z=v.data("students_hash"),w=parseFloat(v.find(".cutoff_score").val(),10);if(!w&&w!==0)w=null;var r=null,C=[];for(n in z)C.push(z[n]);if(z)if(s&&s.callback)r=s.callback.call(window.messageStudents,w,C);else if(J.callback)r=J.callback.call(window.messageStudents,s.text,w,C);r=r||[];v.find(".cutoff_holder").showIf(s.cutoff);v.find(".student_list").toggleClass("show_score",s.cutoff||s.score);v.find("button").attr("disabled",
r.length==0);s={};for(n in r)s[parseInt(r[n],10)||0]=true;for(n in z)z[n].showIf(s[n])})})});
(function(){var m,v=function(J,n){return function(){return J.apply(n,arguments)}};m=function(){function J(){}J.calculate=function(n,s,z){var w;w={};w.group_sums=$.map(s,v(function(r){return{group:r,current:this.create_group_sum(r,n,true),"final":this.create_group_sum(r,n,false)}},this));w.current=this.calculate_total(w.group_sums,true,z);w["final"]=this.calculate_total(w.group_sums,false,z);return w};J.create_group_sum=function(n,s,z){var w,r,C,D,K,L,I,E,M;D={submissions:[],score:0,possible:0,submission_count:0};
I=n.assignments;K=0;for(L=I.length;K<L;K++){w=I[K];r={score:0,possible:0,percent:0,drop:false,submitted:false};C=$.detect(s,function(){return this.assignment_id===w.id});if(C==null)C={score:null};C.assignment_group_id=n.id;if(C.points_possible==null)C.points_possible=w.points_possible;r.submission=C;D.submissions.push(r);if(!(z&&(C.score==null||C.score===""))){r.score=this.parse(C.score);r.possible=this.parse(w.points_possible);r.percent=this.parse(r.score/r.possible);r.submitted=C.score!=null&&C.score!==
"";if(r.submitted)D.submission_count+=1}}D.submissions.sort(function(F,S){return F.percent-S.percent});z=$.extend({drop_lowest:0,drop_highest:0,never_drop:[]},n.rules);n=0;E=["low","high"];C=0;for(L=E.length;C<L;C++){s=E[C];M=D.submissions;K=0;for(I=M.length;K<I;K++){r=M[K];if(!r.drop&&z["drop_"+s+"est"]>0&&$.inArray(r.assignment_id,z.never_drop)===-1&&r.possible>0&&r.submitted){r.drop=true;if((r=r.submission)!=null)r.drop=true;z["drop_"+s+"est"]-=1;n+=1}}}if(n>0&&n===D.submission_count){D.submissions[D.submissions.length-
1].drop=false;if((r=D.submissions[D.submissions.length-1].submission)!=null)r.drop=false;n-=1}D.submission_count-=n;z=D.submissions;n=0;for(s=z.length;n<s;n++){r=z[n];r.drop||(D.score+=r.score)}z=D.submissions;s=0;for(n=z.length;s<n;s++){r=z[s];r.drop||(D.possible+=r.possible)}return D};J.calculate_total=function(n,s,z){var w,r,C,D,K,L,I;r=s?"current":"final";if(z==="percent"){L=K=z=C=0;for(I=n.length;L<I;L++){w=n[L];if(w.group.group_weight>0){if(w[r].submission_count>0){D=w[r].score/w[r].possible;
C+=w.group.group_weight*D;z+=w.group.group_weight}K+=w.group.group_weight}}if(s&&z<100)C=C*(K<100?K:100)/z;return{score:C,possible:100}}else return{score:this.sum(function(){var E,M,F;F=[];E=0;for(M=n.length;E<M;E++){w=n[E];F.push(w[r].score)}return F}()),possible:this.sum(function(){var E,M,F;F=[];E=0;for(M=n.length;E<M;E++){w=n[E];F.push(w[r].possible)}return F}())}};J.sum=function(n){var s,z,w,r;w=s=0;for(r=n.length;w<r;w++){z=n[w];s+=z}return s};J.parse=function(n){return(n=parseFloat(n))&&isFinite(n)?
n:0};J.letter_grade=function(n,s){if(s<0)s=0;return $.grep(n,function(z,w){return s>=z[1]*100||w===n.length-1})[0][0]};return J}();window.INST.GradeCalculator=m}).call(this);
$.extend(true,I18n=I18n||{},{translations:{es:{gradebook:{cancel_button:"Cancelar",scored_more_than:"Obtuvo m\u00e1s de",submission_information:"Informaci\u00f3n del Env\u00edo",mute_assignment:"Obviar Tarea",default_grade_for_course:"Calificaci\u00f3n Predeterminada para %{assignment}",buttons:{change_section:"Cambiar Secci\u00f3n",upload_data:"Cargar Informaci\u00f3n"},curve_grades:"Aplicar Curva a los Grados",hide_all_things:"Esconder %{things}",students_who:{scored_more_than:"Obtuvo m\u00e1s de",
scored_less_than:"Obtuvo menos de",havent_submitted_yet:"A\u00fan no ha enviado"},hide_student_name:"Esconder los Nombres de los Estudiantes",alerts:{students_updated:{one:"1 Estudiante Actualizado",other:"%{count} estudiantes actualizados"},scores_updated:{one:"1 calificaci\u00f3n de estudiante actualizada",other:"%{count} calificaciones de estudiantes actualizados"},no_students_in_section:"No se pudieron encontrar estudiantes en esa secci\u00f3n, regresando para mostrar todas las secciones.",none_to_update:"Nada que Actualizar"},
errors:{upload_as_zip:"Por favor cargue los archivos como un .zip",none_to_update:"Nada que Actualizar",failed_to_load:"El libro de calificaciones no se pudo cargar, intente recargar la p\u00e1gina"},showing_section:"Mostrando la Secci\u00f3n: %{section}",download_submissions:"Descargar los Env\u00edos",titles:{turnitin_score:"Calificaci\u00f3n de Similaridad de Turnitin -- m\u00e1s informaci\u00f3n",assignment_groups:"Grupos de Trabajo",loading:"Cargando..."},download_scores:"Descargar Calificaciones (%{format})",
view_grading_history:"Ver el Historial de Calificaci\u00f3n",sort_rows_by:"Ordenar Filas Por...",student_name:"Nombre del Estudiante",sort_columns_by:"Ordenar Columnas Por...",scored_less_than:"Obtuvo menos de",assignment_details:"Detalles de la Tarea",tooltips:{submission_dropped:"Este env\u00edo se elimin\u00f3 para la calificaci\u00f3n",submitted_late:"Este env\u00edo se envi\u00f3 tarde"},links:{download_attachment:"Descargando %{attachment}",finish_scoring:"Terminar la Calificaci\u00f3n de esta Evaluaci\u00f3n",
go_to_submission:"Ir al URL de Env\u00edo",submission_details:"Detalles de Env\u00edo",view_submission:"Ver Env\u00edo",view_quiz:"Ver esta Evaluaci\u00f3n"},computing_grades:"Computando Calificaciones...",click_to_expand:"Haga click para expandir",set_default_grade:"Establecer Calificaci\u00f3n Predeterminada",showing_all_sections:"Mostrando Todas las Secciones",unmute_assignment:"Activar Tarea",reupload_submissions:"Recargar los Env\u00edos",message_students_who:"Enviar Mensaje a Estudiante Que...",
set_group_weights:"Establecer Peso por Grupo",not_submitted_yet:"No se ha enviado a\u00fan",reupload_submission_files:"Recargar los Archivos de Env\u00edo",speed_grader:"Calificador R\u00e1pido",include_ungraded:"Inclu\u00edr Tareas Actualizadas",curve_grade_for_course:"Aplicar Curva a %{assignment}",teacher_muted_title:"Tarea ha sido obviada",publish_to_sis:"Publicar calificaciones a SIS",upload_scores:"Cargar Calificaciones (desde %{format})",unmute_button:"Activar la Tarea",labels:{details:"Detalles"},
show_student_name:"Mostrar los Nombres de Estudiantes",ignore_ungraded:"Ignorar Tareas No Calificadas",hide_column:"Esconder Columna"},not_applicable:"N/A",message_students:{buttons:{send_message_failed:"Env\u00edo del Mensaje Fall\u00f3, intente de nuevo",sending_message:"Enviando Mensaje...",send_message:"Enviar Mensaje"},message_student:"Enviar Mensaje a Estudiantes para %{course_name}",send_message:"Enviar el Mensaje"}},em2:{gradebook:{links:{finish_scoring:"Finish Scoring this Assessment",view_quiz:"View this Assessment"}}}}});
