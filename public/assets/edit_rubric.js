var rubricEditing={htmlBody:null,updateCriteria:function(b){b.find(".criterion:not(.blank)").each(function(c){$(this).attr("id","criterion_"+(c+1))})},addCriterion:function(b){var c=b.find(".criterion.blank:first").clone(true);c.removeClass("blank");b.find(".summary").before(c.show());rubricEditing.updateCriteria(b);rubricEditing.updateRubricPoints(b);rubricEditing.sizeRatings(c);return c},findOutcomeCriterion:function(b){$("#find_outcome_criterion_dialog").data("current_rubric",b);find_outcome.find(function(c){if($("#find_outcome_criterion_dialog").data("current_rubric")){var e=
$("#find_outcome_criterion_dialog").data("current_rubric"),g=c.find(".learning_outcome_id").text();e.find(".criterion.learning_outcome_"+g).find(".delete_criterion_link").click();e.find(".add_criterion_link").click();e=e.find(".criterion:not(.blank):last");e.toggleClass("ignore_criterion_for_scoring",!c.find(".criterion_for_scoring").attr("checked"));e.find(".mastery_points").val(c.find(".mastery_points").text());e.addClass("learning_outcome_criterion");e.find(".learning_outcome_id").text(g);e.find(".criterion_points").val(c.find(".rating:not(.blank):first .points").text()).blur();
for(g=0;g<c.find(".rating:not(.blank)").length-2;g++)e.find(".rating:not(.blank):first").addClass("add_column").click();e.find(".rating:not(.blank)").each(function(a){a=c.find(".rating:not(.blank)").eq(a).getTemplateData({textValues:["description","points"]});$(this).fillTemplateData({data:a})});g=c.find(".body.description").html();var i=c.find(".mastery_points").text();e.find(".cancel_button").click();e.find(".long_description").val(g);e.find(".long_description_holder").toggleClass("empty",!g);e.find(".criterion_description_value").text(c.find(".short_description").text());
e.find(".criterion_description").val(c.find(".short_description").text()).focus().select();e.find(".mastery_points").text(i)}},{for_rubric:true})},hideCriterionAdd:function(b){b.find(".add_right, .add_left, .add_column").removeClass("add_left add_right add_column")},updateRubricPoints:function(b){var c=0;b.find(".criterion:not(.blank):not(.ignore_criterion_for_scoring) .criterion_points").each(function(){var e=parseFloat($(this).val(),10);isNaN(e)||(c+=e)});b.find(".rubric_total").text(c)},updateCriterionPoints:function(b,
c){rubricEditing.hideEditRating();var e=$.makeArray(b.find(".rating")).reverse(),g=-1,i=parseFloat(b.find(".criterion_points").val());if(isNaN(i))i=5;b.find(".rating:first .points").text(i);$.each(e,function(l,m){var n=$(m),o=n.getTemplateData({textValues:["points"]});if(o.points<g){o.points=g+1;n.fillTemplateData({data:o})}g=parseFloat(o.points)});if(c&&g>i)i=g;b.find(".criterion_points").val(i);b.find(".display_criterion_points").text(i);if(!b.data("criterion_points")||b.data("criterion_points")!=
i){if(!b.data("criterion_points")){e=parseFloat(b.find(".rating:first .points").text());b.data("criterion_points",e)}var a=parseFloat(b.data("criterion_points")),d=i,h=b.find(".rating");$(h[0]).find(".points").text(i);for(var f=i,j=1;j<h.length-1;j++){e=parseFloat($(h[j]).find(".points").text());var k=Math.round(e/a*d);if(isNaN(e)||e==0&&f>0)k=f-Math.round(f/(h.length-j));if(k>=f)k=f-1;f=k=Math.max(0,k);$(h[j]).find(".points").text(k)}b.data("criterion_points",i)}rubricEditing.updateRubricPoints(b.parents(".rubric"))},
editRating:function(b){if(b.parents(".rubric").hasClass("editing")){rubricEditing.hideEditRating(true);rubricEditing.hideCriterionAdd(b.parents(".rubric"));b.find(".rating").height();var c=b.getTemplateData({textValues:["description","points"]}),e=$("#edit_rating");e.fillFormData(c);b.find(".container").hide();b.append(e.show());e.find(":input:first").focus().select();b.addClass("editing");rubricEditing.sizeRatings(b.parents(".criterion"))}},hideEditRating:function(b){var c=$("#edit_rating");c.filter(":visible").length>
0&&b&&c.find("form").submit();b=c.parents(".rating");b.removeClass("editing");c.appendTo($("body")).hide();b.find(".container").show();rubricEditing.sizeRatings(b.parents(".criterion"));rubricEditing.hideCriterionAdd(b.parents(".rubric"))},editCriterion:function(b){if(b.parents(".rubric").hasClass("editing")){rubricEditing.hideEditCriterion(true);var c=b.find(".criterion_description");c.find(".description").height();var e=c.getTemplateData({textValues:["description"]}),g=$("#edit_criterion");g.fillFormData(e);
c.find(".container").hide().after(g.show());g.find(":input:first").focus().select();rubricEditing.sizeRatings(b)}},hideEditCriterion:function(b){var c=$("#edit_criterion");c.filter(":visible").length>0&&b&&c.find("form").submit();b=c.parents(".criterion");c.appendTo("body").hide();b.find(".criterion_description").find(".container").show();rubricEditing.sizeRatings(b)},originalSizeRatings:function(){var b=$(".rubric:not(.rubric_summary) .criterion:visible");if(b.length){var c=$.windowScrollTop();b.each(function(){var e=
$(this),g=e.find(".ratings:visible");if(g.length){var i=g.find(".rating .container").css("height","");e=Math.max(g.height(),e.find(".criterion_description .container").height());i.css("height",e-10+"px")}});rubricEditing.htmlBody.scrollTop(c)}},rubricData:function(b){b=b.filter(":first");b.hasClass("editing")||(b=b.next(".editing"));b.find(".criterion_points").each(function(){var i=$(this).val();$(this).parents(".criterion").find(".display_criterion_points").text(i)});var c=b.getFormData();b.find("thead .title").text(c.title);
c=b.getTemplateData({textValues:["title","description","rubric_total","rubric_association_id"]});var e={};e["rubric[title]"]=c.title;e["rubric[points_possible]"]=c.rubric_total;e["rubric_association[use_for_grading]"]=b.find(".grading_rubric_checkbox").attr("checked")?"1":"0";e["rubric_association[hide_score_total]"]="0";if(e["rubric_association[use_for_grading]"]=="0")e["rubric_association[hide_score_total]"]=b.find(".totalling_rubric_checkbox").attr("checked")?"1":"0";e["rubric[free_form_criterion_comments]"]=
b.find(".rubric_custom_rating").attr("checked")?"1":"0";e["rubric_association[id]"]=c.rubric_association_id;var g=0;b.find(".criterion:not(.blank)").each(function(){var i=$(this);i.hasClass("learning_outcome_criterion")||i.find("span.mastery_points").text(parseFloat(i.find("input.mastery_points").val(),10)||"0");var a=i.getTemplateData({textValues:["description","display_criterion_points","learning_outcome_id","mastery_points","long_description","criterion_id"]});a.long_description=i.find("textarea.long_description").val();
a.mastery_points=i.find("span.mastery_points").text();var d="rubric[criteria]["+g+"]";e[d+"[description]"]=a.description;e[d+"[points]"]=a.display_criterion_points;e[d+"[learning_outcome_id]"]=a.learning_outcome_id;e[d+"[long_description]"]=a.long_description;e[d+"[id]"]=a.criterion_id;if(a.learning_outcome_id)e[d+"[mastery_points]"]=a.mastery_points;var h=0;i.find(".rating").each(function(){var f=$(this).getTemplateData({textValues:["description","points","rating_id"]}),j=d+"[ratings]["+h+"]";e[j+
"[description]"]=f.description;e[j+"[points]"]=f.points;e[j+"[id]"]=f.rating_id;h++});g++});e.title=e["rubric[title]"];e.points_possible=e["rubric[points_possible]"];e.rubric_id=b.attr("id").substring(7);return e=$.extend(e,$("#rubrics #rubric_parameters").getFormData())},addRubric:function(){var b=$("#default_rubric").clone(true).attr("id","rubric_new").addClass("editing");b.find("#edit_rubric").remove();var c=$("#edit_rubric").clone(true).show().removeAttr("id").addClass("edit_rubric"),e=c.find("#edit_rubric_form");
b.append(c);e.attr("method","POST").attr("action",$("#add_rubric_url").attr("href"));c=parseFloat($("#full_assignment .points_possible,#rubrics.rubric_dialog .assignment_points_possible").filter(":first").text());e.find(".rubric_grading").showIf(c||$("#full_assignment").length>0);return b},editRubric:function(b,c){var e=b.clone(true).addClass("editing");e.find("#edit_rubric").remove();var g=e.getTemplateData({textValues:["use_for_grading","free_form_criterion_comments","hide_score_total"]});b.hide().after(e.show());
var i=$("#edit_rubric").clone(true).show().removeAttr("id").addClass("edit_rubric"),a=i.find("#edit_rubric_form");e.append(i);e.find(":text:first").focus().select();a.find(".grading_rubric_checkbox").attr("checked",g.use_for_grading=="true").triggerHandler("change");a.find(".rubric_custom_rating").attr("checked",g.free_form_criterion_comments=="true").triggerHandler("change");a.find(".totalling_rubric_checkbox").attr("checked",g.hide_score_total=="true").triggerHandler("change");a.find(".save_button").text(e.attr("id")==
"rubric_new"?"Create Rubric":"Update Rubric");a.attr("method","PUT").attr("action",c);rubricEditing.sizeRatings();return e},hideEditRubric:function(b,c){b=b.filter(":first");b.hasClass("editing")||(b=b.next(".editing"));b.removeClass("editing");$("#edit_criterion").hide().appendTo("body");b.find(".edit_rubric").remove();if(c){b.attr("id")!="rubric_new"?b.prev(".rubric").show():$(".add_rubric_link").show();b.remove()}else b.find(".rubric_title .links").show()},updateRubric:function(b,c){b.find(".criterion:not(.blank)").remove();
var e=b.find(".rating:first").clone(true).removeAttr("id");b.fillTemplateData({data:c,id:"rubric_"+c.id,hrefValues:["id","rubric_association_id"],avoid:".criterion"});b.fillFormData(c);var g=$.replaceTags(b.find(".edit_rubric_url").attr("href"),"rubric_id",c.id);b.find(".edit_rubric_link").attr("href",g);g=$.replaceTags(b.find(".delete_rubric_url").attr("href"),"association_id",c.rubric_association_id);b.find(".delete_rubric_link").attr("href",g);b.find(".edit_rubric_link").showIf(c.permissions.update_association);
b.find(".find_rubric_link").showIf(c.permissions.update_association&&!$("#rubrics").hasClass("raw_listing"));b.find(".delete_rubric_link").showIf(c.permissions.delete_association);b.find(".criterion:not(.blank) .ratings").empty();for(var i in c.criteria){g=c.criteria[i];g.display_criterion_points=g.points;g.criterion_id=g.id;var a=b.find(".criterion.blank:first").clone(true).show().removeAttr("id");a.removeClass("blank");a.fillTemplateData({data:g});a.find(".long_description_holder").toggleClass("empty",
!g.long_description);a.find(".ratings").empty();a.toggleClass("learning_outcome_criterion",!!g.learning_outcome_id);for(var d in g.ratings){var h=g.ratings[d];h.rating_id=h.id;var f=e.clone(true);f.toggleClass("edge_rating",d===0||d===g.ratings.length-1);f.fillTemplateData({data:h});a.find(".ratings").append(f)}b.find(".summary").before(a);a.find(".criterion_points").val(g.points).blur()}b.find(".criterion:not(.blank)").find(".ratings").showIf(!c.free_form_criterion_comments).end().find(".custom_ratings").showIf(c.free_form_criterion_comments)}};
rubricEditing.sizeRatings=$.debounce(10,rubricEditing.originalSizeRatings);
I18n.scoped("edit_rubric",function(b){$(document).ready(function(){var c=$("#rubric_dialog"),e=$("#rubric_long_description_dialog");rubricEditing.htmlBody=$("html,body");$("#rubrics").delegate(".long_description_link","click",function(a){a.preventDefault();a=$(this).parents(".rubric").hasClass("editing");var d=$(this).parents(".criterion"),h=$(this).parents(".criterion").hasClass("learning_outcome_criterion"),f=d.getTemplateData({textValues:["long_description","description"]});f.long_description=
d.find("textarea.long_description").val();e.data("current_criterion",d).fillTemplateData({data:f,htmlValues:h?["long_description"]:[]}).fillFormData(f).find(".editing").showIf(a&&!d.hasClass("learning_outcome_criterion")).end().find(".displaying").showIf(!a||d.hasClass("learning_outcome_criterion")).end().dialog("close").dialog({autoOpen:false,title:b.t("titles.criterion_long_description","Criterion Long Description"),width:400}).dialog("open").find("textarea:visible:first").focus().select()}).delegate(".find_rubric_link",
"click",function(a){a.preventDefault();c.dialog("close").dialog({autoOpen:true,width:800,height:380,resizable:true,title:b.t("titles.find_existing_rubric","Find Existing Rubric")}).dialog("open");if(!c.hasClass("loaded")){c.find(".loading_message").text(b.t("messages.loading_rubric_groups","Loading rubric groups..."));a=c.find(".grading_rubrics_url").attr("href");$.ajaxJSON(a,"GET",{},function(d){for(var h in d){var f=d[h],j=c.find(".rubrics_dialog_context_select.blank:first").clone(true).removeClass("blank");
j.fillTemplateData({data:{name:f.name,context_code:f.context_code,rubrics:f.rubrics+" rubrics"}});c.find(".rubrics_dialog_contexts_select").append(j.show())}d.length==0?c.find(".loading_message").text("No rubrics found"):c.find(".loading_message").remove();c.find(".rubrics_dialog_rubrics_holder").slideDown();c.find(".rubrics_dialog_contexts_select .rubrics_dialog_context_select:visible:first").click();c.addClass("loaded")},function(){c.find(".loading_message").text(b.t("errors.load_rubrics_failed",
"Loading rubrics failed, please try again"))})}}).delegate(".edit_rubric_link","click",function(){var a=$(this);if(!a.hasClass("copy_edit")||confirm(b.t("prompts.read_only_rubric","You can't edit this rubric, either because you don't have permission or it's being used in more than one place. Any changes you make will result in a new rubric based on the old rubric.  Continue anyway?")))rubricEditing.editRubric(a.parents(".rubric"),a.attr("href"));return false});$(".rubric .delete_rubric_link").bind("click",
function(a,d){a.preventDefault();var h=b.t("prompts.confirm_delete","Are you sure you want to delete this rubric?");if(d&&d.confirmationMessage)h=d.confirmationMessage;$(this).parents(".rubric").confirmDelete({url:$(this).attr("href"),message:h,success:function(){$(this).fadeOut(function(){$(".add_rubric_link").show();d&&$.isFunction(d)&&d()})}})});e.find(".save_button").click(function(){var a=e.find("textarea.long_description").val(),d=e.data("current_criterion");if(d){d.fillTemplateData({data:{long_description:a}});
d.find("textarea.long_description").val(a);d.find(".long_description_holder").toggleClass("empty",!a)}e.dialog("close")});e.find(".cancel_button").click(function(){e.dialog("close")});$(".add_rubric_link").click(function(a){a.preventDefault();if(!($("#rubric_new").length>0))if(!($("#rubrics .rubric:visible").length>0)){a=rubricEditing.addRubric();$("#rubrics").append(a.show());a.find(":text:first").focus().select();$(".add_rubric_link").hide()}});$("#rubric_dialog").delegate(".rubrics_dialog_context_select",
"click",function(a){a.preventDefault();$(".rubrics_dialog_contexts_select .selected_side_tab").removeClass("selected_side_tab");var d=$(this);d.addClass("selected_side_tab");var h=d.getTemplateData({textValues:["context_code"]}).context_code;if(d.hasClass("loaded")){c.find(".rubrics_loading_message").hide();c.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").show();c.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select").hide();c.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select."+
h).show();c.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select:visible:first").click()}else{c.find(".rubrics_loading_message").text(b.t("messages.loading_rubrics","Loading rubrics...")).show();c.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").hide();a=c.find(".grading_rubrics_url").attr("href")+"?context_code="+h;$.ajaxJSON(a,"GET",{},function(f){d.addClass("loaded");c.find(".rubrics_loading_message").hide();c.find(".rubrics_dialog_rubrics,.rubrics_dialog_rubrics_select").show();
for(var j in f){var k=f[j].rubric_association,l=k.rubric,m=c.find(".rubrics_dialog_rubric_select.blank:first").clone(true);m.addClass(k.context_code);l.criterion_count=l.data.length;m.fillTemplateData({data:l}).removeClass("blank");c.find(".rubrics_dialog_rubrics_select").append(m.show());k=c.find(".rubrics_dialog_rubric.blank:first").clone(true);k.removeClass("blank");k.find(".criterion.blank").hide();l.rubric_total=l.points_possible;k.fillTemplateData({data:l,id:"rubric_dialog_"+l.id});for(j in l.data){var n=
l.data[j];n.criterion_points=n.points;n.criterion_points_possible=n.points;n.criterion_description=n.description;m=n.ratings;delete n.ratings;var o=k.find(".criterion.blank:first").clone().removeClass("blank");o.fillTemplateData({data:n});o.find(".rating_holder").addClass("blank");for(var q in m){n=m[q];var p=o.find(".rating_holder.blank:first").clone().removeClass("blank");n.rating=n.description;p.fillTemplateData({data:n});o.find(".ratings").append(p.show())}o.find(".rating_holder.blank").remove();
k.find(".rubric.rubric_summary tr.summary").before(o.show())}c.find(".rubrics_dialog_rubrics").append(k)}c.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select").hide();c.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select."+h).show();c.find(".rubrics_dialog_rubrics_select .rubrics_dialog_rubric_select:visible:first").click()},function(){c.find(".rubrics_loading_message").text("Loading rubrics failed, please try again")})}}).delegate(".rubrics_dialog_rubric_select","click",
function(a){a.preventDefault();a=$(this);a.find("a").focus();var d=a.getTemplateData({textValues:["id"]}).id;$(".rubric_dialog .rubrics_dialog_rubric_select").removeClass("selected_side_tab");a.addClass("selected_side_tab");$(".rubric_dialog .rubrics_dialog_rubric").hide();$(".rubric_dialog #rubric_dialog_"+d).show()}).delegate(".select_rubric_link","click",function(a){a.preventDefault();a={};var d=c.getTemplateData({textValues:["rubric_association_type","rubric_association_id","rubric_association_purpose"]});
a["rubric_association[association_type]"]=d.rubric_association_type;a["rubric_association[association_id]"]=d.rubric_association_id;a["rubric_association[rubric_id]"]=$(this).parents(".rubrics_dialog_rubric").getTemplateData({textValues:["id"]}).id;a["rubric_association[purpose]"]=d.rubric_association_purpose;c.loadingImage();d=c.find(".select_rubric_url").attr("href");$.ajaxJSON(d,"POST",a,function(h){c.loadingImage("remove");var f=$("#rubrics .rubric:visible:first");if(f.length===0)f=rubricEditing.addRubric();
var j=h.rubric;j.rubric_association_id=h.rubric_association.id;j.permissions=j.permissions||{};if(h.rubric_association.permissions){j.permissions.update_association=h.rubric_association.permissions.update;j.permissions.delete_association=h.rubric_association.permissions["delete"]}rubricEditing.updateRubric(f,j);rubricEditing.hideEditRubric(f,false);c.dialog("close")},function(){c.loadingImage("remove")})});c.find(".cancel_find_rubric_link").click(function(a){a.preventDefault();c.dialog("close")});
c.find(".rubric_brief").find(".expand_data_link,.collapse_data_link").click(function(a){a.preventDefault();$(this).parents(".rubric_brief").find(".expand_data_link,.collapse_data_link").toggle().end().find(".details").slideToggle()});var g=false,i=false;$("#edit_rubric_form").formSubmit({processData:function(a){var d=$(this).parents(".rubric");if(d.find(".criterion:not(.blank)").length===0)return false;a=rubricEditing.rubricData(d);if(a["rubric_association[use_for_grading]"]=="1"){d=parseFloat($("#full_assignment .points_possible").text());
var h=parseFloat(a.points_possible);if(d&&h!=d&&!g){a=$.trim($("#full_assignment .title").text());var f=$("<p />").text(b.t("prompts.update_assignment_points","%{assignment_title} has %{assignment_points} points possible, would you like to change it to have %{rubric_points} points possible to match this rubric?",{assignment_points:d,assignment_title:a,rubric_points:h})).dialog({buttons:{Change:function(){g=true;i=false;f.remove();$("#edit_rubric_form").submit()},"Leave different":function(){i=g=true;
f.remove();$("#edit_rubric_form").submit()}},width:320,resizable:false,title:b.t("titles.update_assignment_points","Change points possible to match rubric?"),close:function(){f.remove()}});return false}}a.skip_updating_points_possible=i;g=i=false;return a},beforeSubmit:function(a){var d=$(this).parents(".rubric");d.find("thead .title").text(a["rubric[title]"]);d.find(".rubric_total").text(a.points_possible);d.removeClass("editing");d.attr("id")=="rubric_new"?d.attr("id","rubric_adding"):d.prev(".rubric").remove();
$(this).parents("tr").hide();d.loadingImage();return d},success:function(a,d){var h=a.rubric;d.loadingImage("remove");h.rubric_association_id=a.rubric_association.id;h.permissions=h.permissions||{};if(a.rubric_association.permissions){h.permissions.update_association=a.rubric_association.permissions.update;h.permissions.delete_association=a.rubric_association.permissions["delete"]}rubricEditing.updateRubric(d,h);if(a.rubric_association&&a.rubric_association.use_for_grading&&!a.rubric_association.skip_updating_points_possible){$("#full_assignment .points_possible").text(h.points_possible);
$("#full_assignment input.points_possible").val(h.points_possible)}d.find(".rubric_title .links:not(.locked)").show()}});$("#edit_rubric_form .cancel_button").click(function(){rubricEditing.hideEditRubric($(this).parents(".rubric"),true)});$("#rubrics").delegate(".add_criterion_link","click",function(){var a=rubricEditing.addCriterion($(this).parents(".rubric"));rubricEditing.editCriterion(a);return false}).delegate(".find_outcome_link","click",function(){rubricEditing.findOutcomeCriterion($(this).parents(".rubric"));
return false}).delegate(".criterion_description_value","click",function(){rubricEditing.editCriterion($(this).parents(".criterion"));return false}).delegate(".edit_criterion_link","click",function(){rubricEditing.editCriterion($(this).parents(".criterion"));return false}).delegate(".delete_criterion_link","click",function(){var a=$(this).parents(".criterion");a.fadeOut(function(){var d=a.parents(".rubric");a.remove();rubricEditing.updateCriteria(d);rubricEditing.updateRubricPoints(d)});return false}).delegate(".rating_description_value,.edit_rating_link",
"click",function(){rubricEditing.editRating($(this).parents(".rating"));return false}).bind("mouseover",function(a){$target=$(a.target);$target.closest(".ratings").length||rubricEditing.hideCriterionAdd($target.parents(".rubric"))}).delegate(".rating","mousemove",function(a){var d=$(this),h=d.parents(".rubric");if(h.find(".rating.editing").length>0||d.parents(".criterion").hasClass("learning_outcome_criterion")){rubricEditing.hideCriterionAdd(h);return false}if(!$.data(this,"hover_offset")){$.data(this,
"hover_offset",d.offset());$.data(this,"hover_width",d.outerWidth());var f=$.data(this,"points",parseFloat(d.find(".points").text())),j=$.data(this,"prev_points",parseFloat(d.prev(".rating").find(".points").text())),k=$.data(this,"next_points",parseFloat(d.next(".rating").find(".points").text()));$.data(this,"prev_diff",Math.abs(f-j));$.data(this,"next_diff",Math.abs(f-k))}f=$.data(this,"hover_offset");j=$.data(this,"hover_width");k=d.parents(".ratings");a=a.pageX;var l=false;if(a<=f.left+j/2)l=true;
var m=k.data("hover_rating");k=k.data("hover_left_side");if(!m||d[0]!=m[0]||l!=k){rubricEditing.hideCriterionAdd(h);var n,o;if(l&&(n=d.prev(".rating"))&&n.length){d.addClass("add_left");n.addClass("add_right");d[a<=f.left+10?"addClass":"removeClass"]("add_column")}else if(!l&&(o=d.next(".rating"))&&o.length){d.addClass("add_right");o.addClass("add_left");d[a>=f.left+j-10?"addClass":"removeClass"]("add_column")}}else if(m)if(l)a<=f.left+10&&$.data(this,"prev_diff")>1?d.addClass("add_column"):d.removeClass("add_column");
else a>=f.left+j-10&&$.data(this,"next_diff")>1?d.addClass("add_column"):d.removeClass("add_column");return false}).delegate(".rating","mouseout",function(){$(this).data("hover_offset",null).data("hover_width",null)}).delegate(".delete_rating_link","click",function(a){a.preventDefault();rubricEditing.hideCriterionAdd($(this).parents(".rubric"));$(this).parents(".rating").fadeOut(function(){var d=$(this).parents(".criterion");$(this).remove();rubricEditing.sizeRatings(d)})}).delegate(".add_column",
"click",function(){var a=$(this),d=a.parents(".rubric");if(d.hasClass("editing")){var h=a.clone(true).removeClass("edge_rating"),f=parseFloat(a.find(".points").text()),j=a.parents(".criterion"),k=j.find(".criterion_points"),l=parseFloat(k.val(),10)||5,m={description:"Rating Description"},n=a.hasClass("add_left");if(a.hasClass("add_left")){k=parseFloat(a.prev(".rating").find(".points").text());m.points=Math.round((f+k)/2);if(m.points==f||m.points==k){m.points=k;j.find(".criterion_points").val(l+1)}}else{var o=
parseFloat(a.next(".rating").find(".points").text());m.points=Math.round((f+o)/2);if(m.points==f||m.points==o){m.points=f;k.val(l+1)}}h.fillTemplateData({data:m});n?a.before(h):a.after(h);rubricEditing.hideCriterionAdd(d);rubricEditing.updateCriterionPoints(j);rubricEditing.sizeRatings(j)}return false});$(".criterion_points").keydown(function(a){if(a.keyCode==13){rubricEditing.updateCriterionPoints($(this).parents(".criterion"));$(this).blur()}}).blur(function(){rubricEditing.updateCriterionPoints($(this).parents(".criterion"))});
$("#edit_criterion").delegate(".cancel_button","click",function(){rubricEditing.hideEditCriterion()});$("#edit_criterion_form").submit(function(a){a.preventDefault();a.stopPropagation();a=$(this).parents("#edit_criterion").getFormData();a.criterion_description_value=a.description;delete a.description;$(this).parents(".criterion").fillTemplateData({data:a});rubricEditing.hideEditCriterion()});$("#edit_rating").delegate(".cancel_button","click",function(){rubricEditing.hideEditRating()});$("#edit_rating_form").submit(function(a){a.preventDefault();
a.stopPropagation();a=$(this).parents("#edit_rating").getFormData();a.points=parseFloat(a.points);if(isNaN(a.points)){a.points=parseFloat($(this).parents(".criterion").find(".criterion_points").val());if(isNaN(a.points))a.points=5}var d=$(this).parents(".rating");d.fillTemplateData({data:a});d.prev(".rating").length===0&&$(this).parents(".criterion").find(".criterion_points").val(a.points);rubricEditing.updateCriterionPoints($(this).parents(".criterion"),true)});$("#edit_rubric_form .rubric_custom_rating").change(function(){$(this).parents(".rubric").find("tr.criterion").find(".ratings").showIf(!$(this).attr("checked")).end().find(".custom_ratings").showIf($(this).attr("checked"))}).triggerHandler("change");
$("#edit_rubric_form #totalling_rubric").change(function(){$(this).parents(".rubric").find(".total_points_holder").showIf(!$(this).attr("checked"))});$("#edit_rubric_form .grading_rubric_checkbox").change(function(){$(this).parents(".rubric").find(".totalling_rubric").css("visibility",$(this).attr("checked")?"hidden":"visible");$(this).parents(".rubric").find(".totalling_rubric_checkbox").attr("checked",false)}).triggerHandler("change");$("#criterion_blank").find(".criterion_points").val("5");$("#default_rubric").find(".criterion").length<=
1&&rubricEditing.addCriterion($("#default_rubric"));setInterval(rubricEditing.sizeRatings,1E4)})});
I18n.scoped("find_outcome",function(b){var c=function(){return{find:function(e,g){g=g||{};c.callback=e;var i=$("#find_outcome_criterion_dialog");if(!i.hasClass("loaded")){i.find(".loading_message").text(b.t("messages.loading_outcomes","Loading Outcomes..."));$.ajaxJSON(i.find(".outcomes_list_url").attr("href"),"GET",{},function(d){valids=[];for(var h in d){var f=d[h].learning_outcome;if(!g.for_rubric||f.data&&f.data.rubric_criterion)valids.push(f)}if(valids.length===0){h=g.for_rubric?b.t("messages.no_rubric_outcomes_found",
"No Rubric-Configured Outcomes found"):b.t("messages.no_outcomes_found","No Outcomes found");i.find(".loading_message").text(h)}else{i.find(".loading_message").hide();i.addClass("loaded");for(h in valids){f=valids[h];f.name=f.short_description;f.mastery_points=f.data.rubric_criterion.mastery_points||f.data.rubric_criterion.points_possible;d=i.find(".outcomes_select.blank:first").clone(true).removeClass("blank");f.title=f.short_description;var j=$("<div/>");j.text(f.short_description);f.title=$.truncateText($.trim(j.text()),
35);f.display_name=f.cached_context_short_name||"";d.fillTemplateData({data:f});i.find(".outcomes_selects").append(d.show());d=i.find(".outcome.blank:first").clone(true).removeClass("blank");d.find(".mastery_level").attr("id","outcome_question_bank_mastery_"+f.id).end().find(".mastery_level_text").attr("for","outcome_question_bank_mastery_"+f.id);f.learning_outcome_id=f.id;j=f.data&&f.data.rubric_criterion;j=j.points_possible&&j.mastery_points!=null&&j.mastery_points/j.points_possible||0;j=Math.round(j*
1E4)/100||"";d.find(".mastery_level").val(j);d.fillTemplateData({data:f,htmlValues:["description"]});d.addClass("outcome_"+f.id);if(f.data&&f.data.rubric_criterion)for(var k in f.data.rubric_criterion.ratings){j=f.data.rubric_criterion.ratings[k];var l=d.find(".rating.blank").clone(true).removeClass("blank");l.fillTemplateData({data:j});d.find("tr").append(l.show())}i.find(".outcomes_list").append(d)}i.find(".outcomes_select:not(.blank):first").click()}},function(){i.find(".loading_message").text(b.t("errors.outcome_retrieval_failed",
"Outcomes Retrieval failed unexpected.  Please try again."))})}var a;a=g.for_rubric?b.t("titles.find_outcome_criterion","Find Outcome Criterion"):b.t("titles.find_outcome","Find Outcome");i.dialog("close").dialog({autoOpen:false,modal:true,title:a,width:700,height:400}).dialog("open")}}}();window.find_outcome=c;$(document).ready(function(){$("#find_outcome_criterion_dialog .outcomes_select").click(function(e){e.preventDefault();$("#find_outcome_criterion_dialog .outcomes_select.selected_side_tab").removeClass("selected_side_tab");
$(this).addClass("selected_side_tab");e=$(this).getTemplateData({textValues:["id"]}).id;$("#find_outcome_criterion_dialog .outcomes_list .outcome").hide();$("#find_outcome_criterion_dialog .outcomes_list .outcome_"+e).show()});$("#find_outcome_criterion_dialog .select_outcome_link").click(function(e){e.preventDefault();e=$(this).parents(".outcome");$("#find_outcome_criterion_dialog").dialog("close");$.isFunction(c.callback)&&c.callback(e)})})});
$.extend(true,I18n=I18n||{},{translations:{es:{find_outcome:{messages:{loading_outcomes:"Cargando Resultados...",no_outcomes_found:"No se encontraron Resultados",no_rubric_outcomes_found:"No se encontraron Resultados Configurados para R\u00fabricas"},errors:{outcome_retrieval_failed:"La Recuperaci\u00f3n de Resultados fall\u00f3. Intente de nuevo."},titles:{find_outcome:"Encontrar Resultado",find_outcome_criterion:"Encontrar los Criterios de Resultados"}},edit_rubric:{messages:{loading_rubric_groups:"Cargando grupos de r\u00fabricas...",
loading_rubrics:"Cargando r\u00fabricas..."},errors:{load_rubrics_failed:"Carga de r\u00fabricas ha fallado, intente de nuevo"},prompts:{update_assignment_points:"Los puntos totales no concuerdan con los puntos de la tarea. \u00bfQuiere cambiar los puntos de la tarea para coincidir con el puntaje de la r\u00fabrica?",confirm_delete:"\u00bfSeguro que quiere borrar esta r\u00fabrica?",read_only_rubric:"No puede editar esta r\u00fabrica, puede que sea porque no tenga permiso o est\u00e1 siendo usada en varias localidades. Cualquier cambio resultar\u00e1 en una r\u00fabrica nueva basada en la anterior. \u00bfDesea continuar?"},
titles:{criterion_long_description:"Descripci\u00f3n Detallada de los Criterios",find_existing_rubric:"Encontrar R\u00fabrica Existente"}}}}});
