var INST;
I18n.scoped("select_content_dialog",function(i){$(document).ready(function(){var j=$("#select_context_content_dialog");attachAddAssignment($("#assignments_select .module_item_select"));INST=INST||{};INST.selectContentDialog=function(a){var d=a.for_modules,c=a.select_button_text||i.t("buttons.add_item","Add Item"),e=a.holder_name||"module",b=a.dialog_title||i.t("titles.add_item_to_module","Add Item to Module");j.data("submitted_function",a.submit);j.find(".context_module_content").showIf(d);j.find(".holder_name").text(e);
j.find(".add_item_button").text(c);j.find(".select_item_name").showIf(!a.no_name_input);if(d){var f=$("#content_tag_services").empty();$.getUserServices("BookmarkService",function(h){for(var g in h){service=h[g].user_service;$service=$("<a href='#' class='bookmark_service no-hover'/>");$service.addClass(service.service);$service.data("service",service);$service.attr("title",i.t("titles.find_links_using_service","Find links using %{service}",{service:service.service}));var k=$("<img/>");k.attr("src",
"/images/"+service.service+"_small_icon.png");$service.append(k);$service.click(function(m){m.preventDefault();$.findLinkForService($(this).data("service").service,function(l){$("#content_tag_create_url").val(l.url);$("#content_tag_create_title").val(l.title)})});f.append($service);f.append("&nbsp;&nbsp;")}})}$("#select_context_content_dialog #external_urls_select :text").val("");$("#select_context_content_dialog #context_module_sub_headers_select :text").val("");$("#add_module_item_select").change();
$("#select_context_content_dialog .module_item_select").change();$("#select_context_content_dialog").dialog("close").dialog({autoOpen:true,title:b,width:400}).dialog("open");$("#select_context_content_dialog").dialog("option","title",b)};$("#select_context_content_dialog .cancel_button").click(function(){$("#select_context_content_dialog").dialog("close")});$("#select_context_content_dialog .item_title").keycodes("return",function(){$(this).parents(".module_item_option").find(".add_item_button").click()});
$("#select_context_content_dialog .add_item_button").click(function(){var a=function(e){$("#select_context_content_dialog").dialog("close");var b=j.data("submitted_function");b&&$.isFunction(b)&&b(e)},d=$("#add_module_item_select").val();if(d=="external_url"){var c={"item[type]":$("#add_module_item_select").val(),"item[id]":$("#select_context_content_dialog .module_item_option:visible:first .module_item_select").val(),"item[indent]":$("#content_tag_indent").val()};c["item[url]"]=$("#content_tag_create_url").val();
c["item[title]"]=$("#content_tag_create_title").val();a(c)}else if(d=="context_external_tool"){c={"item[type]":$("#add_module_item_select").val(),"item[id]":$("#external_urls_select .tools .tool.selected").data("id"),"item[new_tab]":$("#external_tool_create_new_tab").attr("checked")?"1":"0","item[indent]":$("#content_tag_indent").val()};c["item[url]"]=$("#external_tool_create_url").val();c["item[title]"]=$("#external_tool_create_title").val();a(c)}else if(d=="context_module_sub_header"){c={"item[type]":$("#add_module_item_select").val(),
"item[id]":$("#select_context_content_dialog .module_item_option:visible:first .module_item_select").val(),"item[indent]":$("#content_tag_indent").val()};c["item[title]"]=$("#sub_header_title").val();a(c)}else $("#select_context_content_dialog .module_item_option:visible:first .module_item_select option:selected").each(function(){var e=$(this),b={"item[type]":d,"item[id]":e.val(),"item[title]":e.text(),"item[indent]":$("#content_tag_indent").val()};if(b["item[id]"]=="new"){$("#select_context_content_dialog").loadingImage();
e=$("#select_context_content_dialog .module_item_option:visible:first .new .add_item_url").attr("href");var f=$("#select_context_content_dialog .module_item_option:visible:first").getFormData(),h=function(g){$("#select_context_content_dialog").loadingImage("remove");g=g[b["item[type]"]];b["item[id]"]=g.id;b["item[title]"]=$("#select_context_content_dialog .module_item_option:visible:first .item_title").val();b["item[title]"]=b["item[title]"]||g.display_name;var k=$(document.createElement("option"));
k.val(g.id).text(b["item[title]"]);$("#"+b["item[type]"]+"s_select").find(".module_item_select option:last").before(k);a(b)};b["item[type]"]=="attachment"?$.ajaxJSONFiles(e,"POST",f,$("#module_attachment_uploaded_data"),function(g){h(g)},function(){$("#select_context_content_dialog").loadingImage("remove");$("#select_context_content_dialog").errorBox(i.t("errors.failed_to_create_item","Failed to Create new Item"))}):$.ajaxJSON(e,"POST",f,function(g){h(g)},function(){$("#select_context_content_dialog").loadingImage("remove");
$("#select_context_content_dialog").errorBox(i.t("errors.failed_to_create_item","Failed to Create new Item"))})}else a(b)})});$("#context_external_tools_select .tools").delegate(".tool","click",function(){var a=$(this);if($(this).hasClass("selected")&&!$(this).hasClass("resource_selection"))$(this).removeClass("selected");else{a.parents(".tools").find(".tool.selected").removeClass("selected");a.addClass("selected");if(a.hasClass("resource_selection")){var d=a.data("tool");a=Math.max(Math.min($(window).height()-
100,550),100);var c=d.resource_selection_settings.selection_width,e=d.resource_selection_settings.selection_height,b=$("#resource_selection_dialog");if(b.length==0){b=$("<div/>",{id:"resource_selection_dialog",style:"padding: 0; overflow-y: hidden;"});b.append($("<iframe/>",{id:"resource_selection_iframe",style:"width: 800px; height: "+a+"px; border: 0;",src:"/images/ajax-loader-medium-444.gif",borderstyle:"0"}));$("body").append(b.hide());b.dialog({autoOpen:false,width:"auto",resizable:true,close:function(){b.find("iframe").attr("src",
"/images/ajax-loader-medium-444.gif")},title:i.t("link_from_external_tool","Link Resource from External Tool")}).bind("dialogresize",function(){$(this).find("iframe").add(".fix_for_resizing_over_iframe").height($(this).height()).width($(this).width())}).bind("dialogresizestop",function(){$(".fix_for_resizing_over_iframe").remove()}).bind("dialogresizestart",function(){$(this).find("iframe").each(function(){$('<div class="fix_for_resizing_over_iframe" style="background: #fff;"></div>').css({width:this.offsetWidth+
"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1E7}).css($(this).offset()).appendTo("body")})}).bind("selection",function(f,h){if(h.embed_type=="basic_lti"&&h.url){$("#external_tool_create_url").val(h.url);$("#external_tool_create_title").val(h.text||d.name);$("#context_external_tools_select .domain_message").hide()}else{alert(i.t("invalid_lti_resource_selection","There was a problem retrieving a valid link from the external tool"));$("#external_tool_create_url").val("");
$("#external_tool_create_title").val("")}$("#resource_selection_dialog iframe").attr("src","about:blank");$("#resource_selection_dialog").dialog("close")})}b.dialog("close").dialog("option","width",c||800).dialog("option","height",e||a||400).dialog("open");b.triggerHandler("dialogresize");a=$.replaceTags($("#select_content_resource_selection_url").attr("href"),"id",d.id);b.find("iframe").attr("src",a)}else{$("#external_tool_create_url").val(a.data("url")||"");$("#context_external_tools_select .domain_message").showIf(a.data("domain")).find(".domain").text(a.data("domain"));
$("#external_tool_create_title").val(a.data("name"))}}});var n=$("#context_external_tools_select .tools .tool:first").detach();$("#add_module_item_select").change(function(){$("#select_context_content_dialog .module_item_option").hide();$("#"+$(this).val()+"s_select").show().find(".module_item_select").change();if($(this).val()=="context_external_tool"){var a=$("#context_external_tools_select");if(!a.hasClass("loaded")){a.find(".message").text("Loading...");var d=$("#select_context_content_dialog .external_tools_url").attr("href");
$.ajaxJSON(d,"GET",{},function(c){a.find(".message").remove();a.addClass("loaded");a.find(".tools").empty();for(var e in c){var b=c[e],f=n.clone(true);f.toggleClass("resource_selection",!!b.resource_selection_settings);f.fillTemplateData({data:b,dataValues:["id","url","domain","name"]});f.data("tool",b);a.find(".tools").append(f.show())}},function(){a.find(".message").text(i.t("errors.loading_failed","Loading Failed"))})}}});$("#select_context_content_dialog .module_item_select").change(function(){$(this).val()==
"new"?$(this).parents(".module_item_option").find(".new").show().focus().select():$(this).parents(".module_item_option").find(".new").hide()})})});$.extend(true,I18n=I18n||{},{translations:{es:{select_content_dialog:{buttons:{add_item:"Agregar Elemento"},errors:{loading_failed:"No se pudo cargar",failed_to_create_item:"No se pudo crear un elemento nuevo"},titles:{add_item_to_module:"Agregar Elemento al M\u00f3dulo",find_links_using_service:"Encontrar enlaces usando %{service}"}}}}});
