I18n.scoped("alerts",function(h){$(function(){var f=$(".alerts_list"),r=function(a){var b=[];a.find("ul.criteria li").each(function(){b.push({id:$(this).find('input[name="alert[criteria][][id]"]').attr("value"),criterion_type:$(this).data("value"),threshold:$(this).find("span").text()})});var c=[];a.find("ul.recipients li").each(function(){c.push($(this).data("value"))});var d=a.find('input[name="repetition"]:checked').attr("value");d=d=="value"?a.find('input[name="alert[repetition]"]').attr("value"):
null;return{criteria:b,recipients:c,repetition:d}},i=function(a,b){a.append(b);return b},n=function(a,b,c,d){var e=$("<"+b+" />");e.data("value",a);e.html(d[a][c]);if(b=="li"){e.append(" ");e.append(f.find(">.delete_item_link").clone().toggle())}else e.attr("value",a);return e},j=function(a,b){$element=n(a,b,"label",possible_alert_recipients);b=="li"&&$element.prepend($("<input type='hidden' name='alert[recipients][]' />").attr("value",a));return $element},k=function(a,b){var c=a,d,e;if(typeof a==
"object"){c=a.criterion_type;d=a.threshold;e=a.id}$element=n(c,b,b=="li"?"label":"option",possible_alert_criteria);if(b=="li"){if(!d)d=possible_alert_criteria[c].default_threshold;$element.find("span").text(d);$element.find("input").attr("value",d).attr("title",possible_alert_criteria[c].title);$element.prepend($("<input type='hidden' name='alert[criteria][][criterion_type]' />").attr("value",c));e&&$element.prepend($("<input type='hidden' name='alert[criteria][][id]' />").attr("value",e))}return $element},
l=function(a,b){var c=a.find(".criteria");c.empty();for(var d in b.criteria)c.append(k(b.criteria[d],"li"));c=a.find(".recipients");c.empty();for(d in b.recipients)c.append(j(b.recipients[d],"li"));if(b.repetition){a.find('input[name="repetition"][value="value"]').attr("checked",true);a.find('input[name="alert[repetition]"]').attr("value",b.repetition);a.find(".repetition_group .no_repetition").toggle(false);a.find(".repetition_group .repetition").toggle(true).find("span").text(b.repetition)}else{a.find('input[name="repetition"][value="none"]').attr("checked",
true);a.find(".repetition_group .no_repetition").toggle(true);a.find(".repetition_group .repetition").toggle(false)}},o;for(o in alert_data){var p=alert_data[o];l($("#edit_alert_"+p.id),p)}$(".add_alert_link").click(function(a){a.preventDefault();a=$(".alert.blank");var b=a.clone();b.removeClass("blank");b.addClass("new");f.find(".alert:visible").length!=0&&$('<div class="alert_separator"></div>').insertBefore(a);var c=Math.floor(Math.random()*1E8);b.find("input").each(function(){$(this).attr("id",
$.replaceTags($(this).attr("id"),"id",c))});b.find("label").each(function(){$(this).attr("for",$.replaceTags($(this).attr("for"),"id",c))});b.insertBefore(a);b.find(".edit_link").trigger("click");b.toggle(false);b.slideDown()});f.delegate(".edit_link","click",function(){var a=$(this).parents(".alert"),b=r(a);a.data("data",b);var c=a.find(".add_criterion_link").prev();c.empty();var d=0,e;for(e in possible_alert_criteria_order){var g=possible_alert_criteria_order[e],q=-1,m;for(m in b.criteria)if(b.criteria[m].criterion_type==
g){q=m;break}if(q==-1){c.append(k(g,"option"));d+=1}}d==0&&a.find(".add_criteria_line").toggle(false);c=a.find(".add_recipient_link").prev();c.empty();d=0;for(e in possible_alert_recipients_order){g=possible_alert_recipients_order[e];if($.inArray(g,b.recipients)==-1){c.append(j(g,"option"));d+=1}}d==0&&a.find(".add_recipients_line").toggle(false);a.find(".repetition_group label").toggle(true);a.toggleClass("editing");a.toggleClass("displaying");return false}).delegate(".delete_link","click",function(){var a=
$(this).parents(".alert");if(a.hasClass("new"))a.slideUp(function(){a.remove();f.find(".alert:first").prev(".alert_separator").remove();f.find(".alert_separator + .alert_separator").remove();f.find(".alert:visible:last").next(".alert_separator").remove()});else{a.find('input[name="_method"]').attr("value","DELETE");$.ajaxJSON(a.attr("action"),"POST",a.serialize(),function(){a.slideUp(function(){a.remove();f.find(".alert:first").prev(".alert_separator").remove();f.find(".alert_separator + .alert_separator").remove();
f.find(".alert:visible:last").next(".alert_separator").remove()})})}return false}).delegate(".cancel_button","click",function(){var a=$(this).parents(".alert");if(a.hasClass("new"))a.slideUp(function(){a.remove();f.find(".alert:first").prev(".alert_separator").remove();f.find(".alert_separator + .alert_separator").remove();f.find(".alert:visible:last").next(".alert_separator").remove()});else{var b=a.data("data");l(a,b);a.toggleClass("editing",false);a.toggleClass("displaying",true)}return false}).delegate(".alert",
"submit",function(){var a=$(this),b=[];a.find(".criteria li").length==0&&b.push([a.find(".add_criterion_link").prev(),h.t("errors.criteria_required","At least one trigger is required")]);a.find(".criteria input.editing").each(function(){var e=$(this).attr("value");if(!e||isNaN(e)||parseFloat(e)<0)b.push([$(this),h.t("errors.threshold_should_be_numeric","This should be a positive number")])});a.find(".recipients li").length==0&&b.push([a.find(".add_recipient_link").prev(),h.t("errors.recipients_required",
"At least one recipient is required")]);if(a.find('input[name="repetition"]:checked').attr("value")=="none")a.find('input[name="alert[repetition]"]').attr("value","");else{var c=a.find('input[name="alert[repetition]"]'),d=c.attr("value");if(!d||isNaN(d)||parseFloat(d)<0)b.push([c,h.t("errors.threshold_should_be_numeric","This should be a positive number")])}if(b.length!=0){a.formErrors(b);return false}$.ajaxJSON(a.attr("action"),"POST",a.serialize(),function(e,g){a.removeClass("new");a.attr("action",
g.getResponseHeader("Location"));a.find('input[name="_method"]').length==0&&a.append($('<input type="hidden" name="_method" value="put" />'));a.toggleClass("editing",false);a.toggleClass("displaying",true);l(a,e)},function(e){a.formErrors(e)});return false}).delegate(".recipients .delete_item_link","click",function(){var a=$(this).parents("li"),b=$(this).parents(".alert").find(".add_recipient_link");i(b.prev(),j(a.data("value"),"option"));a.slideUp(function(){a.remove()});b.parent().slideDown(function(){b.parent().css("display",
"")});return false}).delegate(".add_recipient_link","click",function(){var a=$(this).parents(".alert").find(".recipients"),b=$(this).prev(),c=b.attr("value");i(a,j(c,"li")).toggle().slideDown();var d=b.data("associated_error_box");d&&d.fadeOut("slow",function(){d.remove()});b.find('option[value="'+c+'"]').remove();b.find("*").length==0&&$(this).parent().slideUp();return false}).delegate(".criteria .delete_item_link","click",function(){var a=$(this).parents("li"),b=$(this).parents(".alert").find(".add_criterion_link");
i(b.prev(),k(a.data("value"),"option"));a.slideUp(function(){a.remove()});b.parent().slideDown(function(){b.parent().css("display","")});return false}).delegate(".add_criterion_link","click",function(){var a=$(this).parents(".alert").find(".criteria"),b=$(this).prev(),c=b.attr("value");i(a,k(c,"li")).toggle().slideDown();var d=b.data("associated_error_box");d&&d.fadeOut("slow",function(){d.remove()});b.find('option[value="'+c+'"]').remove();b.find("*").length==0&&$(this).parent().slideUp();return false}).delegate('input[name="repetition"]',
"click",function(){var a=$(this).parents(".alert").find('input[name="alert[repetition]"]').data("associated_error_box");a&&a.fadeOut("slow",function(){a.remove()})})})});$.extend(true,I18n=I18n||{},{translations:{es:{alerts:{errors:{threshold_should_be_numeric:"Este deber\u00eda ser un n\u00famero positivo",recipients_required:"Al menos un recipiente es necesario",criteria_required:"Al menos un activador de alarma es necesario"}}}}});
