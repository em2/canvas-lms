I18n.scoped("files",function(k){var f={},j=[];(function(){var i=$("#files_content"),q=$("#swfupload_holder"),p=$("#add_file_link"),l=$("#files_structure"),n=$("#files_structure_list");$.extend(f,{canManageAContext:false,init:function(){i=$("#files_content");q=$("#swfupload_holder");p=$("#add_file_link");l=$("#files_structure");n=$("#files_structure_list");i.prepend(q);f.clearDataCache.cacheIndex=0;for(var d in contexts){var a={context:contexts[d],context_name:contexts[d].name,context_string:contexts[d].asset_string};
if(contexts[d].asset_string){var c=contexts[d].asset_string.replace(/_\d+$/,"");a[c]=contexts[d]}j.push([a,{}])}for(d in j)if(j[d]){a=j[d][0];var e=c=null,b=null,h;for(h in a)if(a[h]&&h!="context_string"&&h!="context_name"&&h!="context"){c=h;e=a[h].name;b=a[h]}j[d][0].context_string=c+"_"+a[c].id;j[d][0].context_name=e;if((j[d][0].context=b)&&b.permissions&&b.permissions.manage_files)f.canManageAContext=true}i.append($("#drag_n_drop_panel"));i.append($("#content_templates .content_panel").hide());
$.handlesHTML5Files&&i.bind("dragenter dragover",function(g){g.preventDefault();g.stopPropagation();g=f.currentItemData();if(!(!g||g.mime_class!="folder")){$(this).addClass("file_drag");$("#drag_n_drop_panel").css("top",i.scrollTop())}}).bind("dragleave dragout",function(){$(this).closest(".drag_panel").length||$(this).removeClass("file_drag")}).bind("drop",function(g){var o=g.originalEvent.dataTransfer;if(o){var r=f.currentItemData();g.preventDefault();g.stopPropagation();$(this).removeClass("file_drag");
if(!(!r||r.mime_class!="folder")){var u=[];g=o.files;for(var s=0;s<g.length;s++)g[s]&&g[s].size>0&&u.push(g[s]);if(u.length===0)alert(k.t("messages.no_files_selected","No valid files were selected"));else{g=false;if(u.length==1&&u[0].type.match(/application\/(x-)?zip/))g=confirm(k.t("prompts.extract_zip","This file is a zip file.  Do you want to extract its contents into this folder?"));if(g){g=u[0];var v=r.context_string+"_full_files_"+Math.round(Math.random()*999999);o=$("."+r.context_string+"_zip_import_url").attr("href");
$.ajaxFileUpload({url:o,data:{zip_import_batch_id:v,folder_id:r.id,zip_file:u[0],format:"json"},method:"POST",success:function(){},error:function(){}});var t=$("<div/>");t.append("Extracting <b>"+$.htmlEscape(g.name)+"</b><br/>to "+$.htmlEscape(r.name)+"...");t.append("<div class='progress'/>");var w=t.find(".progress");w.css("margin","10px");w.progressbar();t.dialog("close").dialog({autoOpen:false,title:k.t("titles.extracting","Extracting Files into Folder"),close:function(){t.data("closed",true);
setTimeout(function(){t.detach()},500)}}).dialog("open");var A=function(z){t.text(k.t("errors.extracting","There were errors extracting the zip file.  Please try again."));var x=$("<ul/>"),E;for(E in z){var C=z[E],F=$("<li/>");F.text(C);x.append(F)}t.append(x)},y=function(){var z=$("#file_context_links ."+r.context_string+"_zip_import_status_url").attr("href");z=z+"?batch_id="+v;$.ajaxJSON(z,"GET",{},function(x){if(!t.data("closed"))if(x&&x.errors)A(x.errors);else if(x&&x.complete){w.progressbar("value",
100);t.append(k.t("messages.extraction_complete","Extraction complete!  Updating File Structure..."));f.refreshContext(r.context_string,function(){t.dialog("close")})}else if(!x||x.length==0){y.blankCount=y.blankCount||0;y.blankCount++;y.blankCount>30?A([k.t("errors.server_returned_invalid_status","The server stopped returning a valid status")]):setTimeout(y,2E3)}else{y.errorCount=0;setTimeout(y,2E3);w.progressbar("value",(x.progress||0)*100)}},function(){y.errorCount=y.errorCount||0;y.errorCount++;
y.errorCount>5?A([k.t("errors.server_unresponsive","The server stopped responding to status requests")]):setTimeout(y,2E3)})};setTimeout(y,3E3)}else{r=f.currentItemData();g=[];for(s in u)g.push(u[s].name);f.preflight(r.id,r.context_string,g,function(z){for(s in u)u[s].duplicate_handling=z},function(){for(var z in u)m.queueAjaxUpload(u[z])},function(){})}return false}}}})},preflight:function(d,a,c,e,b,h){$.ajaxJSON("/files/preflight","GET",{folder_id:d,context_code:a,filenames:c},function(g){if(g.duplicates&&
g.duplicates.length>0){var o=$("#duplicate_filename_dialog");o.find(".duplicate_filename_prompt").text(k.t("prompts.duplicate_filenames","Files with the following names already exist in this folder. Do you want to replace them, or rename the new files with unique names?"));var r="";for(idx in g.duplicates)r+="<span class='duplicate_filename'>"+$.htmlEscape(g.duplicates[idx])+"</span>";o.find(".duplicate_filenames").html(r);o.dialog("close").dialog({autoOpen:false,title:"",width:500}).dialog("open");
o.find("button").unbind("click");o.find(".cancel_button").click(function(){h();o.dialog("close")});o.find(".rename_button").click(function(){e("rename");b();o.dialog("close")});o.find(".overwrite_button").click(function(){e("overwrite");b();o.dialog("close")})}else b()},function(){h()})},context_page_view_ids:{},updatePageView:function(){},viewFile:function(d,a){var c=$("#file_context_links ."+d+"_inline_view_attachment_url").attr("href");c=$.replaceTags(c,"id",a);$.ajaxJSON(c,"POST",{},function(){},
function(){})},selectFolder:function(d){if(!(!f.selectFolder.forceRefresh&&(d.hasClass("active-node")||d.hasClass("active-leaf")))){f.selectFolder.forceRefresh=false;for(var a=d;a.parent("ul").parent("li").length>0;){a=a.parent("ul").parent("li");f.expandFolder(a)}d.children(".text:visible:first").click();l.find("li.node.active-node,li.leaf.active-leaf").length===0&&l.find("li.node:visible:first").children(".text:visible:first").click();if(f.currentItemData())!f.currentItemData().includes_files&&
f.currentItemData().full_name&&f.getFilesForFolder(f.currentItemData());else setTimeout(function(){f.selectFolder(d)},250)}},deleteAttachmentIds:function(d){for(var a in d){var c=$("#files_structure .file_"+d[a]);c.prev("li.separator").remove();c.remove();f.refreshView();f.updateQuota()}},gettingFiles:{},getFilesForFolder:function(d,a){var c=d.context_string+"_"+d.id;if(!f.gettingFiles[c])if(!(l.find("li.folder_"+d.id).hasClass("folder_locked")&&(!d.context||!d.context.permissions||!d.context.permissions.manage_files)))if(d.false_folder)f.refreshContext(d.context_string,
function(){f.getFilesForFolder(d,a)});else{f.gettingFiles[c]=true;var e=$.replaceTags($("#file_context_links ."+d.context_string+"_folder_url").attr("href"),"id",d.id);$.ajaxJSON(e,"GET",{},function(b){f.gettingFiles[c]=false;var h=b.actual_folder.folder;h.includes_files=true;f.updateFolder(d.context_string,{folder:h,already_in_place:true},false);for(var g in b.files){var o=b.files[g].attachment;o&&f.updateFile(d.context_string,{attachment:o,definitely_new:true},false)}l.find(".folder_"+h.id).triggerHandler("files_load");
h=i.find(".message.no_content:visible").length>0;if(a!==false||h)a&&$.isFunction(a)?a(b):f.refreshView();p.triggerHandler("show")},function(){f.gettingFiles[c]=false})}},expandFolder:function(d){n[0]&&n[0].ExpandNode&&n[0].ExpandNode($("#files_structure_list"),d)},collapseFolder:function(d){n[0]&&n[0].CollapseNode&&n[0].CollapseNode($("#files_structure_list"),d)},fullPath:function(d){var a=[],c=f.itemData(d);for(a.unshift(c.name.replace(/\//g,"//"));d.parent("ul").parent("li").length>0;){d=d.parent("ul").parent("li");
c=f.itemData(d);a.unshift(c.name.replace(/\//g,"//"))}return a.join("/")},selectNodeFromPath:function(d){var a=f.nodeFromPath(d);f.selectFolder(a);var c=function(){a.unbind("files_load",c);a.hasClass("active-node")&&f.selectNodeFromPath(d)};a.bind("files_load",c);l.find(".node.active-node,.leaf.active-leaf").length===0&&f.selectFolder(l.find(".node:visible:first"))},nodeFromPath:function(d){try{if(l.find("#files_structure_list > li."+d).length>0)return l.find("#files_structure_list > li."+d)}catch(a){}d=
d.replace(/\/\//g,"\\").split("/");var c=l,e=true,b;for(b in d){var h=d[b].replace(/\\\\/g,"/"),g=false;e&&c.children("ul").children("li").each(function(){if($(this).children(".text.name").text()==h){c=$(this);g=true;return false}});e=g}return c},draggable_helper:function(d,a){if($(this).hasClass("folder_item"))a=$(this);else{var c=a.width();return a.clone().css("backgroundColor","#eeeeee").css("height",50).css("borderWidth",1).css("borderStyle","solid").css("borderColor","#ccc").css("width",c-50)}c=
a.clone().attr("id","file_drag");c.find(".header .sub_header").remove();c.find(".header").append("<div class='sub_header'/>");c.find(".header .sub_header").html("&nbsp;");c.addClass("file_drag");c.find(".links").remove();c.css("width",100);var e=$("<ul/>");e.addClass("files_content");e.append(c);e.addClass("true-draggable");e.css("width",200);e.css("height",50);$("#content").append(e);return e},updateQuota:function(){if($("#quota").length){var d=$(".quota_url").attr("href");$.ajaxJSON(d,"GET",{},
function(a){$("#quota").text(a.quota);$("#quota_used").text(a.quota_used)},function(){})}}});$.extend(f,{draggable_options:{handle:".draggable.item_icon",distance:5,helper:f.draggable_helper,start:function(){i.addClass("dragging")},stop:function(){setTimeout(function(){i.removeClass("dragging")},500)}},droppable_options:{accept:".file,.folder",hoverClass:"drop_target",tolerance:"pointer",drop:function(d,a){if($(a.helper).hasClass("true-draggable")){var c=$(a.draggable),e=f.itemData(c),b=$(this),h=
f.itemData($(this).parent(".folder"));h=h||f.itemData($(this));l.loadingImage();if(c.hasClass("file"))if($(a.helper).hasClass("copy_drag")){c=$("#file_context_links ."+h.context_string+"_attachments_url").attr("href");var g={"attachment[source_attachment_id]":e.id,"attachment[folder_id]":h.id};$.ajaxJSON(c,"POST",g,function(o){l.loadingImage("remove");f.updateFile(h.context_string,o,false);f.selectFolder(b);f.refreshView()},function(){l.loadingImage("remove")})}else{c=$("#file_context_links ."+h.context_string+
"_attachment_url").attr("href");c=$.replaceTags(c,"id",e.id);$.ajaxJSON(c,"PUT",{"attachment[folder_id]":h.id},function(o){l.loadingImage("remove");f.updateFile(h.context_string,o,false);f.selectFolder(b);f.refreshView()},function(){l.loadingImage("remove")})}else if($(a.helper).hasClass("copy_drag")){c=$("#file_context_links ."+h.context_string+"_folders_url").attr("href");g={"folder[source_folder_id]":e.id,"folder[parent_folder_id]":h.id};$.ajaxJSON(c,"POST",g,function(){l.loadingImage("remove");
f.refreshContext(h.root_context_string)},function(){l.loadingImage("remove")})}else{c=$("#file_context_links ."+h.context_string+"_folder_url").attr("href");c=$.replaceTags(c,"id",e.id);$.ajaxJSON(c,"PUT",{"folder[parent_folder_id]":h.id},function(){l.loadingImage("remove");f.refreshContext(e.root_context_string)},function(){l.loadingImage("remove")})}}},over:function(d,a){$(a.helper).hasClass("true-draggable")||$(this).removeClass("drop_target");var c=f.itemData($(a.draggable)),e=f.itemData($(this).parent(".folder"));
e=e||f.itemData($(this));$(a.helper).find(".header .sub_header").text("move to "+e.name);if(c&&e&&c.context_string!=e.context_string){$(a.helper).addClass("copy_drag");$(a.helper).find(".header .sub_header").html("<strong>copy</strong> to "+$.htmlEscape(e.name))}},out:function(d,a){$(a.helper).removeClass("copy_drag");$(a.helper).find(".header .sub_header").html("&nbsp;")}},breadcrumb:function(){for(var d=location.hash.substring(1).replace(/\/\//g,"\\").split("/"),a=$("<div/>"),c=[],e=0;e<d.length-
1;e++){var b=$("<a/>");c.push(d[e].replace(/\\\\/g,"/"));b.attr("href","#"+c.join("/"));b.text(d[e]);a.append(b)}return a},refreshContext:function(d,a){f.refreshContext.refreshing=f.refreshContext.refreshing||{};if(!f.refreshContext.refreshing[d]){f.refreshContext.refreshing[d]=true;var c=$("#file_context_links ."+d+"_attachments_url").attr("href");$.ajaxJSON(c,"GET",{},function(e){f.clearDataCache();f.refreshContext.refreshing[d]=false;var b=l.scrollTop(),h=null,g;for(g in j){var o=j[g][0];if(o.context_string==
d){h=o.context_name;j[g][0].context.includes_files=true;for(var r in e.folders)for(var u in j[g][1].folders)if(j[g][1].folders[u].id==e.folders[r].id)e.folders[r].includes_files=j[g][1].folders[u].includes_files;e.files=e.files||[];for(r in j[g][1].files)e.files.push(j[g][1].files[r]);j[g][1]=e}}var s=$("#files_structure > ul > li.context."+d).filter(":first");if(s.length===0)s=null;var v=[];o=false;if(s){o=s.hasClass("open");s.find("li.node.open").each(function(){v.push(f.itemData($(this)).id)})}var t=
null;for(g in e.contexts)for(r in e.contexts[g])if(!t){t=r;h=e.contexts[g][r].name}t=null;if(!e.folders&&e[0]&&e[0][1]&&e[0][1].folders)e.folders=e[0][1].folders;for(g in e.folders)if(!t&&e.folders[g].folder&&e.folders[g].folder.parent_folder_id===null)t=e.folders[g].folder;var w=s;if(!w||w.length===0)w=l.find(".folder_blank").clone(true).removeClass("folder_blank");w.children(".name").text(h);w.children(".id").text(t.id);w.addClass("context folder folder_"+t.id+" "+d);w.find("li").addClass("to_be_removed");
h=w.children("ul");var A=function(C,F){for(var D in e.folders)if(F.id&&e.folders[D].folder.parent_folder_id==F.id){var B=C.children("ul").children(".folder_"+e.folders[D].folder.id);if(B.length===0){B=l.find(".folder_blank").clone(true).removeClass("folder_blank");B.addClass("folder folder_"+e.folders[D].folder.id);B.children(".id").text(e.folders[D].folder.id);B.children(".name").text(e.folders[D].folder.name)}B.removeClass("to_be_removed");A(B,e.folders[D].folder);B.parents("body").length===0&&
C.children("ul").append(B.show())}};for(g in e.folders)if(e.folders[g].folder.parent_folder_id==t.id){s=h.find(".folder_"+e.folders[g].folder.id);if(s.length===0){s=l.find(".folder_blank").clone(true).removeClass("folder_blank");s.addClass("folder folder_"+e.folders[g].folder.id);s.children(".name").text(e.folders[g].folder.name);s.children(".id").text(e.folders[g].folder.id)}s.removeClass("to_be_removed");A(s,e.folders[g].folder);s.parents("body").length===0&&h.append(s.show())}if(e.collaborations&&
!d.match(/^user_/)){t=l.find(".folder_blank").clone(true).removeClass("folder_blank");t.addClass("collaborations");t.fillTemplateData({data:{name:"collaborations"}});for(g in e.collaborations){s=$(".collaboration_"+(e.collaborations[g].collaboration||e.collaborations[g].google_docs_collaboration||e.collaborations[g].etherpad_collaboration).id);if(s.length===0){s=l.find(".file_blank").clone(true).removeClass("file_blank");s.addClass("collaboration_"+e.collaborations[g].collaboration.id);s.addClass("collaboration "+
e.collaborations[g].collaboration.collaboration_type);s.fillTemplateData({data:{name:e.collaborations[g].collaboration.title,id:e.collaborations[g].collaboration.id}})}s.removeClass("to_be_removed");s.parents("body").length===0&&t.children("ul").append(s.show())}h.append(t.show())}t={};for(g in e.groups)t[(e.groups[g].group||e.groups[g].course_assigned_group).category]=true;for(g in t){s=l.find(".folder_blank").clone(true).removeClass("folder_blank");s.fillTemplateData({data:{name:g}});s.addClass("groups");
for(r in e.groups){var y=e.groups[r].group||e.groups[r].course_assigned_group;if(y.category==g){var z=null;for(u in e.folders)if(!z&&!e.folders[u].folder.parent_folder_id===null)z=e.folders[u].folder;if(z){var x=s.children("ul").children(".group_"+y.id);if(x.length===0){x=l.find(".folder_blank").clone(true).removeClass("folder_blank");x.addClass("group context folder folder_"+z.id);x.addClass("group_"+y.id);x.fillTemplateData({data:{name:y.name,id:z.id}})}x.removeClass("to_be_removed");A(x,z);x.parents("body").length===
0&&s.children("ul").append(x.show())}}}h.append(s.show())}var E=false;w.find(".to_be_removed").remove();l.find("#files_structure_list > .folder").each(function(){var C=f.itemData($(this));if(C&&C.root_context_string==d){if($(this)[0]!=w[0]){$(this).after(w.show());$(this).remove()}E=true}});E||l.find("#files_structure_list").append(w.show());w.children(".text").droppable(f.droppable_options);w.find(".folder > .text").droppable(f.droppable_options);for(g in v)f.expandFolder(w.find(".folder_"+v[g]));
o&&f.expandFolder(w);l.scrollTop(b);n.instTree.InitInstTree(n);l.find("li.node.active-node,li.leaf.active-leaf").filter(":first").children(".name").click();a&&$.isFunction(a)&&a()},function(){f.refreshContext.refreshing[d]=false})}},refreshContentListeners:function(){var d=f.currentContext();if(d&&d.permissions&&d.permissions.manage_files){i.find(".folder.draggable_droppable").droppable(f.droppable_options);i.sortable("enable");i.sortable("refresh")}else i.sortable("disable").removeClass("ui-state-disabled");
if(f.canManageAContext){i.find(".folder.draggable_droppable").draggable(f.draggable_options);i.find(".file").draggable(f.draggable_options)}},nodeClumpSize:25,addScrollCatcher:function(){var d=$("<li class='catcher'>&nbsp;</li>");if(!f.watchingScroll){i.bind("scroll",function(){var a=i.find(".catcher:visible:first");if(a.length>0){a=a.offset().top;var c=i.offset().top+i.height();if(a<c){a=i.scrollTop();c=0;i.find(".catcher").remove();var e=i.find(".folder_item:visible:last").data("node");if(e){e=
e.next();for(var b=false;e.length>0;){if(!e.hasClass("separator")){c++;if(c<=f.nodeClumpSize)f.addContentItem(e);else b=true}e=e.next()}f.refreshContentListeners();b&&f.addScrollCatcher()}i.scrollTop(a)}}});f.watchingScroll=true}i.append(d)},addContentItem:function(d,a){var c=f.itemData(d);if(c&&c.id){var e=false;if(d.hasClass("node")){var b=i.find(".folder_"+c.id);if(b.length===0){e=true;b=$("#content_templates .folder:first").clone(true);a&&b.hide();b.fillTemplateData({data:c});b.data("parent_node",
d.parent().parent());var h=$.replaceTags($("."+c.context_string+"_folder_url").attr("href"),"id",c.id);b.find(".rename_item_link,.delete_item_link,.folder_url").attr("href",h);b.addClass("folder_"+c.id);b.find(".item_icon.draggable").attr("title",k.t("titles.click_and_drag","Click and drag to move folder to another folder"));b.data("node",d)}b.toggleClass("editable_folder_item",!!(!d.hasClass("context")&&(c.context&&c.context.permissions&&c.context.permissions.manage_files||c.permissions&&c.permissions.update)));
b.removeClass("to_be_removed");b.find(".item_icon").toggleClass("draggable",b.hasClass("editable_folder_item"));b.find(".item_icon").attr("alt","Folder").attr("src",$("#content_blank_icon").attr("src"));c&&c.currently_locked&&b.find(".item_icon").attr("alt",k.t("alts.folder_locked","Locked Folder")).attr("src",$("#content_locked_icon").attr("src"));b.find(".lock_item_link").showIf(!c.currently_locked);b.find(".unlock_item_link").showIf(c.currently_locked);b.toggleClass("folder_locked",!!(c&&c.currently_locked));
b.toggleClass("draggable_droppable",d.hasClass("folder")&&!d.hasClass("context"))}else if(d.hasClass("collaboration")){b=i.find(".collaboration_"+c.id);if(b.length===0){e=true;b=$("#content_templates .collaboration:first").clone(true);a&&b.hide();b.fillTemplateData({data:c});b.data("parent_node",d.parent().parent());b.data("node",d);h=$.replaceTags($("."+c.context_string+"_collaboration_url").attr("href"),"id",c.id);b.find(".collaboration_url").attr("href",h);b.addClass("collaboration_"+c.id);b.addClass(c.collaboration_type)}b.toggleClass("editable_folder_item",
!!(c.permissions&&c.permissions.update));b.removeClass("to_be_removed");b.find(".item_icon").attr("alt",k.t("alts.collaboration","Collaboration")).attr("src",$("#content_blank_icon").attr("src"))}else{b=i.find(".file_"+c.id);if(b.length===0){e=true;b=$("#content_templates .file:first").clone(true);a&&b.hide();h=$.replaceTags($("#file_context_links ."+c.context_string+"_attachment_url").attr("href"),"id",c.id);var g=$.replaceTags($("#file_context_links ."+c.context_string+"_download_attachment_url").attr("href"),
"id",c.id);b.fillTemplateData({data:c}).data({parent_node:d.parent().parent(),node:d}).addClass(c.mime_class+" file_"+c.id);b.find(".attachment_url").attr("href",h);b.find(".download_url").attr("href",g);b.find(".item_icon.draggable").attr("title","Click and drag to move file to another folder")}b.toggleClass("editable_folder_item",!!(c.context&&c.context.permissions&&c.context.permissions.manage_files||c.permissions&&c.permissions.update)).removeClass("to_be_removed").find(".item_icon").attr({alt:k.t("alts.file",
"File"),src:$("#content_blank_icon").attr("src")});c&&c.currently_locked&&b.find(".item_icon").attr({alt:k.t("alts.locked_file","Locked File"),src:$("#content_locked_icon").attr("src")});b.find(".lock_item_link").showIf(!c.currently_locked);b.find(".unlock_item_link").showIf(c.currently_locked);b.find(".preview_item_link").showIf(c.scribd_doc||c.content_type.match(/image/)||c.content_type.match(/(video|audio)/)&&c.media_entry_id);b.find(".edit_item_content_link_holder").showIf(b.hasClass("editable_folder_item")&&
c.context_type!="User"&&(b.hasClass("text")||b.hasClass("html")||b.hasClass("code")));b.find(".item_icon").toggleClass("draggable",b.hasClass("editable_folder_item"))}e&&i.append(b);return e}},reorderContent:function(d,a){for(var c=[],e=[],b=0;b<a.length;b++)if(a[b].attachment)c.push(a[b]);else a[b].folder&&e.push(a[b]);l.find(".folder_"+d).each(function(){var h=$(this),g=[],o=[];h.children("ul").children("li").each(function(){$(this).hasClass("file")?o.push($(this)):g.push($(this))});o=o.sort(function(u,
s){var v=f.itemData(u),t=f.itemData(s);return v.position-t.position});for(var r in o){h.children("ul").append(o[r].prev(".separator"));h.children("ul").append(o[r])}g=g.sort(function(u,s){var v=f.itemData(u)||{};return((f.itemData(s)||{}).position||0)-(v.position||0)});for(r in g)if(o[r]){h.children("ul").prepend(o[r].prev(".separator"));h.children("ul").prepend(o[r])}});f.refreshView()},updateCollaboration:function(d,a,c){var e=$.underscore(a.collaboration.context_type)+"_"+a.collaboration.context_id,
b;for(b in j)if(j[b]&&(j[b][0].context_string==d||j[b][0].context_string==e)){var h=false,g;for(g in j[b][1].collaborations){var o=j[b][1].collaborations[g].collaboration;if(o.id==a.collaboration.id){j[b][1].collaborations[g]=a;l.find(".collaboration_"+o.id).each(function(){f.itemData($(this).parent("ul").parent("li"));$(this).fillTemplateData({data:{name:a.collaboration.title}})});h=true}}if(!h){o=a.collaboration;j[b][1].collaborations.push(a);h=l.find(".file_blank").clone(true).removeClass("file_blank");
h.removeClass("file");h.addClass("collaboration collaboration_"+o.id+" "+o.collaboration_type);o.name=o.title;h.fillTemplateData({data:o});l.find("."+d+" .collaborations").children("ul").prepend(h.show())}}if(c!==false){f.refreshView(a.attachment);n.instTree.InitInstTree(n)}},updateFile:function(d,a,c){f.clearDataCache();var e=$.underscore(a.attachment.context_type)+"_"+a.attachment.context_id,b;for(b in j)if(j[b]&&(j[b][0].context_string==d||j[b][0].context_string==e)){var h=false,g=false;if(!a.definitely_new)for(var o in j[b][1].files){var r=
j[b][1].files[o].attachment;if(r.id==a.attachment.id){j[b][1].files[o]=a;l.find(".file_"+r.id).each(function(){if(f.itemData($(this).parent("ul").parent("li")).id==a.attachment.folder_id)$(this).fillTemplateData({data:{name:a.attachment.display_name}});else g=true});h=true;g&&l.find(".file_"+r.id).remove()}}if(!h||g){r=a.attachment;if(!h){a.definitely_new=false;j[b][1].files.push(a)}h=l.find(".file_blank").clone(true).removeClass("file_blank");h.addClass("file_"+r.id);h.addClass(r.mime_class);r.name=
r.display_name;h.fillTemplateData({data:r});l.find(".folder_"+r.folder_id).children("ul").append(h.show())}}if(c!==false){f.refreshView(a.attachment);n.instTree.InitInstTree(n)}},updateFolder:function(d,a,c){f.clearDataCache();var e=$.underscore(a.folder.context_type)+"_"+a.folder.context_id,b=a.already_in_place;a.already_in_place=null;for(var h in j)if(j[h]&&(j[h][0].context_string==d||j[h][0].context_string==e)){var g=false,o=false,r;for(r in j[h][1].folders){var u=j[h][1].folders[r].folder;if(u.id==
a.folder.id){if(u.includes_files)a.folder.includes_files=u.includes_files;j[h][1].folders[r]=a;l.find(".folder_"+u.id).each(function(){var s=f.itemData($(this).parent("ul").parent("li"));s=s||{parent_folder_id:null};if(s.id==a.folder.parent_folder_id){$(this).hasClass("context")||$(this).children(".name").text(a.folder.name);if(!b){$(this).prev("li.separator").remove();var v=$(this).parent("ul").parent("li"),t=null,w=$(this);v.children("ul").children("li:not(.separator)").each(function(){var A=f.itemData($(this)).position;
if($(this)[0]!=w[0]&&(!$(this).hasClass("folder")||A>=s.position)){t=$(this);return false}});if(t){t.before($(this).show());t.before("<li class='separator'/>")}else{v.children("ul").append("<li class='separator'/>");v.children("ul").append($(this).show())}}}else o=true});g=true;o&&l.find(".folder_"+u.id).remove()}}if(!g||o){f.foldersStillLoading=f.foldersStillLoading||{};f.foldersStillLoading[a.folder.id]=a;f.refreshContext(d);d!=e&&f.refreshContext(e)}}c!==false&&f.refreshView(a.folder)},refreshView:function(d){l.find("li.node.active-node,li.leaf.active-leaf").filter(":first").children(".text:visible:first").click();
if(d&&d.id){i.find(".file_"+d.id).mouseover();i.find(".folder_"+d.id).mouseover()}p.triggerHandler("show")},currentItemData:function(){return f.itemData(l.find("li.node.active-node,#files_structure li.leaf.active-leaf"))},currentContext:function(){var d=f.currentItemData().context_string,a;for(a in j)if(j[a][0].context_string==d)return j[a][0].context;return null},clearDataCache:function(){f.clearDataCache.cacheIndex++},itemData:function(d){var a=d.data("item_data");if(a&&a.cacheIndex==f.clearDataCache.cacheIndex)return a;
if(a=f.uncachedItemData(d)){a.cacheIndex=f.clearDataCache.cacheIndex;d.data("item_data",a)}return a},uncachedItemData:function(d){if(d.closest("#files_content").length>0)return f.itemData(d.data("node"));var a=d.getTemplateData({textValues:["id"]}).id,c;for(c in j){var e=j[c];if(d.hasClass("file")){var b=e[1].files,h;for(h in b){var g=b[h].attachment;if(g.id==a){g.context_string=$.underscore(g.context_type)+"_"+g.context_id;g.root_context_string=e[0].context_string;g.context=e[0].context;g.name=g.display_name;
return g}}}else if(d.hasClass("collaborations")){if(d.parents("li.context:last").hasClass(e[0].context_string)){res=d.getTemplateData({textValues:["name"]});res.context_string=e[0].context_string;res.context=e[0].context;return res}}else if(d.hasClass("groups")){if(d.parents("li.context:last").hasClass(e[0].context_string)){res=d.getTemplateData({textValues:["name"]});res.context_string=e[0].context_string;res.context=e[0].context;return res}}else if(d.hasClass("collaboration")){b=e[1].collaborations;
for(h in b){g=b[h].collaboration;if(g.id==a){g.context_string=$.underscore(g.context_type)+"_"+g.context_id;g.root_context_string=e[0].context_string;g.name=g.title;return g}}}else if(d.hasClass("folder")){b=e[1].folders;for(h in b){g=b[h].folder;if(g.id==a){g.context_string=$.underscore(g.context_type)+"_"+g.context_id;g.root_context_string=e[0].context_string;if(d.hasClass("context"))g.name=d.getTemplateData({textValues:["name"]}).name;g.context=e[0].context;return g}}}else if(d.hasClass("group")){b=
e[1].groups;for(h in b){g=b[h].group||b[h].course_assigned_group;g.context_string=$.underscore(g.context_type)+"_"+g.context_id;g.root_context_string=e[0].context_string;if(g.id==a)return g}}}if(d.hasClass("folder")){e=null;for(c in j)if(d.closest(".context").hasClass(j[c][0].context_string))e=j[c];for(c in f.foldersStillLoading)if(f.foldersStillLoading[c].folder.id==a){g=f.foldersStillLoading[c].folder;g.name=d.getTemplateData({textValues:["name"]}).name;g.context_string=e[0].context_string;g.context=
e[0].context;return g}if(e){g={};g.name=d.getTemplateData({textValues:["name"]}).name;g.id=a;g.context_string=e[0].context_string;g.permissions={read_contents:true};g.context=e[0].context;g.false_folder=true;return g}}return null}});$(document).ready(function(){f.init();setInterval(function(){p.triggerHandler("show")},1E3);$(".folder_item").live("mousedown",function(a){a.preventDefault()});$(".folder_item.ui-draggable").live("mouseover",function(){$(this).find(".item_icon").attr("title",k.t("titles.drag_to_move",
"Drag to move to a different folder"))});p.bind("show",function(){var a=p.width(),c=p.height(),e=p.offset(),b=i.offset();e.left-=b.left;e.top-=b.top;q.css({width:a+5,height:c+5,top:e.top-5,left:e.left-5})});$("#file_uploads_dialog_link").click(function(a){a.preventDefault();$("#file_uploads").dialog("close").dialog({autoOpen:false,title:k.t("titles.file_uplaods_queue","File Uploads Queue")}).dialog("open")});setTimeout(function(){l.find(".folder > .text").droppable(f.droppable_options);i.sortable({distance:5,
cancel:".draggable.item_icon",items:"li.file,li.folder",axis:"y",hoverClass:"lameness",containment:"parent",start:function(){i.addClass("dragging")},stop:function(){setTimeout(function(){i.removeClass("dragging")},500)},helper:f.draggable_helper,update:function(a,c){var e=f.itemData($(c.item)),b=[],h=[],g=i.find(".file:first"),o=i.find(".folder_item"),r=o.index(g);i.find(".folder").each(function(){o.index($(this))>r&&g.before($(this));var v=f.itemData($(this)).id;b.push(v)});i.find(".file").each(function(){var v=
f.itemData($(this)).id;h.push(v)});i.loadingImage();var u={order:h.join(","),folder_id:e.folder_id||e.parent_folder_id,folder_order:b.join(",")},s=$("#file_context_links ."+e.context_string+"_reorder_attachments_url").attr("href");$.ajaxJSON(s,"POST",u,function(v){i.loadingImage("remove");for(var t in v)if(v[t].attachment)f.updateFile(e.context_string,v[t],false);else v[t].folder&&f.updateFolder(e.context_string,v[t],false);f.reorderContent(e.folder_id,v);f.refreshView(e)},function(){i.loadingImage("remove")})}});
$("#files_structure_list > li").hide();n.instTree({autoclose:false,multi:false,dragdrop:false,onExpand:function(a){if(a.hasClass("folder"))(a=f.itemData(a))&&!a.includes_files&&f.getFilesForFolder(a,false)},onCollapse:function(a){a.find(".node.active-node,.leaf.active-leaf").length>0&&a.find(".text:visible:first").click()},onClick:function(a,c){i.find(".content_panel").addClass("to_be_hidden");i.find(".folder_item").addClass("to_be_removed");i.find(".catcher").addClass("to_be_removed");i.find(".file_preview").remove();
i.find(".message").remove();var e=function(){i.find(".content_panel.to_be_hidden").hide();i.find(".catcher.to_be_removed").remove();i.find(".folder_item.to_be_removed").remove()},b=f.itemData(c),h=encodeURIComponent(f.fullPath(c));location.hash!="#"+h&&location.replace("#"+h);!b.includes_files&&b.full_name&&f.getFilesForFolder(b);if(b.context_string){if(INST)INST.interaction_context=b.context_string;f.updatePageView(b.context_string)}if(c.hasClass("node")){var g=$.replaceTags($("."+b.context_string+
"_folder_url").attr("href"),"id",b.id),o=false,r=$("<li class='message'>"+k.t("messages.folder_empty","Nothing in this Folder")+"</li>");if(c.hasClass("folder"))if(!b||!b.permissions||!b.permissions.read_contents){i.find(".content_panel:last").after("<li class='message'>"+k.t("messages.access_denied","You cannot read the contents of this folder.")+"</li>");o=true}else{h=$("#folder_panel");h.find(".rename_item_link,.delete_item_link,.folder_url").attr("href",g);h.find(".breadcrumb").empty().append(f.breadcrumb());
h.toggleClass("editable_content_panel",!!(b.context&&b.context.permissions&&b.context.permissions.manage_files||b.permissions&&b.permissions.update)).toggleClass("addable_content_panel",!!(b.context&&b.context.permissions&&b.context.permissions.manage_files||b.permissions&&b.permissions.update)).toggleClass("downloadable_content_panel",!h.hasClass("editable_content_panel")&&!h.hasClass("addable_content_panel")&&!!(b.permissions&&b.permissions.read_contents));h.removeClass("to_be_hidden");h.find(".download_zip,.upload_zip").hide();
if(c.hasClass("context")||!(b&&b.permissions&&b.permissions.update))h.removeClass("editable_content_panel");g=$.replaceTags($("."+b.context_string+"_folder_url").attr("href")+"/download","id",b.id);$(".download_zip_link").attr("href",g);$(".upload_zip_link").attr("href",$("."+b.context_string+"_import_url").attr("href")+"?return_to="+encodeURIComponent(location.href)+"&folder_id="+b.id);b.unlock_at_string=$.parseFromISO(b.unlock_at).datetime_formatted;b.lock_at_string=$.parseFromISO(b.lock_at).datetime_formatted;
h.find(".lock_after").showIf(b.lock_at);h.find(".lock_until").showIf(b.unlock_at);h.find(".currently_locked_box").showIf(b.currently_locked);h.find(".lock_item_link").showIf(b.parent_folder_id&&!b.currently_locked);h.find(".unlock_item_link").showIf(b.parent_folder_id&&b.currently_locked);h.find(".download_zip").showIf(b.permissions&&b.permissions.read_contents);h.find(".upload_zip").showIf(b.context&&b.context.permissions&&b.context.permissions.manage_files&&b.context_type&&b.context_type=="Course");
h.find(".edit_link").showIf(b.context&&b.context.permissions&&b.context.permissions.manage_files);h.fillTemplateData({data:b});h.data("node",c);h.show();p.triggerHandler("show")}else if(c.hasClass("collaborations")){h=$("#collaborations_panel");g=b.context;h.find(".header .name").text(g.name);h.find(".breadcrumb").empty().append(f.breadcrumb());var u=$("."+b.context_string+"_collaborations_url").attr("href");h.find(".collaborations_link").attr("href",u);h.find(".add_collaboration_link").attr("href",
u);h.find(".view_collaborations").showIf(g&&g.permissions&&g.permissions.manage_grades);h.removeClass("to_be_hidden");h.toggleClass("addable_content_panel",!!(b.context&&b.context.permissions&&b.context.permissions.create_collaborations));h.data("node",c);h.show()}else if(c.hasClass("groups")){h=$("#groups_panel");g=b.context;u=$("."+b.context_string+"_groups_url").attr("href");h.find(".category_name").text(b.name);h.find(".context_name").text(g.name);h.find(".breadcrumb").empty().append(f.breadcrumb());
h.find(".groups_link").attr("href",u);h.removeClass("to_be_hidden");g&&g.permissions&&g.permissions.read_roster&&h.toggleClass("addable_content_panel",true);h.show()}if(!o){var s=0,v=c.children("ul").children("li.node,li.leaf").length;e.already_cleared=true;setTimeout(function(){var w=false;c.children("ul").children("li.node,li.leaf").each(function(){s++;if(s<f.nodeClumpSize)if(newItem=f.addContentItem($(this),true))w=true});i.find("li.folder_item").show();v>=f.nodeClumpSize&&f.addScrollCatcher();
w&&f.refreshContentListeners();if(c.children("ul").children("li.node,li.leaf").length===0||c.hasClass("folder")&&!b.includes_files){if(c.hasClass("folder")&&!b.includes_files){r.addClass("no_content");r.text(k.t("messages.loading_files","Loading Files..."));f.getFilesForFolder(b,function(y){y.files.length>0?f.refreshView():i.find(".message.no_content").remove()})}if(i.find(".message.no_content").length===0){if(c.hasClass("collaborations")){var A="";if(b.context.permissions.create_collaborations)A=
"<p>"+k.t("descriptions.collaborations2","To find out more about a particular type of collaboration, click &quot;New collaboration&quot; and then choose that type in the dropdown list.")+"</p>";r.html(['<div class="ui-state-highlight" style="padding:1em;"><p>',k.t("descriptions.collaborations","Collaborations are a way for you to use web-based tools like Google Docs and EtherPad to work collaboratively on tasks like group papers or note-taking.  This is a special folder that shows you any collaborations you have created so you have an easy place to keep track of and create those collaborations"),
"</p>",A,"</div><p>",k.t("messages.no_collaborations","There are no collaborations to show"),"</p>"].join("").replace("Google Docs",'<a href="http://docs.google.com">Google Docs</a>').replace("EtherPad",'<a href="http://www.etherpad.org">EtherPad</a>'))}i.append(r)}}e()},10)}}else if(c.hasClass("file")){h=$("#file_panel");o=null;b.unlock_at_string=$.parseFromISO(b.unlock_at).datetime_formatted;b.lock_at_string=$.parseFromISO(b.lock_at).datetime_formatted;h.find(".lock_after").showIf(b.lock_at);h.find(".lock_until").showIf(b.unlock_at);
h.find(".currently_locked_box").showIf(b.currently_locked);h.find(".lock_item_link").showIf(!b.currently_locked);h.find(".unlock_item_link").showIf(b.currently_locked);h.removeClass("to_be_hidden");h.fillTemplateData({data:b});u=$.replaceTags($("#file_context_links ."+b.context_string+"_attachment_url").attr("href"),"id",b.id);g=$.replaceTags($("#file_context_links ."+b.context_string+"_download_attachment_url").attr("href"),"id",b.id);h.find(".breadcrumb").empty().append(f.breadcrumb());h.find(".attachment_url").attr("href",
u).end().find(".download_item_link").attr("href",g);h.removeClass("editable_content_panel");b&&b.permissions&&b.permissions.update&&h.addClass("editable_content_panel");h.removeClass("panel_locked");if(!b||!b.permissions||!b.permissions.download)h.addClass("panel_locked");else if(b&&b.permissions&&b.permissions.download&&$.isPreviewable(b.content_type)){o=$("#content_templates .file_scribd_preview").clone(true);o.append("<div id='doc_preview_holder'/>")}else if(b&&b.content_type.match(/image/)){o=
$("#content_templates .file_image_preview").clone(true);u=$.replaceTags($("#file_context_links ."+b.context_string+"_preview_attachment_url").attr("href"),"id",b.id);o.find("a").attr("href",g);o.find("img").attr("src",$(".preview_loading_image").attr("src")).attr("src",u||"").attr("title",b.display_name)}else{if(b&&b.content_type.match(/(video|audio)/)&&b.media_entry_id){o=$("#content_templates .file_media_preview").clone(true);o.fillTemplateData({data:b});u=b.content_type.match(/video/)?"video":
"audio";o.find(".media_preview").mediaComment("show_inline","maybe",u,g)}else{o=$("#content_templates .file_no_preview").clone(true);o.fillTemplateData({data:b})}o.find("a").attr("href",g)}h.data("node",c);h.show();if(o){o.addClass("file_preview");i.append(o);if(b.permissions&&b.permissions.download&&$.isPreviewable(b.content_type)){$("#doc_preview_holder").loadDocPreview({mimeType:b.content_type,attachment_id:b.id,height:"100%",scribd_doc_id:b.scribd_doc&&b.scribd_doc.attributes&&b.scribd_doc.attributes.doc_id,
scribd_access_key:b.scribd_doc&&b.scribd_doc.attributes&&b.scribd_doc.attributes.access_key});f.viewFile(b.context_string,b.id)}}$(window).triggerHandler("resize")}else if(c.hasClass("collaboration")){h=$("#collaboration_panel");h.find(".header .name").text(b.name);h.removeClass("to_be_hidden");u={name:b.name,updated_at:$.parseFromISO(b.updated_at).datetime_formatted,collaborator_count:(b.collaborator_ids||"").split(",").length,description:b.description,collaborator_ids:b.collaborator_ids};h.find(".breadcrumb").empty().append(f.breadcrumb());
var t=$("."+b.context_string+"_collaboration_url").attr("href");t=$.replaceTags(t,"id",b.id);h.find(".collaborations_link").attr("href",t);h.find(".edit_collaboration_link").attr("href",t);h.find(".delete_collaboration_link").attr("href",t);h.find(".view_item_link").attr("href",t);h.data("node",c);g=$("#collaboration_sub_panel");g.find(".subcontent").fillTemplateData({data:u});g.removeClass("to_be_hidden");g.find(".subcontent .collaboration_icon").hide();g.find(".subcontent .google_docs_icon").showIf(b.collaboration_type==
"google_docs");g.find(".subcontent .etherpad_icon").showIf(b.collaboration_type=="etherpad");g.find(".view_item_link").attr("href",t);g.find(".collaborators").empty();u=(u.collaborator_ids||[]).split(",");for(o in u){t=$("."+b.context_string+"_user_list:first .collaborator_"+u[o]).clone(true);t.find(":checkbox").remove();g.find(".collaborators").append(t)}i.find(".content_panel:last").after(g);h.show();h.removeClass("editable_content_panel");b&&b.permissions&&b.permissions.update&&h.addClass("editable_content_panel")}e.already_cleared||
e()}});$("#files_structure_list > li.context").show();$("#files_structure_list .context").length==1&&f.expandFolder($("#files_structure_list .context"))},500);$(window).bind("resize",function(){var a=l.offset().top;a=$(window).height()-a;var c=$("#section-tabs").height();l.height(Math.max(c,a-142));i.height(Math.max(c,a-142));a=i.height();c=$("#file_panel").outerHeight();$("#doc_preview_holder").height(a-c)});$(".folder_item .edit_collaboration_link, #collaboration_panel .edit_collaboration_link").click(function(a){a.preventDefault();
a.stopPropagation();$("#edit_collaboration_form").attr("action",$(this).attr("href"));$("#edit_collaboration_form").attr("method","PUT");$("#edit_collaboration_form .submit_button").text(k.t("buttons.update_collaboration","Update Collaboration"));$("#edit_collaboration_form .add_collaboration").hide();if(!(i.find(".add_form:visible").length>0)){i.children(".message").remove();a=f.itemData($(this).parents(".folder_item,#collaboration_panel"));var c=a.context_string;$("#edit_collaboration_dialog").data("context_string",
c);c=$("."+c+"_user_list:first").clone(true);var e=(a.collaborator_ids||"").split(",");$("#edit_collaboration_form").fillFormData(a,{object_name:"collaboration"});c.find(".collaborator input").each(function(){$(this).attr("id",$(this).attr("class"));var b=$(this).parent("li.collaborator").getTemplateData({textValues:["user_id"]}).user_id;$.inArray(b,e)!=-1&&$(this).attr("checked",true)});$("#edit_collaboration_dialog .collaborator_list").empty().append(c);$("#edit_collaboration_dialog").dialog("close").dialog({autoOpen:false,
title:k.t("titles.edit_collaboration","Edit Collaboration"),width:500}).dialog("open")}});$("#collaborations_panel .add_collaboration_link").click(function(a){a.preventDefault();$("#edit_collaboration_form").attr("action",$(this).attr("href"));$("#edit_collaboration_form").attr("method","POST");$("#edit_collaboration_form .submit_button").text(k.t("buttons.add_collaboration","Add Collaboration"));$("#edit_collaboration_form .add_collaboration").show();$("#collaboration_collaboration_type").triggerHandler("change");
if(!(i.find(".add_form:visible").length>0)){i.children(".message").remove();a=f.itemData($("#collaborations_panel").data("node"));a.title="";a.description="";$("#edit_collaboration_form").fillFormData(a,{object_name:"collaboration"});a=a.context_string;$("#edit_collaboration_dialog").data("context_string",a);a=$("."+a+"_user_list:first").clone(true);a.find(".collaborator input").each(function(){$(this).attr("id",$(this).attr("class"))});$("#edit_collaboration_dialog .collaborator_list").empty().append(a);
$("#edit_collaboration_dialog").dialog("close").dialog({autoOpen:false,title:k.t("titles.add_collaboration","Add New Collaboration"),width:500}).dialog("open")}});$("#folder_panel .download_zip").click(function(a){a.preventDefault();INST.downloadFolderFiles($(this).find(".download_zip_link").attr("href"))});$("#edit_collaboration_dialog").find(".select_all_link,.deselect_all_link").click(function(a){a.preventDefault();var c=$(this);$("#edit_collaboration_dialog .collaborator_list :checkbox").each(function(){$(this).attr("checked",
c.hasClass("select_all_link"))})});$("#edit_collaboration_dialog .cancel_button").click(function(){$("#edit_collaboration_dialog").dialog("close")});$("#edit_collaboration_form").formSubmit({beforeSubmit:function(){$(this).loadingImage()},success:function(a){var c=$("#edit_collaboration_dialog").data("context_string");$("#edit_collaboration_dialog").dialog("close");f.updateCollaboration(c,a);$(this).loadingImage("remove")},error:function(a){$(this).loadingImage("remove");$(this).formErrors(a)}});
$("#collaboration_collaboration_type").change(function(){$("#edit_collaboration_dialog .collaboration_description").hide();$("#edit_collaboration_dialog #"+$(this).val()+"_description").show();$("#edit_collaboration_dialog .collaborate_data").show();$("#edit_collaboration_dialog .collaboration_authorization").hide();if($(this).val()=="google_docs"&&$("#edit_collaboration_dialog #collaborate_authorize_google_docs").length>0){$("#edit_collaboration_dialog .collaborate_data").hide();$("#edit_collaboration_dialog #collaborate_authorize_google_docs").show()}}).triggerHandler("change");
$(".folder_item .edit_item_content_link").click(function(a){a.preventDefault();a.stopPropagation();a=$(this).parents(".folder_item,#file_panel,#folder_panel");var c=f.itemData(a),e=a.find(".download_url").attr("href"),b=a.find(".name:first").text(),h=$("#edit_content_dialog");h.data("update_url",a.find(".rename_item_link").attr("href")).data("content_type",c.content_type||"").data("filename",c.filename||"file_to_update");h.find(".display_name").text(b);h.find(".loading_message").text("Loading File Contents...").show().end().find(".content").hide();
h.dialog("close").dialog({autoOpen:false,width:600,height:410}).dialog("open");$.ajax({dataType:"json",error:function(){h.find(".loading_message").text(k.t("errors.loading_file","Error Loading File Contents.  Please try again."))},success:function(g){g=g.body;h.find("textarea").val(g);h.find(".loading_message").hide().end().find(".content").show();h.find(".textarea").focus()},url:e.replace(/\/download/,"/contents")})});$("#edit_content_dialog .cancel_button").click(function(){$("#edit_content_dialog").dialog("close")});
$("#edit_content_dialog .save_button").click(function(){var a=$("#edit_content_dialog");a.find("button").attr("disabled",false).filter(".save_button").text(k.t("buttons.update_file","Update File"));a.find("button").attr("disabled",true).filter(".save_button").text(k.t("messages.updating_file","Updating File..."));var c=f.currentItemData().context_string;$.ajaxFileUpload({url:a.data("update_url"),method:"PUT",binary:false,data:{"attachment[uploaded_data]":{fake_file:true,name:a.data("filename"),content_type:a.data("content_type"),
content:a.find("textarea").val()}},success:function(e){a.find("button").attr("disabled",false).filter(".save_button").text(k.t("buttons.update_file","Update File"));f.updateFile(c,e);a.dialog("close")},error:function(){a.find("button").attr("disabled",false).filter(".save_button").text(k.t("errors.update_file_failed","Updating File Failed, please try again"))}})});$(".folder_item .preview_item_link").click(function(a){a.preventDefault();a.stopPropagation();f.selectFolder($(this).parents(".folder_item").data("node"))});
$(".folder_item .rename_item_link,#file_panel .rename_item_link,#folder_panel .rename_item_link").click(function(a){a.preventDefault();a.stopPropagation();a=$(this).parents(".folder_item,#file_panel,#folder_panel");var c=a.getTemplateData({textValues:["name"]}).name;a.find(".name").hide().after($("#rename_entry_field"));$("#rename_entry_field").val(c).focus().select();$(this).blur()});$("#rename_entry_field").bind("blur",function(a,c){var e=$(this).parents(".folder_item,#file_panel,#folder_panel");
if(e.length!==0){var b=e.getTemplateData({textValues:["name"]}).name,h=$(this).val();if(c!==false&&h!=""&&b!=h){e.find(".name").text(h);b=f.itemData(e.data("node"));var g=b.root_context_string;if(e.hasClass("folder")||e.attr("id")=="folder_panel"){b=$.replaceTags($("#file_context_links ."+g+"_folder_url").attr("href"),"id",b.id);$.ajaxJSON(b,"PUT",{"folder[name]":h},function(o){f.updateFolder(g,{folder:o.folder,already_in_place:true})},function(){})}else{b=$.replaceTags($("#file_context_links ."+
g+"_attachment_url").attr("href"),"id",b.id);$.ajaxJSON(b,"PUT",{"attachment[display_name]":h},function(o){f.updateFile(g,o)},function(){})}}e.find(".name").show();$(this).val("").appendTo($("#file_context_links"));$(this).triggerHandler("blur",false)}});$("#rename_entry_field").keycodes("return esc",function(a){$(this).triggerHandler("blur",a.keyString=="return")});$(".folder_item .delete_item_link,#folder_panel .delete_item_link,#file_panel .delete_item_link").click(function(a){a.preventDefault();
a.stopPropagation();var c=f.itemData($(this).parents(".folder_item"));c=c||f.itemData($(this).parents("#folder_panel,#file_panel").data("node"));$(this).parents(".folder_item").hasClass("file");$(this).parents(".folder_item").hasClass("collaboration");$(this).parents(".folder_item").confirmDelete({message:$(this).parents(".folder_item").hasClass("folder")||$(this).hasClass("folder_url")?k.t("prompts.delete_folder","Are you sure you want to delete this folder and all of its contents?"):k.t("prompts.delete_file",
"Are you sure you want to delete this file?"),url:$(this).attr("href"),success:function(){l.find(".file_"+c.id+",.folder_"+c.id).filter(".active-node,.active-leaf").length>0&&f.selectFolder(l.find(".file_"+c.id+",.folder_"+c.id).filter(".active-node,.active-leaf").parent("ul").parent("li"));l.find(".file_"+c.id).prev("li.separator").remove();l.find(".file_"+c.id).remove();l.find(".folder_"+c.id).prev("li.separator").remove();l.find(".folder_"+c.id).remove();l.find(".collaboration_"+c.id).prev("li.separator").remove();
l.find(".collaboration_"+c.id).remove();f.refreshView();f.updateQuota();$(this).slideUp(function(){$(this).remove()})}})});$(".folder_item:not(.add_item)").click(function(a){var c=$(this);a.preventDefault();if(!(i.filter(".dragging").length>0))if(!($(this).find("#rename_entry_field").length>0)){a.stopPropagation();c.data("parent_node")&&f.expandFolder(c.data("parent_node"));setTimeout(function(){if(c.hasClass("folder")){f.expandFolder(c.data("node"));var e=function(){f.refreshView();$(this).unbind("files_load",
e)};c.data("node").bind("files_load",e);c.data("node").children(".text").click()}else if(c.hasClass("collaboration"))c.data("node").children(".text").click();else{c.find(".name").focus();location.href=c.find(".download_url").attr("href")}},50)}});$(".folder_item").hover(function(){$(".folder_item_hover").removeClass("folder_item_hover");$(this).addClass("folder_item_hover")},function(){});$("#folder_panel .add_file_link").click(function(a){a.preventDefault();if(!(i.find(".add_form:visible").length>
0)){a=$("#add_file_form").clone(true).removeAttr("id");i.children(".message").remove();i.append(a);i.scrollToVisible(a);var c=f.currentItemData();a.fillFormData({folder_id:c.id},{object_name:"attachment"});a.find("form").attr("action",$("#file_context_links ."+c.context_string+"_attachments_url").attr("href")+".text");a.mouseover();a.find(":text:first").focus().select()}});$("#folder_panel .add_folder_link").click(function(a){a.preventDefault();if(!(i.find(".add_form:visible").length>0)){a=$("#add_folder_form").clone(true).removeAttr("id");
i.children(".message").remove();i.find("#folder_panel.addable_content_panel").after(a);i.scrollToVisible(a);var c=f.currentItemData();a.fillFormData({parent_folder_id:c.id},{object_name:"folder"});a.find("form").attr("action",$("#file_context_links ."+c.context_string+"_folders_url").attr("href"));a.mouseover();a.find(":text:first").focus().select()}});$("#add_folder_form :text").keycodes("esc",function(a){a.keyString=="esc"&&$(this).trigger("blur",true)});$("#add_folder_form :text").bind("blur",
function(a,c){if(c)$(this).parents("li").remove();else $.trim($(this).val())&&$(this).parents("form").trigger("submit")});$("#add_folder_form .add_folder_form").formSubmit({beforeSubmit:function(a){if($(this).hasClass("submitting"))return false;$(this).addClass("submitting");$(this).find(".name").show().text(a["folder[name]"]);$(this).find(":text").hide();$(this).data("root_context_string",f.currentItemData().root_context_string)},success:function(a){$(this).removeClass("submitting");for(var c in j)j[c][0].context_string==
$(this).data("root_context_string")&&j[c][1].folders.push(a);c=a.folder;var e=l.find(".folder_blank").clone(true).removeClass("folder_blank");e.addClass("folder folder_"+c.id);e.fillTemplateData({data:{name:c.name,id:c.id}});var b=l.find(".folder_"+c.parent_folder_id);b.children("ul").append("<li class='separator'/>");b.children("ul").append(e.show());f.updateFolder($(this).data("root_context_string"),a);$(this).parents("li").remove();e.find("span").droppable(f.droppable_options);f.refreshView(c)},
error:function(a){$(this).removeClass("submitting");$(this).formErrors(a)}});$("#add_file_form .add_file_form").formSubmit({fileUpload:true,beforeSubmit:function(){$(this).data("context_string",f.currentItemData().context_string);$(this).find(".loading_message").slideDown()},success:function(a){$(this).parents("li").remove();f.updateFile($(this).data("context_string"),a);f.updateQuota()},error:function(a){$(this).find(".loading_message").slideUp();$(this).formErrors(a)}});$("#add_file_form .cancel_button").click(function(){$(this).parents("li").remove()});
$(".folder_item .lock_item_link,#file_panel .lock_item_link,#folder_panel .lock_item_link").click(function(a){a.preventDefault();a.stopPropagation();a="attachment";var c=$("#lock_attachment_form"),e=$(this).parents(".folder_item,#file_panel,#folder_panel"),b=f.itemData(e)||f.itemData(e.data("node")),h=$(this).attr("href");if(e.hasClass("folder")||$(this).parents("#folder_panel").length>0){a="folder";c=$("#lock_folder_form")}c.attr("action",h);c.data("context_string",b.context_string);$("#lock_item_dialog form").hide();
c.show();b.lock_at=$.parseFromISO(b.last_lock_at).datetime_formatted;b.unlock_at=$.parseFromISO(b.last_unlock_at).datetime_formatted;b.locked=!b.lock_at&&!b.unlock_at?"1":"0";$("#lock_item_dialog").fillTemplateData({data:{name:b.name}});c.fillFormData(b,{object_name:a});c.find("#folder_just_hide,#attachment_just_hide").attr("checked",false).change();c.find(".item_type").text(a);$("#lock_item_dialog").dialog("close").dialog({autoOpen:true,modal:true,width:350,title:a=="folder"?k.t("titles.lock_folder",
"Lock Folder"):k.t("titles.lock_file","Lock File")}).dialog("open")});$("#folder_just_hide,#attachment_just_hide").change(function(){$(this).parents("form").find(".full_lock").showIf(!$(this).attr("checked"));$(this).parents("form").find(".lock_checkbox").change()}).change();$("#lock_item_dialog .cancel_button").click(function(){$("#lock_item_dialog").dialog("close")});$("#lock_item_dialog .lock_checkbox").change(function(){$(this).parents("table").find(".lock_range").showIf(!$(this).attr("checked"))}).change();
$("#lock_attachment_form").formSubmit({processData:function(a){return a},beforeSubmit:function(){$(this).loadingImage()},success:function(a){$(this).loadingImage("remove");$("#lock_item_dialog").dialog("close");f.updateFile($(this).data("context_string"),a)}});$("#lock_folder_form").formSubmit({processData:function(a){return a},beforeSubmit:function(){$(this).loadingImage()},success:function(a){$(this).loadingImage("remove");$("#lock_item_dialog").dialog("close");f.updateFolder($(this).data("context_string"),
{folder:a.folder,already_in_place:true})}});$(".folder_item .unlock_item_link,#file_panel .unlock_item_link,#folder_panel .unlock_item_link").click(function(a){a.preventDefault();a.stopPropagation();var c="attachment";$("#lock_attachment_form");var e=$(this).parents(".folder_item,#file_panel,#folder_panel"),b=f.itemData(e)||f.itemData(e.data("node"));a=$(this).attr("href");if(e.hasClass("folder")||$(this).parents("#folder_panel").length>0){c="folder";$("#lock_folder_form");a=e.find(".folder_url").attr("href")}e.loadingImage();
var h={};h["["+c+"][locked]"]="";h["["+c+"][hidden]"]="";h["["+c+"][lock_at]"]="";h["["+c+"][unlock_at]"]="";e.loadingImage();$.ajaxJSON(a,"PUT",h,function(g){e.loadingImage("remove");c=="attachment"?f.updateFile(b.context_string,g):f.updateFolder(b.context_string,{folder:g.folder,already_in_place:true})},function(){e.loadingImage("remove")})});if(location.hash===""||location.hash=="#"){var d=$("#files_structure_list .context:first .name:first").text();location.href="#"+encodeURIComponent(d)}$(document).fragmentChange(function(a,
c){setTimeout(function(){f.selectNodeFromPath(c.substring(1));l.scrollToVisible($("li.active-node,li.active-leaf").find("span.name").filter(":first"))},100)}).fragmentChange();setTimeout(function(){$(window).triggerHandler("resize");$("#file_swf").uploadify({fileDataName:"file",uploader:"/flash/uploadify/uploadify.swf",buttonText:"testing",folder:"no_idea",script:"s3_url",scriptAccess:"always",multi:true,auto:false,sizeLimit:10737418240,simUploadLimit:1,buttonText:"",hideButton:true,wmode:"transparent",
width:60,height:22,cancelImg:"/images/blank.png",onInit:function(){p.text(k.t("links.add_files","Add Files")).triggerHandler("show")},onSelect:m.swfFileQueue,onSelectOnce:m.swfFileQueueOnce,onCancel:m.swfCancel,onClearQueue:m.swfQueueClear,onError:m.swfFileError,onOpen:m.swfFileOpen,onProgress:m.swfFileProgress,onComplete:m.swfFileComplete,onAllComplete:m.swfQueueComplete})},1E3)})})();var m={ajaxUploadCount:0,swfUploadCount:0,queuedAjaxUploads:[],currentlyUploading:false,status_status:"hidden",status_request:"hidden",
showStatus:function(){m.status_request="shown";if(m.status_status=="hidden"){m.status_status="showing";$("#file_uploads_progress").slideDown(null,null,function(){setTimeout(function(){m.status_status="shown";m.status_request=="hidden"&&m.hideStatus()},3E3)})}},hideStatus:function(){m.status_request="hidden";if(m.status_status=="shown"){m.status_status="hiding";$("#file_uploads_progress").slideUp(null,null,function(){m.status_status="hidden";m.status_request=="shown"&&m.showStatus()})}},queueAjaxUpload:function(i,
q){m.ajaxUploadCount=m.queuedAjaxUploads.length;var p={file:i,folder_id:q,name:i.name},l=m.initFile(p);l.data("folder",f.currentItemData());l.find(".status").text("Queued");m.queuedAjaxUploads.push(p);m.updateUploadCount();m.uploadAjaxFiles()},uploadAjaxFiles:function(i){if(!(m.currentlyUploading&&!i))if(i=m.queuedAjaxUploads.shift()){m.currentlyUploading=true;var q=m.initFile(i);q.find(".status").text("Uploading");q.find(".progress_bar").progressbar("value",10);var p=q.data("folder"),l=i.file;$.ajaxFileUpload({url:$("."+
p.context_string+"_attachments_url").attr("href"),data:{"attachment[uploaded_data]":l,"attachment[display_name]":l.name,"attachment[folder_id]":p.id,duplicate_handling:i.file.duplicate_handling},method:"POST",success:function(n){setTimeout(function(){m.uploadAjaxFiles(true)},500);var d=n.attachment;$.underscore(d.context_type);q.find(".cancel_upload_link").hide().end().find(".status").text(k.t("messages.done_uploading","Done uploading"));q.addClass("done");setTimeout(function(){q.slideUp(function(){q.remove()})},
5E3);n.deleted_attachment_ids&&f.deleteAttachmentIds(n.deleted_attachment_ids);f.updateFile(d.context_code,n)},error:function(){setTimeout(function(){m.uploadAjaxFiles(true)},500);q.find(".status").text(k.t("#errors.failed","Failed")).end().find(".cancel_upload_link").hide()}})}else{m.currentlyUploading=false;m.ajaxUploadCount=0;m.updateUploadCount()}},updateUploadCount:function(){m.ajaxUploadCount=m.queuedAjaxUploads.length;m.currentlyUploading&&m.ajaxUploadCount++;var i=m.swfFiles.length+m.ajaxUploadCount,
q=$("#file_uploads .file_upload.errored:visible").length;if(i===0&&q==0){m.hideStatus();var p=$("#file_upload_blank").clone(true).removeAttr("id").addClass("finished_message").empty();p.text("Finished uploading all files");if(!$("#file_uploads .file_upload:visible:first").hasClass("finished_message")){$("#file_uploads").prepend(p);p.slideDown("fast")}p.addClass("finished_message");p.click(function(){$(this).slideUp(function(){$(this).remove()})});setTimeout(function(){p.slideUp(function(){p.remove()})},
5E3)}else{$("#file_uploads_dialog_link").text(k.t("messages.uploading_files",{one:"Uploading 1 File...",other:"Uploading %{count} Files..."},{count:i}));i===0&&$("#file_uploads_dialog_link").text(k.t("messages.error_count",{one:"1 Error",other:"%{count} Errors"},{count:q}));m.showStatus()}},fileDialogComplete:function(i,q){try{q>0&&this.startUpload()}catch(p){this.debug(p)}},fileQueued:function(i){i=m.initFile(i);i.data("folder",f.currentItemData());i.find(".status").text(k.t("messages.queue","Queued"));
m.updateSwfUploadCount(this.getStats().files_queued)},fileQueueError:function(i,q,p){i=m.initFile(i);i.find(".status").text(k.t("errors.failed","Failed")).end().find(".cancel_upload_link").hide();i.append(p)},swfPreQueued:[],swfQueuedAndPendingFiles:[],swfFiles:[],swfFileQueueOnce:function(i){var q=m.swfPreQueued;m.swfPreQueued=[];var p=f.currentItemData(),l=[];for(idx in q)l.push(q[idx].name);f.preflight(p.id,p.context_string,l,function(n){for(idx in q)q[idx].duplicate_handling=n},function(){for(idx in q){var n=
q[idx];m.swfFileQueueReal(i,n.id,n)}},function(){for(idx in q)$("#file_swf").uploadifyCancel(q[idx].id)})},swfFileQueue:function(i,q,p){p.id=q;m.swfPreQueued.push(p)},swfFileQueueReal:function(i,q,p){p.id=q;var l=m.initFile(p);l.data("folder",f.currentItemData());l.find(".status").text(k.t("messages.queued","Queued"));m.swfFiles.push(p);i=l.data("folder");var n={"attachment[folder_id]":i.id,"attachment[filename]":p.name,"attachment[context_code]":i.context_string,no_redirect:true,"attachment[duplicate_handling]":p.duplicate_handling};
$("#file_swf").uploadifySettings("folder",""+i.id);m.updateUploadCount();$.ajaxJSON("/files/pending","POST",n,function(d){p.upload_url=d.proxied_upload_url||d.upload_url;d.upload_params.key=encodeURIComponent(d.upload_params.key);d.upload_params.Signature=encodeURIComponent(d.upload_params.Signature);p.upload_params=d.upload_params;l.data("success_url",d.success_url);if(!l.hasClass("done")){m.swfQueuedAndPendingFiles.push(p);m.swfUploadNext()}m.updateUploadCount()},function(){$("#file_swf").uploadifyCancel(q);
l.find(".cancel_upload_link").hide().end().find(".status").text("Upload Failed")})},swfUploadNext:function(){if(m.swfQueuedAndPendingFiles.length>0)if(file=m.swfQueuedAndPendingFiles.shift()){$("#file_swf").uploadifySettings("script",file.upload_url);$("#file_swf").uploadifySettings("scriptData",file.upload_params);$("#file_swf").uploadifyUpload(file.id)}m.updateUploadCount()},swfCancel:function(i,q,p){p.id=q;i=m.initFile(p);$("#file_uploads_dialog_link").text(k.t("errors.uploading","Uploading Error"));
i.addClass("done");if(!i.hasClass("errored")&&!i.hasClass("error_cancelled")){i.find(".cancel_upload_link").hide().end().find(".status").text("Cancelled");m.swfFiles=$.grep(m.swfFiles,function(l){return l.id!=p.id})}m.swfUploadNext();return false},swfQueueClear:function(){},swfFileError:function(i,q,p,l,n){n=typeof n!="undefined"?n:true;p.id=q;var d=m.initFile(p);setTimeout(function(){d.addClass("error_cancelled");n&&$("#file_swf").uploadifyCancel(q)},50);m.swfFiles=$.grep(m.swfFiles,function(a){return a.id!=
p.id});$("#file_uploads_dialog_link").text(k.t("errors.uploading","Uploading Error"));m.showStatus();d.find(".cancel_upload_link").hide().end().find(".status").text(k.t("errors.failed_uploading","Failed uploading: %{error_info}",{error_info:l.info}));d.addClass("done").addClass("errored");m.swfUploadNext();return false},swfFileOpen:function(i,q,p){p.id=q;i=m.initFile(p);p.upload_url&&$("#file_swf").uploadifySettings("script",p.upload_url);p.upload_params&&$("#file_swf").uploadifySettings("scriptData",
p.upload_params);m.swfQueuedAndPendingFiles=$.grep(m.swfQueuedAndPendingFiles,function(l){return l.id!=p.id});i.find(".progress_bar").progressbar("value",1);i.find(".status").text(k.t("messages.uploading","Uploading"))},swfFileProgress:function(i,q,p,l){p.id=q;i=m.initFile(p);i.find(".status").text(k.t("messages.uploading_with_speed","Uploading (%{speed}KB/s)",{speed:parseInt(l.speed,10)}));i.find(".cancel_upload_link").showIf(l.percentage<100);i.find(".progress_bar").progressbar("value",l.percentage)},
swfFileComplete:function(i,q,p,l,n){p.id=q;var d=m.initFile(p);if(l.indexOf("<PostResponse>")>=0){d.find(".status").text(k.t("messages.finalizing","Finalizing"));var a=function(){m.swfFileError({},p.id,p,{type:"server",info:k.t("errors.unexpected_response","didn't get back expected response")})};$.ajaxJSON(d.data("success_url"),"GET",{},function(b){if(b&&b.attachment){m.swfFileComplete({},p.id,p,JSON.stringify(b),{});b.deleted_attachment_ids&&f.deleteAttachmentIds(b.deleted_attachment_ids)}else a()},
a)}else{m.swfFiles=$.grep(m.swfFiles,function(b){return b.id!=p.id});d.find(".status").text(k.t("messages.upload_complete","Done uploading"));d.find(".cancel_upload_link").remove();d.find(".progress_bar").progressbar("value",100);d.addClass("done");var c=d.data("folder").context_string;setTimeout(function(){d.slideUp(function(){d.remove()})},5E3);if(l)try{n=$.parseJSON(l);if("errors"in n&&!jQuery.isEmptyObject(n.errors))m.swfFileError(i,q,p,{type:"server",info:JSON.stringify(n.errors)},false);else{n.swf=
true;setTimeout(function(){n.deleted_attachment_ids&&f.deleteAttachmentIds(n.deleted_attachment_ids);f.updateFile(c,n)},500)}}catch(e){m.swfFileError(i,q,p,{type:"JS",info:e.toString()},false)}else d.find(".status").text(k.t("warnings.file_uploaded_without_response","File may have uploaded, but the server failed to respond.  Reload the page to confirm."));m.swfUploadNext()}},swfQueueComplete:function(){m.updateUploadCount()},initFile:function(i){if(!i.id)i.id="tmp_"+Math.round(Math.random()*9999);
var q=$("#file_upload_"+i.id);if(q.length===0){q=$("#file_upload_blank").clone(true).attr("id","file_upload_"+i.id);$("#file_uploads").append(q);q.find(".progress_bar").progressbar();q.click(function(p){if($(this).find(".cancel_upload_link:visible").length===0&&$(this).hasClass("done")){p.preventDefault();$(this).slideUp(function(){$(this).remove();m.updateUploadCount()})}});q.find(".cancel_upload_link").click(function(p){p.preventDefault();($(this).parents(".file_upload").attr("id")||"").substring(12);
$("#file_swf").uploadifyCancel(i.id)})}q.find(".file_name").text(i.name);q.slideDown("fast");return q},attempt:0,file_details:{}}});
jQuery&&function(k){k.extend(k.fn,{uploadify:function(f){k(this).each(function(){var j=k.extend({id:k(this).attr("id"),uploader:"uploadify.swf",script:"uploadify.php",expressInstall:null,folder:"",height:30,width:120,cancelImg:"cancel.png",wmode:"opaque",scriptAccess:"sameDomain",fileDataName:"Filedata",method:"POST",queueSizeLimit:999,simUploadLimit:1,queueID:false,displayData:"percentage",removeCompleted:true,onInit:function(){},onSelect:function(){},onSelectOnce:function(){},onQueueFull:function(){},
onCheck:function(){},onCancel:function(){},onClearQueue:function(){},onError:function(){},onProgress:function(){},onComplete:function(){},onAllComplete:function(){}},f);k(this).data("settings",j);var m=location.pathname;m=m.split("/");m.pop();m=m.join("/")+"/";var i={};i.uploadifyID=j.id;i.pagepath=m;if(j.buttonImg)i.buttonImg=escape(j.buttonImg);if(j.buttonText)i.buttonText=escape(j.buttonText);if(j.rollover)i.rollover=true;i.script=j.script;i.folder=escape(j.folder);if(j.scriptData){var q="",p;
for(p in j.scriptData)q+="&"+p+"="+j.scriptData[p];i.scriptData=escape(q.substr(1))}i.width=j.width;i.height=j.height;i.wmode=j.wmode;i.method=j.method;i.queueSizeLimit=j.queueSizeLimit;i.simUploadLimit=j.simUploadLimit;if(j.hideButton)i.hideButton=true;if(j.fileDesc)i.fileDesc=j.fileDesc;if(j.fileExt)i.fileExt=j.fileExt;if(j.multi)i.multi=true;if(j.auto)i.auto=true;if(j.sizeLimit)i.sizeLimit=j.sizeLimit;if(j.checkScript)i.checkScript=j.checkScript;if(j.fileDataName)i.fileDataName=j.fileDataName;
if(j.queueID)i.queueID=j.queueID;if(j.onInit()!==false){k(this).css("display","none");k(this).after('<div id="'+k(this).attr("id")+'Uploader"></div>');swfobject.embedSWF(j.uploader,j.id+"Uploader",j.width,j.height,"9.0.24",j.expressInstall,i,{quality:"high",wmode:j.wmode,allowScriptAccess:j.scriptAccess},{},function(n){if(typeof j.onSWFReady=="function"&&n.success)j.onSWFReady()});j.queueID==false?k("#"+k(this).attr("id")+"Uploader").after('<div id="'+k(this).attr("id")+'Queue" class="uploadifyQueue"></div>'):
k("#"+j.queueID).addClass("uploadifyQueue")}typeof j.onOpen=="function"&&k(this).bind("uploadifyOpen",j.onOpen);k(this).bind("uploadifySelect",{action:j.onSelect,queueID:j.queueID},function(n,d,a){if(n.data.action(n,d,a)!==false){var c=Math.round(a.size/1024*100)*0.01,e="KB";if(c>1E3){c=Math.round(c*0.1)*0.01;e="MB"}c=c.toString().split(".");c=c.length>1?c[0]+"."+c[1].substr(0,2):c[0];fileName=a.name.length>20?a.name.substr(0,20)+"...":a.name;queue="#"+k(this).attr("id")+"Queue";if(n.data.queueID)queue=
"#"+n.data.queueID;k(queue).append('<div id="'+k(this).attr("id")+d+'" class="uploadifyQueueItem">\t\t\t\t\t\t\t\t<div class="cancel">\t\t\t\t\t\t\t\t\t<a href="javascript:jQuery(\'#'+k(this).attr("id")+"').uploadifyCancel('"+d+'\')"><img src="'+j.cancelImg+'" border="0" /></a>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t<span class="fileName">'+fileName+" ("+c+e+')</span><span class="percentage"></span>\t\t\t\t\t\t\t\t<div class="uploadifyProgress">\t\t\t\t\t\t\t\t\t<div id="'+k(this).attr("id")+d+'ProgressBar" class="uploadifyProgressBar"><\!--Progress Bar--\></div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>')}});
k(this).bind("uploadifySelectOnce",{action:j.onSelectOnce},function(n,d){n.data.action(n,d);if(j.auto)j.checkScript?k(this).uploadifyUpload(null,false):k(this).uploadifyUpload(null,true)});k(this).bind("uploadifyQueueFull",{action:j.onQueueFull},function(n,d){n.data.action(n,d)!==false&&alert("The queue is full.  The max size is "+d+".")});k(this).bind("uploadifyCheckExist",{action:j.onCheck},function(n,d,a,c,e){var b={};b=a;b.folder=c.substr(0,1)=="/"?c:m+c;if(e)for(var h in a)var g=h;k.post(d,b,
function(o){for(var r in o)if(n.data.action(n,o,r)!==false)confirm("Do you want to replace the file "+o[r]+"?")||document.getElementById(k(n.target).attr("id")+"Uploader").cancelFileUpload(r,true,true);e?document.getElementById(k(n.target).attr("id")+"Uploader").startFileUpload(g,true):document.getElementById(k(n.target).attr("id")+"Uploader").startFileUpload(null,true)},"json")});k(this).bind("uploadifyCancel",{action:j.onCancel},function(n,d,a,c,e,b){if(n.data.action(n,d,a,c,b)!==false)if(e)k("#"+
k(this).attr("id")+d).fadeOut(b==true?0:250,function(){k(this).remove()})});k(this).bind("uploadifyClearQueue",{action:j.onClearQueue},function(n,d){var a=j.queueID?j.queueID:k(this).attr("id")+"Queue";d&&k("#"+a).find(".uploadifyQueueItem").remove();n.data.action(n,d)!==false&&k("#"+a).find(".uploadifyQueueItem").each(function(){var c=k(".uploadifyQueueItem").index(this);k(this).delay(c*100).fadeOut(250,function(){k(this).remove()})})});var l=[];k(this).bind("uploadifyError",{action:j.onError},function(n,
d,a,c){if(n.data.action(n,d,a,c)!==false){l.push([d,a,c]);k("#"+k(this).attr("id")+d).find(".percentage").text(" - "+c.type+" Error");k("#"+k(this).attr("id")+d).find(".uploadifyProgress").hide();k("#"+k(this).attr("id")+d).addClass("uploadifyError")}});typeof j.onUpload=="function"&&k(this).bind("uploadifyUpload",j.onUpload);k(this).bind("uploadifyProgress",{action:j.onProgress,toDisplay:j.displayData},function(n,d,a,c){if(n.data.action(n,d,a,c)!==false){k("#"+k(this).attr("id")+d+"ProgressBar").animate({width:c.percentage+
"%"},250,function(){c.percentage==100&&k(this).closest(".uploadifyProgress").fadeOut(250,function(){k(this).remove()})});if(n.data.toDisplay=="percentage")displayData=" - "+c.percentage+"%";if(n.data.toDisplay=="speed")displayData=" - "+c.speed+"KB/s";if(n.data.toDisplay==null)displayData=" ";k("#"+k(this).attr("id")+d).find(".percentage").text(displayData)}});k(this).bind("uploadifyComplete",{action:j.onComplete},function(n,d,a,c,e){if(n.data.action(n,d,a,unescape(c),e)!==false){k("#"+k(this).attr("id")+
d).find(".percentage").text(" - Completed");j.removeCompleted&&k("#"+k(n.target).attr("id")+d).fadeOut(250,function(){k(this).remove()});k("#"+k(n.target).attr("id")+d).addClass("completed")}});typeof j.onAllComplete=="function"&&k(this).bind("uploadifyAllComplete",{action:j.onAllComplete},function(n,d){if(n.data.action(n,d)!==false)l=[]})})},uploadifySettings:function(f,j,m){var i=false;k(this).each(function(){if(f=="scriptData"&&j!=null){var d=m?j:k.extend(k(this).data("settings").scriptData,j),
a="",c;for(c in d)a+="&"+c+"="+d[c];j=escape(a.substr(1))}i=document.getElementById(k(this).attr("id")+"Uploader").updateSettings(f,j)});if(j==null)if(f=="scriptData"){for(var q=unescape(i).split("&"),p={},l=0;l<q.length;l++){var n=q[l].split("=");p[n[0]]=n[1]}i=p}return i},uploadifyUpload:function(f,j){k(this).each(function(){j||(j=false);document.getElementById(k(this).attr("id")+"Uploader").startFileUpload(f,j)})},uploadifyCancel:function(f){k(this).each(function(){document.getElementById(k(this).attr("id")+
"Uploader").cancelFileUpload(f,true,true,false)})},uploadifyClearQueue:function(){k(this).each(function(){document.getElementById(k(this).attr("id")+"Uploader").clearFileUploadQueue(false)})}})}(jQuery);
$.extend(true,I18n=I18n||{},{translations:{es:{files:{descriptions:{collaborations2:"Para saber m\u00e1s acerca de un tipo en particular de colaboraci\u00f3n, haga click en &quot;Nueva Colaboraci\u00f3n&quot; y luego escoja el tipo de la lista desplegable.",collaborations:"Colaboraciones son una forma para usar herramientas en l\u00ednea como Google Docs y Etherpad para trabajar colaborativamente en tareas como trabajos en grupo y toma de notas. Esta es una carpeta especial que muestra cualquier colaboraci\u00f3n que ha creado para poder tener un lugar para seguir y crear estas colaboraciones"},buttons:{update_collaboration:"Actualizar la Colaboraci\u00f3n",
add_collaboration:"Agregue la Colaboraci\u00f3n",update_file:"Actualice el Archivo"},messages:{loading_files:"Cargando los archivos...",uploading_with_speed:"Cargando (%{speed}KB/s) ",no_files_selected:"Ning\u00fan archivo v\u00e1lido fue seleccionado",access_denied:"No puede leer el contenido de este folder.",updating_file:"Actualizando el Archivo...",upload_complete:"Carga completa",error_count:{one:"1 Error",other:"%{count} Errores"},done_uploading:"Carga completa",finalizing:"Finalizando",no_collaborations:"No hay colaboraciones que mostrar",
uploading_files:{one:"Cargando 1 Archivo...",other:"Cargando %{count} Archivos..."},uploading:"Cargando ",extraction_complete:"\u00a1Extracci\u00f3n completa! Actualizaci\u00f3n la Estructura del Archivo...",queue:"En Fila ",folder_empty:"Nada en esta Carpeta",queued:"En Fila"},alts:{folder_locked:"Carpeta Bloqueada",collaboration:"Colaboraci\u00f3n",locked_file:"Archivo Bloqueado",file:"Archivo"},warnings:{file_uploaded_without_response:"El archive puede haberse cargado, pero el servidor no ha respondido. Recargue la p\u00e1gina para confirmar."},
prompts:{duplicate_filenames:"Los archivos con los siguientes nombres ya existen en esta carpeta. \u00bfDesea reemplazarlos, o renombrarlos con nombres \u00fanicos?",delete_file:"\u00bfEst\u00e1 seguro de que quiere borrar este archivo?",delete_folder:"\u00bfEst\u00e1 seguro de que quiere borrar esta carpeta y todos sus componentes?",extract_zip:"Este archivo es un archivo comprimido zip. \u00bfDesea extraer sus contenidos en esta carpeta?"},errors:{failed_uploading:"La Carga Fall\u00f3: %{error_info} ",
loading_file:"Error Cargando los Contenidos de Archivo. Intente de nuevo.",failed:"Fall\u00f3",server_unresponsive:"El servidor dej\u00f3 de responder a las solicitudes de estatus",extracting:"Hubieron errors extrayendo el archivo zip. Intente de nuevo.",update_file_failed:"Actualizaci\u00f3n del Archivo Fall\u00f3, intente de nuevo",uploading:"Error de Carga",server_returned_invalid_status:"El servidor dej\u00f3 de reporter un est\u00e1tus v\u00e1lido",unexpected_response:"no se obtuvo una respuesta esperada"},
titles:{drag_to_move:"Arrastrar para mover a una carpeta diferente",extracting:"Extrayendo Archivos a la Carpeta",lock_folder:"Bloquear la Carpeta",edit_collaboration:"Editar la Colaboraci\u00f3n",click_and_drag:"Hacer click y arrastrar para mover la carpeta a otra carpeta",lock_file:"Bloquear el Archivo",file_uplaods_queue:"Lista de Cargas de Archivos",add_collaboration:"Agregar una Nueva Colaboraci\u00f3n"},links:{add_files:"Agregar Archivos"}},errors:{failed:"Fall\u00f3"}}}});
