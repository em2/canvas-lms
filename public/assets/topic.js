var wikiSidebar;
I18n.scoped("topics",function(h){function k(d,e){$("#add_entry_bottom").hide();var a=$("#add_entry_form").clone(true);d.attr("id")=="entry_id"&&d.attr("id","entry_new");var b=d.attr("id");a.addClass("add_entry_form_new").attr("id","add_entry_form_"+b).find(".entry_content").addClass("entry_content_new").attr("id","entry_content_"+b);var c=d.getTemplateData({textValues:["title","parent_id","attachment_name"],htmlValues:["message"]});c.message=d.find(".content > .message_html").val();if(e&&e.message)c.message=
e.message;var f=h.t("update_entry","Update Entry");a.attr("method","PUT").attr("action",d.find(".edit_entry_url").attr("href"));a.find(".entry_remove_attachment").val("0");a.find(".add_attachment").show().end().find(".no_attachment").showIf(!c.attachment_name).end().find(".current_attachment").showIf(c.attachment_name).end().find(".upload_attachment").hide().end().find(".attachment_name").text(c.attachment_name);if(d.attr("id")=="entry_new"){f=h.t("add_new_entry","Add New Entry");d.find(".user_name").text(CURRENT_USER_NAME_FOR_TOPICS).attr("href",
function(g,l){return $.replaceTags(l,"user_id",$("#identity .user_id").text())});a.attr("method","POST").attr("action",$("#topic_urls .add_entry_url").attr("href"))}a.fillFormData(c,{object_name:"discussion_entry"});d.children(".content").show().children(".subcontent").hide().end().find(".message").hide().end().append(a.show()).end().children(".header").find(".post_date").hide().end().find(".link_box").hide().end().find(".title").hide().end().prepend("<div class='add_message title' style='float: left; padding-right: 20px;'>"+
f+"</div>").show();a.find(".entry_content_new").editorBox().editorBox("set_code",c.message);if(wikiSidebar){wikiSidebar.attachToEditor(a.find(".entry_content_new"));$("#sidebar_content").hide();wikiSidebar.show()}a.find("button[type='submit']").val(f);setTimeout(function(){m("entry_content_"+b)},500);j(d);$("html,body").scrollTo(a)}function m(d){$("#"+d).editorBox("focus")||setTimeout(function(){m(d)},500)}function n(){var d=$(".add_entry_form_new"),e=d.parents(".discussion_entry");d.find(".entry_content_new").editorBox("destroy");
d.hide();if(wikiSidebar){$("#sidebar_content").show();wikiSidebar.hide()}e.children(".header").show().find(".post_date").show().end().find(".add_message").remove().end().find(".title").show().end().find(".link_box").show().end().end().children(".content").show().children(".subcontent").show().end().find(".message").show().end();d.appendTo($("body"))}function o(){var d=$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected");if(d.length===0)d=$(".discussion_topic:first").addClass("selected");
else{for(var e=$(".discussion_topic,.discussion_entry,.communication_sub_message"),a=null,b=$(".discussion_topic,.discussion_entry,.communication_sub_message").index(d.get(0))-1;b>=0;b--){var c=$(e.get(b));if(c.css("display")!="none"){a=c;break}}if(a)d=a}j(d,true)}function p(){$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected").removeClass("selected")}function j(d,e){$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected");
p();if(d.length===0)d=$(".discussion_topic:first").addClass("selected");else d.addClass("selected");if(e){$("html,body").scrollTo(d);d.mouseover();d.find(":tabbable:visible:first").focus()}}function i(d){var e=$("#entry_list").children(".discussion_entry");e.removeClass("discussion_start").removeClass("discussion_end");e.length===0?$(".discussion_topic").addClass("discussion_end"):$(".discussion_topic").removeClass("discussion_end");e.filter(":last").addClass("discussion_end");$(".message_count").text(messageCount);
$(".message_count_text").text(messageCount==1?"post":"posts");$(".total_message_count").text(totalMessageCount);if(d){e=d.children(".discussion_entry");e.removeClass("discussion_start").removeClass("discussion_end");e.filter(":first").addClass("discussion_start");e.filter(":last").addClass("discussion_end");e=d.prev(".discussion_entry");e.hasClass("has_loaded")&&e.fillTemplateData({data:{replies:h.t("number_of_replies",{zero:"No Replies",one:"1 Reply",other:"%{count} Replies"},{count:d.children(".discussion_entry").length})}})}}
$(document).ready(function(){setTimeout(function(){$(".communication_sub_message.blank").each(function(){$(this).find(".user_name").text("")})},500);var d=[];$.ajaxJSON($(".discussion_entry_permissions_url").attr("href"),"GET",{},function(a){for(var b in a){var c=a[b].discussion_entry;d.push({id:"entry_"+c.id,permissions:c.permissions||{}})}setTimeout(e,500)},function(){});var e=function(){for(var a=0;a<10;a++){var b=d.shift();if(b){var c=b.permissions;b=b.id;if(c.update||c["delete"]||c.reply){b=
$("#"+b);c.update&&b.find(".header .edit_entry_link").removeClass("disabled_link");c["delete"]&&b.find(".header .delete_entry_link").removeClass("disabled_link");if(c.reply){b.find(".add_entry_link").removeClass("disabled_link");b.find(".reply_message").show()}}}}d.length>0&&setTimeout(e,500)};$(".show_rubric_link").click(function(a){function b(){c=$("#rubrics.rubric_dialog");c.dialog("close").dialog({title:h.t("titles.assignment_rubric_details","Assignment Rubric Details"),width:600,modal:false,
resizable:true,autoOpen:false}).dialog("open")}a.preventDefault();a=$(this).attr("rel");var c=$("#rubrics.rubric_dialog");if(c.length)b();else{var f=$("<div/>");f.text(h.t("loading","Loading..."));$("body").append(f);f.dialog({width:400,height:200});$.get(a,function(g){$("body").append(g);f.dialog("close");f.remove();b()})}});$(".add_topic_rubric_link").click(function(a){a.preventDefault();$("#rubrics.rubric_dialog").dialog("close").dialog({title:h.t("titles.assignment_rubric_details","Assignment Rubric Details"),
width:600,modal:false,resizable:true,autoOpen:false}).dialog("open");$(".add_rubric_link").click()});$("#add_entry_form .add_attachment_link").click(function(a){a.preventDefault();a=$(this).parents("form");a.find(".no_attachment").slideUp().addClass("current");a.find(".current_attachment").hide().removeClass("current");a.find(".upload_attachment").slideDown()});$("#add_entry_form .delete_attachment_link").click(function(a){a.preventDefault();a=$(this).parents("form");a.find(".current_attachment").slideUp().removeClass("current");
a.find(".no_attachment").slideDown().addClass("current");a.find(".upload_attachment").hide();a.find(".entry_remove_attachment").val("1")});$("#add_entry_form .replace_attachment_link").click(function(a){a.preventDefault();a=$(this).parents("form");a.find(".upload_attachment").slideDown();a.find(".no_attachment").hide().removeClass("current");a.find(".current_attachment").slideUp().addClass("current")});$("#add_entry_form .cancel_attachment_link").click(function(a){a.preventDefault();a=$(this).parents("form");
a.find(".no_attachment.current").slideDown();a.find(".upload_attachment").slideUp();a.find(".current_attachment.current").slideDown();a.find(".attachment_uploaded_data").val("");a.find(".entry_remove_attachment").val("0")});$("#add_entry_form").formSubmit({fileUpload:function(a){(a=a["attachment[uploaded_data]"])&&$(this).attr("action",$(this).attr("action")+".text");return a},object_name:"discussion_entry",processData:function(){var a=$(this).getFormData({object_name:"discussion_entry"});a.message=
$(this).find(".entry_content_new").editorBox("get_code");a["discussion_entry[message]"]=a.message;return a},beforeSubmit:function(a){var b=$(this).parents(".discussion_entry"),c=h.t("updating","Updating...");if(b.attr("id")=="entry_new"){c=h.t("adding","Adding...");b.attr("id","entry_id")}b.next().attr("id","replies_entry_id");a.post_date=c;b.fillTemplateData({data:a,except:["message"],avoid:".subcontent"});n();a=b.parents(".discussion_subtopic");i(a);b.find(".content").loadingImage();return b},success:function(a,
b){var c=a.discussion_entry;c.user_name=c.user_name?c.user_name:h.t("default_user_name","User Name");delete c.user;var f=$.parseFromISO(c.created_at,"event");c.post_date=f.datetime_formatted;if(b.attr("id")=="entry_id"){totalMessageCount++;b.parents(".discussion_subtopic").length===0&&messageCount++;i()}if(c.attachment){c.attachment_name=c.attachment.display_name;f=$.replaceTags(b.find(".entry_attachment_url").attr("href"),"attachment_id",c.attachment.id);b.find(".attachment_name").attr("href",f)}b.find(".attachment_data").showIf(c.attachment);
b.find("input.parent_id").val(c.id);b.find("span.parent_id").text(c.id);b.find(".content > .message_html").val(c.message);b.fillTemplateData({id:"entry_"+c.id,data:c,htmlValues:["message"],hrefValues:["id","user_id","discussion_topic_id"],avoid:".subcontent"});b.find(".add_entry_link").toggleClass("disabled_link",!c.permissions.reply).end().find(".edit_entry_link").toggleClass("disabled_link",!c.permissions.update).end().find(".delete_entry_link").toggleClass("disabled_link",!c.permissions["delete"]);
b.find(".content").loadingImage("remove");b.find(".user_content").removeClass("enhanced");$("#initial_post_required").length&&location.reload();$(document).triggerHandler("user_content_change")},error:function(a,b){b.find(".content").loadingImage("remove");k(b);b.attr("id")=="entry_id"&&b.attr("id","entry_new");return b.find("form")}});$("#add_entry_form .cancel_button").click(function(){var a=$(this).parents(".discussion_entry");$("#add_entry_bottom").show();n();if(a.attr("id")=="entry_new"){o();
var b=a.parents(".discussion_subtopic:first");a.next().remove();a.remove();i(b)}});$(".add_entry_link").live("click",function(a,b){a.preventDefault();a.stopPropagation();if(!($("#entry_new").length>0)){var c=$("#entry_list"),f={parent_id:0};if($(this).parents(".discussion_subtopic").length>0){c=$(this).parents(".discussion_subtopic");f.parent_id=c.prev().getTemplateData({textValues:["id"]}).id}else if($(this).parents(".discussion_entry").length>0){c=$(this).parents(".discussion_entry").next();f.parent_id=
c.prev().getTemplateData({textValues:["id"]}).id}var g=c.prev(".discussion_entry");if(!(g.length>0&&g.find(".replies_link").text()!=h.t("no_replies","No Replies")&&!g.hasClass("has_loaded"))){g=$("#entry_blank").clone(true);var l=$("#replies_entry_blank").clone(true);g.fillTemplateData({data:f});c.append(g.show());c.append(l);i(g.parents(".discussion_subtopic:first"));g.attr("id","entry_new");k(g,b)}}});$(".switch_entry_views_link").live("click",function(a){a.preventDefault();$(this).parents("form").find("textarea").editorBox("toggle")});
$(".edit_entry_link").live("click",function(a){a.preventDefault();if($(this).parents(".discussion_entry").length>0){a=$(this).parents(".discussion_entry");k(a)}else $(".discussion_topic:first .edit_topic_link").click()});$(".delete_entry_link").live("click",function(a){a.preventDefault();a=$("#add_entry_form").getFormData({values:["authenticity_token"]});$(this).closest(".discussion_entry,.communication_sub_message").confirmDelete({token:a.authenticity_token,url:$(this).attr("href"),message:h.t("confirms.delete_entry",
"Are you sure you want to delete this entry?"),success:function(){$(this).fadeOut("normal",function(){var b=$(this).parents(".discussion_subtopic:first");$(this).remove();i(b)});totalMessageCount--;$(this).parents(".discussion_subtopic").length===0&&messageCount--;i()}})});$("#entry_list").delegate(".replies_link","click",function(a){a.preventDefault()});$(".toggle_subtopics_link").live("click",function(a){a.preventDefault();$(this).text().indexOf(h.t("expand","Expand"));$(".toggle_subtopics_link").toggle()});
$(document).click(function(a){$(a.target).parents(".discussion_entry,.discussion_topic").length===0?p():j($(a.target).closest(".communication_sub_message,.discussion_entry,.discussion_topic").filter(":first"))});$.scrollSidebar();$("#add_entry_form :input").keydown(function(a,b){if(a.keyCode==27||b==27){a.preventDefault();var c=$(this).parents("form").attr("id");setTimeout("cancelEditEntry('"+c+"')",100)}});$(document).fragmentChange(function(a,b){if(b.match(/^#reply/)){var c=null;try{c=$.parseJSON(b.substring(6))}catch(f){}$("#sidebar .add_entry_link:visible:first").triggerHandler("click",
c)}});$(document).keycodes("j k d e r n",function(a){a.preventDefault();a.stopPropagation();var b=$(".discussion_entry,.discussion_topic,.communication_sub_message").filter(".selected:first");if(a.keyCode==74){a=$(".discussion_topic.selected,.discussion_entry.selected,.communication_sub_message.selected");if(a.length===0)a=$(".discussion_topic:first").addClass("selected");else{b=$(".discussion_topic,.discussion_entry,.communication_sub_message");for(var c=null,f=$(".discussion_topic,.discussion_entry,.communication_sub_message").index(a.get(0))+
1;f<b.length;f++){var g=$(b.get(f));if(g.css("display")!="none"){c=g;break}}if(c)a=c}j(a,true)}else if(a.keyCode==75)o();else if(a.keyCode==68)b.find(".delete_topic_link,.delete_entry_link").clickLink();else if(a.keyCode==69)b.find(".edit_topic_link,.edit_entry_link").clickLink();else if(a.keyCode==82){b.find(".add_entry_link").length?b.find(".add_entry_link").clickLink():b.closest(".communication_message").find(".add_entry_link").clickLink();a=$(".add_sub_message_form,.new_discussion_entry").filter(":visible:first");
a.length&&$("html,body").scrollTo(a)}else a.keyCode==78&&$(document).find(".add_entry_link:first").clickLink()})})});
$.extend(true,I18n=I18n||{},{translations:{es:{topics:{confirms:{delete_entry:"\u00bfSeguro que quiere borrar esta entrada?"},default_user_name:"Nombre de Usuario",add_new_entry:"Agregar una Nueva Entrada",adding:"Agregando...",no_replies:"Sin Respuestas",number_of_replies:{one:"1 Respuesta",other:"%{count} Respuestas",zero:"Sin Respuestas"},expand:"Expandir",titles:{assignment_rubric_details:"Detalles de la R\u00fabrica de la Tarea"},loading:"Cargando...",update_entry:"Actualizar la Contribuci\u00f3n",
updating:"Actualizando..."}}}});
