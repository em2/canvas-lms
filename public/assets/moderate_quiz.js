var timing;
I18n.scoped("quizzes.timing",function(g){timing={initialTime:new Date,initTimes:function(){if(timing.timesReady)return timing.clientServerDiff;var b=Date.parse($(".now").text())||timing.initialTime||new Date,e=timing.initialTime||new Date;timing.clientServerDiff=b.getTime()-e.getTime();timing.timesReady=true},setReferenceDate:function(b,e){timing.timesReady||timing.initTimes();var c={};c.referenceDate=Date.parse(e);c.isDeadline=true;$(".time_header").text(g.beforeLabel("time_remaining","Time Remaining"));
if(!c.referenceDate){c.isDeadline=false;$(".time_header").text(g.beforeLabel("time_elapsed","Time Elapsed"));c.referenceDate=Date.parse(b)}c.clientServerDiff=timing.clientServerDiff;return c}}});var moderation;
I18n.scoped("quizzes.moderate",function(g){moderation={updateTimes:function(){var b=new Date;moderation.studentsCurrentlyTakingQuiz=!!$("#students .student.in_progress");$("#students .student.in_progress").each(function(){var e=$(this),c=e.data("timing")||{},h=e.attr("data-started-at"),j=e.attr("data-end-at");c.referenceDate||$.extend(c,timing.setReferenceDate(h,j,b));if(c.referenceDate){e.data("timing",c);h=c.referenceDate.getTime()-b.getTime()-c.clientServerDiff;if(c.isDeadline&&h<0)e.find(".time").text(g.t("time_up",
"Time Up!"));else{e.data("minutes_left",h/6E4);var k=new Date(Math.abs(h));h=k.getUTCFullYear()-1970;c=k.getUTCMonth();c+=12*h;h=k.getUTCDate()-1;j=k.getUTCHours();var l=k.getUTCMinutes();k=k.getUTCSeconds();var a=[];if(c)a.push(c<10?"0"+c:c);if(h)a.push(h<10?"0"+h:h);if(j)a.push(j<10?"0"+j:j);a.push(l<10?"0"+l:l);a.push(k<10?"0"+k:k);e.find(".time").text(a.join(":"))}}})},updateSubmission:function(b,e){var c=$("#student_"+b.user_id);if(e)moderation.lastUpdatedAt=new Date(Math.max(Date.parse(b.updated_at),
moderation.lastUpdatedAt));var h="";if(b.workflow_state=="complete"||b.workflow_state=="pending_review")h=g.t("finished_in_duration","finished in %{duration}",{duration:b.finished_in_words});var j={attempt:b.attempt||"--",extra_time:b.extra_time,extra_attempts:b.extra_attempts,score:b.kept_score};if(b.attempts_left==-1)j.attempts_left="--";else if(b.attempts_left)j.attempts_left=b.attempts_left;if(b.workflow_state!="untaken")j.time=h;c.fillTemplateData({data:j}).toggleClass("extendable",b["extendable?"]).toggleClass("in_progress",
b.workflow_state=="untaken").toggleClass("manually_unlocked",!!b.manually_unlocked).attr("data-started-at",b.started_at||"").attr("data-end-at",b.end_at||"").data("timing",null).find(".extra_time_allowed").showIf(b.extra_time).end().find(".unlocked").showIf(b.manually_unlocked)},lastUpdatedAt:"",studentsCurrentlyTakingQuiz:false};$(document).ready(function(){function b(a){(k=a)?l.attr("src",l.attr("src").replace("ajax-reload.gif","ajax-reload-animated.gif")):l.attr("src",l.attr("src").replace("ajax-reload-animated.gif",
"ajax-reload.gif"))}function e(a){if(!k){b(true);var d=moderation.lastUpdatedAt&&moderation.lastUpdatedAt.toISOString();$.ajaxJSON($.replaceTags(j,"update",d),"GET",{},function(f){b(false);if(a)f.length||moderation.studentsCurrentlyTakingQuiz?setTimeout(function(){e(true)},6E4):setTimeout(function(){e(true)},18E4);for(var i in f)moderation.updateSubmission(f[i],true)},function(){b(false);h++;if(h>5){$.flashMessage(g.t("errors.server_communication_failed","There was a problem communicating with the server.  The system will try again in five minutes, or you can reload the page"));
h=0;a&&setTimeout(function(){e(true)},3E5)}else a&&setTimeout(function(){e(true)},12E4)})}}function c(){var a=$(".student_check:checked").length;$("#checked_count").text(a);$(".moderate_multiple_button").showIf(a)}timing.initTimes();setInterval(moderation.updateTimes,500);var h=0,j=$(".update_url").attr("href");moderation.lastUpdatedAt=Date.parse($(".last_updated_at").text());var k=false,l=$(".reload_link img");setTimeout(function(){e(true)},1E3);$("#check_all").change(function(){$(".student_check").attr("checked",
$(this).attr("checked"));c()});$(".student_check").change(function(){$(this).attr("checked")||$("#check_all").attr("checked",false);c()});$(".moderate_multiple_button").live("click",function(){var a=[],d={};$(".student_check:checked").each(function(){var f=$(this).parents(".student");a.push($(this).attr("data-id"));var i={manually_unlocked:f.hasClass("manually_unlocked")?"1":"0",extra_attempts:parseInt(f.find(".extra_attempts").text(),10)||"",extra_time:parseInt(f.find(".extra_time").text(),10)||
""};$.each(["manually_unlocked","extra_attempts","extra_time"],function(){if(d[this]==null)d[this]=i[this].toString();else if(d[this]!=i[this].toString())d[this]=""})});$("#moderate_student_form").data("ids",a);$("#moderate_student_dialog h2").text(g.t("extensions_for_students",{one:"Extensions for 1 Student",other:"Extensions for %{count} Students"},{count:a.length}));$("#moderate_student_form").fillFormData(d);$("#moderate_student_dialog").dialog("close").dialog({auotOpen:false,title:g.t("titles.student_extensions",
"Student Extensions"),width:400}).dialog("open")});$(".moderate_student_link").live("click",function(a){a.preventDefault();a=$(this).parents(".student");var d={manually_unlocked:a.hasClass("manually_unlocked")?"1":"0",extra_attempts:parseInt(a.find(".extra_attempts").text(),10)||"",extra_time:parseInt(a.find(".extra_time").text(),10)||""},f=a.find(".student_name").text();$("#moderate_student_form").fillFormData(d);$("#moderate_student_form").data("ids",[a.attr("data-user-id")]);$("#moderate_student_form").find("button").attr("disabled",
false);$("#moderate_student_dialog h2").text(g.t("extensions_for_student","Extensions for %{student}",{student:f}));$("#moderate_student_dialog").dialog("close").dialog({auotOpen:false,title:g.t("titles.student_extensions","Student Extensions"),width:400}).dialog("open")});$(".reload_link").click(function(a){a.preventDefault();e()});$("#moderate_student_form").submit(function(a){function d(){if(m>=f.length)if(n>0)f.length==1?i.find("button").attr("disabled",false).filter(".save_button").text(g.t("buttons.save_failed",
"Save Failed, please try again")):i.find("button").attr("disabled",false).filter(".save_button").text(g.t("buttons.save_failed_n_updates_lost","Save Failed, %{n} Students were not updated",{n:n}));else{i.find("button").attr("disabled",false).filter(".save_button").text(g.t("buttons.save","Save"));$("#moderate_student_dialog").dialog("close")}}a.preventDefault();a.stopPropagation();var f=$(this).data("ids");if(f.length!=0){var i=$(this);i.find("button").attr("disabled",true).filter(".save_button").text(g.t("buttons.saving",
"Saving..."));var m=0,n=0;a=$(this).getFormData();for(var p in f){var o=f[p];o=$.replaceTags($(".extension_url").attr("href"),"user_id",o);$.ajaxJSON(o,"POST",a,function(q){m++;moderation.updateSubmission(q);d()},function(){m++;n++;d()})}}});$("#moderate_student_dialog").find(".cancel_button").click(function(){$("#moderate_student_dialog").dialog("close")});$(".extend_time_link").live("click",function(a){a.preventDefault();a=$(a.target).parents(".student");var d=$.parseFromISO(a.attr("data-end-at")).datetime_formatted,
f=$.parseFromISO(a.attr("data-started-at")).datetime_formatted,i=$("#extend_time_dialog");i.data("row",a);i.fillTemplateData({data:{end_at:d,started_at:f}});i.find("button").attr("disabled",false);i.dialog("close").dialog({auto_open:false,title:g.t("titles.extend_quiz_time","Extend Quiz Time"),width:400}).dialog("open")});$("#extend_time_dialog").find(".cancel_button").click(function(){$("#extend_time_dialog").dialog("close")}).end().find(".save_button").click(function(){var a=$("#extend_time_dialog"),
d=a.getFormData(),f={};d.time=parseInt(d.time,10)||0;if(!(d.time<=0)){if(d.time_type=="extend_from_now"&&d.time<a.data("row").data("minutes_left"))if(!confirm(g.t("confirms.taking_time_away","That would be less time than the student currently has.  Continue anyway?")))return;f[d.time_type]=d.time;a.find("button").attr("disabled",true).filter(".save_button").text(g.t("buttons.extending_time","Extending Time..."));d=$.replaceTags($(".extension_url").attr("href"),"user_id",a.data("row").attr("data-user-id"));
$.ajaxJSON(d,"POST",f,function(i){a.find("button").attr("disabled",false).filter(".save_button").text(g.t("buttons.extend_time","Extend Time"));moderation.updateSubmission(i);a.dialog("close")},function(){a.find("button").attr("disabled",false).filter(".save_button").text(g.t("buttons.time_extension_failed","Extend Time Failed, please try again"))})}})})});
$.extend(true,I18n=I18n||{},{translations:{es:{quizzes:{timing:{labels:{time_remaining:"Tiempo Restante",time_elapsed:"Tiempo Transcurrido"}},moderate:{confirms:{taking_time_away:"Eso ser\u00eda menos tiempo del que el estudiante tiene actualmente. \u00bfContinuar?"},buttons:{save_failed:"No se pudo Guardar, intente de nuevo",extend_time:"Extender el Tiempo",save_failed_n_updates_lost:"No se pudo guardar, %{n} estudiantes no se actualizaron",extending_time:"Extendiendo el Tiempo...",saving:"Guardando...",
save:"Guardar",time_extension_failed:"No se pudo Extender el Tiempo, intente de nuevo"},finished_in_duration:"termin\u00f3 en %{duration}",extensions_for_students:{one:"Extensiones para 1 estudiante",other:"Extensiones para %{count} estudiantes"},time_up:"\u00a1Se ha acabado el Tiempo!",errors:{server_communication_failed:"Ocurri\u00f3 un problema al comunicarse con el servidor. El sistema intentar\u00e1 de nuevo en cinco minutos, o puede recargar la p\u00e1gina"},extensions_for_student:"Extensiones para %{student}",
titles:{student_extensions:"Extensiones de Estudiantes",extend_quiz_time:"Extender el Tiempo de la Evaluaci\u00f3n"}}}},em2:{quizzes:{moderate:{titles:{extend_quiz_time:"Extend Assessment Time"}}}}}});
