$(document).ready(function(){I18n.scoped("conferences",function(e){$("#add_conference_form .cancel_button").click(function(){$("#add_conference_form").prev(".conference").length>0?$("#add_conference_form").hide():$("#add_conference_form").slideUp();$("#add_conference_form").prev(".conference").show()});$("#add_conference_form :text").keycodes("esc",function(){$("#add_conference_form").find(".cancel_button").click()});$("#add_conference_form").formSubmit({object_name:"web_conference",beforeSubmit:function(b){var a=
$(this).prev(".conference");if(a.length==0){a=$("#conference_blank").clone(true).attr("id","");$("#conferences").prepend(a.show())}else a.show();$("#add_conference_form").hide();a.loadingImage();if(!b.duration)b.long_running="1";a.fillTemplateData({data:b});a.find(".join_conference_link").hide();return a},success:function(b,a){$("#no_conferences_message").slideUp();a.loadingImage("remove");a.fillTemplateData({data:b.web_conference,hrefValues:["id"]});if(b.web_conference&&b.web_conference.permissions){a.find(".edit_conference_link").showIf(b.web_conference.permissions.update);
a.find(".delete_conference_link").showIf(b.web_conference.permissions["delete"]);if(b.web_conference.permissions.initiate||b.web_conference.permissions.join)a.find(".join_conference_link").show()}},error:function(b,a){a.loadingImage("remove");a.remove();$(this).show()}});$("#add_conference_form select").change(function(){var b=INST.webConferenceUserSettingTemplates[$(this).val()],a="";$.each(b,function(f,c){a+=c.html+"<br>"});$("#web_conference_user_settings").html(a)});$(".edit_conference_link, .add_conference_link").click(function(b){b.preventDefault();
var a=$("#add_conference_form");if(a.is(":visible"))if(confirm(e.t("confirm.quit","It looks like you are already editing another conference. Do you wish to continue? Any unsaved changes will be lost.")))a.prev(".conference").show();else return;b=$(this).hasClass("edit_conference_link");var f=$(this).parents(".conference");b||(f=$("#conference_blank"));var c=f.getTemplateData({textValues:["title","duration","description","user_ids","conference_type","long_running","has_advanced_settings","id"].concat(INST.webConferenceUserSettings)});
if(b){a.find("span.title").text(e.t("index.edit_conference_heading","Edit Conference Details"));a.find("button[type=submit]").text(e.t("index.buttons.update","Update Conference"));a.attr("method","PUT").attr("action",$(this).attr("href"));a.find("select").attr("disabled",true);var d=a.find(".advanced_settings").showIf(parseInt(c.has_advanced_settings));d.attr("href",$.replaceTags(d.data("base-href"),{id:c.id}));f.after(a);a.find("#members_list").show().find(":checkbox").attr("checked",false).end().end().find(".all_users_checkbox").attr("checked",
false);d=(c.user_ids||"").split(",");for(var g in d)a.find("#members_list .member.user_"+d[g]).find(":checkbox").attr("checked",true);if(c.conference_type){a.find("select").val(c.conference_type).change();delete c.conference_type}}else{delete c.conference_type;a.find("span.title").text(e.t("index.new_conference_heading","Start a New Conference"));a.find("button[type=submit]").text(e.t("index.buttons.create","Create Conference"));a.attr("method","POST").attr("action",$(".add_conference_url").attr("href"));
a.find("select").attr("disabled",false);a.find(".advanced_settings").hide();a.find(".all_users_checkbox").attr("checked",true).end().find("#members_list").hide().find(":checkbox").attr("checked",false);$("#conferences").before(a)}a.fillFormData(c,{object_name:"web_conference"});a.find("#web_conference_long_running").change(function(){$(this).attr("checked")?a.find("#web_conference_duration").attr("disabled",true).val(""):a.find("#web_conference_duration").attr("disabled",false).val(INST.webConferenceDefaultDuration)}).change();
f.hide();if(b){a.show();a.find(":input:visible:first").focus().select()}else a.slideDown(function(){$(this).find(":input:visible:first").focus().select()})});$(".delete_conference_link").click(function(b){b.preventDefault();$(this).parents(".conference").confirmDelete({url:$(this).attr("href"),message:e.t("confirm.delete","Are you sure you want to delete this conference?"),success:function(){$("#conferences .conference:visible").length<=1&&$("#no_conferences_message").slideDown();$(this).slideUp(function(){$(this).remove()})}})});
$(".all_users_checkbox").change(function(){$(this).attr("checked")?$("#members_list").slideUp():$("#members_list").slideDown()}).change();$(document).fragmentChange(function(b,a){if(match=a.match(/^#conference_\d+$/))$(match[0]).find(".edit_conference_link").click()});$(".close_conference_link").click(function(){var b=$(this).parents(".conference");event.preventDefault();if(confirm(e.t("confirm.close","Are you sure you want to end this conference? You will not be able to reopen it"))){b.loadingImage();
b.find(".close_conference_link, .join_conference_link, .edit_conference_link").hide();$.ajaxJSON($(this).attr("href"),"POST",{},function(){$("#no_conferences_message").slideUp();b.loadingImage("remove")})}});$(".external_url").click(function(b){b.preventDefault();b=e.t("loading_urls_message","Loading, please wait...");var a=$(this),f=a.text();if(f!=b){a.text(b);$.ajaxJSON(a.attr("href"),"GET",{},function(c){a.text(f);if(c.length==0)$.flashError(e.t("no_urls_error","Sorry, it looks like there aren't any %{type} pages for this conference yet.",
{type:a.attr("name")}));else if(c.length>1){$box=$(document.createElement("DIV"));$box.append($("<p />").text(e.t("multiple_urls_message","There are multiple %{type} pages available for this conference. Please select one:",{type:a.attr("name")})));for(var d=0;d<c.length;d++){$a=$("<a />",{href:c[d].url||a.attr("href")+"&url_id="+c[d].id,target:"_blank"});$a.text(c[d].name);$box.append($a).append("<br>")}$box.dialog("close").dialog({autoOpen:false,width:425,minWidth:425,minHeight:215,resizable:true,
height:"auto",title:a.text()}).dialog("open")}else window.open(c[0].url)})}})})});
$.extend(true,I18n=I18n||{},{translations:{es:{conferences:{confirm:{"delete":"\u00bfSeguro que quiere borrar esta conferencia?",close:"\u00bfSeguro que quiere finalizar esta conferencia? No podr\u00e1 volver a abrirla.",quit:"Parece que ya est\u00e1 editando otra conferencia. \u00bfDesea continuar? Cualquier cambio no guardado se perder\u00e1."},no_urls_error:"Perdon, parece que no hay p\u00e1ginas %{type} para esta conferencia todav\u00eda.",multiple_urls_message:"Hay m\u00faltiples p\u00e1ginas %{type} disponibles para esta conferencia. Seleccione uno:",
index:{new_conference_heading:"Iniciar una Conferencia Nueva",buttons:{create:"Crear una Conferencia",update:"Actualizar la Conferencia"},edit_conference_heading:"Editar los Detalles de la Conferencia"},loading_urls_message:"Cargando, por favor espere..."}}}});
