(function(){var q,z,j,y,s,x,r,u,N,R,G,w=function(l,d){return function(){return l.apply(d,arguments)}},H=Array.prototype.indexOf||function(l){for(var d=0,g=this.length;d<g;d++)if(this[d]===l)return d;return-1};z=[];q=[];x=[];s=[];j=[];y=r=null;G={};u={};N=function(){function l(d,g){var h,n;this.node=d;this.options=g;this.node.data("token_input",this);this.fake_input=$("<div />").css("font-family",this.node.css("font-family")).insertAfter(this.node).addClass("token_input").click(w(function(){return this.input.focus()},
this));this.node_name=this.node.attr("name");this.node.removeAttr("name").hide().change(w(function(){this.tokens.html("");return typeof this.change==="function"?this.change(this.token_values()):void 0},this));this.added=this.options.added;this.placeholder=$("<span />");this.placeholder.text(this.options.placeholder);this.options.placeholder&&this.placeholder.appendTo(this.fake_input);this.tokens=$("<ul />").appendTo(this.fake_input);this.tokens.click(w(function(t){var B;if(B=$(t.target).closest("li")){t=
$(t.target).closest("a");if(t.length){B.remove();return typeof this.change==="function"?this.change(this.token_values()):void 0}}},this));this.tokens.maxTokenWidth=w(function(){return parseInt(this.tokens.css("width").replace("px",""))-150+"px"},this);this.tokens.resizeTokens=w(function(t){return t.find("div.ellipsis").css("max-width",this.tokens.maxTokenWidth())},this);$(window).resize(w(function(){return this.tokens.resizeTokens(this.tokens)},this));this.input=$("<input />").appendTo(this.fake_input).css("width",
"20px").css("font-size",this.fake_input.css("font-size")).autoGrowInput({comfortZone:20}).focus(w(function(){this.placeholder.hide();this.active=true;return this.fake_input.addClass("active")},this)).blur(w(function(){this.active=false;return setTimeout(w(function(){var t;if(!this.active){this.fake_input.removeClass("active");this.placeholder.showIf(this.val()===""&&!this.tokens.find("li").length);return(t=this.selector)!=null?typeof t.blur==="function"?t.blur():void 0:void 0}},this),50)},this)).keydown(w(function(t){return this.input_keydown(t)},
this)).keyup(w(function(t){return this.input_keyup(t)},this));if(this.options.selector){h=(n=this.options.selector.type)!=null?n:R;delete this.options.selector.type;if(this.browser=this.options.selector.browser){delete this.options.selector.browser;$('<a class="browser">browse</a>').click(w(function(){if(this.selector.browse(this.browser.data))return this.fake_input.addClass("browse")},this)).prependTo(this.fake_input)}this.selector=new h(this,this.node.attr("finder_url"),this.options.selector)}this.base_exclude=
[];this.resize()}l.prototype.resize=function(){return this.fake_input.css("width",this.node.css("width"))};l.prototype.add_token=function(d){var g,h,n,t,B,A,E;A=(n=d!=null?d.value:void 0)!=null?n:this.val();t="token_"+A;n=this.tokens.find("#"+t);if(B=n.length===0){n=$("<li />");g=(h=d!=null?d.text:void 0)!=null?h:this.val();n.attr("id",t);h=$("<div />").addClass("ellipsis");h.attr("title",g);h.text(g);n.append(h);g=$("<a />");n.append(g);n.append($("<input />").attr("type","hidden").attr("name",this.node_name+
"[]").val(A));this.tokens.resizeTokens(n);this.tokens.append(n)}d!=null&&d.no_clear||this.val("");this.placeholder.hide();d&&typeof this.added==="function"&&this.added(d.data,n,B);typeof this.change==="function"&&this.change(this.token_values());return(E=this.selector)!=null?E.reposition():void 0};l.prototype.has_token=function(d){var g;return this.tokens.find("#token_"+((g=d!=null?d.value:void 0)!=null?g:d)).length>0};l.prototype.remove_token=function(d){var g,h;this.tokens.find("#"+("token_"+((g=
d!=null?d.value:void 0)!=null?g:d))).remove();typeof this.change==="function"&&this.change(this.token_values());return(h=this.selector)!=null?h.reposition():void 0};l.prototype.remove_last_token=function(){var d;this.tokens.find("li").last().remove();typeof this.change==="function"&&this.change(this.token_values());return(d=this.selector)!=null?d.reposition():void 0};l.prototype.input_keydown=function(d){var g,h,n;this.keyup_action=false;if(this.selector)if((g=this.selector)!=null&&g.capture_keydown(d)){d.preventDefault();
return false}else this.fake_input.removeClass("browse");else if((h=(n=d.which,H.call(this.delimiters,n)>=0))!=null?h:1){this.keyup_action=this.add_token;d.preventDefault();return false}return true};l.prototype.token_values=function(){var d,g,h,n,t;n=this.tokens.find("input");t=[];g=0;for(h=n.length;g<h;g++){d=n[g];t.push(d.value)}return t};l.prototype.input_keyup=function(){return typeof this.keyup_action==="function"?this.keyup_action():void 0};l.prototype.bottom_offset=function(){var d;d=this.fake_input.offset();
d.top+=this.fake_input.height()+2;return d};l.prototype.focus=function(){return this.input.focus()};l.prototype.val=function(d){var g;if(d!=null){if(d!==this.input.val()){this.input.val(d).change();return(g=this.selector)!=null?g.reposition():void 0}}else return this.input.val()};l.prototype.caret=function(){var d,g,h;if(this.input[0].selectionStart!=null){g=this.input[0].selectionStart;d=this.input[0].selectionEnd}else{h=this.val();d=document.selection.createRange().duplicate();d.moveEnd("character",
h.length);g=d.text===""?h.length:h.lastIndexOf(d.text);d=document.selection.createRange().duplicate();d.moveStart("character",-h.length);d=d.text.length}return g===d?g:-1};l.prototype.selector_closed=function(){return this.fake_input.removeClass("browse")};return l}();$.fn.tokenInput=function(l){return this.each(function(){return new N($(this),$.extend(true,{},l))})};R=function(){function l(d,g,h){this.input=d;this.url=g;this.options=h!=null?h:{};this.stack=[];this.query_cache={};this.container=$("<div />").addClass("autocomplete_menu");
this.menu=$("<div />").append(this.list=this.new_list());this.container.append($("<div />").append(this.menu));this.container.css("top",0).css("left",0);this.mode="input";$("body").append(this.container);this.reposition=w(function(){var n;n=this.input.bottom_offset();this.container.css("top",n.top);return this.container.css("left",n.left)},this);$(window).resize(this.reposition);this.close()}l.prototype.browse=function(d){if(!this.ui_locked){this.input.val("");this.close();this.fetch_list({data:d});
return true}};l.prototype.new_list=function(){var d;d=$('<div class="list"><ul class="heading"></ul><ul></ul></div>');d.find("ul").mousemove(w(function(g){if(!this.ui_locked){g=$(g.target).closest("li");g.hasClass("selectable")||(g=null);return this.select(g)}},this)).mousedown(w(function(){return setTimeout(w(function(){return this.input.focus()},this),0)},this)).click(w(function(g){var h;if(!this.ui_locked){h=$(g.target).closest("li");h.hasClass("selectable")||(h=null);this.select(h);if(this.selection)if($(g.target).closest("a.expand").length)this.selection_expanded()?
this.collapse():this.expand_selection();else if(this.selection_toggleable()&&$(g.target).closest("a.toggle").length)this.toggle_selection();else if(this.selection_expanded())this.collapse();else if(this.selection_expandable())this.expand_selection();else{this.toggle_selection(true);this.clear();this.close()}return this.input.focus()}},this));d.body=d.find("ul").last();return d};l.prototype.capture_keydown=function(d){var g,h;if(this.ui_locked)return true;switch((g=(h=d.originalEvent)!=null?h.keyIdentifier:
void 0)!=null?g:d.which){case "Backspace":case "U+0008":case 8:if(this.input.val()===""){if(this.list_expanded())this.collapse();else this.menu.is(":visible")?this.close():this.input.remove_last_token();return true}break;case "Tab":case "U+0009":case 9:if(this.selection&&(this.selection_toggleable()||!this.selection_expandable()))this.toggle_selection(true);this.clear();this.close();if(this.selection)return true;break;case "Enter":case 13:if(this.selection_expanded()){this.collapse();return true}else if(this.selection_expandable()&&
!this.selection_toggleable()){this.expand_selection();return true}else if(this.selection){this.toggle_selection(true);this.clear()}this.close();return true;case "Shift":case 16:return false;case "Esc":case "U+001B":case 27:if(this.menu.is(":visible")){this.close();return true}else return false;case "U+0020":case 32:if(this.selection_toggleable()&&this.mode==="menu"){this.toggle_selection();return true}break;case "Left":case 37:if(this.list_expanded()&&this.input.caret()===0){this.selection_expanded()||
this.input.val()===""?this.collapse():this.select(this.list.find("li").first());return true}break;case "Up":case 38:this.select_prev();return true;case "Right":case 39:if(this.input.caret()===this.input.val().length&&this.expand_selection())return true;break;case "Down":case 40:this.select_next();return true;case "U+002B":case 187:case 107:if(this.selection_toggleable()&&this.mode==="menu"){this.toggle_selection(true);return true}break;case "U+002D":case 189:case 109:if(this.selection_toggleable()&&
this.mode==="menu"){this.toggle_selection(false);return true}}this.mode="input";this.fetch_list();return false};l.prototype.fetch_list=function(d,g){if(d==null)d={};this.ui_locked=g!=null?g:false;this.timeout!=null&&clearTimeout(this.timeout);return this.timeout=setTimeout(w(function(){var h,n,t;delete this.timeout;h=this.prepare_post((t=d.data)!=null?t:{});n=JSON.stringify(h);if(h.search===""&&!this.list_expanded()&&!d.data){this.ui_locked=false;this.close()}else if(n===this.last_applied_query)this.ui_locked=
false;else if(this.query_cache[n]){this.last_applied_query=n;this.last_search=h.search;this.clear_loading();this.render_list(this.query_cache[n],d,h)}else{this.set_loading();return $.ajaxJSON(this.url,"POST",$.extend({},h),w(function(B){var A;this.query_cache[n]=B;this.clear_loading();if(JSON.stringify(this.prepare_post((A=d.data)!=null?A:{}))===n){this.last_applied_query=n;this.last_search=h.search;if(this.menu.is(":visible"))return this.render_list(B,d,h)}else return this.ui_locked=false},this),
w(function(){this.ui_locked=false;return this.clear_loading()},this))}},this),100)};l.prototype.add_by_user_id=function(d,g){this.set_loading();return $.ajaxJSON(this.url,"POST",{user_id:d,from_conversation_id:g},w(function(h){this.clear_loading();this.close();if(h=h[0])return this.input.add_token({value:h.id,text:h.name,data:h})},this),w(function(){this.clear_loading();return this.close()},this))};l.prototype.open=function(){this.container.show();return this.reposition()};l.prototype.close=function(){var d,
g,h,n;this.ui_locked=false;this.container.hide();delete this.last_applied_query;n=this.stack;g=0;for(h=n.length;g<h;g++){d=n[g];d=d[1];this.list.remove();this.list=d.css("height","auto")}this.list.find("ul").html("");this.stack=[];this.menu.css("left",0);this.select(null);return this.input.selector_closed()};l.prototype.clear=function(){return this.input.val("")};l.prototype.blur=function(){return this.close()};l.prototype.list_expanded=function(){return this.stack.length?true:false};l.prototype.selection_expanded=
function(){var d,g;return(d=(g=this.selection)!=null?g.hasClass("expanded"):void 0)!=null?d:false};l.prototype.selection_expandable=function(){var d,g;return(d=(g=this.selection)!=null?g.hasClass("expandable"):void 0)!=null?d:false};l.prototype.selection_toggleable=function(d){var g;if(d==null)d=this.selection;return((g=d!=null?d.hasClass("toggleable"):void 0)!=null?g:false)&&!this.selection_expanded()};l.prototype.expand_selection=function(){if(!(this.selection_expandable()&&!this.selection_expanded()))return false;
this.stack.push([this.selection,this.list,this.last_applied_query,this.last_search]);this.clear();this.menu.css("width",(this.stack.length+1)*100+"%");return this.fetch_list({expand:true},true)};l.prototype.collapse=function(){var d,g,h;if(!this.list_expanded())return false;h=this.stack.pop();g=h[0];d=h[1];this.last_applied_query=h[2];this.last_search=h[3];this.ui_locked=true;d.css("height","auto");return this.menu.animate({left:"+="+this.menu.parent().css("width")},"fast",w(function(){this.input.val(this.last_search);
this.list.remove();this.list=d;this.select(g);return this.ui_locked=false},this))};l.prototype.toggle_selection=function(d,g,h){var n,t;if(g==null)g=this.selection;if(h==null)h=false;if(!(d!=null||this.selection_toggleable(g)))return false;n=g.data("id");if(d==null)d=!g.hasClass("on");if(d){this.selection_toggleable(g)&&!h&&g.addClass("on");this.input.add_token({value:n,text:(t=g.data("text"))!=null?t:g.text(),no_clear:true,data:g.data("user_data")})}else{h||g.removeClass("on");this.input.remove_token({value:n})}if(!h)return this.update_select_all(g)};
l.prototype.update_select_all=function(d,g){var h,n,t;if(g==null)g=0;n=d.data("user_data").select_all;h=g?this.stack[this.stack.length-g][1]:this.list;if(t=h.select_all){h=h.body.find("li.toggleable").not(t);if(n)t.hasClass("on")?h.addClass("on").each(w(function(B,A){return this.toggle_selection(false,$(A),true)},this)):h.removeClass("on").each(w(function(B,A){return this.toggle_selection(false,$(A),true)},this));else{n=h.filter(".on");if(n.length<h.length&&t.hasClass("on")){t.removeClass("on");this.toggle_selection(false,
t,true);n.each(w(function(B,A){return this.toggle_selection(true,$(A),true)},this))}else if(n.length===h.length&&!t.hasClass("on")){t.addClass("on");this.toggle_selection(true,t,true);n.each(w(function(B,A){return this.toggle_selection(false,$(A),true)},this))}}if(g<this.stack.length){g++;h=this.stack[this.stack.length-g][0];if(this.selection_toggleable(h)){t.hasClass("on")?h.addClass("on"):h.removeClass("on");return this.update_select_all(h,g)}}}};l.prototype.select=function(d,g){var h;if(g==null)g=
false;if((d!=null?d[0]:void 0)!==((h=this.selection)!=null?h[0]:void 0)){if((h=this.selection)!=null)h.removeClass("active");this.selection=d!=null&&d.length?(d.addClass("active"),d.scrollIntoView({ignore:{border:true}}),d):null;if(!g)return this.mode=d?"menu":"input"}};l.prototype.select_next=function(d){var g;if(d==null)d=false;this.select(this.selection?this.selection.next().length?this.selection.next():this.selection.parent("ul").next().length?this.selection.parent("ul").next().find("li").first():
null:this.list.find("li:first"),d);if((g=this.selection)!=null&&g.hasClass("message"))return this.select_next(d)};l.prototype.select_prev=function(){var d,g;this.select(this.selection?(d=this.selection)!=null&&d.prev().length?this.selection.prev():this.selection.parent("ul").prev().length?this.selection.parent("ul").prev().find("li").last():null:this.list.find("li:last"));if((g=this.selection)!=null&&g.hasClass("message"))return this.select_prev()};l.prototype.populate_row=function(d,g,h){if(h==null)h=
{};if(this.options.populator)this.options.populator(d,g,h);else{d.data("id",g.text);d.text(g.text)}h.first&&d.addClass("first");if(h.last)return d.addClass("last")};l.prototype.set_loading=function(){if(!this.menu.is(":visible")){this.open();this.list.find("ul").last().append($('<li class="message first last"></li>'))}return this.list.find("li").first().loadingImage()};l.prototype.clear_loading=function(){return this.list.find("li").first().loadingImage("remove")};l.prototype.render_list=function(d,
g,h){var n,t,B,A,E,O,S,K,F;if(g==null)g={};if(h==null)h={};this.open();B=g.expand?this.new_list():this.list;this.selection=B.select_all=null;n=B.find("ul");n.html("");t=n.first();n=n.last();if(d.length){E=this.stack.length?this.stack[this.stack.length-1][0]:null;if(!d.prepared){if(typeof(A=this.options).preparer==="function")A.preparer(h,d,E);d.prepared=true}A=0;for(K=d.length;A<K;A++){O=d[A];h=$("<li />").addClass("selectable");this.populate_row(h,O,{level:this.stack.length,first:A===0,last:A===
d.length-1,parent:E});if(O.select_all)B.select_all=h;h.hasClass("toggleable")&&this.input.has_token(h.data("id"))&&h.addClass("on");n.append(h)}if((F=B.select_all)!=null&&typeof F.hasClass==="function"&&F.hasClass("on")||this.stack.length&&typeof(S=this.stack[this.stack.length-1][0]).hasClass==="function"&&S.hasClass("on"))B.body.find("li.toggleable").addClass("on")}else{d=$('<li class="message first last"></li>');d.text((E=(A=this.options.messages)!=null?A.no_results:void 0)!=null?E:"");n.append(d)}if(this.list_expanded()){h=
this.stack[this.stack.length-1][0].clone();h.addClass("expanded").removeClass("active first last");t.append(h).show()}else t.hide();if(g.expand){B.insertAfter(this.list);return this.menu.animate({left:"-="+this.menu.parent().css("width")},"fast",w(function(){this.list.animate({height:"1px"},"fast",w(function(){return this.ui_locked=false},this));this.list=B;return this.select_next(true)},this))}else{g.loading||this.select_next(true);return this.ui_locked=false}};l.prototype.prepare_post=function(d){var g,
h;d=$.extend(d,{search:this.input.val()},(h=this.options.base_data)!=null?h:{});d.exclude=this.input.base_exclude.concat(this.stack.length?[]:this.input.token_values());if(this.list_expanded())d.context=this.stack[this.stack.length-1][0].data("id");if(d.per_page==null)d.per_page=typeof(g=this.options).limiter==="function"?g.limiter({level:this.stack.length}):void 0;return d};return l}();$.fn.scrollIntoView=function(l){var d,g,h,n,t,B;if(l==null)l={};d=this.offsetParent();h=d.scrollTop();g=h+d.height();
t=this[0].offsetTop;n=t+$(this[0]).outerHeight();if((B=l.ignore)!=null&&B.border){t+=parseInt($(this[0]).css("border-top-width").replace("px",""));n-=parseInt($(this[0]).css("border-bottom-width").replace("px",""))}if(t<h)return d.scrollTop(t);else if(n>g)return d.scrollTop(n-d.height())};I18n.scoped("conversations",function(l){var d,g,h,n,t,B,A,E,O,S,K,F,W,I,P,X,Y,Z,L,ea,T,V,fa,M,U,aa,ga,ba,Q,J;ga=function(){var b;b=r==null;j.find("#recipient_info").showIf(b);j.find("#group_conversation_info").hide();
$("#action_compose_message").toggleClass("active",b);if(b){j.find(".audience").html(l.t("headings.new_message","New Message"));j.addClass("new");j.find("#action_add_recipients").hide();j.attr({action:"/conversations"})}else{j.find(".audience").html(r.find(".audience").html());j.removeClass("new");j.find("#action_add_recipients").showIf(!r.hasClass("private"));j.attr({action:r.find("a.details_link").attr("add_url")})}T();j.find("#user_note_info").hide().find("input").attr("checked",false);return j.show().find(":input:visible:first").focus()};
T=function(){r!=null&&j.find(".audience").html(r.find(".audience").html());j.find("input[name!=authenticity_token], textarea").val("").change();j.find(".attachment:visible").remove();j.find(".media_comment").hide();j.find("#action_media_comment").show();return I()};Z=function(b){var a,f,i,m,p;if(b==null)b=window.location.search.substr(1);a={};p=b.split(/\&/);b=0;for(m=p.length;b<m;b++){f=p[b];i=f.split(/\=/,2);f=i[0];i=i[1];a[decodeURIComponent(f)]=decodeURIComponent(i)}return a};P=function(b){return r&&
r.attr("id")===(b!=null?b.attr("id"):void 0)};fa=function(b,a){return $.ajaxJSON("/conversations/"+b,"GET",{},function(f){d(f.conversation,true);$("#conversation_"+b).hide();return V($("#conversation_"+b),$.extend(a,{data:f}))})};V=function(b,a){var f,i;if(a==null)a={};Q(false);if(P(b)){r.removeClass("inactive");s.find("li.selected").removeClass("selected")}else{s.removeClass("private").hide().html("");b!=null&&b.hasClass("private")&&s.addClass("private");if(r){r.removeClass("selected inactive");
u.scope==="unread"&&r.fadeOut("fast",function(){$(this).remove();return $("#no_messages").showIf(!q.find("li").length)});r=null}if(b)r=b.addClass("selected");if(r||$("#action_compose_message").length){ga();a.message&&j.find("#body").val(a.message)}else j.parent().hide();if(r){r.scrollIntoView();j.loadingImage();f=r;i=function(m){var p,v,c,e,k,o;if(P(f)){c=m.participants;p=0;for(v=c.length;p<v;p++){k=c[p];if(!((e=u.user_cache[k.id])!=null&&e.avatar_url)){u.user_cache[k.id]=k;k.html_name=K(k)}}if(m["private"]&&
(k=function(){var C,D,ca,da;ca=m.participants;da=[];C=0;for(D=ca.length;C<D;C++){k=ca[C];k.id!==u.user_id&&da.push(k)}return da}()[0]&&A(k)))j.find("#user_note_info").show();I();x.show();p=v=0;c=m.messages[0];for(e=m.submissions[0];c||e;)if(c&&(!e||$.parseFromISO(c.created_at).datetime>$.parseFromISO((o=e.submission_comments[e.submission_comments.length-1])!=null?o.created_at:void 0).datetime)){s.append(n(c));c=m.messages[++p]}else{s.append(t(e));e=m.submissions[++v]}j.loadingImage("remove");s.hide().slideDown("fast");
if(r.hasClass("unread"))return M(r,"read")}};return a.data?i(a.data):$.ajaxJSON(r.find("a.details_link").attr("href"),"GET",{},function(m){return i(m)},function(){return j.loadingImage("remove")})}else if(a.user_id){$("#from_conversation_id").val(a.from_conversation_id);$("#recipients").data("token_input").selector.add_by_user_id(a.user_id,a.from_conversation_id)}}};u.context_list=function(b,a){var f,i,m,p,v;if(a==null)a=2;v=function(){var c,e;c=b.courses;e=[];for(i in c)if(f=this.contexts.courses[i])e.push(f.name);
return e}.call(this).concat(function(){var c,e;c=b.groups;e=[];for(p in c)if(m=this.contexts.groups[p])e.push(m.name);return e}.call(this));return $.toSentence(v.sort(function(c,e){c=c.toLowerCase();e=e.toLowerCase();return c<e?-1:c>e?1:0}).slice(0,a))};K=function(b,a){var f,i;if(a==null)a={courses:b.common_courses,groups:b.common_groups};return $.h(b.name)+((f=a.courses)!=null&&f.length||(i=a.groups)!=null&&i.length?" <em>"+$.h(u.context_list(a))+"</em>":"")};A=function(b){var a,f,i;if(!u.notes_enabled)return false;
if(b.can_add_notes)return true;f=b.common_courses;for(a in f){b=f[a];if(H.call(b,"StudentEnrollment")>=0&&(u.can_add_notes_for_account||(i=u.contexts.courses[a])!=null&&i.can_add_notes))return true}return false};O=function(b){var a,f,i,m,p,v,c,e;f=[];i=[];b=b.replace(/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))|(LINK_PLACEHOLDER)/gi,
function(k){var o;i.push(k==="LINK_PLACEHOLDER"?"LINK_PLACEHOLDER":(o=k,o.slice(0,4)==="www"&&(o="http://"+o),o=encodeURI(o).replace(/'/g,"%27"),f.push(o),"<a href='"+$.h(o)+"'>"+$.h(k)+"</a>"));return"LINK_PLACEHOLDER"});b=$.h(b);b=b.replace(RegExp("LINK_PLACEHOLDER","g"),function(){return i.shift()});b=b.replace(/\n/g,"<br />\n");m=[];p=[];c=0;v=function(k){c+=1;return"<div class='quoted_text_holder'>        <a href='#' class='show_quoted_text_link'>"+l.t("quoted_text_toggle","show quoted text")+
"</a>        <div class='quoted_text' style='display: none;'>          "+k.join("\n")+"        </div>      </div>"};e=b.split("\n");for(a in e){b=e[a];if(b.match(/^(&gt;|>)/))p.push(b);else{p.length&&m.push(v(p));p=[];m.push(b)}}p.length&&m.push(v(p));return b=m.join("\n")};n=function(b){var a,f,i,m,p,v,c;i=$("#message_blank").clone(true).attr("id","message_"+b.id);i.data("id",b.id);i.addClass(b.generated?"generated":b.author_id===u.user_id?"self":"other");a=u.user_cache[b.author_id];if(f=a!=null?
a.avatar_url:void 0)i.prepend($("<img />").attr("src",f).addClass("avatar"));if(a)if(a.html_name==null)a.html_name=K(a);f=(v=a!=null?a.name:void 0)!=null?v:l.t("unknown_user","Unknown user");i.find(".audience").html((a!=null?a.html_name:void 0)||$.h(f));i.find("span.date").text($.parseFromISO(b.created_at).datetime_formatted);i.find("p").html(O(b.body));i.find("a.show_quoted_text_link").click(function(e){var k;k=$(this).parents(".quoted_text_holder").children(".quoted_text");if(k.length){e.stopPropagation();
e.preventDefault();k.show();return $(this).hide()}});a=i.find("a.send_private_message");f=$.replaceTags(a.attr("href"),{user_id:b.author_id,user_name:encodeURIComponent(f),from_conversation_id:r.data("id")});a.attr("href",f).click(function(e){return e.stopPropagation()});if((m=b.forwarded_messages)!=null&&m.length){m=$('<ul class="messages"></ul>');c=b.forwarded_messages;f=0;for(v=c.length;f<v;f++){a=c[f];m.append(n(a))}i.append(m)}m=i.find("ul.message_attachments").detach();f=m.find(".media_object_blank").detach();
a=m.find(".attachment_blank").detach();if(b.media_comment!=null||(p=b.attachments)!=null&&p.length){i.append(m);b.media_comment!=null&&m.append(h(f,b.media_comment));if(b.attachments!=null){v=b.attachments;p=0;for(f=v.length;p<f;p++){b=v[p];m.append(g(a,b))}}}return i};h=function(b,a){var f;f=b.clone(true).attr("id","media_comment_"+a.media_id);f.find("span.title").html($.h(a.display_name));f.find("span.media_comment_id").html($.h(a.media_id));return f};g=function(b,a){var f,i;f=b.clone(true).attr("id",
"attachment_"+a.id);f.data("id",a.id);f.find("span.title").html($.h(a.display_name));i=f.find("a");i.attr("href",a.url);i.click(function(m){return m.stopPropagation()});return f};ba=function(b){return"submission_"+b.assignment_id+"_"+b.user_id};t=function(b){var a,f,i,m,p,v,c,e;m=$("#submission_blank").clone(true).attr("id",ba(b));m.data("id",ba(b));p=m.find("ul");f=p.find("li.header");v=$.replaceTags(f.find("a").attr("href"),{course_id:b.assignment.course_id,assignment_id:b.assignment_id,id:b.user_id});
f.find("a").attr("href",v);if(i=u.user_cache[b.user_id])if(i.html_name==null)i.html_name=K(i);c=(e=i!=null?i.name:void 0)!=null?e:l.t("unknown_user","Unknown user");f.find(".title").html($.h(b.assignment.name));b.submitted_at&&f.find("span.date").text($.parseFromISO(b.submitted_at).datetime_formatted);f.find(".audience").html((i!=null?i.html_name:void 0)||$.h(c));i=b.score&&b.assignment.points_possible?""+b.score+" / "+b.assignment.points_possible:(a=b.score)!=null?a:l.t("not_scored","no score");
f.find(".score").html(i);a=p.find(".comment").detach();f=0;for(c=b.submission_comments.length-1;c>=0;c+=-1){i=b.submission_comments[c];if(f>=10)break;f++;i=B(a,i);f>4&&i.hide();p.append(i)}i=p.find(".more").detach();if(f>4){a=i.clone(true);a.find(".hidden").text(f-4);a.attr("title",$.h(l.t("titles.expand_inline","Show more comments")));a.click(function(){var k;k=$(this).closest(".submission");k.find(".more:hidden").show();$(this).hide();k.find(".comment:hidden").slideDown("fast");I();return false});
p.append(a)}if(b.submission_comments.length>f){i.find("a").attr("href",v).attr("target","_blank");i.find(".hidden").text(b.submission_comments.length-f);i.attr("title",$.h(l.t("titles.view_submission","Open submission in new window.")));b.submission_comments.length>4&&i.hide();p.append(i)}return m};B=function(b,a){var f,i,m,p;f=b.clone(true);m=u.user_cache[a.author_id];if(i=m!=null?m.avatar_url:void 0)f.prepend($("<img />").attr("src",i).addClass("avatar"));if(m)if(m.html_name==null)m.html_name=K(m);
i=(p=m!=null?m.name:void 0)!=null?p:l.t("unknown_user","Unknown user");f.find(".audience").html((m!=null?m.html_name:void 0)||$.h(i));f.find("span.date").text($.parseFromISO(a.created_at).datetime_formatted);f.find("p").html($.h(a.comment).replace(/\n/g,"<br />"));return f};W=function(b,a){return $.replaceTags(b.attr("href"),"id",a.data("id"))};F=function(b,a){var f,i,m;f=(i=a.loading_node)!=null?i:b.closest("ul.conversations li");f.length||(f=$("#conversation_actions").data("selected_conversation"));
f={loading_node:f,url:W(b,f),method:"POST",data:{}};a=$.extend(f,a);if((m=typeof a.before==="function"?a.before(a.loading_node,a):void 0)!=null?m:1){if((m=a.loading_node)!=null)m.loadingImage();return $.ajaxJSON(a.url,a.method,a.data,function(p){var v;if((v=a.loading_node)!=null)v.loadingImage("remove");return typeof a.success==="function"?a.success(a.loading_node,p):void 0},function(p){var v;if((v=a.loading_node)!=null)v.loadingImage("remove");return typeof a.error==="function"?a.error(a.loading_node,
p):void 0})}};d=function(b,a){var f;$("#no_messages").hide();f=$("#conversation_"+b.id);if(f.length)f.show();else f=$("#conversation_blank").clone(true).attr("id","conversation_"+b.id);f.data("id",b.id);b.avatar_url&&f.prepend($("<img />").attr("src",b.avatar_url).addClass("avatar"));f[a?"appendTo":"prependTo"](q).click(function(i){i.preventDefault();return U("#/conversations/"+$(this).data("id"))});J(f,b,null);a||f.hide().slideDown("fast");q.append($("#conversations_loader"));return f};S=function(b,
a){var f,i,m,p;if(a==null)a=2;f=b.audience;if(f.length===0)return"<span>"+$.h(l.t("notes_to_self","Monologue"))+"</span>";i="<em>"+$.h(u.context_list(b.audience_contexts))+"</em>";if(f.length===1)return"<span>"+$.h(u.user_cache[f[0]].name)+"</span> "+i;if(f.length>a)f=f.slice(0,a).concat([f.slice(a,f.length)]);return $.toSentence(function(){var v,c,e;e=[];v=0;for(c=f.length;v<c;v++){p=f[v];e.push(typeof p==="number"?"<span>"+$.h(u.user_cache[p].name)+"</span>":"<span class='others'>\n  "+$.h(l.t("other_recipients",
"other",{count:p.length}))+"\n  <span>\n    <ul>\n      "+function(){var k,o,C;C=[];k=0;for(o=p.length;k<o;k++){m=p[k];C.push("<li>"+$.h(u.user_cache[m].name)+"</li>")}return C}().join("")+"\n    </ul>\n  </span>\n</span>")}return e}())+" "+i};J=function(b,a,f){var i,m,p,v,c;if(f==null)f="slide";Q(false);i=b.find("a.details_link");i.attr("href",$.replaceTags(i.attr("href"),"id",a.id));i.attr("add_url",$.replaceTags(i.attr("add_url"),"id",a.id));if(a.participants){v=a.participants;m=0;for(p=v.length;m<
p;m++){i=v[m];u.user_cache[i.id]||(u.user_cache[i.id]=i)}}if(a.audience){b.data("audience",a.audience.concat([u.user_id]));b.find(".audience").html(S(a))}b.find(".actions a").click(function(e){e.preventDefault();e.stopImmediatePropagation();E();return X($(this))}).focus(function(){E();return X($(this))});if(a.message_count!=null){b.find(".count").text(a.message_count);b.find(".count").showIf(a.message_count>1)}b.find("span.date").text($.friendlyDatetime($.parseFromISO(a.last_message_at).datetime));
i=b.data("last_message_at")>a.last_message_at?"down":"up";b.data("last_message_at",a.last_message_at);b.data("label",a.label);b.find("p").text(a.last_message);if(a.properties.length){c=a.properties;p=0;for(v=c.length;p<v;p++){m=c[p];b.addClass(m)}}a["private"]&&b.addClass("private");a.label&&b.addClass("labeled").addClass(a.label);a.subscribed||b.addClass("unsubscribed");M(b,a.workflow_state);if(f)return ea(b,i,f)};ea=function(b,a,f){var i,m;b.show();m=b.data("last_message_at");i=b;if(a==="up")for(;i.prev()&&
i.prev().data("last_message_at")<m;)i=i.prev();else for(;i.next()&&i.next().data("last_message_at")>m;)i=i.next();if(i!==b)if(f==="immediate")return b.detach()[a==="up"?"insertBefore":"insertAfter"](i).scrollIntoView();else{f=b.clone().insertAfter(b);b.detach()[a==="up"?"insertBefore":"insertAfter"](i).animate({opacity:"toggle",height:"toggle"},0);f.animate({opacity:"toggle",height:"toggle"},200,function(){return $(this).remove()});return b.animate({opacity:"toggle",height:"toggle"},200,function(){return b.scrollIntoView()})}};
L=function(b){var a;a=P(b);return b.fadeOut("fast",function(){$(this).remove();$("#no_messages").showIf(!q.find("li").length);if(a)return U("")})};M=function(b,a){return b.removeClass("read unread archived").addClass(a)};$("#conversations").delegate(".actions a","blur",function(){return $(window).one("keyup",function(b){if(b.shiftKey)return E()})});X=function(b){var a;a={node:b,container:$("#conversation_actions"),conversation:b.closest("li"),parent:b.parent(),lists:$("#conversation_actions ul"),
listElements:$("#conversation_actions li"),focusable:$("a, input, select, textarea"),actions:{markAsRead:$("#action_mark_as_read").parent(),markAsUnread:$("#action_mark_as_unread").parent(),unsubscribe:$("#action_unsubscribe").parent(),subscribe:$("#action_subscribe").parent(),forward:$("#action_forward").parent(),archive:$("#action_archive").parent(),unarchive:$("#action_unarchive").parent(),"delete":$("#action_delete").parent(),deleteAll:$("#action_delete_all").parent()},labels:{group:$("#conversation_actions .label_group"),
icon:$("#conversation_actions .label_icon")}};G.activeActionMenu=a.node;a.parent.addClass("selected");a.container.addClass("selected");a.conversation.addClass("menu_active");b=a.conversation;a.container.data("selected_conversation",a.conversation);a.lists.removeClass("first last").hide();a.listElements.hide();a.conversation.hasClass("unread")&&a.actions.markAsRead.show();a.conversation.hasClass("read")&&a.actions.markAsUnread.show();a.labels.group.show();a.labels.icon.removeClass("checked");a.container.find(".label_icon."+
(b.data("label")||"none")).addClass("checked");if(a.conversation.hasClass("private")){a.actions.subscribe.hide();a.actions.unsubscribe.hide()}else{a.conversation.hasClass("unsubscribed")||a.actions.unsubscribe.show();a.conversation.hasClass("unsubscribed")&&a.actions.subscribe.show()}a.actions.forward.show();a.actions["delete"].show();a.actions.deleteAll.show();u.scope==="archived"?a.actions.unarchive.show():a.actions.archive.show();$(window).one("keydown",function(f){if(!(f.keyCode!==9||f.shiftKey))return a.focusable.one("focus.actions_menu",
function(i){G.nextElement=$(i.target);a.focusable.unbind(".actions_menu");a.container.find("a:visible:first").focus();a.container.find("a:visible:first").bind("blur.actions_menu",i,function(){return $(window).one("keyup",function(){if(!a.container.find("a:focus").length){a.container.find("a.visible").unbind(".actions_menu");return G.activeActionMenu.focus()}})});return a.container.find("a:visible:last").bind("blur.actions_menu",i,function(){return $(window).one("keyup",function(){if(!a.container.find("a:focus").length){a.container.find("a.visible").unbind(".actions_menu");
G.nextElement.focus();return E()}})})})});a.container.find('li[style*="list-item"]').parent().show();a.groups=a.container.find('ul[style*="block"]');if(a.groups.length){a.groups.first().addClass("first");a.groups.last().addClass("last")}b=a.node.offset();return a.container.css({left:b.left+a.node.width()/2-a.container.offsetParent().offset().left-a.container.width()/2,top:b.top+a.node.height()*0.9-a.container.offsetParent().offset().top})};E=function(){$("#actions .menus > li, #conversation_actions, #conversations .actions").removeClass("selected");
return $("#conversations li.menu_active").removeClass("menu_active")};Y=function(b){var a;E();if(!b.hasClass("disabled")){b=b.parent("li, span").addClass("selected").find("div");a=-(b.parent().position().left+b.parent().outerWidth()/2)+6;if(a<-(b.outerWidth()/2))a=-(b.outerWidth()/2);return b.css("margin-left",a+"px")}};I=function(){var b;b=$(window).height()-$("#header").outerHeight(true)-($("#wrapper-container").outerHeight(true)-$("#wrapper-container").height())-($("#main").outerHeight(true)-$("#main").height())-
$("#breadcrumbs").outerHeight(true)-$("#footer").outerHeight(true);if(b<425)b=425;$("#inbox").height(b);s.height(b-j.outerHeight(true));return q.height(b-$("#actions").outerHeight(true))};Q=function(b){if(b!=null){s.find("> li").removeClass("selected");s.find("> li :checkbox").attr("checked",false)}else b=!!s.find("li.selected").length;b?$("#message_actions").slideDown(100):$("#message_actions").slideUp(100);return j[b?"addClass":"removeClass"]("disabled")};aa=function(b){q.removeClass("red orange yellow green blue purple").addClass(b);
$.cookie("last_label",b);return y=b};U=function(b){if(b!==location.hash){location.hash=b;return $(document).triggerHandler("document_fragment_change",b)}};$.extend(window,{MessageInbox:u});return $(document).ready(function(){var b,a,f,i,m,p,v;z=$("#conversations");q=z.find("ul.conversations");aa((f=$.cookie("last_label"))!=null?f:"red");x=$("#messages");s=x.find("ul.messages");j=$("#create_message_form");b=$("#add_recipients_form");a=$("#forward_message_form");$("#help_crumb").click(function(c){c.preventDefault();
return $.conversationsIntroSlideshow()});$("#create_message_form, #forward_message_form").find("textarea").elastic().keypress(function(c){if(c.which===13&&c.shiftKey){c.preventDefault();$(this).closest("form").submit();return false}});j.submit(function(c){var e;(e=!!(j.find("#body").val()&&(j.find("#recipient_info").filter(":visible").length===0||j.find(".token_input li").length>0)))||c.stopImmediatePropagation();return e});j.formSubmit({fileUpload:function(){return $(this).find(".file_input:visible").length>
0},beforeSubmit:function(){return $(this).loadingImage()},success:function(c){var e,k,o,C;$(this).loadingImage("remove");if(c.length>1){o=0;for(C=c.length;o<C;o++){k=c[o];e=$("#conversation_"+k.id);e.length&&J(e,k,"immediate")}$.flashMessage(l.t("messages_sent","Messages Sent"))}else{k=(e=c[0])!=null?e:c;e=$("#conversation_"+k.id);if(e.length){P(e)&&n(k.messages[0]).prependTo(s).slideDown("fast");J(e,k)}else{d(k);U("#/conversations/"+k.id)}$.flashMessage(l.t("message_sent","Message Sent"))}return T()},
error:function(){j.find(".token_input").errorBox(l.t("recipient_error","The course or group you have selected has no valid recipients"));$(".error_box").filter(":visible").css("z-index",10);return $(this).loadingImage("remove")}});j.click(function(){return Q(false)});b.submit(function(c){var e;(e=!!$(this).find(".token_input li").length)||c.stopImmediatePropagation();return e});b.formSubmit({beforeSubmit:function(){return $(this).loadingImage()},success:function(c){$(this).loadingImage("remove");
n(c.messages[0]).prependTo(s).slideDown("fast");J(r,c);T();return $(this).dialog("close")},error:function(){$(this).loadingImage("remove");return $(this).dialog("close")}});s.click(function(c){if(!$(c.target).closest("a.instructure_inline_media_comment").length){c=$(c.target).closest("#messages > ul > li");if(!(c.hasClass("generated")||c.hasClass("submission"))){r!=null&&r.addClass("inactive");c.toggleClass("selected");c.find("> :checkbox").attr("checked",c.hasClass("selected"))}return Q()}});$(".menus > li > a").click(function(c){c.preventDefault();
return Y($(this))}).focus(function(){return Y($(this))});$(document).bind("mousedown",function(c){$(c.target).closest("span.others").find("> span").length||$("span.others > span").hide();if(!$(c.target).closest(".menus > li, #conversation_actions, #conversations .actions").length)return E()});$("#menu_views").parent().find("li a").click(function(){E();return $("#menu_views").text($(this).text())});$("#message_actions").find("a").click(function(c){return c.preventDefault()});$("#conversation_actions").find("li a").click(function(c){c.preventDefault();
return E()});$(".action_mark_as_read").click(function(c){c.preventDefault();c.stopImmediatePropagation();return F($(this),{method:"PUT",before:function(e){u.scope!=="unread"&&M(e,"read");return true},success:function(e){if(u.scope==="unread")return L(e)},error:function(e){if(u.scope!=="unread")return M(e("unread"))}})});$(".action_mark_as_unread").click(function(c){c.preventDefault();c.stopImmediatePropagation();return F($(this),{method:"PUT",before:function(e){return M(e,"unread")},error:function(e){return M(e,
"read")}})});$(".action_remove_label").click(function(c){var e;c.preventDefault();c.stopImmediatePropagation();e=null;return F($(this),{method:"PUT",before:function(k){(e=k.data("label"))&&k.removeClass("labeled "+e);return e},success:function(k,o){J(k,o);if(u.scope==="labeled")return L(k)},error:function(k){return k.addClass("labeled "+e)}})});$(".action_add_label").click(function(c){var e,k;c.preventDefault();c.stopImmediatePropagation();e=k=null;return F($(this),{method:"PUT",before:function(o,
C){e=o.data("label");k=C.url.match(/%5Blabel%5D=(.*)/)[1];if(k==="last"){k=y;C.url=C.url.replace(/%5Blabel%5D=last/,"%5Blabel%5D="+k)}o.removeClass("red orange yellow green blue purple").addClass("labeled").addClass(k);return k!==e},success:function(o,C){J(o,C);aa(k);if(u.label_scope&&u.label_scope!==k)return L(o)},error:function(o){o.removeClass("labeled "+k);if(e)return o.addClass("labeled "+e)}})});$("#action_add_recipients").click(function(c){c.preventDefault();return b.attr("action",W($(this),
r)).dialog("close").dialog({width:420,title:l.t("title.add_recipients","Add Recipients"),buttons:[{text:l.t("buttons.add_people","Add People"),click:function(){return $(this).submit()}},{text:l.t("#buttons.cancel","Cancel"),click:function(){return $(this).dialog("close")}}],open:function(){$("#add_recipients").data("token_input").base_exclude=r.data("audience");return $(this).find("input[name!=authenticity_token]").val("").change()},close:function(){return $("#add_recipients").data("token_input").input.blur()}})});
$("#action_subscribe").click(function(){return F($(this),{method:"PUT",data:{subscribed:1},success:function(c){return c.removeClass("unsubscribed")}})});$("#action_unsubscribe").click(function(){return F($(this),{method:"PUT",data:{subscribed:0},success:function(c){return c.addClass("unsubscribed")}})});$("#action_archive, #action_unarchive").click(function(){return F($(this),{method:"PUT",success:L})});$("#action_delete_all").click(function(){if(confirm(l.t("confirm.delete_conversation","Are you sure you want to delete your copy of this conversation? This action cannot be undone.")))return F($(this),
{method:"DELETE",success:L})});$("#action_delete").click(function(){var c,e;c=s.find(".selected");e=c.length>1?l.t("confirm.delete_messages","Are you sure you want to delete your copy of these messages? This action cannot be undone."):l.t("confirm.delete_message","Are you sure you want to delete your copy of this message? This action cannot be undone.");if(confirm(e)){c.fadeOut("fast");return F($(this),{loading_node:r,data:{remove:function(){var k,o,C;C=[];k=0;for(o=c.length;k<o;k++){e=c[k];C.push(parseInt(e.id.replace(/message_/,
"")))}return C}()},success:function(k,o){if(s.find("> li").not(".selected, .generated, .submission").length){c.remove();return J(k,o)}else return L(k)},error:function(){return c.show()}})}});$("#action_forward").click(function(){var c;a.find("input[name!=authenticity_token], textarea").val("").change();c=a.find("ul.messages").first();c.html("");c.html(s.find("> li.selected").clone(true).removeAttr("id").removeClass("self"));c.find("> li").removeClass("selected odd").find("> :checkbox").attr("checked",
true).attr("name","forwarded_message_ids[]").val(function(){return $(this).closest("li").data("id")});c.find("> li").last().addClass("last");return a.css("max-height",$(window).height()-300+"px").dialog("close").dialog({position:"center",height:"auto",width:510,title:l.t("title.forward_messages","Forward Messages"),buttons:[{text:l.t("buttons.send_message","Send"),click:function(){return $(this).submit()}},{text:l.t("#buttons.cancel","Cancel"),click:function(){return $(this).dialog("close")}}],close:function(){return $("#forward_recipients").data("token_input").input.blur()}})});
a.submit(function(c){var e;(e=!!($(this).find("#forward_body").val()&&$(this).find(".token_input li").length))||c.stopImmediatePropagation();return e});a.formSubmit({beforeSubmit:function(){return $(this).loadingImage()},success:function(c){var e;e=c[0];$(this).loadingImage("remove");c=$("#conversation_"+e.id);if(c.length){P(c)&&n(e.messages[0]).prependTo(s).slideDown("fast");J(c,e)}else d(e);U("#/conversations/"+e.id);T();return $(this).dialog("close")},error:function(){$(this).loadingImage("remove");
return $(this).dialog("close")}});$("#cancel_bulk_message_action").click(function(){return Q(false)});$("#conversation_blank .audience, #create_message_form .audience").click(function(c){var e;if((e=$(c.target).closest("span.others").find("> span")).length){if(!$(c.target).closest("span.others > span").length){$("span.others > span").not(e).hide();e.toggle();e.css("left",e.parent().position().left);e.css("top",e.parent().height()+e.parent().position().top)}c.preventDefault();return false}});i=0;$("#action_add_attachment").click(function(c){c.preventDefault();
c=$("#attachment_blank").clone(true);c.attr("id",null);c.find("input[type='file']").attr("name","attachments["+i++ +"]");$("#attachment_list").append(c);c.slideDown("fast",function(){return I()});return false});$("#attachment_blank a.remove_link").click(function(c){c.preventDefault();$(this).parents(".attachment").slideUp("fast",function(){I();return $(this).remove()});return false});$("#action_media_comment").click(function(c){c.preventDefault();return $("#create_message_form .media_comment").mediaComment("create",
"audio",function(e,k){$("#media_comment_id").val(e);$("#media_comment_type").val(k);$("#create_message_form .media_comment").show();return $("#action_media_comment").hide()})});$("#create_message_form .media_comment a.remove_link").click(function(c){c.preventDefault();$("#media_comment_id").val("");$("#media_comment_type").val("");$("#create_message_form .media_comment").hide();return $("#action_media_comment").show()});v=u.initial_conversations;m=0;for(p=v.length;m<p;m++){f=v[m];d(f,true)}$("#no_messages").showIf(!q.find("li:not([id=conversations_loader])").length);
$(".recipients").tokenInput({placeholder:l.t("recipient_field_placeholder","Enter a name, course, or group"),added:function(c,e,k){var o;if(k&&c.type){e.addClass(c.type);if(c.user_count!=null){e.addClass("details");k=$("<span />");k.text(l.t("people_count","person",{count:c.user_count}));e.append(k)}}if(!(c.id&&(""+c.id).match(/^(course|group)_/))){c=$.extend({},c);delete c.avatar_url;e=(o=u.user_cache[c.id])!=null?o:{};return u.user_cache[c.id]=$.extend(e,c)}},selector:{messages:{no_results:l.t("no_results",
"No results found")},populator:function(c,e,k){var o,C,D;if(k==null)k={};if(e.avatar_url){D=$('<img class="avatar" />');D.attr("src",e.avatar_url);c.append(D)}D=e.context_name?e.context_name:"";D=D.length<40?D:D.substr(0,40)+"...";C=e.context_name?$("<span />",{"class":"context_name"}).text("("+D+")"):"";o=$("<b />");o.text(e.name);D=$("<span />",{"class":"name"});D.append(o,C);o=$("<span />",{"class":"details"});if(e.common_courses!=null)o.text(u.context_list({courses:e.common_courses,groups:e.common_groups}));
else if(e.type&&e.user_count!=null)o.text(l.t("people_count","person",{count:e.user_count}));else if(e.item_count!=null)if(e.id.match(/_groups$/))o.text(l.t("groups_count","group",{count:e.item_count}));else e.id.match(/_sections$/)&&o.text(l.t("sections_count","section",{count:e.item_count}));c.append(D,o);c.attr("title",e.name);D=e.name;if(k.parent)if(e.select_all&&e.no_expand)D=k.parent.data("text");else if((e.id+"").match(/_\d+_/))D=l.beforeLabel(k.parent.data("text"))+" "+D;c.data("text",D);
c.data("id",e.id);c.data("user_data",e);c.addClass(e.type?e.type:"user");if(k.level>0){c.prepend('<a class="toggle"><i></i></a>');e.item_count||c.addClass("toggleable")}if(e.type==="context"&&!e.no_expand){c.prepend('<a class="expand"><i></i></a>');return c.addClass("expandable")}},limiter:function(c){return c.level>0?-1:5},preparer:function(c,e,k){var o;o=c.context;if(!c.search&&o&&e.length>1)if(o.match(/^(course|section)_\d+$/))return e.unshift({id:""+o+"_all",name:l.t("enrollments_everyone","Everyone"),
user_count:k.data("user_data").user_count,type:"context",avatar_url:k.data("user_data").avatar_url,select_all:true});else if(o.match(/^((course|section)_\d+_.*|group_\d+)$/)&&!o.match(/^course_\d+_(groups|sections)$/))return e.unshift({id:o,name:l.t("select_all","Select All"),user_count:k.data("user_data").user_count,type:"context",avatar_url:k.data("user_data").avatar_url,select_all:true,no_expand:true})},base_data:{synthetic_contexts:1},browser:{data:{per_page:-1,type:"context"}}}});f=$("#recipients").data("token_input");
f.fake_input.css("width","100%");f.change=function(c){var e,k;if(c.length>1||(k=c[0])!=null&&k.match(/^(course|group)_/)){j.find("#group_conversation_info").is(":visible")||j.find("#group_conversation").attr("checked",false);j.find("#group_conversation_info").show();j.find("#user_note_info").hide()}else{j.find("#group_conversation").attr("checked",false);j.find("#group_conversation_info").hide();j.find("#user_note_info").showIf((e=u.user_cache[c[0]])&&A(e))}return I()};$(window).resize(I);setTimeout(I);
setTimeout(function(){return q.pageless({totalPages:Math.ceil(u.initial_conversations_count/u.conversation_page_size),container:q,params:{format:"json",per_page:u.conversations_per_page},loader:$("#conversations_loader"),scrape:function(c){var e,k,o;if(typeof c==="string"){try{c=$.parseJSON(c)||[]}catch(C){c=[]}k=0;for(o=c.length;k<o;k++){e=c[k];d(e,true)}}q.append($("#conversations_loader"));return false}},1)});return $(window).bind("hashchange",function(){var c,e,k,o;e=location.hash;if(k=e.match(/^#\/conversations\/(\d+)(\?(.*))?/)){o=
k[3]?Z(k[3]):{};return(c=$("#conversation_"+k[1]))&&c.length?V(c,o):fa(k[1],o)}else if($("#action_compose_message").length){o={};if(k=e.match(/^#\/conversations\?(.*)$/))o=Z(k[1]);return V(null,o)}}).triggerHandler("hashchange")})})}).call(this);
(function(){I18n.scoped("slideshow",function(q){var z,j;z=function(){function y(s,x){var r,u;this.title=s;this.slideshow=x;this.body=$("<li/>").addClass("slide");this.slideshow.slides.append(this.body);this.prevSlide=this.slideshow.slideObjects[this.slideshow.slideObjects.length-1];if((u=this.prevSlide)!=null)u.nextSlide=this;this.nextSlide=null;this.indicator=$("<a/>").addClass("slide").attr("href","#").attr("title",$.h(this.title)).html("&nbsp;");this.indicator.data("slide",this);this.slideshow.navigation.append(this.indicator);
r=this;this.indicator.click(function(){x.showSlide(r);return false});this.hide()}y.prototype.addParagraph=function(s,x){var r;r=$("<p/>");x!=null&&r.addClass(x);r.html($.h(s));return this.body.append(r)};y.prototype.addImage=function(s,x,r){s=$("<img/>").attr("src",s);x!=null&&s.addClass(x);if(r){x=$("<a/>").attr("href",r).attr("target","_blank");x.append(s);return this.body.append(x)}else return this.body.append(s)};y.prototype.show=function(){this.body.show();return this.indicator.addClass("current_slide")};
y.prototype.hide=function(){this.indicator.removeClass("current_slide");return this.body.hide()};return y}();j=function(){function y(s){var x;x=this;this.dom=$("<div/>").attr("id",s);this.slides=$("<ul/>").addClass("slides");this.dom.append(this.slides);this.separator=$("<div/>").addClass("separator");this.dom.append(this.separator);this.navigation=$("<div/>").addClass("navigation");this.dom.append(this.navigation);this.backButton=$("<a/>").addClass("back").attr("href","#").attr("title",$.h(q.t("titles.back",
"Back"))).html("&nbsp;");this.navigation.append(this.backButton);this.backButton.click(function(){x.showPrevSlide();return false});this.forwardButton=$("<a/>").addClass("forward").attr("href","#").attr("title",$.h(q.t("titles.forward","Forward"))).html("&nbsp;");this.navigation.append(this.forwardButton);this.forwardButton.click(function(){x.showNextSlide();return false});this.closeButton=$("<a/>").addClass("close").attr("href","#").attr("title",$.h(q.t("titles.close","Close"))).html("&nbsp;");this.navigation.append(this.closeButton);
this.closeButton.click(function(){x.close();return false});this.slideObjects=[];this.slideShown=null}y.prototype.addSlide=function(s,x){var r;r=new z(s,this);this.slideObjects.push(r);return x(r)};y.prototype.start=function(){this.showSlide(this.slideObjects[0]);return this.dialog=this.dom.dialog({dialogClass:"slideshow_dialog",height:529,width:700,modal:true,draggable:false,resizable:false})};y.prototype.showSlide=function(s){var x;if(s){if(!(this.slideShown&&s===this.slideShown)){if((x=this.slideShown)!=
null)x.hide();this.slideShown=s;this.slideShown.show()}this.slideShown.prevSlide?this.backButton.removeClass("inactive"):this.backButton.addClass("inactive");return this.slideShown.nextSlide?this.forwardButton.removeClass("inactive"):this.forwardButton.addClass("inactive")}};y.prototype.showPrevSlide=function(){var s;return this.showSlide((s=this.slideShown)!=null?s.prevSlide:void 0)};y.prototype.showNextSlide=function(){var s;return this.showSlide((s=this.slideShown)!=null?s.nextSlide:void 0)};y.prototype.close=
function(){var s;this.dom.dialog("close");this.dom.hide();if((s=this.slideShown)!=null)s.hide();return this.slideShown=null};return y}();return window.Slideshow=j})}).call(this);
(function(){I18n.scoped("conversations_intro",function(q){return $.conversationsIntroSlideshow=function(){var z;z=new window.Slideshow("conversations_intro");z.addSlide(q.t("titles.slide1","Slide 1"),function(j){j.addImage("/images/conversations/intro/icon.png","icon");j.addParagraph(q.t("slide1.paragraph1","Take a look at your Inbox!"),"large");j.addParagraph(q.t("slide1.paragraph2","Conversations\u2014the new Canvas messaging system\u2014has arrived!"),"large");j.addParagraph(q.t("slide1.paragraph3",
"Use Conversations to send a private message to a classmate or use Conversations to talk to an entire group of people."),"large_and_blue");return j.addParagraph(q.t("slide1.paragraph4","Ready for a short intro? Click the right arrow to get started."),"large")});z.addSlide(q.t("titles.slide2","Slide 2"),function(j){j.addImage("/images/conversations/intro/image2.png","screenshot");j.addParagraph(q.t("slide2.paragraph1","All your conversations are shown on the left side."));return j.addParagraph(q.t("slide2.paragraph2",
"You can see who the conversation is with, how many messages there are, and a few lines from the newest message in each conversation."))});z.addSlide(q.t("titles.slide3","Slide 3"),function(j){j.addImage("/images/conversations/intro/image3.png","screenshot");j.addParagraph(q.t("slide3.paragraph1",'Conversations can be marked as read/unread, archived, or labeled by color using the "actions" button on the message.'));return j.addParagraph(q.t("slide3.paragraph2","Archived messages aren't deleted, they're just moved out of your inbox, so you can access them again if needed."))});
z.addSlide(q.t("titles.slide4","Slide 4"),function(j){j.addImage("/images/conversations/intro/image4.png","screenshot");return j.addParagraph(q.t("slide4.paragraph1","When you select a conversation, all the messages for that conversation are shown in the panel on the right. When conversations get long, you can always scroll down to see earlier messages."))});z.addSlide(q.t("titles.slide5","Slide 5"),function(j){j.addImage("/images/conversations/intro/image5.png","screenshot");return j.addParagraph(q.t("slide5.paragraph1",
"To begin a message, start by clicking the Compose icon."))});z.addSlide(q.t("titles.slide6","Slide 6"),function(j){j.addImage("/images/conversations/intro/image6.png","screenshot");j.addParagraph(q.t("slide6.paragraph1","In the New Message box, start typing the person, or group's name, and they'll show up in the dropdown. Alternatively, you can click the address book icon to find someone if you don't remember a name."));return j.addParagraph(q.t("slide6.paragraph2","Type your message, click Send, and you're golden."))});
z.addSlide(q.t("titles.slide7","Slide 7"),function(j){j.addImage("/images/conversations/intro/image7.png","screenshot");j.addParagraph(q.t("slide7.paragraph1","You can send messages to one person or to a group of people. By default all group messages are available to everyone in the group."));return j.addParagraph(q.t("slide7.paragraph2",'If you wanted to send the message privately to all the recipients, uncheck the "This is a group conversation" checkbox.'))});z.addSlide(q.t("titles.slide8","Slide 8"),
function(j){j.addImage("/images/conversations/intro/image8.png","screenshot");j.addParagraph(q.t("slide8.paragraph1","You can select one or more messages by clicking the checkbox on the right hand side."));return j.addParagraph(q.t("slide8.paragraph2","Once selected, you can forward them to someone else, or delete them."))});z.addSlide(q.t("titles.slide9","Slide 9"),function(j){j.addImage("/images/conversations/intro/image9.png","screenshot","http://www.youtube.com/watch?v=NWqIaEyVWZM");j.addParagraph(q.t("slide9.paragraph1",
"We think you'll find Conversations simple and easy to use."));j.addParagraph(q.t("slide9.paragraph2","Check out this short introduction video to see Conversations in action."));return j.addParagraph(q.t("slide9.paragraph3","Your old messages have been organized into Conversations for you. So what are you waiting for? Get started!"))});z.dom.bind("dialogclose",function(){return $.ajaxJSON("/conversations/watched_intro","POST",{})});return z.start()}})}).call(this);
(function(q){q.fn.extend({elastic:function(z){var j=q.extend({},z),y=["paddingTop","paddingRight","paddingBottom","paddingLeft","borderLeftWidth","borderLeftStyle","borderRightWidth","borderRightStyle","fontSize","lineHeight","fontFamily","width","fontWeight"];return this.each(function(){function s(w,H){var l=Math.floor(parseInt(w,10));r.height()!=l&&r.css({height:l+"px",overflow:H})}function x(){var w=r.val().replace(/&/g,"&amp;").replace(/  /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),
H=u.html().replace(/<br>/ig,"<br />");if(w+"&nbsp;"!=H){u[0].innerHTML=w+"&nbsp;";u.width(r.width());w=u.height();if(Math.abs(w+N-r.height())>3){w+=N;if(w>=G)s(G,"auto");else w<=R?s(R,"hidden"):s(w,"hidden");q.isFunction(j.callback)&&j.callback()}}}if(this.type!="textarea")return false;var r=q(this),u=q("<div />").css({position:"absolute",display:"none","word-wrap":"break-word"}).prependTo(r.parent()),N=parseInt(r.css("line-height"),10)||parseInt(r.css("font-size"),"10"),R=parseInt(r.css("height"),
10)||N*3,G=parseInt(r.css("max-height"),10)||Number.MAX_VALUE;if(G<0)G=Number.MAX_VALUE;q.each(y,function(w,H){u.css(H,r.css(H))});r.css({overflow:"hidden"}).bind("keyup change cut paste",x).bind("input paste",function(){setTimeout(x,250)});x()})}})})(jQuery);
jQuery.cookie=function(q,z,j){if(typeof z!="undefined"){j=j||{};if(z===null){z="";j.expires=-1}var y="";if(j.expires&&(typeof j.expires=="number"||j.expires.toUTCString)){if(typeof j.expires=="number"){y=new Date;y.setTime(y.getTime()+j.expires*864E5)}else y=j.expires;y="; expires="+y.toUTCString()}var s=j.path?"; path="+j.path:"",x=j.domain?"; domain="+j.domain:"";j=j.secure?"; secure":"";document.cookie=[q,"=",encodeURIComponent(z),y,s,x,j].join("")}else{z=null;if(document.cookie&&document.cookie!=
""){j=document.cookie.split(";");for(y=0;y<j.length;y++){s=jQuery.trim(j[y]);if(s.substring(0,q.length+1)==q+"="){z=decodeURIComponent(s.substring(q.length+1));break}}}return z}};
