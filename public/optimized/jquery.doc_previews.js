define(["INST","i18n!instructure","jquery","vendor/scribd.view","str/htmlEscape","jquery.ajaxJSON","jquery.google-analytics","jquery.instructure_misc_helpers","jquery.loadingImg"],function(a,b,c,d,e){var f={"application/vnd.openxmlformats-officedocument.wordprocessingml.template":[1,1],"application/vnd.oasis.opendocument.spreadsheet":[1,1],"application/vnd.sun.xml.writer":[1,1],"application/excel":[1,1],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[1,1],"text/rtf":[1,!1],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":[1,1],"application/vnd.sun.xml.impress":[1,1],"application/vnd.sun.xml.calc":[1,1],"application/vnd.ms-excel":[1,1],"application/msword":[1,1],"application/mspowerpoint":[1,1],"application/rtf":[1,1],"application/vnd.oasis.opendocument.presentation":[1,1],"application/vnd.oasis.opendocument.text":[1,1],"application/vnd.openxmlformats-officedocument.presentationml.template":[1,1],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":[1,1],"text/plain":[1,!1],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[1,1],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[1,1],"application/postscript":[1,1],"application/pdf":[1,1],"application/vnd.ms-powerpoint":[1,1]};c.filePreviewsEnabled=function(){return!a.disableScribdPreviews||!a.disableGooglePreviews},c.isPreviewable=function(b,d){return c.filePreviewsEnabled()&&f[b]&&(!d||!a["disable"+c.capitalize(d)+"Previews"]&&f[b][{scribd:0,google:1}[d]])},c.fn.loadDocPreview=function(f){var g=swfobject.getFlashPlayerVersion(),h=g&&g.major>9;return this.each(function(){function j(a){i.attachment_view_inline_ping_url&&(c.ajaxJSON(i.attachment_view_inline_ping_url,"POST",{},function(){},function(){}),c.trackEvent("Doc Previews",a,JSON.stringify(i)))}var g=c(this),i=c.extend({height:"400px"},g.data(),f);if(!a.disableScribdPreviews&&i.scribd_doc_id&&i.scribd_access_key&&h&&d){var k=d.Document.getDoc(i.scribd_doc_id,i.scribd_access_key),l=g.attr("id"),m=c.extend({jsapi_version:1,disable_related_docs:!0,auto_size:!1,height:i.height,use_ssl:"https:"==document.location.protocol},i.scribdParams);l||(l=c.uniqueId("scribd_preview_"),g.attr("id",l)),c.each(m,function(a,b){k.addParam(a,b)}),c.isFunction(i.ready)&&k.addEventListener("iPaperReady",i.ready),k.write(l),this.childNodes[0].keyboardShortcutDown=this.childNodes[0].keyboardShortcutUp=function(){},j("scribd")}else if(!a.disableGooglePreviews&&(!i.mimeType||c.isPreviewable(i.mimeType,"google"))&&i.attachment_id||i.public_url){function n(){var a="//docs.google.com/viewer?"+c.param({embedded:!0,url:i.public_url});c('<iframe src="'+a+'" height="'+i.height+'" width="100%" />').appendTo(g).load(function(){j("google"),c.isFunction(i.ready)&&i.ready()})}if(i.public_url)n();else if(i.attachment_id){var o="/files/"+i.attachment_id+"/public_url.json";i.submission_id&&(o+="?"+c.param({submission_id:i.submission_id})),g.loadingImage(),c.ajaxJSON(o,"GET",{},function(a){g.loadingImage("remove"),a&&a.public_url&&(c.extend(i,a),n())})}}else g.html("<p>"+e(b.t("errors.cannot_view_document_inline","This document cannot be viewed inline, you might not have permission to view it or it might have been deleted."))+"</p>")})}})