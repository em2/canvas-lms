function prepareCanvasLF(a,b,c,d,e){if(d==1)return;var f=new Image;f.crossOrigin="",f.src=e;var g,h,i,j=!1,k,l=722,m=170,n=25,o=8,p="#cb3594",q="#659b41",r="#0033ff",s="#000000",t=new Image,u=new Image,v=new Image,w=new Array,x=new Array,y=new Array,z=new Array,A=new Array,B=new Array,C=!1,D=r,E="marker",F="normal",G=10,H=10,I=600,J=150,K=55,L=38,M=3,N=0;f.onload=function(){function e(){++N>=M&&V()}function o(){c=!1,V()}function p(){c=!0,V()}function q(){c&&(j=!0,O())}function s(){c&&(j=!1,P())}function O(a){if(!a)var a=event;c&&(h=a.pageX-k.offsetLeft,i=a.pageY-k.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-k.offsetTop+60,S(),V())}function P(a){if(!a)var a=event;c&&(a.preventDefault(),h=a.targetTouches[0].pageX-k.offsetLeft,i=a.targetTouches[0].pageY-k.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-k.offsetTop+60,S(),V(),j||(j=!0))}function Q(){c&&(j=!1,C=!1)}function R(){c&&(j=!1,C=!1)}function S(){h>G+I+16&&i>K&&!j&&(i<K+L*2?(E="marker",F="normal"):i<K+L*3&&(E="eraser",F="huge")),C=!0,T()}function T(){c&&C&&(w.push(h),x.push(i),z.push(E),y.push(D),A.push(F),B.push(j),$("#explain_canvas_"+b+"_click_x_data").val(w.toString()),$("#explain_canvas_"+b+"_click_y_data").val(x.toString()),$("#explain_canvas_"+b+"_click_color_data").val(y.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(z.toString()),$("#explain_canvas_"+b+"_click_size_data").val(A.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(B.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function U(){n.clearRect(0,0,l,m)}function V(){if(N<M)return;U(),E=="marker"&&c==1?n.drawImage(t,0,0,l,m):E=="eraser"&&c==1?n.drawImage(u,0,0,l,m):c?alert("Error: Current Tool is undefined"):n.drawImage(v,0,0,l-104,m);var a=649,b=37;c==1&&(n.beginPath(),n.moveTo(a,b),n.lineTo(a+10,b+6),n.lineTo(a,b+11),n.lineTo(a,b),n.closePath(),n.fillStyle=r,n.fill()),n.save(),n.beginPath(),n.rect(G,H,I,J),n.clip();var d,e=0;for(;e<w.length;e++)A[e]=="small"?d=2:A[e]=="normal"?d=3:A[e]=="large"?d=10:A[e]=="huge"?d=20:(alert("Error: Radius is zero for click "+e),d=0),n.beginPath(),B[e]?n.moveTo(w[e-1]-15,x[e-1]-70):n.moveTo(w[e]-15,x[e]-70),n.lineTo(w[e]-15,x[e]-70),n.closePath(),z[e]=="eraser"?n.strokeStyle="white":n.strokeStyle=y[e],n.lineJoin="round",n.lineWidth=d,n.stroke();n.restore(),n.globalAlpha=1,n.drawImage(f,G,H,I,J)}if($("#explain_canvas_"+b+"_click_x_data").val().length>0){w=$("#explain_canvas_"+b+"_click_x_data").val(),w=w.split(","),x=$("#explain_canvas_"+b+"_click_y_data").val(),x=x.split(","),y=$("#explain_canvas_"+b+"_click_color_data").val(),y=y.split(","),z=$("#explain_canvas_"+b+"_click_tool_data").val(),z=z.split(","),A=$("#explain_canvas_"+b+"_click_size_data").val(),A=A.split(","),B=$("#explain_canvas_"+b+"_click_drag_data").val(),B=B.split(",");for(var d=0;d<w.length;d++)w[d]=parseInt(w[d]),x[d]=parseInt(x[d]);for(var d=0;d<B.length;d++)B[d]=="true"?B[d]=!0:B[d]=!1}var g=document.getElementById(a),k=document.createElement("canvas");k.setAttribute("width",l),k.setAttribute("height",m),k.setAttribute("id","canvas_"+a),k.setAttribute("name","canvas_"+a),g.appendChild(k),typeof G_vmlCanvasManager!="undefined"&&(k=G_vmlCanvasManager.initElement(k));var n=k.getContext("2d");t.onload=function(){e()},t.src="../../../../images/canvas_drawing/marker-background_LF.png",u.onload=function(){e()},u.src="../../../../images/canvas_drawing/eraser-background_LF.png",v.onload=function(){e()},v.src="../../../../images/canvas_drawing/plain-background_LF.png",$("#canvas_"+a).bind("mousedown",function(a){q()}),$("#canvas_"+a).bind("mousemove",function(a){O(a.originalEvent)}),$(document.body).bind("mouseup",function(a){Q()}),$("#canvas_"+a).bind("touchstart",function(a){s()}),$("#canvas_"+a).bind("touchmove",function(a){P(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){R()}),$(document.body).bind("touchcancel",function(a){R()}),$("#canvas_"+a).bind("hideYerStuff",function(a){o()}),$("#canvas_"+a).bind("showYerStuff",function(a){p()})}}