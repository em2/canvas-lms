function prepareCanvasLF(a,b,c,d,e){function f(){++ba>=_&&r()}function g(){c=!1,r()}function h(){c=!0,r()}function i(a){c&&(x=!0,k(a))}function j(a){c&&(x=!1,l(a))}function k(a){c&&(v=a.pageX-u.offsetLeft,w=a.pageY-u.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-u.offsetTop+60,o(),s())}function l(a){c&&(a.preventDefault(),v=a.targetTouches[0].pageX-u.offsetLeft,w=a.targetTouches[0].pageY-u.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-u.offsetTop+60,o(),s(),x||(x=!0))}function m(){c&&(x=!1,Q=!1)}function n(){c&&(x=!1,Q=!1)}function o(){v>U+W+16&&w>Y&&!x&&(w<Y+Z*2?(S="marker",T="normal"):w<Y+Z*3&&(S="eraser",T="huge")),Q=!0,p()}function p(){c&&Q&&(K.push(v),L.push(w),N.push(S),M.push(R),O.push(T),P.push(x),$("#explain_canvas_"+b+"_click_x_data").val(K.toString()),$("#explain_canvas_"+b+"_click_y_data").val(L.toString()),$("#explain_canvas_"+b+"_click_color_data").val(M.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(N.toString()),$("#explain_canvas_"+b+"_click_size_data").val(O.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(P.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function q(){y.clearRect(0,0,z,A)}function r(){if(ba<_)return;q(),S=="marker"&&c==1?y.drawImage(H,0,0,z,A):S=="eraser"&&c==1?y.drawImage(I,0,0,z,A):c?alert("Error: Current Tool is undefined"):y.drawImage(J,0,0,z-104,A);var a=649,b=37;c==1&&(y.beginPath(),y.moveTo(a,b),y.lineTo(a+10,b+6),y.lineTo(a,b+11),y.lineTo(a,b),y.closePath(),y.fillStyle=F,y.fill()),y.save(),y.beginPath(),y.rect(U,V,W,X),y.clip();var d,e=0;for(;e<K.length;e++)O[e]=="small"?d=2:O[e]=="normal"?d=3:O[e]=="large"?d=10:O[e]=="huge"?d=20:(alert("Error: Radius is zero for click "+e),d=0),y.beginPath(),P[e]?y.moveTo(K[e-1]-15,L[e-1]-70):y.moveTo(K[e]-15,L[e]-70),y.lineTo(K[e]-15,L[e]-70),y.closePath(),N[e]=="eraser"?y.strokeStyle="white":y.strokeStyle=M[e],y.lineJoin="round",y.lineWidth=d,y.stroke(),bb=e;y.restore(),y.globalAlpha=1,y.drawImage(t,U,V+X/2,W,X)}function s(){var a,b,d,e;b=bb;for(;b<K.length;b++)O[b]=="small"?a=2:O[b]=="normal"?a=3:O[b]=="large"?a=10:O[b]=="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),y.beginPath(),P[b]&&b?y.moveTo(K[b-1]-15,L[b-1]-70):y.moveTo(K[b]-15,L[b]-70),y.lineTo(K[b]-15,L[b]-70),y.closePath(),N[b]=="eraser"?y.strokeStyle="white":y.strokeStyle=M[b],y.lineJoin="round",y.lineWidth=a,y.stroke(),bb=b,S=="marker"&&c==1?y.drawImage(H,0,0,z,A):S=="eraser"&&c==1?y.drawImage(I,0,0,z,A):c?alert("Error: Current Tool is undefined"):y.drawImage(J,0,0,z-104,A),d=649,e=37,c==1&&(y.beginPath(),y.moveTo(d,e),y.lineTo(d+10,e+6),y.lineTo(d,e+11),y.lineTo(d,e),y.closePath(),y.fillStyle=F,y.fill()),y.drawImage(t,U,V+X/2,W,X)}if(d==1)return;var t=new Image;t.crossOrigin="";var u,v,w,x=!1,y,z=722,A=350,B=25,C=8,D="#cb3594",E="#659b41",F="#0033ff",G="#000000",H=new Image,I=new Image,J=new Image,K=new Array,L=new Array,M=new Array,N=new Array,O=new Array,P=new Array,Q=!1,R=F,S="marker",T="normal",U=10,V=10,W=600,X=150,Y=55,Z=38,_=4,ba=0,bb=0;if($("#explain_canvas_"+b+"_click_x_data").val().length>0){K=$("#explain_canvas_"+b+"_click_x_data").val(),K=K.split(","),L=$("#explain_canvas_"+b+"_click_y_data").val(),L=L.split(","),M=$("#explain_canvas_"+b+"_click_color_data").val(),M=M.split(","),N=$("#explain_canvas_"+b+"_click_tool_data").val(),N=N.split(","),O=$("#explain_canvas_"+b+"_click_size_data").val(),O=O.split(","),P=$("#explain_canvas_"+b+"_click_drag_data").val(),P=P.split(",");for(var bc=0;bc<K.length;bc++)K[bc]=parseInt(K[bc]),L[bc]=parseInt(L[bc]);for(var bc=0;bc<P.length;bc++)P[bc]=="true"?P[bc]=!0:P[bc]=!1}var bd=document.getElementById(a),u=document.createElement("canvas");u.setAttribute("width",z),u.setAttribute("height",A),u.setAttribute("id","canvas_"+a),u.setAttribute("name","canvas_"+a),bd.appendChild(u),typeof G_vmlCanvasManager!="undefined"&&(u=G_vmlCanvasManager.initElement(u));var y=u.getContext("2d");H.onload=function(){f()},H.src="../../../../images/canvas_drawing/marker-background_LF.png",I.onload=function(){f()},I.src="../../../../images/canvas_drawing/eraser-background_LF.png",J.onload=function(){f()},J.src="../../../../images/canvas_drawing/plain-background_LF.png",t.onload=function(){f()},t.src=e,$("#canvas_"+a).bind("mousedown",function(a){i(a.originalEvent)}),$("#canvas_"+a).bind("mousemove",function(a){k(a.originalEvent)}),$(document.body).bind("mouseup",function(a){m()}),$("#canvas_"+a).bind("touchstart",function(a){j(a.originalEvent)}),$("#canvas_"+a).bind("touchmove",function(a){l(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){n()}),$(document.body).bind("touchcancel",function(a){n()}),$("#canvas_"+a).bind("hideYerStuff",function(a){g()}),$("#canvas_"+a).bind("showYerStuff",function(a){h()})}