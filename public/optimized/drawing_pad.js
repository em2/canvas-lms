function prepareCanvas(a,b,c,d){function e(){++W>=V&&o()}function f(){c&&(s=!0,h())}function g(){c&&(s=!1,i())}function h(a){if(!a)var a=event;c&&(q=a.pageX-p.offsetLeft,r=a.pageY-p.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-p.offsetTop+60,l(),o())}function i(a){if(!a)var a=event;c&&(a.preventDefault(),q=a.targetTouches[0].pageX-p.offsetLeft,r=a.targetTouches[0].pageY-p.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-p.offsetTop+60,l(),o(),s||(s=!0))}function j(){c&&(s=!1,L=!1)}function k(){c&&(s=!1,L=!1)}function l(){q>P+R+16&&r>T&&!s&&(r<T+U*2?(N="marker",O="normal"):r<T+U*3&&(N="eraser",O="huge")),L=!0,m()}function m(){c&&L&&(F.push(q),G.push(r),I.push(N),H.push(M),J.push(O),K.push(s),$("#explain_canvas_"+b+"_click_x_data").val(F.toString()),$("#explain_canvas_"+b+"_click_y_data").val(G.toString()),$("#explain_canvas_"+b+"_click_color_data").val(H.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(I.toString()),$("#explain_canvas_"+b+"_click_size_data").val(J.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(K.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function n(){t.clearRect(0,0,u,v)}function o(){if(W<V)return;n(),N=="marker"&&c==1?t.drawImage(C,0,0,u,v):N=="eraser"&&c==1?t.drawImage(D,0,0,u,v):c?alert("Error: Current Tool is undefined"):t.drawImage(E,0,0,u-104,v);var a=313,b=75;c==1&&(t.beginPath(),t.moveTo(a,b),t.lineTo(a+10,b+6),t.lineTo(a,b+11),t.lineTo(a,b),t.closePath(),t.fillStyle=A,t.fill()),t.save(),t.beginPath(),t.rect(P,Q,R,S),t.clip();var d,e=0;for(;e<F.length;e++)J[e]=="small"?d=2:J[e]=="normal"?d=3:J[e]=="large"?d=10:J[e]=="huge"?d=20:(alert("Error: Radius is zero for click "+e),d=0),t.beginPath(),K[e]&&e?t.moveTo(F[e-1]-15,G[e-1]-70):t.moveTo(F[e]-15,G[e]-70),t.lineTo(F[e]-15,G[e]-70),t.closePath(),I[e]=="eraser"?t.strokeStyle="white":t.strokeStyle=H[e],t.lineJoin="round",t.lineWidth=d,t.stroke();t.restore(),t.globalAlpha=1}if(d==1)return;var p,q,r,s=!1,t,u=386,v=220,w=25,x=8,y="#cb3594",z="#659b41",A="#0033ff",B="#000000",C=new Image,D=new Image,E=new Image,F=new Array,G=new Array,H=new Array,I=new Array,J=new Array,K=new Array,L=!1,M=A,N="marker",O="normal",P=7,Q=11,R=267,S=200,T=95,U=38,V=3,W=0;if($("#explain_canvas_"+b+"_click_x_data").val().length>0){F=$("#explain_canvas_"+b+"_click_x_data").val(),F=F.split(","),G=$("#explain_canvas_"+b+"_click_y_data").val(),G=G.split(","),H=$("#explain_canvas_"+b+"_click_color_data").val(),H=H.split(","),I=$("#explain_canvas_"+b+"_click_tool_data").val(),I=I.split(","),J=$("#explain_canvas_"+b+"_click_size_data").val(),J=J.split(","),K=$("#explain_canvas_"+b+"_click_drag_data").val(),K=K.split(",");for(var X=0;X<F.length;X++)F[X]=parseInt(F[X]),G[X]=parseInt(G[X]);for(var X=0;X<K.length;X++)K[X]=="true"?K[X]=!0:K[X]=!1}var Y=document.getElementById(a),p=document.createElement("canvas");p.setAttribute("width",u),p.setAttribute("height",v),p.setAttribute("id","canvas_"+a),p.setAttribute("name","canvas_"+a),Y.appendChild(p),typeof G_vmlCanvasManager!="undefined"&&(p=G_vmlCanvasManager.initElement(p));var t=p.getContext("2d");C.onload=function(){e()},C.src="../../../../images/canvas_drawing/marker-background.png",D.onload=function(){e()},D.src="../../../../images/canvas_drawing/eraser-background.png",E.onload=function(){e()},E.src="../../../../images/canvas_drawing/plain-background.png",$("#canvas_"+a).bind("mousedown",function(a){f()}),$("#canvas_"+a).bind("mousemove",function(a){h(a.originalEvent)}),$(document.body).bind("mouseup",function(a){j()}),$("#canvas_"+a).bind("touchstart",function(a){g()}),$("#canvas_"+a).bind("touchmove",function(a){i(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){k()}),$(document.body).bind("touchcancel",function(a){k()})}