function prepareCanvas(a,b,c,d){function R(){++M>=L&&be()}function T(){c=!1,be()}function U(){c=!0,be()}function V(a){c&&(h=!0,X(a))}function W(a){c&&(h=!1,Y(a))}function X(a){if(c){var b=Z(a);f=b.x,g=b.y,bb(),bf()}}function Y(a){if(c){a.preventDefault();var b=Z(a);f=b.x,g=b.y,bb(),bf(),h||(h=!0)}}function Z(a){var b=e.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}}function _(){c&&(h=!1,B=!1)}function ba(){c&&(h=!1,B=!1)}function bb(){f>F+H&&g>J&&!h&&(g<J+K?(D="marker",E="normal"):g<J+K*2&&(D="eraser",E="huge")),B=!0,bc()}function bc(){c&&B&&(v.push(f),w.push(g),y.push(D),x.push(C),z.push(E),A.push(h),$("#explain_canvas_"+b+"_click_x_data").val(v.toString()),$("#explain_canvas_"+b+"_click_y_data").val(w.toString()),$("#explain_canvas_"+b+"_click_color_data").val(x.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(y.toString()),$("#explain_canvas_"+b+"_click_size_data").val(z.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(A.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function bd(){i.clearRect(0,0,j,k)}function be(){if(M<L)return;bd(),i.drawImage(u,0,0,j,k),D=="marker"&&c==1?i.drawImage(r,0,0,j,k):D=="eraser"&&c==1?i.drawImage(s,0,0,j,k):c?alert("Error: Current Tool is undefined"):i.drawImage(t,0,0,j-104,k),c==1&&(i.beginPath(),i.moveTo(O,P),i.lineTo(O+10,P+6),i.lineTo(O,P+11),i.lineTo(O,P),i.closePath(),i.fillStyle=p,i.fill()),i.save(),i.beginPath(),i.rect(F,G,H,I),i.clip();var a,b=0;for(;b<v.length;b++)z[b]=="small"?a=2:z[b]=="normal"?a=3:z[b]=="large"?a=10:z[b]=="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),i.beginPath(),A[b]&&b?i.moveTo(v[b-1],w[b-1]):i.moveTo(v[b],w[b]),i.lineTo(v[b],w[b]),i.closePath(),y[b]=="eraser"?i.strokeStyle="white":i.strokeStyle=x[b],i.lineJoin="round",i.lineWidth=a,i.stroke(),N=b;i.restore(),i.globalAlpha=1}function bf(){var a,b;b=N;for(;b<v.length;b++)z[b]=="small"?a=2:z[b]=="normal"?a=3:z[b]=="large"?a=10:z[b]=="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),i.beginPath(),A[b]&&b?i.moveTo(v[b-1],w[b-1]):i.moveTo(v[b],w[b]),i.lineTo(v[b],w[b]),i.closePath(),y[b]=="eraser"?i.strokeStyle="white":i.strokeStyle=x[b],i.lineJoin="round",i.lineWidth=a,i.stroke(),N=b;D=="marker"&&c==1?i.drawImage(r,0,0,j,k):D=="eraser"&&c==1?i.drawImage(s,0,0,j,k):c?alert("Error: Current Tool is undefined"):i.drawImage(t,0,0,j-104,k),c==1&&(i.beginPath(),i.moveTo(O,P),i.lineTo(O+10,P+6),i.lineTo(O,P+11),i.lineTo(O,P),i.closePath(),i.fillStyle=p,i.fill())}if(d==1)return;var e,f,g,h=!1,i,j=590,k=332,l=25,m=8,n="#cb3594",o="#659b41",p="#0033ff",q="#000000",r=new Image,s=new Image,t=new Image,u=new Image,v=new Array,w=new Array,x=new Array,y=new Array,z=new Array,A=new Array,B=!1,C=p,D="marker",E="normal",F=1,G=1,H=481,I=330,J=65,K=38,L=4,M=0,N=0,O=521,P=65;if($("#explain_canvas_"+b+"_click_x_data").val().length>0){v=$("#explain_canvas_"+b+"_click_x_data").val(),v=v.split(","),w=$("#explain_canvas_"+b+"_click_y_data").val(),w=w.split(","),x=$("#explain_canvas_"+b+"_click_color_data").val(),x=x.split(","),y=$("#explain_canvas_"+b+"_click_tool_data").val(),y=y.split(","),z=$("#explain_canvas_"+b+"_click_size_data").val(),z=z.split(","),A=$("#explain_canvas_"+b+"_click_drag_data").val(),A=A.split(",");for(var Q=0;Q<v.length;Q++)v[Q]=parseInt(v[Q]),w[Q]=parseInt(w[Q]);for(var Q=0;Q<A.length;Q++)A[Q]=="true"?A[Q]=!0:A[Q]=!1}var S=document.getElementById(a),e=document.createElement("canvas");e.setAttribute("width",j),e.setAttribute("height",k),e.setAttribute("id","canvas_"+a),e.setAttribute("name","canvas_"+a),S.appendChild(e),typeof G_vmlCanvasManager!="undefined"&&(e=G_vmlCanvasManager.initElement(e));var i=e.getContext("2d");r.onload=function(){R()},r.src="../../../../images/canvas_drawing/marker-background.png",s.onload=function(){R()},s.src="../../../../images/canvas_drawing/eraser-background.png",t.onload=function(){R()},t.src="../../../../images/canvas_drawing/plain-background.png",u.onload=function(){R()},u.src="../../../../images/canvas_drawing/background-white.png",$("#canvas_"+a).bind("mousedown",function(a){V(a.originalEvent)}),$("#canvas_"+a).bind("mousemove",function(a){X(a.originalEvent)}),$(document.body).bind("mouseup",function(a){_()}),$("#canvas_"+a).bind("touchstart",function(a){W(a.originalEvent)}),$("#canvas_"+a).bind("touchmove",function(a){Y(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){ba()}),$(document.body).bind("touchcancel",function(a){ba()}),$("#canvas_"+a).bind("hideYerStuff",function(a){T()}),$("#canvas_"+a).bind("showYerStuff",function(a){U()})}