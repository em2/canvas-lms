function prepareCanvas(a,b,c,d){function e(){++Z>=Y&&q()}function f(){c=!1,q()}function g(){c=!0,q()}function h(a){c&&(v=!0,j(a))}function i(a){c&&(v=!1,k(a))}function j(a){c&&(t=a.pageX-s.offsetLeft,u=a.pageY-s.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-s.offsetTop+60,n(),r())}function k(a){c&&(a.preventDefault(),t=a.targetTouches[0].pageX-s.offsetLeft,u=a.targetTouches[0].pageY-s.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-s.offsetTop+60,n(),r(),v||(v=!0))}function l(){c&&(v=!1,O=!1)}function m(){c&&(v=!1,O=!1)}function n(){t>S+U+16&&u>W&&!v&&(u<W+X*2?(Q="marker",R="normal"):u<W+X*3&&(Q="eraser",R="huge")),O=!0,o()}function o(){c&&O&&(I.push(t),J.push(u),L.push(Q),K.push(P),M.push(R),N.push(v),$("#explain_canvas_"+b+"_click_x_data").val(I.toString()),$("#explain_canvas_"+b+"_click_y_data").val(J.toString()),$("#explain_canvas_"+b+"_click_color_data").val(K.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(L.toString()),$("#explain_canvas_"+b+"_click_size_data").val(M.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(N.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function p(){w.clearRect(0,0,x,y)}function q(){if(Z<Y)return;p(),Q=="marker"&&c==1?w.drawImage(F,0,0,x,y):Q=="eraser"&&c==1?w.drawImage(G,0,0,x,y):c?alert("Error: Current Tool is undefined"):w.drawImage(H,0,0,x-104,y);var a=313,b=75;c==1&&(w.beginPath(),w.moveTo(a,b),w.lineTo(a+10,b+6),w.lineTo(a,b+11),w.lineTo(a,b),w.closePath(),w.fillStyle=D,w.fill()),w.save(),w.beginPath(),w.rect(S,T,U,V),w.clip();var d,e=0;for(;e<I.length;e++)M[e]=="small"?d=2:M[e]=="normal"?d=3:M[e]=="large"?d=10:M[e]=="huge"?d=20:(alert("Error: Radius is zero for click "+e),d=0),w.beginPath(),N[e]&&e?w.moveTo(I[e-1]-15,J[e-1]-70):w.moveTo(I[e]-15,J[e]-70),w.lineTo(I[e]-15,J[e]-70),w.closePath(),L[e]=="eraser"?w.strokeStyle="white":w.strokeStyle=K[e],w.lineJoin="round",w.lineWidth=d,w.stroke(),_=e;w.restore(),w.globalAlpha=1}function r(){var a,b,d,e;b=_;for(;b<I.length;b++)M[b]=="small"?a=2:M[b]=="normal"?a=3:M[b]=="large"?a=10:M[b]=="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),w.beginPath(),N[b]&&b?w.moveTo(I[b-1]-15,J[b-1]-70):w.moveTo(I[b]-15,J[b]-70),w.lineTo(I[b]-15,J[b]-70),w.closePath(),L[b]=="eraser"?w.strokeStyle="white":w.strokeStyle=K[b],w.lineJoin="round",w.lineWidth=a,w.stroke(),_=b,Q=="marker"&&c==1?w.drawImage(F,0,0,x,y):Q=="eraser"&&c==1?w.drawImage(G,0,0,x,y):c?alert("Error: Current Tool is undefined"):w.drawImage(H,0,0,x-104,y),d=313,e=75,c==1&&(w.beginPath(),w.moveTo(d,e),w.lineTo(d+10,e+6),w.lineTo(d,e+11),w.lineTo(d,e),w.closePath(),w.fillStyle=D,w.fill())}if(d==1)return;var s,t,u,v=!1,w,x=386,y=220,z=25,A=8,B="#cb3594",C="#659b41",D="#0033ff",E="#000000",F=new Image,G=new Image,H=new Image,I=new Array,J=new Array,K=new Array,L=new Array,M=new Array,N=new Array,O=!1,P=D,Q="marker",R="normal",S=7,T=11,U=267,V=200,W=95,X=38,Y=3,Z=0,_=0;if($("#explain_canvas_"+b+"_click_x_data").val().length>0){I=$("#explain_canvas_"+b+"_click_x_data").val(),I=I.split(","),J=$("#explain_canvas_"+b+"_click_y_data").val(),J=J.split(","),K=$("#explain_canvas_"+b+"_click_color_data").val(),K=K.split(","),L=$("#explain_canvas_"+b+"_click_tool_data").val(),L=L.split(","),M=$("#explain_canvas_"+b+"_click_size_data").val(),M=M.split(","),N=$("#explain_canvas_"+b+"_click_drag_data").val(),N=N.split(",");for(var ba=0;ba<I.length;ba++)I[ba]=parseInt(I[ba]),J[ba]=parseInt(J[ba]);for(var ba=0;ba<N.length;ba++)N[ba]=="true"?N[ba]=!0:N[ba]=!1}var bb=document.getElementById(a),s=document.createElement("canvas");s.setAttribute("width",x),s.setAttribute("height",y),s.setAttribute("id","canvas_"+a),s.setAttribute("name","canvas_"+a),bb.appendChild(s),typeof G_vmlCanvasManager!="undefined"&&(s=G_vmlCanvasManager.initElement(s));var w=s.getContext("2d");F.onload=function(){e()},F.src="../../../../images/canvas_drawing/marker-background.png",G.onload=function(){e()},G.src="../../../../images/canvas_drawing/eraser-background.png",H.onload=function(){e()},H.src="../../../../images/canvas_drawing/plain-background.png",$("#canvas_"+a).bind("mousedown",function(a){h(a.originalEvent)}),$("#canvas_"+a).bind("mousemove",function(a){j(a.originalEvent)}),$(document.body).bind("mouseup",function(a){l()}),$("#canvas_"+a).bind("touchstart",function(a){i(a.originalEvent)}),$("#canvas_"+a).bind("touchmove",function(a){k(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){m()}),$(document.body).bind("touchcancel",function(a){m()}),$("#canvas_"+a).bind("hideYerStuff",function(a){f()}),$("#canvas_"+a).bind("showYerStuff",function(a){g()})}