function prepareCanvas(a,b,c,d){function O(){++L>=K&&ba()}function Q(){c=!1,ba()}function R(){c=!0,ba()}function S(a){c&&(h=!0,U(a))}function T(a){c&&(h=!1,V(a))}function U(a){c&&(f=a.pageX-e.offsetLeft,g=a.pageY-e.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-e.offsetTop+60,Y(),bb())}function V(a){c&&(a.preventDefault(),f=a.targetTouches[0].pageX-e.offsetLeft,g=a.targetTouches[0].pageY-e.parentNode.parentNode.parentNode.parentNode.parentNode.offsetTop-e.offsetTop+60,Y(),bb(),h||(h=!0))}function W(){c&&(h=!1,A=!1)}function X(){c&&(h=!1,A=!1)}function Y(){f>E+G+16&&g>I&&!h&&(g<I+J*2?(C="marker",D="normal"):g<I+J*3&&(C="eraser",D="huge")),A=!0,Z()}function Z(){c&&A&&(u.push(f),v.push(g),x.push(C),w.push(B),y.push(D),z.push(h),$("#explain_canvas_"+b+"_click_x_data").val(u.toString()),$("#explain_canvas_"+b+"_click_y_data").val(v.toString()),$("#explain_canvas_"+b+"_click_color_data").val(w.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(x.toString()),$("#explain_canvas_"+b+"_click_size_data").val(y.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(z.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function _(){i.clearRect(0,0,j,k)}function ba(){if(L<K)return;_(),C=="marker"&&c==1?i.drawImage(r,0,0,j,k):C=="eraser"&&c==1?i.drawImage(s,0,0,j,k):c?alert("Error: Current Tool is undefined"):i.drawImage(t,0,0,j-104,k);var a=313,b=75;c==1&&(i.beginPath(),i.moveTo(a,b),i.lineTo(a+10,b+6),i.lineTo(a,b+11),i.lineTo(a,b),i.closePath(),i.fillStyle=p,i.fill()),i.save(),i.beginPath(),i.rect(E,F,G,H),i.clip();var d,e=0;for(;e<u.length;e++)y[e]=="small"?d=2:y[e]=="normal"?d=3:y[e]=="large"?d=10:y[e]=="huge"?d=20:(alert("Error: Radius is zero for click "+e),d=0),i.beginPath(),z[e]&&e?i.moveTo(u[e-1]-15,v[e-1]-70):i.moveTo(u[e]-15,v[e]-70),i.lineTo(u[e]-15,v[e]-70),i.closePath(),x[e]=="eraser"?i.strokeStyle="white":i.strokeStyle=w[e],i.lineJoin="round",i.lineWidth=d,i.stroke(),M=e;i.restore(),i.globalAlpha=1}function bb(){var a,b,d,e;b=M;for(;b<u.length;b++)y[b]=="small"?a=2:y[b]=="normal"?a=3:y[b]=="large"?a=10:y[b]=="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),i.beginPath(),z[b]&&b?i.moveTo(u[b-1]-15,v[b-1]-70):i.moveTo(u[b]-15,v[b]-70),i.lineTo(u[b]-15,v[b]-70),i.closePath(),x[b]=="eraser"?i.strokeStyle="white":i.strokeStyle=w[b],i.lineJoin="round",i.lineWidth=a,i.stroke(),M=b,C=="marker"&&c==1?i.drawImage(r,0,0,j,k):C=="eraser"&&c==1?i.drawImage(s,0,0,j,k):c?alert("Error: Current Tool is undefined"):i.drawImage(t,0,0,j-104,k),d=313,e=75,c==1&&(i.beginPath(),i.moveTo(d,e),i.lineTo(d+10,e+6),i.lineTo(d,e+11),i.lineTo(d,e),i.closePath(),i.fillStyle=p,i.fill())}if(d==1)return;var e,f,g,h=!1,i,j=386,k=220,l=25,m=8,n="#cb3594",o="#659b41",p="#0033ff",q="#000000",r=new Image,s=new Image,t=new Image,u=new Array,v=new Array,w=new Array,x=new Array,y=new Array,z=new Array,A=!1,B=p,C="marker",D="normal",E=7,F=11,G=267,H=200,I=95,J=38,K=3,L=0,M=0;if($("#explain_canvas_"+b+"_click_x_data").val().length>0){u=$("#explain_canvas_"+b+"_click_x_data").val(),u=u.split(","),v=$("#explain_canvas_"+b+"_click_y_data").val(),v=v.split(","),w=$("#explain_canvas_"+b+"_click_color_data").val(),w=w.split(","),x=$("#explain_canvas_"+b+"_click_tool_data").val(),x=x.split(","),y=$("#explain_canvas_"+b+"_click_size_data").val(),y=y.split(","),z=$("#explain_canvas_"+b+"_click_drag_data").val(),z=z.split(",");for(var N=0;N<u.length;N++)u[N]=parseInt(u[N]),v[N]=parseInt(v[N]);for(var N=0;N<z.length;N++)z[N]=="true"?z[N]=!0:z[N]=!1}var P=document.getElementById(a),e=document.createElement("canvas");e.setAttribute("width",j),e.setAttribute("height",k),e.setAttribute("id","canvas_"+a),e.setAttribute("name","canvas_"+a),P.appendChild(e),typeof G_vmlCanvasManager!="undefined"&&(e=G_vmlCanvasManager.initElement(e));var i=e.getContext("2d");r.onload=function(){O()},r.src="../../../../images/canvas_drawing/marker-background.png",s.onload=function(){O()},s.src="../../../../images/canvas_drawing/eraser-background.png",t.onload=function(){O()},t.src="../../../../images/canvas_drawing/plain-background.png",$("#canvas_"+a).bind("mousedown",function(a){S(a.originalEvent)}),$("#canvas_"+a).bind("mousemove",function(a){U(a.originalEvent)}),$(document.body).bind("mouseup",function(a){W()}),$("#canvas_"+a).bind("touchstart",function(a){T(a.originalEvent)}),$("#canvas_"+a).bind("touchmove",function(a){V(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){X()}),$(document.body).bind("touchcancel",function(a){X()}),$("#canvas_"+a).bind("hideYerStuff",function(a){Q()}),$("#canvas_"+a).bind("showYerStuff",function(a){R()})}