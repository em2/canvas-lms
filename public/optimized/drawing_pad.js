function prepareCanvas(a,b,c,d){function e(){++bb>=ba&&s()}function f(){c=!1,s()}function g(){c=!0,s()}function h(a){c&&(x=!0,j(a))}function i(a){c&&(x=!1,k(a))}function j(a){if(c){var b=l(a);v=b.x,w=b.y,p(),t()}}function k(a){if(c){a.preventDefault();var b=m(a);v=b.x,w=b.y,p(),t(),x||(x=!0)}}function l(a){var b=u.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}}function m(a){var b=u.getBoundingClientRect();return{x:a.targetTouches[0].clientX-b.left,y:a.targetTouches[0].clientY-b.top}}function n(){c&&(x=!1,R=!1)}function o(){c&&(x=!1,R=!1)}function p(){v>V+X&&w>Z&&!x&&(w<Z+_?(T="marker",U="normal"):w<Z+_*2&&(T="eraser",U="huge")),R=!0,q()}function q(){c&&R&&(L.push(v),M.push(w),O.push(T),N.push(S),P.push(U),Q.push(x),$("#explain_canvas_"+b+"_click_x_data").val(L.toString()),$("#explain_canvas_"+b+"_click_y_data").val(M.toString()),$("#explain_canvas_"+b+"_click_color_data").val(N.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(O.toString()),$("#explain_canvas_"+b+"_click_size_data").val(P.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(Q.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function r(){y.clearRect(0,0,z,A)}function s(){if(bb<ba)return;r(),y.drawImage(K,0,0,z,A),T=="marker"&&c==1?y.drawImage(H,0,0,z,A):T=="eraser"&&c==1?y.drawImage(I,0,0,z,A):c?alert("Error: Current Tool is undefined"):y.drawImage(J,0,0,z-104,A),c==1&&(y.beginPath(),y.moveTo(bd,be),y.lineTo(bd+10,be+6),y.lineTo(bd,be+11),y.lineTo(bd,be),y.closePath(),y.fillStyle=F,y.fill()),y.save(),y.beginPath(),y.rect(V,W,X,Y),y.clip();var a,b=0;for(;b<L.length;b++)P[b]=="small"?a=2:P[b]=="normal"?a=3:P[b]=="large"?a=10:P[b]=="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),y.beginPath(),Q[b]&&b?y.moveTo(L[b-1],M[b-1]):y.moveTo(L[b],M[b]),y.lineTo(L[b],M[b]),y.closePath(),O[b]=="eraser"?y.strokeStyle="white":y.strokeStyle=N[b],y.lineJoin="round",y.lineWidth=a,y.stroke(),bc=b;y.restore(),y.globalAlpha=1}function t(){var a,b;b=bc;for(;b<L.length;b++)P[b]=="small"?a=2:P[b]=="normal"?a=3:P[b]=="large"?a=10:P[b]=="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),y.beginPath(),Q[b]&&b?y.moveTo(L[b-1],M[b-1]):y.moveTo(L[b],M[b]),y.lineTo(L[b],M[b]),y.closePath(),O[b]=="eraser"?y.strokeStyle="white":y.strokeStyle=N[b],y.lineJoin="round",y.lineWidth=a,y.stroke(),bc=b;T=="marker"&&c==1?y.drawImage(H,0,0,z,A):T=="eraser"&&c==1?y.drawImage(I,0,0,z,A):c?alert("Error: Current Tool is undefined"):y.drawImage(J,0,0,z-104,A),c==1&&(y.beginPath(),y.moveTo(bd,be),y.lineTo(bd+10,be+6),y.lineTo(bd,be+11),y.lineTo(bd,be),y.closePath(),y.fillStyle=F,y.fill())}if(d==1)return;var u,v,w,x=!1,y,z=590,A=332,B=25,C=8,D="#cb3594",E="#659b41",F="#0033ff",G="#000000",H=new Image,I=new Image,J=new Image,K=new Image,L=new Array,M=new Array,N=new Array,O=new Array,P=new Array,Q=new Array,R=!1,S=F,T="marker",U="normal",V=1,W=1,X=481,Y=330,Z=65,_=38,ba=4,bb=0,bc=0,bd=521,be=65;if($("#explain_canvas_"+b+"_click_x_data").val().length>0){L=$("#explain_canvas_"+b+"_click_x_data").val(),L=L.split(","),M=$("#explain_canvas_"+b+"_click_y_data").val(),M=M.split(","),N=$("#explain_canvas_"+b+"_click_color_data").val(),N=N.split(","),O=$("#explain_canvas_"+b+"_click_tool_data").val(),O=O.split(","),P=$("#explain_canvas_"+b+"_click_size_data").val(),P=P.split(","),Q=$("#explain_canvas_"+b+"_click_drag_data").val(),Q=Q.split(",");for(var bf=0;bf<L.length;bf++)L[bf]=parseInt(L[bf]),M[bf]=parseInt(M[bf]);for(var bf=0;bf<Q.length;bf++)Q[bf]=="true"?Q[bf]=!0:Q[bf]=!1}var bg=document.getElementById(a),u=document.createElement("canvas");u.setAttribute("width",z),u.setAttribute("height",A),u.setAttribute("id","canvas_"+a),u.setAttribute("name","canvas_"+a),bg.appendChild(u),typeof G_vmlCanvasManager!="undefined"&&(u=G_vmlCanvasManager.initElement(u));var y=u.getContext("2d");H.onload=function(){e()},H.src="../../../../images/canvas_drawing/marker-background.png",I.onload=function(){e()},I.src="../../../../images/canvas_drawing/eraser-background.png",J.onload=function(){e()},J.src="../../../../images/canvas_drawing/plain-background.png",K.onload=function(){e()},K.src="../../../../images/canvas_drawing/background-white.png",$("#canvas_"+a).bind("mousedown",function(a){h(a.originalEvent)}),$("#canvas_"+a).bind("mousemove",function(a){j(a.originalEvent)}),$(document.body).bind("mouseup",function(a){n()}),$("#canvas_"+a).bind("touchstart",function(a){i(a.originalEvent)}),$("#canvas_"+a).bind("touchmove",function(a){k(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){o()}),$(document.body).bind("touchcancel",function(a){o()}),$("#canvas_"+a).bind("hideYerStuff",function(a){f()}),$("#canvas_"+a).bind("showYerStuff",function(a){g()})}