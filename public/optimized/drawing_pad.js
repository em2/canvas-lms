function prepareCanvas(a,b,c,d){function e(a,b){var c,d,e;c=0,d=0;for(e in a)d++;for(e in a)J[e]=new Image,J[e].onload=function(){if(++c>=d)return b()},J[e].src=a[e]}function f(){c=!1,s()}function g(){c=!0,s()}function h(a){c&&(x=!0,j(a))}function i(a){c&&(x=!1,k(a))}function j(a){if(c){var b=l(a);v=b.x,w=b.y,p(),t()}}function k(a){if(c){a.preventDefault();var b=m(a);v=b.x,w=b.y,p(),t(),x||(x=!0)}}function l(a){var b=u.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}}function m(a){var b=u.getBoundingClientRect();return{x:a.targetTouches[0].clientX-b.left,y:a.targetTouches[0].clientY-b.top}}function n(){c&&(x=!1,Q=!1)}function o(){c&&(x=!1,Q=!1)}function p(){v>U+W&&w>Y&&!x&&(w<Y+Z?(S="marker1",T="normal",R=G):w<Y+Z*2?(S="marker2",T="normal",R=F):w<Y+Z*3&&(S="eraser",T="huge",R=H)),Q=!0,q()}function q(){c&&Q&&(K.push(v),L.push(w),N.push(S),M.push(R),O.push(T),P.push(x),$("#explain_canvas_"+b+"_click_x_data").val(K.toString()),$("#explain_canvas_"+b+"_click_y_data").val(L.toString()),$("#explain_canvas_"+b+"_click_color_data").val(M.toString()),$("#explain_canvas_"+b+"_click_tool_data").val(N.toString()),$("#explain_canvas_"+b+"_click_size_data").val(O.toString()),$("#explain_canvas_"+b+"_click_drag_data").val(P.toString()),$("#explain_canvas_"+b+"_click_x_data").change())}function r(){y.clearRect(0,0,z,A)}function s(){r(),y.drawImage(J.whiteBackgroundImage,0,0,z,A),S==="marker1"&&c===!0?y.drawImage(J.marker1BackgroundImage,0,0,z,A):S!=="marker2"&&S!=="marker"||c!==!0?S==="eraser"&&c===!0?y.drawImage(J.eraserBackgroundImage,0,0,z,A):c?alert("Error: Current Tool is undefined"):y.drawImage(J.plainBackgroungImage,0,0,z-104,A):y.drawImage(J.marker2BackgroundImage,0,0,z,A),c===!0&&(y.beginPath(),y.moveTo(bb,bc),y.lineTo(bb+10,bc+6),y.lineTo(bb,bc+11),y.lineTo(bb,bc),y.closePath(),y.fillStyle=G,y.fill(),y.beginPath(),y.moveTo(bb,bd),y.lineTo(bb+10,bd+6),y.lineTo(bb,bd+11),y.lineTo(bb,bd),y.closePath(),y.fillStyle=F,y.fill()),y.save(),y.beginPath(),y.rect(U,V,W,X),y.clip();var a,b=0;for(;b<K.length;b++)O[b]==="small"?a=2:O[b]==="normal"?a=3:O[b]==="large"?a=10:O[b]==="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),y.beginPath(),P[b]&&b?y.moveTo(K[b-1],L[b-1]):y.moveTo(K[b],L[b]),y.lineTo(K[b],L[b]),y.closePath(),N[b]==="eraser"?y.strokeStyle=H:y.strokeStyle=M[b],y.lineJoin="round",y.lineWidth=a,y.stroke(),ba=b;y.restore(),y.globalAlpha=1}function t(){var a,b;b=ba;for(;b<K.length;b++)O[b]==="small"?a=2:O[b]==="normal"?a=3:O[b]==="large"?a=10:O[b]==="huge"?a=20:(alert("Error: Radius is zero for click "+b),a=0),y.beginPath(),P[b]&&b?y.moveTo(K[b-1],L[b-1]):y.moveTo(K[b],L[b]),y.lineTo(K[b],L[b]),y.closePath(),N[b]==="eraser"?y.strokeStyle=H:y.strokeStyle=M[b],y.lineJoin="round",y.lineWidth=a,y.stroke(),ba=b;S==="marker1"&&c===!0?y.drawImage(J.marker1BackgroundImage,0,0,z,A):S!=="marker2"&&S!=="marker"||c!==!0?S==="eraser"&&c===!0?y.drawImage(J.eraserBackgroundImage,0,0,z,A):c?alert("Error: Current Tool is undefined"):y.drawImage(J.plainBackgroungImage,0,0,z-104,A):y.drawImage(J.marker2BackgroundImage,0,0,z,A),c===!0&&(y.beginPath(),y.moveTo(bb,bc),y.lineTo(bb+10,bc+6),y.lineTo(bb,bc+11),y.lineTo(bb,bc),y.closePath(),y.fillStyle=G,y.fill(),y.beginPath(),y.moveTo(bb,bd),y.lineTo(bb+10,bd+6),y.lineTo(bb,bd+11),y.lineTo(bb,bd),y.closePath(),y.fillStyle=F,y.fill())}if(d===!0)return;var u,v,w,x=!1,y,z=590,A=332,B=25,C=8,D="#cb3594",E="#659b41",F="#0033ff",G="#000000",H="#FFFFFF",I={},J={},K=new Array,L=new Array,M=new Array,N=new Array,O=new Array,P=new Array,Q=!1,R=F,S="marker2",T="normal",U=1,V=1,W=481,X=330,Y=30,Z=38,_=0,ba=0,bb=521,bc=44,bd=83;if($("#explain_canvas_"+b+"_click_x_data").val().length>0){K=$("#explain_canvas_"+b+"_click_x_data").val(),K=K.split(","),L=$("#explain_canvas_"+b+"_click_y_data").val(),L=L.split(","),M=$("#explain_canvas_"+b+"_click_color_data").val(),M=M.split(","),N=$("#explain_canvas_"+b+"_click_tool_data").val(),N=N.split(","),O=$("#explain_canvas_"+b+"_click_size_data").val(),O=O.split(","),P=$("#explain_canvas_"+b+"_click_drag_data").val(),P=P.split(",");for(var be=0;be<K.length;be++)K[be]=parseInt(K[be]),L[be]=parseInt(L[be]);for(var be=0;be<P.length;be++)P[be]==="true"?P[be]=!0:P[be]=!1}var bf=document.getElementById(a),u=document.createElement("canvas");u.setAttribute("width",z),u.setAttribute("height",A),u.setAttribute("id","canvas_"+a),u.setAttribute("name","canvas_"+a),bf.appendChild(u),typeof G_vmlCanvasManager!="undefined"&&(u=G_vmlCanvasManager.initElement(u));var y=u.getContext("2d");return I={marker1BackgroundImage:"../../../../images/canvas_drawing/marker1-background.png",marker2BackgroundImage:"../../../../images/canvas_drawing/marker2-background.png",eraserBackgroundImage:"../../../../images/canvas_drawing/eraser-background.png",plainBackgroungImage:"../../../../images/canvas_drawing/plain-background.png",whiteBackgroundImage:"../../../../images/canvas_drawing/background-white.png"},$("#canvas_"+a).bind("mousedown",function(a){h(a.originalEvent)}),$("#canvas_"+a).bind("mousemove",function(a){j(a.originalEvent)}),$(document.body).bind("mouseup",function(a){n()}),$("#canvas_"+a).bind("touchstart",function(a){i(a.originalEvent)}),$("#canvas_"+a).bind("touchmove",function(a){k(a.originalEvent)}),$("#canvas_"+a).bind("touchend",function(a){o()}),$(document.body).bind("touchcancel",function(a){o()}),$("#canvas_"+a).bind("hideYerStuff",function(a){f()}),$("#canvas_"+a).bind("showYerStuff",function(a){g()}),e(I,s)}