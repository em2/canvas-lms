(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["jquery","use!underscore","i18n!calendar.edit","compiled/backbone-ext/Backbone","jst/calendar/editCalendarEventFull","wikiSidebar","compiled/object/unflatten","tinymce.editor_box","compiled/tinymce"],function(b,d,e,f,g,h,i){var j;return j=function(){function j(){this.toggleUseSectionDates=a(this.toggleUseSectionDates,this),this.toggleUsingSectionClass=a(this.toggleUsingSectionClass,this),this.destroyModel=a(this.destroyModel,this),this.render=a(this.render,this),j.__super__.constructor.apply(this,arguments)}return c(j,f.View),j.prototype.el=b("#content"),j.prototype.template=g,j.prototype.events={"submit form":"submit",'change [name="use_section_dates"]':"toggleUseSectionDates","click .delete_link":"destroyModel"},j.prototype.initialize=function(){return this.model.fetch().done(a(function(){var a,b;return ENV.NEW_CALENDAR_EVENT_ATTRIBUTES&&(a=this.model.parse(ENV.NEW_CALENDAR_EVENT_ATTRIBUTES),a.all_day=((b=a.start_at)!=null?!!b.equals(a.end_at):!!void 0)&&a.start_at.equals(a.start_at.clearTime()),this.model.set(a)),this.render()},this)),this.model.on("change:use_section_dates",this.toggleUsingSectionClass)},j.prototype.render=function(){var a;return this.$el.html(this.template(this.model.toJSON("forView"))),this.$(".date_field").date_field(),this.$(".time_field").time_field(),a=this.$("textarea").editorBox(),h.inited||h.init(),h.attachToEditor(a).show(),this},j.prototype.destroyModel=function(){var b;b=e.t("confirm_delete_calendar_event","Are you sure you want to delete this calendar event?");if(confirm(b))return this.$el.disableWhileLoading(this.model.destroy({success:a(function(){return this.redirectWithMessage(e.t("event_deleted","%{event_title} deleted successfully",{event_title:this.model.get("title")}))},this)}))},j.prototype.toggleUsingSectionClass=function(){return this.$("#editCalendarEventFull").toggleClass("use_section_dates",this.model.get("use_section_dates"))},j.prototype.toggleUseSectionDates=function(){return this.model.set("use_section_dates",!this.model.get("use_section_dates"))},j.prototype.redirectWithMessage=function(a){b.flashMessage(a);if(this.model.get("return_to_url"))return window.location=this.model.get("return_to_url")},j.prototype.submit=function(b){var c;return b!=null&&b.preventDefault(),c=i(this.$el.getFormData()),c.use_section_dates=!!c.use_section_dates,d.each([c].concat(c.child_event_data),this.setStartEnd),this.$el.disableWhileLoading(this.model.save(c,{success:a(function(){return this.redirectWithMessage(e.t("event_saved","Event Saved Successfully"))},this)}))},j.prototype.setStartEnd=function(a){if(!a)return;return a.start_at=Date.parse(a.start_date+" "+a.start_time),a.end_at=Date.parse(a.start_date+" "+a.end_time)},j}()})}).call(this)