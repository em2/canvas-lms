(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};define(["jquery","jst/calendar/contextList","jst/calendar/undatedEvents","compiled/calendar/commonEventFactory","compiled/calendar/EditEventDetailsDialog","compiled/calendar/EventDataSource","compiled/jquery.kylemenu","jquery.instructure_misc_helpers","vendor/jquery.ba-tinypubsub","vendor/jquery.store"],function(c,d,e,f,g,h){var i,j;return i=function(){function d(b,d,e){var f,g,h;this.$holder=e,this.restoreList=a(this.restoreList,this),this.saveAndClear=a(this.saveAndClear,this),g=function(){try{return c.parseJSON(c.decodeFromHex(location.hash.substring(1)))||{}}catch(a){return{}}}(),h=c.store.userGet("checked_calendar_codes"),g.show&&(this.contexts=g.show.split(",")),d&&(this.contexts||(this.contexts=d)),h&&(this.contexts||(this.contexts=h.split(","))),this.contexts||(this.contexts=function(){var a,c,d,e;d=b.slice(0,10),e=[];for(a=0,c=d.length;a<c;a++)f=d[a],e.push(f.asset_string);return e}()),this.notify(),c.subscribe("Calendar/saveVisibleContextListAndClear",this.saveAndClear),c.subscribe("Calendar/restoreVisibleContextList",this.restoreList)}return d.prototype.saveAndClear=function(){if(!this.savedContexts)return this.savedContexts=this.contexts,this.contexts=[],this.notify()},d.prototype.restoreList=function(){if(this.savedContexts)return this.contexts=this.savedContexts,this.savedContexts=null,this.notify()},d.prototype.toggle=function(a){var b;return b=c.inArray(a,this.contexts),b<0?(this.contexts.push(a),this.contexts.length>10&&this.contexts.shift):this.contexts.splice(b,1),this.notify()},d.prototype.notify=function(){return c.publish("Calendar/visibleContextListChanged",[this.contexts]),this.$holder.find(".context_list_context").each(a(function(a,d){var e,f,g;return e=c(d),f=(g=e.data("context"),b.call(this.contexts,g)>=0),e.toggleClass("checked",f).toggleClass("not-checked",!f)},this))},d}(),j=function(a,b,e){var h,j,k,l,m;for(l=0,m=a.length;l<m;l++)j=a[l],j.can_create_stuff=j.can_create_calendar_events||j.can_create_assignments;return h=c("#context-list-holder"),h.html(d({contexts:a})),k=new i(a,b,h),h.find(".settings").kyleMenu({buttonOpts:{icons:{primary:"ui-icon-cog-with-droparrow",secondary:null}}}),h.delegate(".context_list_context","click",function(a){if(!c(a.target).closest(".settings, .actions").length)return k.toggle(c(this).data("context"))}),h.delegate(".context_list_context",{"mouseenter mouseleave":function(a){var b;return b=a.type!=="mouseleave"||!!c(this).find(".ui-menu:visible").length,c(this).toggleClass("hovering",b)},"popupopen popupclose":function(a){var b;return b=a.type==="popupopen",c(this).toggleClass("hovering",b).find(".settings").toggleClass("ui-state-active",b)}}),h.delegate(".actions a","click",function(){var b,d,e;d=c(this).parents("li[data-context]").data("context"),b=c(this).data("action");if(b==="add_event"||b==="add_assignment"){e=f(null,a),(new g(e)).show(),c('select[class="context_id"]').val(d);if(b==="add_assignment")return c('a[href="#edit_assignment_form"]').click()}})}})}).call(this)