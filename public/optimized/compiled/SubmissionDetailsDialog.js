(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","jst/SubmissionDetailsDialog","jst/_submission_detail","jquery.ajaxJSON","jquery.disableWhileLoading","jquery.instructure_forms","jquery.instructure_jquery_patches","jquery.instructure_misc_plugins","vendor/jquery.scrollTo"],function(b,c){var d;return d=function(){function d(d,e,f){var g;this.assignment=d,this.student=e,this.options=f,this.update=a(this.update,this),this.scrollCommentsToBottom=a(this.scrollCommentsToBottom,this),this.open=a(this.open,this),this.url=this.options.change_grade_url.replace(":assignment",this.assignment.id).replace(":submission",this.student.id),this.submission=b.extend({},this.student["assignment_"+this.assignment.id],{assignment:this.assignment,speedGraderUrl:""+this.options.context_url+"/gradebook/speed_grader?assignment_id="+this.assignment.id+"#%7B%22student_id%22%3A"+this.student.id+"%7D",loading:!0}),this.dialog=b('<div class="use-css-transitions-for-show-hide" style="padding:0;"/>'),this.dialog.html(c(this.submission)).dialog({title:this.student.name,width:600,resizable:!1,open:this.scrollCommentsToBottom}).delegate("select","change",a(function(a){return this.dialog.find(".submission_detail").each(function(c){return b(this).showIf(c===a.currentTarget.selectedIndex)})},this)).delegate(".submission_details_add_comment_form","submit",a(function(c){return c.preventDefault(),b(c.currentTarget).disableWhileLoading(b.ajaxJSON(this.url,"PUT",b(c.currentTarget).getFormData(),a(function(b){return this.update(b),setTimeout(a(function(){return this.dialog.dialog("close")},this),500)},this)))},this)),g=b.ajaxJSON(this.url+"?include[]=submission_history&include[]=submission_comments&include[]=rubric_assessment","GET",{},this.update),this.dialog.find(".submission_details_comments").disableWhileLoading(g)}return d.prototype.open=function(){return this.dialog.dialog("open")},d.prototype.scrollCommentsToBottom=function(){return this.dialog.find(".submission_details_comments").scrollTop(999999)},d.prototype.update=function(a){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;b.extend(this.submission,a),this.submission.submission_history[0]=this.submission,this.submission.moreThanOneSubmission=this.submission.submission_history.length>1,this.submission.loading=!1,o=this.submission.submission_history;for(i=0,l=o.length;i<l;i++){f=o[i],f["submission_type_is"+f.submission_type]=!0,f.submissionWasLate=this.assignment.due_at&&new Date(this.assignment.due_at)>new Date(f.submitted_at),p=f.submission_comments||[];for(j=0,m=p.length;j<m;j++)e=p[j],e.url=""+this.options.context_url+"/users/"+e.author_id,h=""+location.protocol+"//"+location.host,e.image_url=""+h+"/images/users/"+e.author_id+"?fallback="+encodeURIComponent(h+"/images/messages/avatar-50.png");q=f.attachments||[];for(k=0,n=q.length;k<n;k++){d=q[k];if(g=(r=f.turnitin_data)!=null?r["attachment_"+d.id]:void 0)d.turnitinUrl=""+this.options.context_url+"/assignments/"+this.assignment.id+"/submissions/"+this.student.id+"/turnitin/attachment_"+d.id,d.turnitin_data=g}}return this.dialog.html(c(this.submission)),this.dialog.find("select").trigger("change"),this.scrollCommentsToBottom()},d.cachedDialogs={},d.open=function(a,b,c){var e,f;return((e=d.cachedDialogs)[f=""+a.id+"-"+b.id]||(e[f]=new d(a,b,c))).open()},d}()})}).call(this)