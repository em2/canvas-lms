(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["compiled/gradebook2/GRADEBOOK_TRANSLATIONS","jquery","jquery.ajaxJSON"],function(b,d){var e;return e=function(){function c(a){this.opts=a,this.init()}return c.prototype.init=function(){var a;return a=this.opts.item[this.opts.column.field],this.$wrapper=d(this.cellWrapper('<input class="grade"/>')).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},c.prototype.destroy=function(){return this.$input.remove()},c.prototype.focus=function(){return this.$input.focus()},c.prototype.loadValue=function(){return this.val=this.opts.item[this.opts.column.field].grade||"",this.$input.val(this.val),this.$input[0].defaultValue=this.val,this.$input.select()},c.prototype.serializeValue=function(){return this.$input.val()},c.prototype.applyValue=function(a,b){var c;return a[this.opts.column.field].grade=b,(c=this.wrapper)!=null&&c.remove(),this.postValue(a,b)},c.prototype.postValue=function(b,c){var e,f;return e=b[this.opts.column.field],f=this.opts.grid.getOptions().change_grade_url,f=f.replace(":assignment",e.assignment_id).replace(":submission",e.user_id),d.ajaxJSON(f,"PUT",{"submission[posted_grade]":c},a(function(a){return d.publish("submissions_updated",[[a]])},this))},c.prototype.isValueChanged=function(){return this.val!==this.$input.val()},c.prototype.validate=function(){return{valid:!0,msg:null}},c.formatter=function(a,b,c,d){return this.prototype.cellWrapper(c.grade,{submission:c,assignment:d,editable:!1})},c.prototype.cellWrapper=function(a,e){var f,g,h,i;return e==null&&(e={}),f=d.extend({},{innerContents:"",classes:"",editable:!0},e),f.submission||(f.submission=this.opts.item[this.opts.column.field]),f.assignment||(f.assignment=this.opts.column.object),g=c.classesBasedOnSubmission(f.submission,f.assignment),h=d.map(g,function(a){return b["submission_tooltip_"+a]}).join(", "),f.submission.grade||(f.classes+=" no_grade_yet "),a==null&&(a=((i=f.submission)!=null?i.submission_type:void 0)?'<span class="submission_type_icon" />':"-"),""+(h?'<div class="gradebook-tooltip">'+h+"</div>":"")+'\n<div class="gradebook-cell '+(f.editable?"gradebook-cell-editable focus":"")+" "+f.classes+" "+g.join(" ")+'">\n  <a href="#" data-user-id='+f.submission.user_id+" data-assignment-id="+f.assignment.id+' class="gradebook-cell-comment"><span class="gradebook-cell-comment-label">submission comments</span></a>\n  '+a+"\n</div>"},c.classesBasedOnSubmission=function(a,b){var c;return a==null&&(a={}),b==null&&(b={}),c=[],a.grade_matches_current_submission===!1&&c.push("resubmitted"),b.due_at&&a.submitted_at&&a.submitted_at.timestamp>b.due_at.timestamp&&c.push("late"),a.drop&&c.push("dropped"),""+b.submission_types=="not_graded"&&c.push("ungraded"),b.muted&&c.push("muted"),a.submission_type&&c.push(a.submission_type),c},c}(),e.out_of=function(){function a(){a.__super__.constructor.apply(this,arguments)}return c(a,e),a.prototype.init=function(){var a;return a=this.opts.item[this.opts.column.field],this.$wrapper=d(this.cellWrapper('<div class="overflow-wrapper">\n  <div class="grade-and-outof-wrapper">\n    <input type="number" class="grade"/><span class="outof"><span class="divider">/</span>'+this.opts.column.object.points_possible+"</span>\n  </div>\n</div>",{classes:"gradebook-cell-out-of-formatter"})).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},a}(),e.letter_grade=function(){function a(){a.__super__.constructor.apply(this,arguments)}return c(a,e),a.formatter=function(a,b,c,d){var f;return f=c.score?""+c.grade+"<span class='letter-grade-points'>"+c.score+"</span>":c.grade,e.prototype.cellWrapper(f,{submission:c,assignment:d,editable:!1})},a}(),e.pass_fail=function(){function g(){g.__super__.constructor.apply(this,arguments)}var b,f;return c(g,e),f=["pass","fail",""],b=function(a){return{pass:"pass",complete:"pass",fail:"fail",incomplete:"fail"}[a.grade]||""},g.prototype.htmlFromSubmission=function(a){var c;return a==null&&(a={}),c=b(a.submission),e.prototype.cellWrapper('<a data-value="'+c+'" class="gradebook-checkbox gradebook-checkbox-'+c+" "+(a.editable?"editable":void 0)+'" href="#">'+c+"</a>",a)},g.formatter=function(a,b,c,d){return c.grade==null?e.formatter.apply(this,arguments):g.prototype.htmlFromSubmission({submission:c,assignment:d,editable:!1})},g.prototype.init=function(){return this.$wrapper=d(this.cellWrapper()),this.$wrapper=d(this.htmlFromSubmission({submission:this.opts.item[this.opts.column.field],assignment:this.opts.column.object,editable:!0})).appendTo(this.opts.container),this.$input=this.$wrapper.find(".gradebook-checkbox").bind("click keypress",a(function(a){var b,c;return a.preventDefault(),b=this.$input.data("value"),b==="pass"?c="fail":b==="fail"?c="":c="pass",this.transitionValue(c)},this)).focus()},g.prototype.destroy=function(){return this.$wrapper.remove()},g.prototype.transitionValue=function(a){return this.$input.removeClass("gradebook-checkbox-pass gradebook-checkbox-fail").addClass("gradebook-checkbox-"+b({grade:a})).data("value",a)},g.prototype.loadValue=function(){return this.val=this.opts.item[this.opts.column.field].grade||""},g.prototype.serializeValue=function(){return this.$input.data("value")},g.prototype.isValueChanged=function(){return this.val!==this.$input.data("value")},g}(),e.points=function(){function a(){a.__super__.constructor.apply(this,arguments)}return c(a,e),a}(),e})}).call(this)