(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["require","i18n!discussions.entry","compiled/backbone-ext/Backbone","compiled/discussions/EntryCollection","jst/discussions/_entry_content","jst/discussions/_deleted_entry","jst/discussions/entry_with_replies","compiled/discussions/Reply","compiled/discussions/EntryEditor","compiled/discussions/MarkAsReadWatcher","str/htmlEscape","vendor/jquery.ba-tinypubsub","compiled/jquery.kylemenu","jst/_avatar","jst/discussions/_reply_form"],function(b,d,e,f,g,h,i,j,k,l,m,n){var o,p,q;return q=n.publish,p=function(){},o=function(){function b(){this.onReadState=a(this.onReadState,this),this.onCollapsedView=a(this.onCollapsedView,this),b.__super__.constructor.apply(this,arguments)}return c(b,e.View),b.instances=[],b.prototype.tagName="li",b.prototype.className="entry",b.prototype.initialize=function(){var c;return b.__super__.initialize.apply(this,arguments),c=this.model.get("id"),b.instances[c]=this,this.model.bind("change:id",a(function(a,b){return this.$el.attr("data-id",b)},this)),this.model.bind("change:collapsedView",this.onCollapsedView),this.model.bind("change:read_state",this.onReadState),this.render(),this.model.bind("change:deleted",a(function(a,b){return this.$(".discussion_entry:first").toggleClass("deleted-discussion-entry",b)},this)),this.model.get("deleted")&&this.$(".discussion_entry:first").addClass("deleted-discussion-entry"),this.toggleCollapsedClass(),this.createReplies()},b.prototype.onCollapsedView=function(a,b){var c;this.toggleCollapsedClass();if(this.model.get("hideRepliesOnCollapse"))return c=this.$(".replies, .add-side-comment-wrap"),b?c.hide():c.show()},b.prototype.onReadState=function(a,b){var c;return b==="unread"&&(c=this.markAsReadWatcher)==null&&(this.markAsReadWatcher=new l(this)),this.$("article:first").toggleClass("unread",b==="unread")},b.prototype.fetchFullEntry=function(){return this.model.set("message",d.t("loading","loading...")),this.model.fetch()},b.prototype.toggleCollapsedClass=function(){var a;return a=this.model.get("collapsedView"),this.$el.children(".discussion_entry").toggleClass("collapsed",!!a).toggleClass("expanded",!a)},b.prototype.render=function(){return this.$el.html(i(this.model.toJSON())),this.$el.attr("data-id",this.model.get("id")),this.$el.attr("id",this.model.cid),q("userContent/change"),b.__super__.render.apply(this,arguments)},b.prototype.openMenu=function(a,b){return this.$menu||this.createMenu(b),this.$menu.popup("open"),!1},b.prototype.createMenu=function(b){return b.kyleMenu({appendMenuTo:"body",buttonOpts:{icons:{primary:null,secondary:null}}}),this.$menu=b.data("kyleMenu"),this.$menu.delegate("[data-event]","click",a(function(a){var c;return a.preventDefault(),b=$(a.currentTarget),c=b.data("event"),this[c](a,b)},this))},b.prototype.createReplies=function(){},b.prototype.remove=function(){var a;return this.model.set("collapsedView",!0),a=h(this.model.toJSON()),this.$(".entry_content:first").html(a),this.model.destroy()},b.prototype.edit=function(){var a;return(a=this.editor)==null&&(this.editor=new k(this)),this.editor.edit(),!1},b.prototype.toggleCollapsed=function(a,b){return this.model.set("collapsedView",!this.model.get("collapsedView"))},b.prototype.addReply=function(a,b){var c;return a.preventDefault(),(c=this.reply)==null&&(this.reply=new j(this)),this.model.set("notification",""),this.reply.edit()},b.prototype.addReplyAttachment=function(a,b){return a.preventDefault(),this.reply.addAttachment(b)},b.prototype.removeReplyAttachment=function(a,b){return a.preventDefault(),this.reply.removeAttachment(b)},b.prototype.goToReply=function(a,b){},b}(),b(["compiled/discussions/EntryCollectionView"],function(b){return o.prototype.createReplies=function(){var c,d;return c=this.$el.find(".replies"),this.collection=new f,this.view=new b({$el:c,collection:this.collection}),d=this.model.get("replies"),_.each(d,a(function(a){return a.parent_cid=this.model.cid},this)),this.collection.reset(this.model.get("replies"))}}),o})}).call(this)