(function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define(["jquery","use!underscore","compiled/backbone-ext/Backbone","compiled/util/backbone.multipart.sync","jquery.ajaxJSON"],function(a,c,d){var e;return e=function(){function e(){e.__super__.constructor.apply(this,arguments)}return b(e,d.Model),e.prototype.defaults={id:null,parent_id:null,message:null,user_id:null,read_state:"read",created_at:null,updated_at:null,deleted:!1,attachment:null,replies:[],parent_cid:null,collapsedView:!1,canAttach:ENV.DISCUSSION.PERMISSIONS.CAN_ATTACH,focused:!1},e.prototype.computedAttributes=["author","editor","canModerate","allowsSideComments","hideRepliesOnCollapse","speedgraderUrl",{name:"canReply",deps:["parent_id"]},{name:"summary",deps:["message"]}],e.prototype.read=function(){return""+ENV.DISCUSSION.ENTRY_ROOT_URL+"?ids[]="+this.get("id")},e.prototype.create=function(){var a;return a=this.get("parent_id"),a===null?ENV.DISCUSSION.ROOT_REPLY_URL:ENV.DISCUSSION.REPLY_URL.replace(/:entry_id/,a)},e.prototype["delete"]=function(){return ENV.DISCUSSION.DELETE_URL.replace(/:id/,this.get("id"))},e.prototype.update=function(){return ENV.DISCUSSION.DELETE_URL.replace(/:id/,this.get("id"))},e.prototype.sync=function(a,b,c){return c==null&&(c={}),c.url=this[a](),d.sync(a,this,c)},e.prototype.parse=function(a){return c.isArray(a)?a[0]:a},e.prototype.author=function(){var a,b;return this.get("deleted")?{}:(a=this.get("user_id"),a===ENV.DISCUSSION.CURRENT_USER.id?ENV.DISCUSSION.CURRENT_USER:(b=DISCUSSION.participants.get(a))!=null?b.toJSON():void 0)},e.prototype.canModerate=function(){var a;return a=this.get("user_id")===ENV.DISCUSSION.CURRENT_USER.id,a||ENV.DISCUSSION.PERMISSIONS.MODERATE},e.prototype.canReply=function(){return ENV.DISCUSSION.PERMISSIONS.CAN_REPLY?ENV.DISCUSSION.THREADED?!0:!1:!1},e.prototype.editor=function(){var a,b;a=this.get("editor_id");if(!a)return;return(b=DISCUSSION.participants.get(a))!=null?b.toJSON():void 0},e.prototype.speedgraderUrl=function(){if(ENV.DISCUSSION.SPEEDGRADER_URL_TEMPLATE)return ENV.DISCUSSION.SPEEDGRADER_URL_TEMPLATE.replace(/%22%3Astudent_id%22/,this.get("user_id"))},e.prototype.summary=function(){return this.escapeDiv||(this.escapeDiv=a("<div/>")),this.escapeDiv.html(this.get("message")).text()},e.prototype.allowsSideComments=function(){var a;return a=this.get("deleted"),!ENV.DISCUSSION.THREADED&&ENV.DISCUSSION.PERMISSIONS.CAN_REPLY&&this.get("parent_id")===null&&!a},e.prototype.hideRepliesOnCollapse=function(){return!ENV.DISCUSSION.THREADED&&this.get("parent_id")===null},e.prototype.markAsRead=function(){var b;return this.set("read_state","read"),b=ENV.DISCUSSION.MARK_READ_URL.replace(/:id/,this.get("id")),a.ajaxJSON(b,"PUT")},e}()})}).call(this)